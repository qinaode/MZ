function baseTree(){this.tree=null,this.folderPre=null,this.folderNow=null,this.fileList=null,this.isFolderChanged=!1,this.getItemHtml=function(e){return e[0].toLowerCase()=="folder"?'<span class="folder-icon-closed">&nbsp;</span><span title="'+e[2]+'">'+e[2].subByte(30,"...")+"</span>":""}}function fileTree(){baseTree.call(this)}function jsonpcallbackFunc(e){yunpan.ytree.tree_loading_handler(e,yunpan.ytree)}function sfileTofileTree(){baseTree.call(this)}function sfileTree(){baseTree.call(this)}(function(){function x(t){return e(this,t,1),this.lazyRender||this.render(),this}function T(t){return e(this,t,1),this.lazyRender||this.render(),this}function N(t){return e(this,t,1),this.lazyRender||this.render(),this}var e=QW.ObjectH.mix,t=QW.ArrayH.remove,n=QW.StringH.format,r=QW.Browser.ie6,i=QW.DomU,s=i.createElement,o=i.getDocRect,u=QW.NodeH,a=QW.EventTargetH.addEventListener,f=QW.EventTargetH.removeEventListener,l=u.fire,c=u.hide,h=u.setStyle,p=u.getXY,d=function(e,t,n,r,s){var o=i.getDocRect();r==null&&(r=(o.width-t)/2+o.scrollX),r=Math.max(Math.min(r,o.scrollX+o.width-t),o.scrollX),s==null&&(s=(o.height-n)/2+o.scrollY),s=Math.max(Math.min(s,o.scrollY+o.height-n),o.scrollY),u.setXY(e,r,s)},v=u.contains,m=u.removeNode,g=QW.EventH,y=g.getTarget,b=g.getKeyCode,w=g.preventDefault,E=QW.CustEvent,S={VERSION:"0.0.1"};(function(){function v(){var e=s("div",{className:"mask",tabIndex:-1,unselectable:"on"});return document.body.insertBefore(e,document.body.firstChild),e}function g(){var e=u.offsetParent,t=document.documentElement,n=u.style;if(parseInt(n.top)!=e.scrollTop||parseInt(n.left)!=e.scrollLeft)n.top=e.scrollTop,n.left=e.scrollLeft;t.clientHeight!=u.offsetHeight&&(n.height=t.clientHeight),t.clientWidth!=u.offsetWidth&&(n.width=t.clientWidth)}function y(e){e.keyEsc&&(f(document,"keydown",S.keydownHdl),a(document,"keydown",S.keydownHdl))}var n=100,i=[],u,l=0;e(S,{showPanel:function(e,s,a,f,c,m){e._rendered&&e.render(),t(i,e),i.push(e);var b=e.oWrap.style;e.isVisible?b.zIndex!=n&&(b.zIndex=n+=2):b.zIndex=n+=2,e.withMask&&(u=u||v(),h(u,{zIndex:n-1,display:"block"}),r&&(g(u),clearInterval(l),l=setInterval(g,1e3))),f!=null&&(b.width=f+"px"),c!=null&&(b.height=c+"px");if(e.posCenter){var w=S.getWrapSize(e);d(e.oWrap,w[0],w[1],s,a)}else{s=s||0,a=a||0;if(m){var E=p(m);s+=E[0],a+=E[1]}if(e.posAdjust){var w=S.getWrapSize(e),x=o();s=Math.min(s,x.scrollX+x.width-w[0]),s=Math.max(s,x.scrollX),a=Math.min(a,x.scrollY+x.height-w[1]),a=Math.max(a,x.scrollY)}b.left=s+"px",b.top=a+"px"}b.display="block",e.isVisible=!0,y(e)},hidePanel:function(e){c(e.oWrap),e.isVisible=!1,t(i,e);var n=!1;for(var r=i.length-1;r>-1;r--){var s=i[r];if(s.withMask){u.style.zIndex=s.oWrap.style.zIndex-1,n=!0;break}}!n&&u&&(c(u),clearInterval(l))},disposePanel:function(e){m(e.oWrap);for(var t in e)e[t]=null},risePanel:function(e){if(!e.isVisible)throw alert("\u7a0b\u5e8f\u9519\u8bef."),"\u9519\u8bef\uff1a\u8fd8\u6ca1\u6709\u6253\u5f00panel\u5462.";var r=e.oWrap.style;if(r.zIndex!=n){r.zIndex=n+=2,t(i,e),i.push(e);if(e.withMask){var s=u.style;s.zIndex=n-1}}},keydownHdl:function(e){if(i.length&&b(e)==27){var t=i[i.length-1];t.keyEsc&&(t.hide(),w(e))}i.length||f(document,"keydown",S.keydownHdl)},getWrapSize:function(e,t,n){var r=e.oWrap,i=r.style,s=[i.display,i.width,i.height];i.display="block",t&&(i.width=t),n&&(i.height=n);var o=[r.offsetWidth,r.offsetHeight];return i.display=s[0],s[1]&&(i.width=s[1]),s[2]&&(i.height=s[2]),o}})})(),function(){function e(e,t){t=t||"",t.tagName?(e.innerHTML="",e.appendChild(t)):e.innerHTML=t}x.EVENTS=["beforeshow","aftershow","beforehide","afterhide"],x._elHtml={content:'<div class="panel-content" remark="oContent"><div class="hd"></div><div class="bd"></div><div class="ft"></div></div>',closeHdl:'<span class="close"></span>',resizeHdl:'<span class="resize"><span></span></span>',corner1:'<span class="co1"><span></span></span>',corner2:'<span class="co2"><span></span></span>',cue:'<span class="cue"></span>',shadow:'<span class="sd"></span>'},x.prototype={defaultClassName:"panel",wrapId:"",className:"",title:"",header:"",body:"Panel Body",footer:"",withCorner:0,withCue:0,withShadow:0,withClose:0,withMask:0,dragable:0,resizable:0,keyEsc:0,posCenter:0,posAdjust:0,isVisible:!1,oWrap:null,oContent:null,oHeader:null,oBody:null,oFooter:null,oCloseHdl:null,oResizeHdl:null,oShadow:null,oCue:null,oCorner1:null,oCorner2:null,render:function(){var t=this;if(t._rendered)return;var n=s("div",{className:t.defaultClassName+" "+(t.className||"")});n.style.display="none",t.oWrap=n,t.wrapId&&(n.id=t.wrapId),c(n);var r=x._elHtml,i=[r.content,t.withClose?r.closeHdl:"",t.resizable?r.resizeHdl:"",t.withCorner?r.corner1+r.corner2:"",t.withCue?r.cue:"",t.withShadow?r.shadow:""];n.innerHTML=i.join("");var o=n.childNodes;t.oContent=o[0];var u=1;t.withClose&&(t.oCloseHdl=o[u++]),t.resizable&&(t.oResizeHdl=o[u++]),t.withCorner&&(t.oCorner1=o[u++],t.oCorner2=o[u++]),t.withCue&&(t.oCue=o[u++]),t.withShadow&&(t.oShadow=o[u++]);var o=t.oContent.childNodes;t.oHeader=o[0],t.oBody=o[1],t.oFooter=o[2],t.isVisible=!1;var f=t.title&&"<h3>"+t.title+"</h3>"||t.header;f&&e(t.oHeader,f),t.body&&e(t.oBody,t.body),t.footer&&e(t.oFooter,t.footer),t.withClose&&a(t.oCloseHdl,"click",function(){t.hide()}),t.dragable&&t.initDrag(),t.resizable&&t.initResize(),document.body.insertBefore(n,document.body.firstChild),E.createEvents(t,x.EVENTS),t._rendered=!0},show:function(e,t,n,r,i){return this._rendered&&this.render(),this.fire("beforeshow")==0?!1:(S.showPanel(this,e,t,n,r,i),this.fire("aftershow"),!0)},hide:function(){return this.fire("beforehide")==0?!1:(S.hidePanel(this),this.fire("afterhide"),!0)},dispose:function(){if(this.isVisible)return!1;S.disposePanel(this)},rise:function(){S.risePanel(this)},initDrag:function(){var e=this,t=new QW.SimpleDrag({oSrc:this.oWrap,oHdl:this.oHeader,minXAttr:1,minYAttr:1,maxXAttr:this.maxXAttr,maxYAttr:this.maxYAttr,withProxy:!0});t.on("dragstart",function(){e.rise()})},initResize:function(){var e=this,t=new QW.SimpleResize({oSrc:this.oWrap,oHdl:this.oResizeHdl,minXAttr:150,yFixed:!0,withProxy:!0});t.on("dragstart",function(){e.rise()})}}}(),function(){T.MENTOR_CLASS=x,T.prototype={posAdjust:1,defaultClassName:"panel panel-popup",relatedEls:null,_refreshBlurHdl:function(e){this._fnBlur&&(f(document,"keydown",this._fnBlur),f(document,"keyup",this._fnBlur),f(document,"mousedown",this._fnBlur),e&&(a(document,"keydown",this._fnBlur),a(document,"keyup",this._fnBlur),a(document,"mousedown",this._fnBlur)))},show:function(e,t,n,r,i){var s=this;return s._rendered&&s.render(),s._fnBlur=s._fnBlur||function(e){var t=y(e)||document.body;if(!s.oWrap)return;var n=s.relatedEls||[];n.push(s.oWrap);for(var r=0;r<n.length;r++){var i=n[r];if(i==t||v(i,t))return}s.hide()},s.fire("beforeshow")==0?!1:(S.showPanel(s,e,t,n,r,i),s._refreshBlurHdl(!0),s.fire("aftershow"),!0)},hide:function(){return this.fire("beforehide")==0?!1:(S.hidePanel(this),this._refreshBlurHdl(!1),this.fire("afterhide"),!0)}},e(T.prototype,x.prototype)}(),function(){N.MENTOR_CLASS=x,N.prototype={defaultClassName:"panel panel-dialog",withMask:1,withClose:1,dragable:!!QW.SimpleDrag},e(N.prototype,x.prototype)}();var C=function(){var t={alert:'<div class="panel-dialog-sys panel-alert cls"><div class="msg">{0}</div><div class="btn-ctn"><button>\u786e\u5b9a</button></div></div>',confirm:'<div class="panel-dialog-sys panel-confirm cls"><div class="msg">{0}</div><div class="btn-ctn"><button>\u786e\u5b9a</button><button>\u53d6\u6d88</button></div></div>',prompt:'<div class="panel-dialog-sys panel-prompt cls"><div class="msg">{0}</div><div class="ipt-ctn"><input type="text-input"></div><div class="btn-ctn"><button>\u786e\u5b9a</button><button>\u53d6\u6d88</button></div></div>',msgbox:'<div class="panel-dialog-sys panel-msgbox cls"><div class="msg">{0}</div><div class="btn-ctn"><button>\u662f(Yes)</button><button>\u5426(No)</button><button>\u53d6\u6d88</button></div></div>'},r={getSysDialog:function(r,i,s,o){o=o||{},e(o,{posCenter:1,keyEsc:1,title:"\u7cfb\u7edf\u63d0\u793a",dragable:!!QW.SimpleDrag,body:n(t[r]||"error",i)});var u=new N(o),f=u.oWrap.getElementsByTagName("button");u.dialogButtons=f;switch(r){case"alert":a(f[0],"click",function(e){u.hide()});break;case"confirm":a(f[0],"click",function(e){u.returnValue=!0,u.hide()}),a(f[1],"click",function(e){u.hide()}),u.returnValue=!1;break;case"prompt":var c=u.oWrap.getElementsByTagName("input")[0];u.dialogInput=c,a(c,"keydown",function(e){b(e)==g.KEY_ENTER&&setTimeout(function(){l(f[0],"click")},10)}),a(f[0],"click",function(e){u.returnValue=c.value,u.hide()}),a(f[1],"click",function(e){u.hide()});break;case"msgbox":a(f[0],"click",function(e){u.returnValue=!0,u.hide()}),a(f[1],"click",function(e){u.returnValue=!1,u.hide()}),a(f[2],"click",function(e){u.hide()})}return u.on("aftershow",function(){var e=c||f[0];try{e.focus(),e.select()}catch(t){}}),u.on("afterhide",function(){try{s&&s(this.returnValue)}finally{}}),u},_sysDialog:function(e,t,n,r,i){i=i||{};var s=QW.Panel.getSysDialog(e,t,r,i);e=="prompt"&&(s.dialogInput.value=n||""),s.show(null,null,i.width||300,i.height)},alert:function(e,t,n){QW.Panel._sysDialog("alert",e,null,t,n)},confirm:function(e,t,n){QW.Panel._sysDialog("confirm",e,null,t,n)},prompt:function(e,t,n,r){QW.Panel._sysDialog("prompt",e,t,n,r)},msgbox:function(e,t,n){QW.Panel._sysDialog("msgbox",e,null,t,n)}};return r}();QW.provide({PanelManager:S,BasePanel:x,LayerPopup:T,LayerDialog:N,Panel:C})})(),function(){function T(t){e(this,t,1),this.lazyRender||this.render()}function N(e){T.call(this,e)}function C(t){e(this,t,1),this.lazyRender||this.render()}function k(e){T.call(this,e)}var e=QW.ObjectH.mix,t=QW.FunctionH.lazyApply,n=QW.DomU,r=n.createElement,i=QW.NodeH,s=QW.EventTargetH,o=s.addEventListener,u=s.removeEventListener,a=s.delegate,f=i.ancestorNode,l=i.getCurrentStyle,c=i.setStyle,h=i.getRect,p=i.setRect,d=i.addClass,v=i.removeClass,m=i.marginWidth,g=QW.EventH,y=g.getTarget,b=g.preventDefault,w=g.getPageX,E=g.getPageY,S=QW.CustEvent,x={isDragging:!1,oDrag:null,startDate:null,startX:0,startY:0,pageX:0,pageY:0,deltaX:0,deltaY:0,deltaDeltaX:0,deltaDeltaY:0,mouseDownTarget:null,startDrag:function(e,t){}};(function(){var e=function(e){var r=x.oDrag;if(r.fire("beforedragstart")===!1)return;if(x.isDragging||!r)return;x.isDragging=!0,o(document,"mousemove",n),o(document,"mouseup",t),x.startDate=new Date,x.deltaX=x.deltaY=x.deltaDeltaX=x.deltaDeltaY=0,x.startX=x.pageX=w(e),x.startY=x.pageY=E(e),x.mouseDownTarget=y(e),b(e),r.dragstart(e)},t=function(e){var r=x.oDrag;if(!x.isDragging||!r)return;r.dragend(e),x.isDragging=!1,x.oDrag=null,u(document,"mousemove",n),u(document,"mouseup",t)},n=function(e){var t=x.oDrag;if(!x.isDragging||!t)return;var n=w(e),r=E(e);x.deltaDeltaX=n-x.pageX,x.deltaDeltaY=r-x.pageY,x.pageX=n,x.pageY=r,x.deltaX=n-x.startX,x.deltaY=r-x.startY,t.drag(e)};x.startDrag=function(t,n){if(x.isDragging)return;x.oDrag=n,e(t)}})(),function(){T.EVENTS=["dragstart","drag","dragend"];var e=function(e){return parseFloat(e)||0};T.prototype={oSrc:null,oHdl:null,oProxy:null,xAttr:"left",yAttr:"top",maxXAttr:null,minXAttr:null,maxYAttr:null,minYAttr:null,xFixed:!1,yFixed:!1,className:"proxy-dd",withProxy:!1,showProxy:!0,getProxy:function(){var e=null;return function(){var t=this.oProxy||e;return t||(t=r("div",{className:this.className}),document.body.appendChild(t),t.style.display="none"),this.oProxy=t}}(),dragstart:function(n){var r=this;r.oHdl.setCapture&&r.oHdl.setCapture(),r.startXAttr=e(l(r.oSrc,r.xAttr.replace(/^-/,""))),r.startYAttr=e(l(r.oSrc,r.yAttr.replace(/^-/,"")));if(r.withProxy){var i=r.getProxy(),s=h(r.oSrc);p(i,s.left,s.top,s.width,s.height,!1),r.startXAttrProxy=e(i.style[r.xAttr.replace(/^-/,"")]),r.startYAttrProxy=e(i.style[r.yAttr.replace(/^-/,"")]),i.__deltaX=i.__deltaY=0,t(function(){r.showProxy&&(i.style.display="block")},null,[],20,function(){return r!=x.oDrag||i.style.display!="none"?-1:x.deltaX*x.deltaX+x.deltaY*x.deltaY>4||new Date-x.startDate>500?1:0})}r.fire("dragstart")},drag:function(e){var t=this,n={X:1,Y:1};for(var r in n){var i=r.toLowerCase();if(!t[i+"Fixed"]){var s=(t[i+"Attr"].indexOf("-")==0?-1:1)*x["delta"+r];t["max"+r+"Attr"]!=null&&(s=Math.min(s,t["max"+r+"Attr"]-t["start"+r+"Attr"])),t["min"+r+"Attr"]!=null&&(s=Math.max(s,t["min"+r+"Attr"]-t["start"+r+"Attr"]));if(t.withProxy){try{c(t.oProxy,t[i+"Attr"],t["start"+r+"AttrProxy"]+s+"px")}catch(o){}t.oProxy["__delta"+r]=s}else c(t.oSrc,t[i+"Attr"].replace(/^-/,""),t["start"+r+"Attr"]+s+"px")}}t.fire("drag")},dragend:function(e){var t=this;t.oHdl.releaseCapture&&t.oHdl.releaseCapture();if(t.withProxy){var n=t.oProxy;n.style.display="none",t.xFixed||c(t.oSrc,t.xAttr.replace(/^-/,""),t.startXAttr+n.__deltaX+"px"),t.yFixed||c(t.oSrc,t.yAttr.replace(/^-/,""),t.startYAttr+n.__deltaY+"px")}t.fire("dragend")},render:function(){var e=this;if(e._rendered)return;S.createEvents(e,T.EVENTS),e.delegateContainer?a(e.delegateContainer,e.oHdlSelector,"mousedown",function(t){e.oHdl=this,e.oSrcSelector?e.oSrc=f(this,e.oSrcSelector):e.oSrc=e.oHdl,x.startDrag(t&&t.core||t,e)}):(e.oHdl=e.oHdl||e.oSrc,o(e.oHdl,"mousedown",function(t){x.startDrag(t,e)})),e._rendered=!0}}}(),function(){N.MENTOR_CLASS=T,N.prototype={xAttr:"width",yAttr:"height",minXAttr:0,minYAttr:0},e(N.prototype,T.prototype)}(),function(){C.EVENTS=["dragstart","drag","dragend"],C.prototype={oProxy:null,oHdl:null,getProxy:function(){var e=null;return function(){var t=this.oProxy||e;return t||(t=r("div",{className:"proxy-rectselector"}),document.body.appendChild(t),t.style.display="none"),this.oProxy=t}}(),dragstart:function(e){this.oProxy=this.getProxy();var n=this;t(function(){n.oProxy.style.display="block"},null,[],10,function(){return n!=x.oDrag||n.oProxy.style.display!="none"?-1:x.deltaX*x.deltaX+x.deltaY*x.deltaY>2?1:0}),this.oHdl.setCapture&&this.oHdl.setCapture(),p(this.oProxy,x.startX,x.startY,1,1),this.fire("dragstart")},drag:function(e){p(this.oProxy,Math.min(x.startX,x.pageX),Math.min(x.startY,x.pageY),Math.abs(x.deltaX),Math.abs(x.deltaY)),this.fire("drag")},dragend:function(e){this.oHdl.releaseCapture&&this.oHdl.releaseCapture(),this.oProxy.style.display="none",this.fire("dragend")},render:function(){var e=this;if(e._rendered)return;S.createEvents(e,C.EVENTS),o(e.oHdl,"mousedown",function(t){if(e.ignoreLeftButtonDrag&&(g.getEvent(t)||{}).button&2)return;if(e.blackSelectors4Start){var n=y(t),r=[];while(n)n.tagName&&r.push(n),n=n.parentNode;if(QW.Selector.filter(r,e.blackSelectors4Start).length)return;x.startDrag(t,e)}else y(t)==e.oHdl&&x.startDrag(t,e)}),e._rendered=!0}}}(),function(){k.MENTOR_CLASS=T,k.prototype={withProxy:!0,isInline:!1,dragstart:function(e){d(this.oSrc,"dragingModule"),T.prototype.dragstart.call(this,e)},dragend:function(e){v(this.oSrc,"dragingModule"),T.prototype.dragend.call(this,e)},adjustLayout:function(e){var t=this,n=x.pageX,r=x.pageY,i=t.siblings,s=t.containers,o=t.isInline?"deltaDeltaX":"deltaDeltaY",u;if(e.type=="dragstart")t.__elAnim&&t.__elAnim.pause();else if(e.type=="drag")if(s||i){var a=!1;u=h(t.oSrc);var f=m(t.oSrc);if(n>=u.left-f[3]&&n<=u.right+f[1]&&r>=u.top-f[0]&&r<=u.bottom+f[2])return;for(var l=0;i!=null&&l<i.length;l++){var c=i[l];if(c==t.oSrc)continue;u=h(c),f=m(c);if(n>=u.left-f[3]&&n<=u.right+f[1]&&r>=u.top-f[0]&&r<=u.bottom+f[2]){x[o]>0?c.parentNode.insertBefore(t.oSrc,c.nextSibling):x[o]<0&&c.parentNode.insertBefore(t.oSrc,c),a=!0;break}}for(var l=0;!a&&s!=null&&l<s.length;l++){c=s[l],u=h(c);if(n>u.left+1&&n<u.right-1&&r>u.top+1&&r<u.bottom-1){c.lastChild!=t.oSrc&&(c.appendChild(t.oSrc),a=!0);break}}a&&t.oHdl.setCapture&&t.oHdl.setCapture()}if(e.type=="dragend"&&t.needAnim&&QW.ElAnim){u=h(t.oSrc),t.oProxy.style.display="block";var p=new QW.ElAnim(t.oProxy,{width:{to:u.width},height:{to:u.height},left:{to:u.left},top:{to:u.top}},300);p.on("end",function(){t.oProxy.style.display="none"}),p.play(),t.oProxy.__elAnim=p}},render:function(){var e=this;T.prototype.render.call(e)}},e(k.prototype,T.prototype)}(),QW.provide({DragManager:x,SimpleDrag:T,SimpleResize:N,LayoutDrag:k,RectSelector:C})}(),function(){function e(e){e=e||{},this.path=e.path||"/",this.domain=e.domain||"",this.expires=e.expires||31536e6,this.secure=e.secure||""}e.prototype={set:function(e,t){var n=new Date;typeof this.expires=="number"&&n.setTime(n.getTime()+this.expires),document.cookie=e+"="+escape(t)+";expires="+n.toGMTString()+";path="+this.path+(this.domain==""?"":"; domain="+this.domain)+(this.secure?"; secure":"")},get:function(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):""},remove:function(e){var t=this.expires;this.expires=-31536e6,this.set(e,""),this.expires=t}},e.set=function(t,n,r){(new e(r)).set(t,n)},e.get=function(t,n){return(new e(n)).get(t)},e.remove=function(t,n){(new e(n)).remove(t)},QW.provide("Cookie",e)}(),function(){function e(e){QW.ObjectH.mix(this,e,!0),this.lazyRender||this.render()}var t=/msie/i.test(navigator.userAgent),n=QW.EventH.getTarget,r=QW.DomU.createElement,i=QW.EventTargetH.addEventListener,s=QW.NodeH,o=s.hasClass,u=s.addClass,a=s.removeClass,f=s.replaceClass,l=s.show,c=s.hide,h=s.ancestorNode,p=s.g,d=0;e.prototype={rootItemData:["folderRoot","0","Root\u793a\u4f8b"],loadItemsData:function(e){this.setItemsData(e,this.dataSource[e],!0)},getItemHtml:function(e){return"\u9700\u8981\u91cd\u5199"},getNoDataHtml:function(e){return"\u6ca1\u6709\u6570\u636e"},setItemsData:function(e,t,n){var r=p(this._idPre+e);if(!r){alert("\u7a0b\u5e8f\u9519\u8bef\uff1a\u8282\u70b9\u8fd8\u6ca1\u751f\u6210\uff1a"+e);return}r.itemsData=t||[],r.dataIsLoading=!1,n&&this._renderItems(e)},openFolder:function(e){var t=p(this._idPre+e);if(!t){alert("\u7a0b\u5e8f\u9519\u8bef\uff1a\u8282\u70b9\u8fd8\u6ca1\u751f\u6210\uff1a"+e);return}var n=t.childNodes[2];n.innerHTML||(!t.itemsData&&!t.dataIsLoading&&(u(t.firstChild,"folder-img-loading"),this.loadItemsData(e)),this._renderItems(e,!0)),f(t,"folder-closed","folder-open"),f(t.firstChild,"folder-img-closed","folder-img-open"),l(n)},closeFolder:function(e){var t=p(this._idPre+e);if(!t){alert("\u7a0b\u5e8f\u9519\u8bef\uff1a\u8282\u70b9\u8fd8\u6ca1\u751f\u6210\uff1a"+e);return}f(t,"folder-open","folder-closed"),f(t.firstChild,"folder-img-open","folder-img-closed"),c(t.childNodes[2])},openFolders:function(e){for(var t=0;t<e.length;t++)this.openFolder(e[t])},refreshFolder:function(e){var t=p(this._idPre+e);if(!t){alert("\u7a0b\u5e8f\u9519\u8bef\uff1a\u8282\u70b9\u8fd8\u6ca1\u751f\u6210\uff1a"+e);return}u(t.firstChild,"folder-img-loading"),t.childNodes[2].innerHTML="",this.loadItemsData(e)},focusItem:function(e){var t=p(this._idPre+e);if(!t){alert("\u7a0b\u5e8f\u9519\u8bef\uff1a\u8282\u70b9\u8fd8\u6ca1\u751f\u6210\uff1a"+e);return}var n=t.getElementsByTagName("a");try{if(n.length){if(this._highlightEl)try{a(this._highlightEl,"highlight")}catch(r){}var i=n[0];i.focus(),u(i,"highlight"),this._highlightEl=i}else t.scrollIntoView()}catch(s){}},_highlightEl:null,_idPre:"",_renderItems:function(e,t){var n=p(this._idPre+e),r=n.itemsData;if(!r)return t||alert("\u8fd8\u6ca1\u6709load\u51fa\u6570\u636e\u6765\u5462!"),!1;var i=n.childNodes[2];if(r.length){var s=[];for(var o=0;o<r.length;o++){var u=r[o],f=this.getItemHtml(u);u[0].toLowerCase().indexOf("folder")>-1?s[o]='<li id="'+this._idPre+u[1]+'" class="folder-closed '+u[0]+'"><span class="folder-img-closed '+u[0]+'">&nbsp;</span><div class="node-ctn">'+f+'</div><ul style="display:none"></ul></li>':s[o]='<li id="'+this._idPre+u[1]+'" class="folder-closed '+u[0]+'"><div class="node-ctn">'+f+"</div></li>"}i.innerHTML=s.join("")}else i.innerHTML="<li>"+this.getNoDataHtml(e)+"</li>";a(n.firstChild,"folder-img-loading")},_mouseover:function(e){var t=n(e);if(t.tagName=="UL")return;t.tagName!="LI"&&(t=h(t,"LI"));var r=t.getElementsByTagName("div")[0];r&&u(r,"ms-over")},_mouseout:function(e){var t=n(e);if(t.tagName=="UL")return;t.tagName!="LI"&&(t=h(t,"LI"));var r=t.getElementsByTagName("div")[0];r&&a(r,"ms-over")},_click:function(e){var t=n(e);o(t,"folder-img-closed")?this.openFolder(t.parentNode.id.substr(this._idPre.length)):o(t,"folder-img-open")&&this.closeFolder(t.parentNode.id.substr(this._idPre.length))},render:function(){var e=this;if(e._rendered)return;e._rendered=!0,this._idPre="tree"+(e.treeId==undefined?++d:e.treeId)+"_";var t=e.rootItemData;e.treeCtn.innerHTML='<ul class="tree-wrap"><li id="'+this._idPre+t[1]+'"><span class="folder-img-root '+t[0]+'">&nbsp;</span><div class="node-ctn">'+t[2]+'</div><ul style="display:none" class="tree-wrap-inner"></ul></li></ul>';var n=this.treeCtn.firstChild;i(n,"mouseover",function(t){e._mouseover(t)}),i(n,"mouseout",function(t){e._mouseout(t)}),i(n,"click",function(t){e._click(t)}),e.openFolder(t[1])}},QW.provide("Tree",e)}(),function(){function h(e){t(this,e),this.render()}function p(e){return document.getElementById(e)}var e=function(e){var t=document.getElementsByTagName("head")[0]||document.documentElement,n=document.createElement("script"),r=!1;n.src=e,n.charset="utf-8",n.onerror=n.onload=n.onreadystatechange=function(){!r&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")&&(r=!0,t.removeChild(n))},t.insertBefore(n,t.firstChild)},t=function(e,t){for(var n in t)e[n]=t[n];return e},n=function(e,n){return t(document.createElement(e),n)},r=function(e){return e=e||window.event,e.target||e.srcElement},i=function(e){return e=e||window.event,e.which||e.keyCode||e.charCode},s=function(e){e=e||window.event,e.preventDefault&&e.preventDefault()||(e.returnValue=!1)},o=function(e,t){return(new RegExp("(?:^|\\s)"+t+"(?:\\s|$)","i")).test(e.className)},u=function(e,t){o(e,t)||(e.className=(e.className+" "+t).replace(/^\s+|\s+$/g,""))},a=function(e,t){o(e,t)&&(e.className=e.className.replace(new RegExp("(?:\\s|^)"+t+"(?:\\s|$)","i")," ").replace(/^\s+|\s+$/g,""))},f=function(e,t,n){do if(e.tagName==t)return e;while(e!=n&&(e=e.parentNode));return null},l=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},c=/msie/i.test(navigator.userAgent);h.prototype={width:0,oText:null,itemsData:null,oMenu:null,oWrap:null,selectedIndex:-1,filteredValue:"",filteringValue:"",acValue:"",closed:!1,show:function(){this.oText.value&&this.oMenu.childNodes.length&&(this.oWrap.style.display="")},hide:function(){this.oWrap.style.display="none"},refreshItems:function(){var e=this,t=e.itemsData;if(t&&!t.__isItemsDataRendered){var n=[];for(var r=0;r<t.length;r++)n.push('<li acValue="'+t[r].encode4Html().replace(/"/g,"&quot;")+'">'+t[r].encode4Html()+"</li>");e.oMenu.innerHTML=n.join("").replace(/(<\w+)/g,'$1 unselectable="on"'),t.length?e.show():e.hide(),e.filteredValue=e.filteringValue,e.acValue="",e.selectedIndex=-1,t.__isItemsDataRendered=!0}},setSelectedIndex:function(e,t){var n=this,r=n.oMenu.childNodes;r.length?(n.selectedIndex>-1&&a(r[n.selectedIndex],"selected"),e=(e+r.length+1)%(r.length+1),e==r.length?(n.acValue=n.oText.value=n.filteringValue,e=-1):(n.acValue=n.oText.value=r[e].getAttribute("acValue"),u(r[e],"selected"))):e=-1,n.selectedIndex=e},render:function(){var e=this;if(e._rendered)return;e._rendered=!0;var t=n("div",{className:"ac_wrap",innerHTML:"<div class=ac_wrap_inner><div class=ac_menu_ctn><ul class=ac_menu></ul></div></div>".replace(/(<\w+)/g,'$1 unselectable="on"')}),o=e.oText;W(t).insertTo("afterend",W(o).parentNode());var h=e.oMenu=t.getElementsByTagName("ul")[0];o.setAttribute("autoComplete","off"),e.oWrap=t,e.hide(),l(e.oText,"dblclick",function(t){e.show()}),l(e.oText,"keydown",function(n){var r=i(n),u=0;switch(r){case 40:u=1;break;case 38:u=-1;break;case 27:e.closed||(e.hide(),e.closed=!0,s(n));break;case 13:e.hide(),e.onenter&&e.onenter(),s(n)}u&&o.value&&(s(n),t.style.display=="none"?(e.show(),e.closed=!1):e.setSelectedIndex(e.selectedIndex+u))}),l(e.oText,"focus",function(t){e.closed||e.show(),clearInterval(e._refreshTimer),e._refreshTimer=setInterval(function(){var t=o.value;t?e.closed||(t!=e.filteredValue&&t!=e.filteringValue&&t!=e.acValue&&(e.filteringValue=t,e.refreshData()),e.itemsData&&e.refreshItems()):(e.acValue=e.filteringValue=e.filteredValue="",e.hide(),e.closed=!1)},100)}),l(e.oText,"blur",function(t){e.hide(),clearInterval(e._refreshTimer)}),t.onmousedown=function(e){c&&(o.setCapture(),setTimeout(function(){o.releaseCapture()},10)),s(e)},h.onclick=function(t){var n=r(t),i=f(n,"LI",h);if(i){o.blur(),setTimeout(function(){o.focus()},10);var s=0,u=i;while(u=u.previousSibling)s++;e.setSelectedIndex(s,!0),e.hide(),e.onselectitem&&e.onselectitem()}},h.onmouseover=function(e){var t=r(e),n=f(t,"LI",h);n&&u(n,"hover")},h.onmouseout=function(e){var t=r(e),n=f(t,"LI",h);n&&a(n,"hover")}}},window.ComboBox=h}();var TypeHelpers=new function(){var e=this;e.hasSmoothing=function(){if(typeof screen.fontSmoothingEnabled!="undefined")return screen.fontSmoothingEnabled;try{var e=document.createElement("canvas");e.width="35",e.height="35",e.style.display="none",document.body.appendChild(e);var t=e.getContext("2d");t.textBaseline="top",t.font="32px Arial",t.fillStyle="black",t.strokeStyle="black",t.fillText("E",0,0);for(var n=8;n<=32;n++)for(var r=1;r<=32;r++){var i=t.getImageData(r,n,1,1).data,s=i[3];if(s!=255&&s!=0)return document.body.removeChild(e),!0}return document.body.removeChild(e),!1}catch(o){return null}},e.insertClasses=function(){var t=navigator.userAgent.indexOf("Windows NT 5")>-1,n=t?e.hasSmoothing():!0,r=document.getElementsByTagName("html")[0];n!=1&&(r.className+=" hasFontSmoothing-false")}};Dom.ready(function(){TypeHelpers.insertClasses()}),namespace("yunpan.util"),yunpan.util.imgSize=function(){function n(){for(var r=0;r<e.length;r++)e[r].end?e.splice(r--,1):e[r]();e.length?setTimeout(n,40):(clearTimeout(t),t=null)}var e=[],t=null;return function(r,i,s,o){var u,a,f,l,c,h=new Image;h.src=r;if(h.complete){i.call(h),s&&s.call(h);return}a=h.width,f=h.height,u=function(){l=h.width,c=h.height;if(l!==a||c!==f||l*c>1024)i.call(h),u.end=!0},u(),h.onerror=function(){o&&o.call(h),u.end=!0,h=h.onload=h.onerror=null},h.onload=function(){!u.end&&u(),s&&s.call(h),h=h.onload=h.onerror=null},u.end||(e.push(u),t===null&&(t=setTimeout(n,40)))}}(),function(){var e=function(){return{on:EventTargetH.on,toJSONString:ObjectH.stringify,encode:StringH.encode4Js}}(),t=window.HistoryManager=function(){function i(){document.write('<input id="'+n+'" style="display:none">'),e.on(window,"load",u)}function s(){if(Browser.ie<8){var t="/resource/html/bridge_frame.html";document.write('<iframe id="'+r+'" src="'+t+'" style="display:none"></iframe>')}else e.on(window,"hashchange",function(){c(a())});c(a())}function o(){document.write('<img src="javascript:location.href=\'javascript:HistoryManager._checkStateChange();\'" style="width:0;height:0;position:absolute;left:-30000px;">')}function u(){if(!Browser.safari&&!Browser.opera){var e=HistoryManager.isFirstLoaded();e||setTimeout(function(){HistoryManager._onStateChange(a())},10)}}function a(){var e=window.location.href,t=e.indexOf("#");return t>=0?e.substr(t+1):""}function f(e){if(e=="")return!1;location.hash=e}function l(){var e=a();t!=e&&(HistoryManager._onStateChange(e),t=e),setTimeout(arguments.callee,20)}function c(e){HistoryManager.listener&&HistoryManager.listener.apply(this,[e]),Browser.ie&&f(e)}function h(e,t){this._iframeFirstLoaded=!0;var n=g(r),i=n.src.indexOf("?");i<0?n.src+="?"+e:n.src=n.src.replace(/\?.*$/,"?"+e)}var t="-1",n="first_loaded_detect_input",r="ie_bridge_frame";return{listener:null,_init:function(){i(),Browser.ie&&s(),Browser.opera&&o(),this._pageFirstLoaded=null},init:function(e,t){this.listener=e;if(t)for(var n in t)this[n]=t[n];Browser.ie||l()},isFirstLoaded:function(e){if(!e)return;var t=this;setTimeout(function(){if(t._pageFirstLoaded!=null)return t._pageFirstLoaded;var r=g(n);!r||r.value==""?(r.value="loaded",t._pageFirstLoaded=!0):t._pageFirstLoaded=!1,e.call(t,t._pageFirstLoaded)},0)},getCurrentState:function(){return t},add:function(e,n){Browser.ie&&Browser.ie<8&&h.apply(this,arguments),f(e),t=e},_iframeFirstLoaded:!0,_pageFirstLoaded:null,_onStateChange:c,_checkStateChange:l}}();t._init()}(),namespace("yunpan"),yunpan.dialog=function(){function t(t){var n={wrapId:"BasePanel"+ ++e,className:"panel-t1",title:"",header:"",body:"",footer:"",withClose:!0,withCorner:!1,withCue:!1,withShadow:!1,withBgIframe:!0,keyEsc:!0,withMask:!0,dragable:!!QW.SimpleDrag,resizable:!1,posCenter:!0,posAdjust:!1,aftershowcallback:null};Object.mix(n,t,!0);var r=new QW.BasePanel(n);n.withClose&&W(r.oWrap).query(".close").appendChild(W('<a class="close-link" href="###" onclick="return false;"><span>\u5173\u95ed</span></a>'));if(t.buttons){for(var i=0,s=t.buttons.length;i<s;i++){var o=t.buttons[i],u=o.cls?" "+o.cls:"",a=o.type?o.type=="blue"?"blue":"gray":o.text=="\u786e\u5b9a"?"blue":"gray",f=o.style?' style="'+o.style+'"':"",l=o.id?" id="+o.id:"";btnHtml=['<span class="y-btn y-btn-'+a+u+'"'+f+l+">",o.withIcon?'<i class="icon"></i>':"",o.text,"</span>"].join("");var c=W(btnHtml).insertTo("beforeend",r.oFooter);o.handler&&c.on("click",o.handler)}W(r.oFooter).css("display","")}else W(r.oFooter).addClass("ft-none");return r.on("aftershow",function(){var e=W(r.oContent),n=e.getRect();W(r.oHeader).css("width",n.width-16+"px"),W(r.oFooter).css("width",n.width-2+"px"),W('<span class="left-corner"></span><span class="right-corner"></span>').insertTo("beforeend",r.oWrap),t.aftershowcallback&&t.aftershowcallback()}),r}var e=0;return{create:t}}(),namespace("yunpan.util"),yunpan.util.getSwfVersion=function(){var e=!1;return function(){if(e===!1){var t=navigator;if(t.plugins&&t.mimeTypes.length){var n=t.plugins["Shockwave Flash"];n&&n.description&&(e=n.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s)+r/,".")+".0")}else if(window.ActiveXObject&&!window.opera)for(var r=12;r>=2;r--)try{var i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+r);if(i){var s=i.GetVariable("$version");e=s.replace(/WIN/g,"").replace(/,/g,".")}}catch(o){}}return e}}(),yunpan.util.formatByte=function(e,t,n){var r="";Object.isString(e)&&(e=parseInt(e)),Object.isString(t)&&(t=parseInt(t));var i=[1099511627776,1073741824,1048576,1024],s=["T","G","M","K"];t==undefined&&(t=1);for(var o=0;o<i.length;o++){var u=i[o];if(e>=u){r=(e/u).toFixed(t)+s[o];break}}r||(e>0?r="1K":r="0K");if(n||typeof n=="undefined")r+="B";return r},yunpan.util.formatTime=function(e){var t=[86400,3600,60,1],n=["\u5929","\u5c0f\u65f6","\u5206","\u79d2"],r=!1,i="";for(var s=0;s<t.length;s++){var o=t[s],u=n[s],a;if(r||e>=o)a=parseInt(e/o),i+=a+u,e%=o,r=!0}return i||"0\u79d2"},yunpan.id=yunpan.util.id=function(){var e=0;return function(){return"x-yp-"+ ++e}}(),function(){function i(t){e||(e={});try{var n=t.cssRules||t.rules,r,i=n.length-1,s,o;for(;i>=0;--i){r=n[i].selectorText;if(r){r=r.split(","),o=r.length;for(s=0;s<o;s++)e[r[s].trim().toLowerCase()]=n[i]}}}catch(u){}}function s(n){if(e===null||n){e={};var r=t.styleSheets,s=0,o=r.length;for(;s<o;s++)try{r[s].disabled||i(r[s])}catch(u){}}return e}function o(e,t){var n=s(t),r;if(!Object.isArray(e))return n[e.toLowerCase()];for(r=0;r<e.length;r++)if(n[e[r]])return n[e[r].toLowerCase()];return null}var e=null,t=document,n=/(-[a-z])/gi,r=function(e,t){return t.charAt(1).toUpperCase()};yunpan.util.createStyleSheet=function(e,n){var r,s=t.getElementsByTagName("head")[0],o=t.createElement("style");o.setAttribute("type","text/css"),n&&o.setAttribute("id",n);if(Browser.ie)s.appendChild(o),r=o.styleSheet,r.cssText=e;else{try{o.appendChild(t.createTextNode(e))}catch(u){o.cssText=e}s.appendChild(o),r=o.styleSheet?o.styleSheet:o.sheet||t.styleSheets[t.styleSheets.length-1]}return i(r),r},yunpan.util.updateRule=function(e,t,i){var s,u;if(!Object.isArray(e)){s=o(e);if(s)return s.style[t.replace(n,r)]=i,!0}else for(u=0;u<e.length;u++)if(yunpan.util.updateRule(e[u],t,i))return!0;return!1}}(),namespace("yunpan.util"),yunpan.util.Lazyload=function(e){function s(){var e;n._isForBody?e=document.body.scrollTop||document.documentElement.scrollTop||0:e=r.scrollTop,Math.abs(e-n.scrollTop)>i&&(n.scrollTop=e,n.loadImg())}var t=this.options=ObjectH.mix({threshold:0,selector:"img",lazyLength:25,type:"src"},e,!0);if(!t.container)return;this.container=W(t.container),this.container[0]==document.body&&(this._isForBody=!0),this.images=this.container.query(t.selector).toArray(),this._isForBody?this.scrollTop=document.body.scrollTop||document.documentElement.scrollTop||0:this.scrollTop=this.container[0].scrollTop;var n=this,r=n.container[0],i=t.lazyLength,o;this._onScroll=function(){o&&(clearTimeout(o),o=null),o=setTimeout(s,t.checkInterval)},t.checkInterval||(this._onScroll=s)},yunpan.util.Lazyload.prototype={start:function(){this._isForBody?W(window).on("scroll",this._onScroll):this.container.on("scroll",this._onScroll),this.loadImg()},stop:function(){this._isForBody?W(window).un("scroll",this._onScroll):this
.container.un("scroll",this._onScroll)},loadImg:function(){if(this.images.length<=0){this.stop();return}var e=this,t=this.options.type=="src",n=this.options.threshold,r=[];if(this._isForBody){var i=Dom.getDocRect(),s=i.scrollX,o=i.scrollY,u=i.width,a=i.height;this.images.forEach(function(e,i){try{e=W(e);var f=e.getRect();f.bottom+n-o<0||f.top-n-o>a||f.right+n-s<0||f.left-n-s>u?r.push(e):t?e.attr("src",e.attr("data-imgurl")):e.setStyle("background-image","url("+e.attr("data-imgurl")+")")}catch(l){}})}else{var f=this.container.getRect(),l=f.top,c=f.bottom,h=f.left,p=f.right;this.images.forEach(function(e,i){try{e=W(e);var s=e.getRect();s.bottom+n<l||s.top-n>c||s.right+n<h||s.left-n>p?r.push(e):t?e.attr("src",e.attr("data-imgurl")):e.setStyle("background-image","url("+e.attr("data-imgurl")+")")}catch(o){}})}this.images=r}};if(!Function.prototype.bind){var methodize=QW.HelperH.methodize,mix=QW.ObjectH.mix;mix(Function.prototype,methodize({bind:QW.FunctionH.bind}))}namespace("yunpan"),yunpan.Storage=function(){function e(e){return e.replace(/[_\s]/g,function(e){return e=="_"?"__":"_s"})}function t(){var e;try{window.localStorage?e=r():window.ActiveXObject?e=n():e=i()}catch(t){window.ActiveXObject?e=n():e=i()}return e}function n(){W('<div id="ypStorage" style="display:none;"></div>').insertTo("beforeend",document.body);var t=g("ypStorage");t.addBehavior("#default#userData");var n=new Date;return n.setDate(n.getDate()+365),t.expires=n.toUTCString(),{set:function(n,r){var i=e(n);try{t.load("yunpanuserdata"),t.setAttribute(i,r),t.save("yunpanuserdata")}catch(s){}},get:function(n){var r=e(n),i=null;try{t.load("yunpanuserdata"),i=t.getAttribute(r)}catch(s){}return i},del:function(n){var r=e(n);try{t.load("yunpanuserdata"),t.removeAttribute(r),t.save("yunpanuserdata")}catch(i){}}}}function r(){return{set:function(t,n,r){var i=window.localStorage,s=e(t);try{i.setItem(s,n)}catch(o){}},get:function(t){var n=window.localStorage,r=e(t),i=null,s,o;try{i=n.getItem(r)}catch(u){}return i},del:function(t){var n=window.localStorage,r=e(t),i=null;try{i=n.getItem(r)}catch(s){}i&&n.removeItem(r)}}}function i(){return{set:function(t,n){Cookie.set(e(t),n)},get:function(t){return Cookie.get(e(t))},del:function(t){Cookie.remove(e(t))}}}return{set:function(e,n){var r=this;!r._storage&&(r._storage=t()),r._storage.set(e,n)},get:function(e){var n=this;return!n._storage&&(n._storage=t()),n._storage.get(e)},remove:function(e){var n=this;!n._storage&&(n._storage=t()),n._storage.del(e)},proxy:function(e){var t="http://yunpan.360.cn/resource/html/storage.html#",n=[];for(var r in e)n.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));t+=n.join("&"),W('<iframe style="display:none;width:0;height:0;border:none" src="'+t+'"></iframe>').insertTo("beforeend",document.body)}}}(),Ajax.prototype._execComplete=function(){var e=this,t=e.requester;t.onreadystatechange=new Function,e.isLocked=0,clearTimeout(this._timer);if(e.state!=Ajax.STATE_CANCEL&&e.state!=Ajax.STATE_TIMEOUT)if(e.isSuccess()){e.state=Ajax.STATE_SUCCESS;var n=/(['"]?)errno\1\s*:\s*(['"]?)\s*(9999|2006|1002)\s*(\2)/i;if(n.test(t.responseText)){if(RegExp.$3==2006){Cookie.remove("Q",{domain:".360.cn"}),Cookie.remove("token",{domain:".yunpan.360.cn"}),top.location.href="/";return}if(RegExp.$3==9999){yunpan.Msg.forceAlert(t.responseText.evalExp().errmsg,{type:"error"});return}if(RegExp.$3==1002){top.location.hash!="#recycleBin"?top.location.href="/my/index/?p=sFile":top.location.href="/my/index/?p=recycleBin";return}}e.fire("succeed")}else e.state=Ajax.STATE_ERROR,e.fire("error");e.fire("complete")},Ajax.post=function(e,t){var n=[].slice.call(arguments,0);return n.push("post"),ObjectH.isObject(n[1])?n[1].ajax=1:n.splice(1,0,{ajax:1}),Ajax.request.apply(null,n)},Ajax.get=function(e,t){var n=[].slice.call(arguments,0);return n.push("get"),ObjectH.isObject(n[1])?n[1].ajax=1:n.splice(1,0,{ajax:1}),Ajax.request.apply(null,n)},namespace("yunpan.tip"),yunpan.tip.TipManager=function(){var e=[];return{hideAll:function(){for(var t=0,n=e.length;t<n;t++)e[t].hide()},create:function(t){this.hideAll();var n=new yunpan.tip.Tip(t);return e.push(n),n}}}(),yunpan.tip.Tip=function(){function t(t){this.options=t=Object.mix({borderRadius:5,borderWidth:1,borderColor:"#000",borderOpacity:"1",backgroundColor:"#fff",backgroundOpactiy:1,width:200,height:50,left:0,top:0,triangleWidth:11,triangleHeight:6,contentCls:"",html:"",hideType:"delay"},t,!0),t.width=parseInt(t.width),t.height=parseInt(t.height),t.borderRadius=parseInt(t.borderRadius),t.borderWidth=parseInt(t.borderWidth),t.triangleHeight=parseInt(t.triangleHeight),t.triangleWidth=parseInt(t.triangleWidth);var n=t.width*10,r=t.height*10,i=t.borderWidth*10,s=(t.borderWidth+t.triangleHeight)*10,o=i+n,u=s+r,a=t.borderRadius*10,f=a/2,l=t.triangleWidth*10,c=t.triangleHeight*10,h=[[i,s+a],[i,s+f],[i+f,s],[i+a,s],[i+(n-l)/2,s],[i+n/2,s-c],[i+(n+l)/2,s],[o-a,s],[o-f,s],[o,s+f],[o,s+a],[o,u-a],[o,u-f],[o-f,u],[o-a,u],[i+a,u],[i+f,u],[i,u-f],[i,u-a]];for(var p=0,d=h.length;p<d;p++)h[p]=h[p].join(",");var v="",m=2*t.borderWidth+t.width,g=2*t.borderWidth+t.height+t.triangleHeight;if(e){v="m "+h[0]+" c "+[h[1],h[2],h[3]].join(",")+" l "+[h[4],h[5],h[6],h[7]].join(",")+" c "+[h[8],h[9],h[10]].join(",")+" l "+h[11]+" c "+[h[12],h[13],h[14]].join(",")+" l "+h[15]+" c "+[h[16],h[17],h[18]].join(",")+" x e";var y=['<v:shape style="position:absolute;z-index:-2;width:'+m+"px;height:"+g+'px;" '+'coordsize="'+m*10+","+g*10+'" '+'strokecolor="'+t.borderColor+'" '+'strokeweight="'+t.borderWidth*2+'px">','<v:path v="'+v+'"/>','<v:stroke opacity="'+t.borderOpacity+'" joinstyle="miter"/>',"</v:shape>",'<v:shape style="position:absolute;z-index:-1;width:'+m+"px;height:"+g+'px;" '+'coordsize="'+m*10+","+g*10+'" '+'fillcolor="'+t.backgroundColor+'">','<v:path v="'+v+'"/>','<v:stroke opacity="0" joinstyle="miter"/>',"</v:shape>"].join("\n");document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML");var b=t.id||yunpan.id(),w='<div id="'+b+'" style="display:none;position:absolute;width:'+m+"px;height:"+g+'px;"></div>',E=W(w).insertTo("beforeend",document.body);E.css(t.style,!0),E[0].insertAdjacentHTML("beforeEnd",y+'<div style="z-index:1" class="'+t.contentCls+'">'+t.html+"</div>"),this.oDom=E}else{v="M "+h[0]+" C "+[h[1],h[2],h[3]].join(" ")+" L "+[h[4],h[5],h[6],h[7]].join(" ")+" C "+[h[8],h[9],h[10]].join(" ")+" L "+h[11]+" C "+[h[12],h[13],h[14]].join(" ")+" L "+h[15]+" C "+[h[16],h[17],h[18]].join(" ")+" Z";var b=t.id||yunpan.id(),w='<div id="'+b+'" style="display:none;position:absolute;width:'+m+"px;height:"+g+'px;"></div>',E=W(w).insertTo("beforeend",document.body);E.css(t.style,!0);var S="http://www.w3.org/2000/svg",x=document.createElementNS(S,"svg"),T=document.createElementNS(S,"path");x.setAttribute("width",m),x.setAttribute("height",g),x.setAttribute("viewBox","0 0 "+m*10+" "+g*10),T.setAttribute("d",v),T.style.fill=t.backgroundColor,T.style.stroke=t.borderColor,T.style.strokeWidth=t.borderWidth*2*10,T.style.strokeOpacity=t.borderOpacity,T.style.strokeLinejoin="miter",x.appendChild(T),E[0].appendChild(x),W('<div style="z-index:1" class="'+t.contentCls+'">'+t.html+"</div>").insertTo("beforeend",E[0]),this.oDom=E}this._bindEvent()}var e=Browser.ie&&parseFloat(Browser.ie)<9?!0:!1;return t.prototype={_bindEvent:function(){var e=this.options.target,t=this;Object.isString(e)?e=W("#"+e):e=W(e),e.length>0&&(e.on("mouseover",function(){t.show()}),W(document.body).on("click",function(){t.hide()}))},show:function(){yunpan.tip.TipManager.hideAll();var e=this.options.hideType,t=this;setTimeout(function(){t.oDom.fadeIn()},0),(e=="leave"||e=="delay&leave")&&this.oDom.on("mouseleave",function(){t.oDom.fadeOut()});if(e=="delay"||e=="delay&leave")this._delayId&&(clearTimeout(this._delayId),this._delayId=null),this._delayId=setTimeout(function(){t.oDom.fadeOut()},2e3);e=="delay&leave"&&this.oDom.on("mouseenter",function(){t._delayId&&(clearTimeout(t._delayId),t._delayId=null)})},hide:function(){this.oDom.fadeOut()}},t}(),yunpan.tip.QuickTip=function(){function r(n){t&&a(!0),e=n=Object.mix({width:298,type:"success",container:document.body,align:"center",delay:2e3,close:!1,closeIcon:!1},n,!0),t?(n.cls&&t.removeClass(n.cls),n.style&&t.removeAttr("style")):t=W('<div class="x-quicktip"><div class="y-alert y-alert-success"><span class="close">\u00d7</span><p class="text"></p></div></div>'),t.insertTo("beforeend",W(n.container)[0]),n.cls&&t.addClass(n.cls),n.style&&t.css(n.style),n.close?t.query(".close").show().on("click",u):t.query(".close").hide(),n.closeIcon&&t.query(".close").hide()}function o(r,o,a){o=s.indexOf(o)>=0?o:"success",t.query(".y-alert").replaceClass("y-alert-"+i,"y-alert-"+o),i=o;var f=t.query(".text");f.html(r),t.show();var l=t.getRect(),c=f.getRect();if(e.align=="left")t.css("left","0px");else if(e.align=="right")t.css("right","0px");else{var h=W(e.container).getRect(),l=t.getRect();t.css("left",Math.max((h.width-l.width)/2,0)+"px")}e.close||(n=setTimeout(u,a?a:e.delay))}function u(){n=null,t.fadeOut(500,function(){t.css("left","-10000px")})}function a(e){if(t==null)return;n&&clearTimeout(n),e?(n=null,t.css("left","-10000px")):u()}var e,t=null,n,i="success",s=["success","warning","loading","danger","unknow","none"];return{init:r,show:o,hide:a}}();var ZeroClipboard={version:"1.0.7",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(e){return typeof e=="string"&&(e=document.getElementById(e)),e.addClass||(e.hide=function(){this.style.display="none"},e.show=function(){this.style.display=""},e.addClass=function(e){this.removeClass(e),this.className+=" "+e},e.removeClass=function(e){var t=this.className.split(/\s+/),n=-1;for(var r=0;r<t.length;r++)t[r]==e&&(n=r,r=t.length);return n>-1&&(t.splice(n,1),this.className=t.join(" ")),this},e.hasClass=function(e){return!!this.className.match(new RegExp("\\s*"+e+"\\s*"))}),e},setMoviePath:function(e){this.moviePath=e},dispatch:function(e,t,n){var r=this.clients[e];r&&r.receiveEvent(t,n)},register:function(e,t){this.clients[e]=t},getDOMObjectPosition:function(e,t){var n={left:0,top:0,width:e.width?e.width:e.offsetWidth,height:e.height?e.height:e.offsetHeight};while(e&&e!=t)n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent;return n},Client:function(e){this.handlers={},this.id=ZeroClipboard.nextId++,this.movieId="ZeroClipboardMovie_"+this.id,ZeroClipboard.register(this.id,this),e&&this.glue(e)}};ZeroClipboard.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,glue:function(e,t,n){this.domElement=ZeroClipboard.$(e);var r=99;this.domElement.style.zIndex&&(r=parseInt(this.domElement.style.zIndex,10)+1),typeof t=="string"?t=ZeroClipboard.$(t):typeof t=="undefined"&&(t=document.getElementsByTagName("body")[0]);var i=ZeroClipboard.getDOMObjectPosition(this.domElement,t);this.div=document.createElement("div");var s=this.div.style;s.position="absolute",s.left=""+i.left+"px",s.top=""+i.top+"px",s.width=""+i.width+"px",s.height=""+i.height+"px",s.zIndex=r;if(typeof n=="object")for(addedStyle in n)s[addedStyle]=n[addedStyle];t.appendChild(this.div),this.div.innerHTML=this.getHTML(i.width,i.height)},getHTML:function(e,t){var n="",r="id="+this.id+"&width="+e+"&height="+t;if(navigator.userAgent.match(/MSIE/)){var i=location.href.match(/^https/i)?"https://":"http://";n+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+i+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+e+'" height="'+t+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+"?vyp="+Math.random()+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+r+'"/><param name="wmode" value="transparent"/></object>'}else n+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+e+'" height="'+t+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+r+'" wmode="transparent" />';return n},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide(),this.div.innerHTML="";var e=document.getElementsByTagName("body")[0];try{e.removeChild(this.div)}catch(t){}this.domElement=null,this.div=null}},reposition:function(e){e&&(this.domElement=ZeroClipboard.$(e),this.domElement||this.hide());if(this.domElement&&this.div){var t=ZeroClipboard.getDOMObjectPosition(this.domElement),n=this.div.style;n.left=""+t.left+"px",n.top=""+t.top+"px"}},setText:function(e){this.clipText=e,this.ready&&this.movie.setText(e)},addEventListener:function(e,t){e=e.toString().toLowerCase().replace(/^on/,""),this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},setHandCursor:function(e){this.handCursorEnabled=e,this.ready&&this.movie.setHandCursor(e)},setCSSEffects:function(e){this.cssEffects=!!e},receiveEvent:function(e,t){e=e.toString().toLowerCase().replace(/^on/,"");switch(e){case"load":this.movie=document.getElementById(this.movieId);if(!this.movie){var n=this;setTimeout(function(){n.receiveEvent("load",null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var n=this;setTimeout(function(){n.receiveEvent("load",null)},100),this.ready=!0;return}this.ready=!0,this.movie.setText(this.clipText),this.movie.setHandCursor(this.handCursorEnabled);break;case"mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[e])for(var r=0,i=this.handlers[e].length;r<i;r++){var s=this.handlers[e][r];typeof s=="function"?s(this,t):typeof s=="object"&&s.length==2?s[0][s[1]](this,t):typeof s=="string"&&window[s](this,t)}}},namespace("yunpan"),yunpan.CopyClip=function(e){this.clip,this.gTitle=document.title,this.conf=ObjectH.mix({listeners:{},type:0,text:""},e,!0),this.tid=Math.random(),this.create()},yunpan.CopyClip.prototype={create:function(){var e=this.conf,t=e.box,n=e.btn,r=e.text,i=yunpan.util.getSwfVersion();if(i&&parseInt(i)>=10){e.type=0;var s="http://s5.qhimg.com/static/dd0f0a62aea2c1cb.swf";ZeroClipboard.setMoviePath(s),this.clip=new ZeroClipboard.Client,this.clip.glue(n[0],t[0]),this.clip.addEventListener("onMouseUp",this._copy()),this.clip.addEventListener("onMouseenter",function(){n.addClass("hover")}),this.clip.addEventListener("onMouseeleave",function(){n.removeClass("hover")}),this.clip.setCSSEffects(!0)}else window.clipboardData?(e.type=1,n.on("click",this._copy())):(e.type=2,n.on("click",this._copy()))},setText:function(e){e.attr("value")?this.conf.text=e.val():this.conf.text=e.html()},_copy:function(){var e=this;return this.conf.type==0?function(){var t=e.conf,n=e.clip,r=t.listeners.beforecopy||"";r&&typeof r=="function"&&r(e);try{n.setText(t.text)}catch(i){}document.title=this.gTitle;var s=t.listeners.aftercopy||"";s&&typeof s=="function"&&s(!0)}:this.conf.type==1?function(){var t=e.conf,n=t.listeners.beforecopy||"";n&&typeof n=="function"&&n(e);var r=window.clipboardData.setData("Text",t.text),i=t.listeners.aftercopy||"";r?i&&typeof i=="function"&&i(!0):i&&typeof i=="function"&&i(!1)}:function(){var t=e.conf,n=t.listeners.aftercopy||"";n&&typeof n=="function"&&n(!1)}}},namespace("yunpan"),yunpan.gotoTop=function(){function i(){if(e)return;var t,n,i,s,o=Dom.getDocRect().scrollY;r.yId&&(o=document.getElementById(r.yId).scrollTop),o>r.headH&&(QW.Browser.ie6?(r.el.setStyle("visibility","hidden"),s&&(clearTimeout(s),s=null),s=setTimeout(function(){r.el.setStyle("visibility","visible")},500),r.el.on("click",function(){window.scrollTo(0,0)})):r.el.setStyle("visibility","visible")),o==0&&r.el.setStyle("visibility","hidden")}function s(){var e=n("div",{className:"returnToTop"});return e.innerHTML='<div id="rtt" style="visibility:hidden"></div>',document.body.insertBefore(e,document.body.firstChild),e}function o(e){var t=s(),n=r;n.el=W(t).firstChild("div"),n.mw=n.el.getRect().width,n.mh=n.el.getRect().height,QW.ObjectH.mix(r,e,!0),r.el.css({bottom:r.bottom+"px",right:r.right+"px"});if(r.left){var o=(Dom.getDocRect().width+950)/2;r.el.css("left",o+"px")}r.dom.on("scroll",i),r.dom.on("resize",i),r.el.on("click",r.toTop)}var e=!1,t=QW.ElAnim,n=DomU.createElement,r={ch:Dom.getDocRect().height,cw:Dom.getDocRect().width,mw:0,mh:0,headH:10,right:0,bottom:0,el:0,dom:W(window),doc:QW.Browser.webkit?document.body:document.documentElement,y:Dom.getDocRect().scrollY,toTop:function(){e=!0;var n=new t(r.doc,{scrollTop:{to:0}},500,QW.Easing.easeBothStrong);n.on("beforeplay",function(){r.el.setStyle("visibility","hidden")}),n.play(),n.on("end",function(){e=!1})}};return{init:o,rTop:i}}(),yunpan.config=function(){var e;return{init:function(e){var t=e!="sFile"?function(){return{rename:"/file/rename/",move:"/file/move/",preview:"/file/preview",previewOri:"/file/getoriginalphotourl",packDown:"/file/pack/",f_down:"/file/download",delToRecyle:"/file/recycle/",recover:"/file/recover",delInRecyle:"/file/deletefilesinrecycle",clean:"/file/cleanrecycle",mkdir:"/file/mkdir/",getList:"/file/list",getNodeList:"/file/listAjax",getRecoverList:"/file/getRecoverList",uploadNameCheck:"/file/detectFileExists",uploadAddress:"/upload/getuploadaddress/",uploadFile:"/upload/addfile/",docviewerInfo:"/docviewer/getInfo",share:"/share/create",cancelShareNode:"/share/cancelLinkNode",cancelShare:"/share/cancelLink"}}:function(){return{rename:"/sFile/rename/",move:"/sFile/move/",preview:"/sFile/preview",previewOri:"/sFile/getoriginalphotourl",packDown:"/sFile/pack/",f_down:"/sFile/download",delToRecyle:"/sFile/recycle/",recover:"/sFile/recover",mkdir:"/sFile/mkdir/",getList:"/sFile/list",docviewerInfo:"/sDocviewer/getInfo",getNodeList:"/sFile/listAjax",uploadNameCheck:"/sFile/detectFileExists",uploadAddress:"/upload/getuploadaddress/",uploadFile:"/sUpload/addfile/"}};yunpan.config.url=t()},url:e}}(),namespace("yunpan"),yunpan.title=document.title,yunpan.id=function(){var e=0;return function(){return"x-yp-"+ ++e}}(),function(){function i(){e=null;if(Browser.ie6){var i=Dom.getDocRect();i.width<1160?(W("#doc").css("width","1160px"),W("html").css("overflow-x","auto")):W("#doc").css("width","auto")}var i=Dom.getDocRect(),s=i.height-r;t.css("height",s+"px"),t.query(".clients-download").show(),n.css("height",i.height-n.getRect().top+"px"),yunpan.filelist.resizeHolder(),yunpan.envSwitch.resizeIframe(),yunpan.group.relayout()}function s(){e&&clearTimeout(e),e=setTimeout(i,100)}var e,t=W("#leftPanel"),n=W("#fileListMain"),r=56;Dom.ready(i),W(window).on("resize",s)}(),Dom.ready(function(){W("#leftPanel .menu-global").delegate("a","click",function(e){var t=W(this),n=t.query("i");yunpan.filelist.nav=[];if(n.hasClass("icon-all")){yunpan.filelist.page=0,yunpan.filelist.curFunc="file";var r=location.search.substr("1").queryUrl();r.his_nid&&(location.href="/my/index"),yunpan.cmdCenter.gotoPath("/",null,null,null,null,"file")}else n.hasClass("icon-links")?(yunpan.filelist.page=0,yunpan.cmdCenter.gotoLink()):n.hasClass("icon-sFile")?yunpan.cmdCenter.gotosFile():n.hasClass("icon-recycle")&&(yunpan.cmdCenter.gotoRecycleBin(),Ajax.post("/authority/isRecycleBinLocked",{qid:SYS_CONF.qid},function(e){var t=e.evalExp();t.errno!=0?(W("#tbOpenPassword").show(),W("#tbOpenPasswordDone").hide()):(W("#tbOpenPasswordDone").show(),W("#tbOpenPassword").hide())}));yunpan.cmdCenter.updateNav(),W("#fileListHistory").hide(),e.preventDefault()});var e=W(".more-clients-down");W("#leftPanel .icon-more").on("mouseenter",function(t){e.isVisible()||e.show()}),W("#leftPanel .clients-down").on("mouseleave",function(t){e.isVisible()&&e.hide()}),W("#leftPanel .more-clients-down").on("mouseenter",function(t){e.show()}),W("#leftPanel .more-clients-down").on("mouseleave",function(t){e.hide()}),yunpan.group.initGroup()}),yunpan.BatchRequest=function(){function h(n){if(e||!n.url)return!1;e=!0,t=ObjectH.mix({size:50,method:"post",showProTipReset:!1},n,!0),p(),n.withoutProgress||setTimeout(g,1e3),n.withProgressTip&&setTimeout(y,1)}function p(){if(n){d();return}var e={},s,o;t.method==="jsonp"?(s=t.data.slice(i,i+t.size),s=s[0],e.t=+(new Date),e.cross_domain_callback="yunpan.BatchRequest.jsonp_callback",e.callback||(e.callback=e.cross_domain_callback),e=ObjectH.mix(e,s.params,!0),o=s.url,o+="?",o+=ObjectH.encodeURIJson(e),yunpan.BatchRequest.jsonp_callback=function(e){s.batchSuccess&&s.batchSuccess(e),i+=t.size,i>=t.data.length?(n||t.success&&t.success(),d()):p()},loadJs(o)):(e[t.batchParam]=t.data.slice(i,i+t.size),e.t=Math.random(),e=ObjectH.mix(e,t.params,!0),r=Ajax.request(t.url,e,function(e){t.batchSuccess&&t.batchSuccess(e),i+=t.size,i>=t.data.length?(n||t.success&&t.success(),d()):p()},t.method));var u=t.data.length;l=i+t.size>=u?c:(i+t.size)/u*c}function d(){var r=!1;setTimeout(function(){m(),r&&yunpan.tip.QuickTip.hide()},300),t.showProTipReset||(r=!0),e=!1,t=null,n=!1,i=0}function v(e){e&&r&&r.cancel(),n=!0,t.onTerminate&&t.terminate()}function m(){s&&s.hide()}function g(){if(!e)return;if(!s){var n=['<div id="batchRequest">','<div class="box">','<span class="progress"><span class="progress-bar"></span></span>',"<p>"+(t.msg||"\u64cd\u4f5c\u6b63\u5728\u8fdb\u884c\u4e2d\uff0c\u8bf7\u7a0d\u7b49...")+"</p>","</div>","</div>"].join("");s=yunpan.dialog.create({body:n,title:"\u63d0\u793a",withClose:!1}),o=W("#batchRequest .progress-bar")}a=0,o.css("width","0px"),s.show(),setTimeout(w,100)}function y(){if(!e)return;a=0,yunpan.tip.QuickTip.init({container:t.showProTipcontainer,cls:"batchRequestTip",close:!0,closeIcon:!0}),yunpan.tip.QuickTip.show(t.showProTipTitle,t.showProTipType,0),u=W(".x-quicktip em.batch-title"),setTimeout(b,100)}function b(){e?(a+=Math.floor((l-a)*.1),u.html(parseInt(a/c*100,10)+"%"),setTimeout(b,100)):u.html(parseInt(c/c*100,10)+"%")}function w(){e?(a+=Math.floor((l-a)*.1),o.css("width",a+"px"),setTimeout(w,100)):o.css("width",c+"px")}var e=!1,t,n=!1,r,i=0,s,o,u,a=0,f=0,l=0,c=376;return{create:h,showProgress:g,terminate:v,showProgressTip:y}}();var gTitle=document.title;yunpan.isLogin=function(){return Cookie.get("token","")==""||Cookie.get("Q","")==""?(yunpan.Msg.alert("\u767b\u5f55\u5931\u6548\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\uff01",{type:"error",fn:function(){location.href="/"}}),!1):SYS_CONF.token!=Cookie.get("token","")?(location.reload(),!1):!0},yunpan.login=function(){function t(){e=new QW.BasePanel({withClose:!1,withCorner:!1,withCue:!1,withShadow:!1,keyEsc:!0,withMask:!0,posCenter:!0,body:W("#tpl-panel-msg").html()}),msgBox=W(".popbox .bd"),W(".popbox .close a").on("click",function(){e.hide()})}var e;return function(){e||t(),msgBox.html('<iframe src="/index/minilogin" scrolling="no" frameborder="0" style="width:470px;height:290px;overflow:hidden"></iframe>'),e.show(null,null,500,326)}}(),yunpan.Msg=function(){function e(){}var t=['<div class="msg-panel {$type}" style="{$style}">','<div class="msg-text-box"><div class="msg-text {$type}-tip" style="{$textstyle}">{$text}</div></div>',"</div>"].join(""),n=['<div class="msg-panel msg-prompt">','<div class="msg-text-box">','<div class="msg-text">{$text}\uff1a<input id="{$promptIpt}" value="{$defaultText}"></div>',"</div>","</div>"].join(""),r='        <div class="msg-panel msg-prompt">            <div class="msg-text-box">                <div class="msg-text">                <label for="{$promptIpt}">{$text}\uff1a</label>                <textarea id="{$promptIpt}">{$defaultText}</textarea>                </div>            </div>        </div>';return{forceAlert:function(e,n){n=ObjectH.mix({title:"\u63d0\u793a",type:"ok"},n,!0);var r=yunpan.dialog.create({body:t.tmpl({type:"msg-"+n.type,text:e}),title:n.title,withClose:!1});return r.show(),r},alert:function(e,n){n=ObjectH.mix({title:"\u64cd\u4f5c\u63d0\u793a",type:"ok"},n,!0);var r=n.dialog_after||null,i=[],s=[];n.width&&i.push("width:"+n.width+"px"),n.height&&i.push("height:"+n.height+"px"),i=i.join(";"),n.textwidth&&s.push("width:"+n.textwidth+"px;"),n.textheight&&s.push("height:"+n.textheight+"px"),s=s.join(";");var o=yunpan.dialog.create({body:t.tmpl({type:"msg-"+n.type,text:e,style:i,textstyle:s}),title:n.title,withMask:n.with_Mask===!1?!1:!0,withClose:n.with_close===!1?!1:!0,maxXAttr:n.maxXAttr,maxYAttr:n.maxYAttr,buttons:[{text:n.btnOkText||"\u786e\u5b9a",type:n.btnOKType||"blue",handler:function(){o.hide(),o.dispose(),o=null,n.fn&&n.fn("yes"),r&&(r.show(),r=null)}}]});return o.show(),W(o.oFooter).query(".y-btn").item(0).focus(),o},confirm:function(e,n){n=ObjectH.mix({title:"\u64cd\u4f5c\u63d0\u793a",type:"ok"},n,!0);var r=[],i=[];n.width&&r.push("width:"+n.width+"px"),n.height&&r.push("height:"+n.height+"px"),r=r.join(";"),n.textwidth&&i.push("width:"+n.textwidth+"px"),n.textheight&&i.push("height:"+n.textheight+"px"),i=i.join(";");var s=yunpan.dialog.create({body:t.tmpl({type:"msg-"+n.type,text:e,style:r,textstyle:i}),title:n.title,withClose:n.with_close===!1?!1:!0,maxXAttr:n.maxXAttr,maxYAttr:n.maxYAttr,withMask:n.with_Mask===!1?!1:!0,buttons:[{text:n.btnOkText||"\u786e\u5b9a",type:n.btnOKType||"blue",handler:function(){s.hide(),s.dispose(),s=null,n.fn&&n.fn("yes")}},{text:n.btnCancelText||"\u53d6\u6d88",handler:function(){s.hide(),s.dispose(),s=null,n.fn&&n.fn("no")}}]});return s.show(),W(s.oFooter).query(".y-btn").item(0).focus(),s},prompt:function(e,t){t=ObjectH.mix({title:"\u64cd\u4f5c\u63d0\u793a",type:"ok",defaultText:"",inputId:yunpan.id()},t,!0);var i=n;t.enable_textarea&&(i=r);var s=yunpan.dialog.create({body:i.tmpl({type:"msg-prompt",text:e,promptIpt:t.inputId,defaultText:t.defaultText}),title:t.title,withClose:!0,withMask:t.with_Mask===!1?!1:!0,maxXAttr:t.maxXAttr,maxYAttr:t.maxYAttr,buttons:[{text:"\u786e\u5b9a",handler:function(){t.fn&&t.fn("yes",g(t.inputId).value),s.hide()}},{text:"\u53d6\u6d88",handler:function(){t.fn&&t.fn("no",g(t.inputId).value),s.hide(),s.dispose(),s=null}}]});return s.show(),setTimeout(function(){g(t.inputId).focus()},1),W("#"+t.inputId).on("keydown",function(e){13==e.keyCode&&W(s.oFooter).query(".x-button").item(0).fire("click")}),s}}}(),yunpan.tips=function(){var e,t,n=null;return{show:function(r,i,s){e||(e=W('<div id="topTips"><span class="msg"></span><a class="close"></a></div>').insertTo("beforeend",document.body),t=e.query("span"));var o=i!=undefined?i:!0,u=s!=undefined?s:!1,a=e.query(".close");u?a.show():a.hide(),r=r||"\u63d0\u4ea4\u4e2d...",n&&(clearTimeout(n),n=null),t.html(r),e.css("height","28px").fadeIn(100),o&&(n=setTimeout(function(){e.fadeOut(300)},3e3))},hide:function(){n&&(clearTimeout(n),n=null),e&&e.fadeOut(100)},delayHide:function(){n&&(clearTimeout(n),n=null);if(!e.isVisible())return!1;n=setTimeout(function(){e.fadeOut(300)},500)}}}(),yunpan.envSwitch=function(){function t(e){r("iframe"),W("#mainFrame").attr("src",e).show()}function n(){W("#profile").on("click",function(){yunpan.isLogin()?t("/user/info?from=my"):top.location.href="http://yunpan.360.cn"}),W("#updateSpace").on("click",function(){yunpan.isLogin()?t("/task?from=my"):top.location.href="http://yunpan.360.cn"}),W("#inviteFri").on("click",function(){yunpan.isLogin()?t("/task/invitefriend?from=my"):top.location.href="http://yunpan.360.cn"}),W("#ypLevel").on("click",function(){yunpan.isLogin()?t("/task/myLevel?from=my"):top.location.href="http://yunpan.360.cn"}),W("#volRecords").on("click",function(){yunpan.isLogin()?t("/user/volrecords?type=all"):top.location.href="http://yunpan.360.cn"}),W("#userLevel").on("click",function(){yunpan.isLogin()?t("/task/myLevel?from=my"):top.location.href="http://yunpan.360.cn"}),W("#recharge").on("click",function(){yunpan.isLogin()?t("http://yunpan.360.cn/card?domain="+location.host):top.location.href="http://yunpan.360.cn"}),W("#buyspace").on("click",function(){yunpan.isLogin()?t("http://yunpan.360.cn/pay/index/?domain="+location.host):top.location.href="http://yunpan.360.cn"}),W("#saveMessage,.user-info .badge-count").on("click",function(){W(".user-info .badge-count").hide(),W("#userInfo .message em").hide(),yunpan.Storage.set("readMessageTime",yunpan.userInfo.showMessageTime),yunpan.isLogin()?t("/notice/index/?domain="+location.host):top.location.href="http://yunpan.360.cn"})}function r(t){t=="iframe"?(e=!0,W("#leftPanel .folders li").removeClass("current"),W("#crumb").hide(),W("#toolbar").hide(),W("#fileList").hide(),W("#fileListHistory").hide(),W("#search").hide(),W("#mainFrame").attr("src","/task").show(),i()):(e=!1,W("#mainFrame").hide(),W("#crumb").show(),W("#toolbar").show(),W("#fileList").show(),W("#search").show())}function i(){if(e){var t=W("#mainFrame"),n=t.getRect(),r=Dom.getDocRect();t.setStyle({height:r.height-n.top+"px",width:r.width-n.left+"px"})}}var e=!1;return{init:n,showIfrPage:t,show:r,resizeIframe:i}}(),Dom.ready(function(){yunpan.envSwitch.init()}),yunpan.userInfo=function(){function i(){t=W("#userInfo").css("height"),n=W("#userInfo"),W("#topPanel .user-info a").on("click",function(e){n.slideToggle(200),e.stopPropagation()}),W("body,#userInfo li a").on("click",function(){n.slideUp(200,function(){n.setStyle({height:t,display:"none"})})}),W("#userInfo").on("click",function(e){e.stopPropagation()})}function s(){Ajax.get("/user/getsize/",{t:+(new Date)},function(e){try{var t=e.evalExp(),n=t.data.total_size||1,r=t.data.used_size,i=parseInt(r/n*100,10)}catch(s){}r=yunpan.util.formatByte(r,2),n=yunpan.util.formatByte(n,2),W("#topPanel .progress-bar .percent").html(r+"/"+n),i=i>100?100:i<2.5?2.5:i,W("#topPanel .progress-bar .used").css("width",i+"%");var o=W("#topPanel .progress-bar").getRect();yunpan.userInfo.progressTip||(yunpan.userInfo.progressTip=yunpan.tip.TipManager.create({id:"progressTip",target:W("#topPanel .progress-bar"),width:193,height:50,borderWidth:2,borderRadius:3,borderColor:"#e7e9ea",borderOpacity:"0.5",backgroundColor:"#f8fdff",hideType:"delay&leave",style:{left:o.left+o.width/2-83+"px",top:o.top+o.height+"px",zIndex:1002,display:"none"},html:'\u7a7a\u95f4\u5df2\u7528<span class="tip-used">'+r+'</span>,\u5171<span class="tip-total">'+n+'</span></br><a href="#" onclick="return false;">\u67e5\u770b\u6269\u5bb9\u8bb0\u5f55</a>'}),W("#progressTip a").on("click",function(){yunpan.isLogin()?yunpan.envSwitch.showIfrPage("/user/volrecords?type=all"):top.location.href="http://yunpan.360.cn"})),W("#progressTip .tip-used").html(r),W("#progressTip .tip-total").html(n)})}function o(){Ajax.post("/notice/getNoticeCount",{},function(e){var t=e.evalExp();if(!t||!t.data)return;if(t.data.new_notice_time!=0){yunpan.userInfo.showMessageTime=t.data.new_notice_time;var n=yunpan.Storage.get("readMessageTime")+"",r=yunpan.userInfo.showMessageTime+"";if(n!==r&&t.data.unread_num!=0){if(t.data.unread_num>99)var i="99+";else var i=t.data.unread_num+"";W("#topPanel .user-info .badge-count em").html(i+"\u6d88\u606f"),W("#topPanel .user-info .badge-count").show(),W("#userInfo .message em").html(i).show()}}})}var e,t,n,r;return{init:i,updateDiskInfo:s,updateMessageInfo:o,showMessageTime:r}}(),yunpan.userInfo.updateDiskInfo(),yunpan.userInfo.updateMessageInfo(),Dom.ready(function(){yunpan.userInfo.init()}),yunpan.lottery=function(){var words_share=["\u4eba\u54c1\u5927\u7206\u53d1\uff01\u6211\u4eca\u5929\u5728#360\u4e91\u76d8\u62bd\u5956#\u83b7\u5f97\u4e86{$reward}\u6c38\u4e45\u514d\u8d39\u7a7a\u95f4\uff0c\u5e78\u8fd0\u6307\u6570\u2605\u2605\u2605\u2605\u2605\uff0c\u4f60\u4e5f\u6765\u8bd5\u8bd5\u624b\u6c14\u5427~@{$nickname}\uff0c\u514d\u8d39\u5927\u5bb9\u91cf\u5b58\u50a8\u7a7a\u95f4\uff0c\u5b89\u5168\u5907\u4efd\u7167\u7247\u3001\u6587\u6863\uff0c\u6c38\u4e0d\u4e22\u5931\uff0c\u8fd8\u80fd\u8f7b\u677e\u5206\u4eab\u7ed9\u597d\u53cb\uff0c\u4f60\u4e5f\u8d76\u7d27\u6765\u8bd5\u8bd5\u5427\u3002{$inviteUrl}","\u624b\u6c14\u5f88\u4e0d\u9519\u54e6\uff01\u6211\u4eca\u5929\u5728#360\u4e91\u76d8\u62bd\u5956#\u83b7\u5f97\u4e86{$reward}\u6c38\u4e45\u514d\u8d39\u7a7a\u95f4\uff0c\u5e78\u8fd0\u6307\u6570\u2605\u2605\u2605\u2605\uff0c\u4f60\u4e5f\u6765\u8bd5\u8bd5\u624b\u6c14\u5427~@{$nickname}\uff0c\u514d\u8d39\u5927\u5bb9\u91cf\u5b58\u50a8\u7a7a\u95f4\uff0c\u5b89\u5168\u5907\u4efd\u7167\u7247\u3001\u6587\u6863\uff0c\u6c38\u4e0d\u4e22\u5931\uff0c\u8fd8\u80fd\u8f7b\u677e\u5206\u4eab\u7ed9\u597d\u53cb\uff0c\u4f60\u4e5f\u8d76\u7d27\u6765\u8bd5\u8bd5\u5427\u3002{$inviteUrl}"
,"\u518d\u63a5\u518d\u5389\uff0c\u4e89\u53d6\u66f4\u5927\u80dc\u5229\uff01\u6211\u4eca\u5929\u5728#360\u4e91\u76d8\u62bd\u5956#\u83b7\u5f97\u4e86{$reward}\u6c38\u4e45\u514d\u8d39\u7a7a\u95f4\uff0c\u5e78\u8fd0\u6307\u6570\u2605\u2605\u2605\uff0c\u4f60\u4e5f\u6765\u8bd5\u8bd5\u624b\u6c14\u5427~@{$nickname}\uff0c\u514d\u8d39\u5927\u5bb9\u91cf\u5b58\u50a8\u7a7a\u95f4\uff0c\u5b89\u5168\u5907\u4efd\u7167\u7247\u3001\u6587\u6863\uff0c\u6c38\u4e0d\u4e22\u5931\uff0c\u8fd8\u80fd\u8f7b\u677e\u5206\u4eab\u7ed9\u597d\u53cb\uff0c\u4f60\u4e5f\u8d76\u7d27\u6765\u8bd5\u8bd5\u5427\u3002{$inviteUrl}","\u4e00\u822c\u4e00\u822c\uff0c\u4e16\u754c\u7b2c\u4e09\uff01\u6211\u4eca\u5929\u5728#360\u4e91\u76d8\u62bd\u5956#\u83b7\u5f97\u4e86{$reward}\u6c38\u4e45\u514d\u8d39\u7a7a\u95f4\uff0c\u5e78\u8fd0\u6307\u6570\u2605\u2605\uff0c\u4f60\u4e5f\u6765\u8bd5\u8bd5\u624b\u6c14\u5427~@{$nickname}\uff0c\u514d\u8d39\u5927\u5bb9\u91cf\u5b58\u50a8\u7a7a\u95f4\uff0c\u5b89\u5168\u5907\u4efd\u7167\u7247\u3001\u6587\u6863\uff0c\u6c38\u4e0d\u4e22\u5931\uff0c\u8fd8\u80fd\u8f7b\u677e\u5206\u4eab\u7ed9\u597d\u53cb\uff0c\u4f60\u4e5f\u8d76\u7d27\u6765\u8bd5\u8bd5\u5427\u3002{$inviteUrl}","\u6562\u518d\u5c11\u70b9\uff1f\u6211\u8ddf\u4f60\u6025\uff01\u6211\u4eca\u5929\u5728#360\u4e91\u76d8\u62bd\u5956#\u83b7\u5f97\u4e86{$reward}\u6c38\u4e45\u514d\u8d39\u7a7a\u95f4\uff0c\u5e78\u8fd0\u6307\u6570\u2605\uff0c\u4f60\u4e5f\u6765\u8bd5\u8bd5\u624b\u6c14\u5427~@{$nickname}\uff0c\u514d\u8d39\u5927\u5bb9\u91cf\u5b58\u50a8\u7a7a\u95f4\uff0c\u5b89\u5168\u5907\u4efd\u7167\u7247\u3001\u6587\u6863\uff0c\u6c38\u4e0d\u4e22\u5931\uff0c\u8fd8\u80fd\u8f7b\u677e\u5206\u4eab\u7ed9\u597d\u53cb\uff0c\u4f60\u4e5f\u8d76\u7d27\u6765\u8bd5\u8bd5\u5427\u3002{$inviteUrl}"],html_dialog='    <div class="content0">        <h2>{$reward}</h2>        <p>\u606d\u559c\u60a8\uff0c\u672c\u6b21\u62bd\u5956\u83b7\u5f97\u4e86<b>{$total}</b>\u6c38\u4e45\u514d\u8d39\u7a7a\u95f4\u3002</p>        <p>\u5e78\u8fd0\u6307\u6570\uff1a<span class="stars" style="width:{$width}">stars</span></p>        <a href="{$sina}" onclick="monitor.yplog(208)" target="_blank" class="sina">\u8f6c\u53d1\u5230\u65b0\u6d6a\u5fae\u535a</a>        <a href="{$tencent}" onclick="monitor.yplog(209)" target="_blank" class="tencent">\u8f6c\u53d1\u5230\u817e\u8baf\u5fae\u535a</a>        <a href="#" id="lotteryRecords" style="position:absolute;left: 210px;top: 117px;">\u67e5\u770b\u62bd\u5956\u8bb0\u5f55</a>    </div>    <div class="message content1">        <p>\u62b1\u6b49\uff0c\u62bd\u5956\u5931\u8d25\uff01</p>        <p>\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002</p>    </div>    <div class="message content2">        <p>\u4eca\u65e5\u5df2\u62bd\u5956\uff01</p>        <p>\u8bf7\u660e\u65e5\u518d\u6765\u3002</p>    </div>',pic_url=encodeURIComponent("http://"+document.domain+"/resource/img/lottery_weibo.png"),link_sina="http://service.t.sina.com.cn/share/share.php?title={$title}&appkey=4060160539&content=utf8&pic="+pic_url,link_tencent="http://v.t.qq.com/share/share.php?title={$title}&url={$url}&pic="+pic_url,STATUS_DONE=0,STATUS_UNDONE=1,isRequesting=!1;return{interface_update:function(e,t){var n=this.node_interface.parentNode("div");n.show();switch(e){case STATUS_DONE:n.replaceClass("lottery-ing","lottery-already");var r=n.getRect();if(t){var i=yunpan.tip.TipManager.create({id:"lotteryTip",target:n,width:166,height:50,borderWidth:2,borderRadius:3,borderColor:"#e7e9ea",borderOpacity:"0.5",backgroundColor:"#f8fdff",style:{left:r.left+r.width/2-83+"px",top:r.top+r.height+"px",zIndex:1002,display:"none"},html:"\u4eca\u65e5\u5df2\u6210\u529f\u62bd\u5230"+t+'\u7a7a\u95f4<br><a href="#" onclick="return false;">\u67e5\u770b\u5386\u53f2\u8bb0\u5f55</a>'});W("#lotteryTip a").on("click",function(){yunpan.isLogin()?yunpan.envSwitch.showIfrPage("/user/volrecords?type=sign"):top.location.href="http://yunpan.360.cn"})}break;case STATUS_UNDONE:n.replaceClass("lottery-already","lottery-ing");break;default:}},dialog_show:function(e,t){var n={};switch(e){case 0:n.body=t,n.className="lottery-dialog0";if(t)break;case 1:n.body=html_dialog,n.className="lottery-dialog1";break;case 2:n.body=html_dialog,n.className="lottery-dialog2";break;default:n=null}if(!n)return;this.dialog=yunpan.dialog.create(n),this.dialog.show(),this.dialog.on("afterhide",function(){yunpan.lottery.dialog.dispose(),yunpan.lottery.dialog=null,yunpan.lottery.from_browser&&(document.location.href="/my/index")}),QW.Browser.ie6&&W(".mask").css("z-index","20")},signin_communicate:function(){if(isRequesting)return;isRequesting=!0,Ajax.post("/user/signin/",{qid:SYS_CONF.qid,method:"signin",t:+(new Date)},function(response){isRequesting=!1,response=eval("("+response+")");var reward,total,level,words,width;response.errno?response.errno===27002?(yunpan.lottery.dialog_show(2),yunpan.lottery.interface_update(0)):yunpan.lottery.dialog_show(1):(reward=Math.round(response.data.reward/1048576),total=Math.round(response.data.total/1048576),level=Math.ceil(reward/20),level>5&&(level=5),words=words_share[5-level],words=[words.tmpl({reward:reward+"MB",nickname:"360\u4e91\u76d8",inviteUrl:"http://yunpan.360.cn/invite/"+SYS_CONF.inviteCode+"?sid=208"}),words.tmpl({reward:reward+"MB",nickname:"i360yunpan",inviteUrl:""})],reward="+"+reward+"MB",total+="MB",width=1+level*22,width+="px",yunpan.lottery.dialog_show(0,html_dialog.tmpl({reward:reward,total:total,width:width,sina:link_sina.tmpl({title:encodeURIComponent(words[0])}),tencent:link_tencent.tmpl({title:encodeURIComponent(words[1]),url:"http://yunpan.360.cn/invite/"+SYS_CONF.inviteCode+"?sid=209"})})),W("#lotteryRecords").on("click",function(){yunpan.lottery.dialog&&yunpan.lottery.dialog.hide(),yunpan.isLogin()?yunpan.envSwitch.showIfrPage("/user/volrecords?type=sign"):top.location.href="http://yunpan.360.cn"}),monitor.yplog("316"),yunpan.lottery.interface_update(0,total),yunpan.userInfo.updateDiskInfo())})},check_communicate:function(){Ajax.post("/user/signin/",{qid:SYS_CONF.qid,method:"check",t:+(new Date)},function(response){response=eval("("+response+")");var total;response.errno===27002?(total=Math.round(response.data.total/1048576),total+="MB",yunpan.lottery.interface_update(0,total)):yunpan.lottery.interface_update(1)})}}}(),Dom.ready(function(){var e=location.search.substr("1").queryUrl();yunpan.lottery.node_interface=W("#lottery-everyday"),yunpan.lottery.node_interface.on("click",function(e){yunpan.lottery.signin_communicate()}),e.p==="signin"?(yunpan.lottery.from_browser=!0,yunpan.lottery.signin_communicate()):yunpan.lottery.check_communicate()}),namespace("yunpan.docviewer"),function(){var e={doc:5242880,docx:5242880,xls:5242880,xlsx:5242880,ppt:5242880,pptx:5242880,pdf:20971520,txt:2097152,url:4096,sh:2097152,js:2097152,css:2097152,php:2097152,python:2097152,py:2097152,c:2097152,cpp:2097152,cs:2097152,java:2097152,xml:2097152};yunpan.docviewer.canPreview=function(t,n){return e[t]&&parseInt(n)<=e[t]?!0:!1},yunpan.docviewer.checkPreview=function(t,n){var r={isDoc:!1,isOversize:!1};return e[t]&&(r.isDoc=!0,parseInt(n)>e[t]&&(r.isOversize=!0)),r}}(),yunpan.docviewer.getUrl=function(){var e=[{type:"Source",suffix:["txt","url","sh","js","css","php","python","py","c","cpp","cs","java","xml"]},{type:"Word",suffix:["doc","docx"]},{type:"Excel",suffix:["xls","xlsx","csv"]},{type:"Ppt",suffix:["ppt","pptx"]},{type:"Pdf",suffix:["pdf"]}];return function(t,n,r,i,s,o,u){var a="";for(var f=0,l=e.length;f<l;f++){var c=e[f];if(c.suffix.indexOf(r)>=0){a+=t=="share"?"share"+c.type+"viewer":c.type.toLowerCase()+"viewer";break}}return a?(t=="sFile"?a=(i?"http://"+i:"")+"/sDocviewer/"+a:a=(i?"http://"+i:"")+"/docviewer/"+a,a+="?nid="+n+"&type="+r+"&id="+o+"&hisFile="+u,s&&(a+="&"+Object.encodeURIJson(s)),a):""}}(),namespace("yunpan.authority"),yunpan.authority=function(){function _(e,t){var n=e.getValue(),r=t.getValue(),i=!1,s=W(".sfile-pass-tip");try{var o=QHPass.regUtils.getPassLevel(n);if(o>=2){var u=n==r?function(){i=!0}:function(){i=!1,s.html("\u4e24\u6b21\u8f93\u5165\u7684\u65b0\u5bc6\u7801\u4e0d\u4e00\u81f4").css("visibility","visible")};u()}else{switch(o){case-1:s.html("\u5bc6\u7801\u5e94\u4e3a6-20\u4e2a\u5b57\u7b26\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09").css("visibility","visible");break;case 0:s.html("\u5bc6\u7801\u4e0d\u80fd\u5168\u4e3a\u76f8\u540c\u5b57\u7b26").css("visibility","visible");break;case 1:s.html("\u5bc6\u7801\u4e0d\u80fd\u4e3a\u8fde\u7eed\u5b57\u7b26").css("visibility","visible");break;default:}i=!1}}catch(a){throw"FPassword:_checkPass:"+a.message}return i}function D(e,t,n){var r=e,i=t,s=n;try{W(W("input")[0]).focus(),i.on("focus",function(){r.css("visibility","hidden")}),s.on("focus",function(){var e=QHPass.regUtils.getPassLevel(i.val());switch(e){case-1:r.html("\u5bc6\u7801\u5e94\u4e3a6-20\u4e2a\u5b57\u7b26\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09").css("visibility","visible");break;case 0:r.html("\u5bc6\u7801\u4e0d\u80fd\u5168\u4e3a\u76f8\u540c\u5b57\u7b26").css("visibility","visible");break;case 1:r.html("\u5bc6\u7801\u4e0d\u80fd\u4e3a\u8fde\u7eed\u5b57\u7b26").css("visibility","visible");break;default:}})}catch(o){throw"FPassword:_checkPassAction:"+o.message}}function P(e){var t=e.trim();return g.test(t)?!0:!1}function H(){try{var e="http://captcha.360.cn/image.php?app=ypshare&t=",t=(new Date).getTime(),n=e+t;W(".verCode img").attr("src",n),W(".verCode input").val("")}catch(r){throw"FPassword:_refVerCode:"+r.message}}function B(){Ajax.post("/authority/getAuthentication",{},function(e){var t=e.evalExp();if(!t.errno){yunpan.authority.createResetPassDia();var n=W("#resetPassDia .chooseEmailType"),r=W("#resetPassDia .choosePhoneType"),i=W("#resetPassDia .resetPassType");t.data.secEmailActivedStatus?(n.query("em").html(t.data.secEmail),W("#resetPassDia .mobileTpl .text").html(t.data.secEmail.subByte(18,"\u2026"))):(n.query("input")[0].disabled=!0,n.addClass("disabled"),n.query("em").html("\u6682\u65e0")),t.data.secMobileActivedStatus?(r.query("em").html(t.data.secMobile),W("#resetPassDia .phoneTpl .text").html(t.data.secMobile)):(r.query("input")[0].disabled=!0,r.addClass("disabled"),r.query("em").html("\u6682\u65e0")),i[0].disabled?i[1].disabled||(i[1].checked=!0):i[0].checked=!0}else yunpan.Msg.alert(t.errmsg,{type:"error"})})}function F(e){try{w=!0;var t=f.attr("className").split(" ")[3];switch(t){case"step1":var n=e==1?function(){if(r[1].disabled&&r[0].disabled)return;r[0].checked==1?i.show():s.show(),W_chooseType.hide(),o.show(),v.html(""),f.replaceClass("step1","step2"),d.replaceClass("flow-step-1","flow-step-2")}:function(){};n();break;case"step2":var n=e==1?function(){var e="",t=W("#resetPassDia .help-inline-erro");i.isVisible()?e=l[0].value:e=l[1].value;if(!m.test(e.trim())){t.html("\u8bf7\u8f93\u51656\u4f4d\u9a8c\u8bc1\u7801\u6570\u5b57").show();return}Ajax.post("/authority/checkVeri",{veri:e},function(e){var n=e.evalExp();n.errno?t.html(n.errmsg).show():(i.hide(),s.hide(),o.hide(),f.replaceClass("step2","step3"),c.show(),h.focus(),d.replaceClass("flow-step-2","flow-step-3"),W_nextStepBtn.html("\u786e\u5b9a"))})}:function(){W_chooseType.show(),o.hide(),i.hide(),s.hide(),f.replaceClass("step2","step1")};n();break;case"step3":var n=e==1?function(){_(h,p)&&Ajax.post("/authority/resetPass",{pass:hex_md5(p.val())},function(e){var t=e.evalExp();t.errno?W("#resetPassDia .sfile-pass-tip").html(t.errmsg).css("visibility","visible"):(c.hide(),W_resetOKTpl.show(),f.replaceClass("step3","step4"),d.replaceClass("flow-step-3","flow-step-4"),W_nextStepBtn.hide())})}:function(){};n();break;case"step4":j.hide(),j.dispose(),j=null;break;default:}}catch(u){throw"FPassword:_stepChange:"+u.message}}function I(){var e;try{var t=yunpan.dialog.create({title:"360\u4e91\u76d8\u5b89\u5168\u5bc6\u7801\u4fee\u6539",className:"panel-t1 y-pop",body:A,wrapId:"modiPassDia",withClose:!0,buttons:[{text:"\u786e\u5b9a",type:"blue",withIcon:!1,handler:function(n){var s="";if(e.isVisible()){var o=e.query("input").val();if(o==""){W("#modiPassDia .sfile-pass-tip").html("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801");return}if(!P(o)){W("#modiPassDia .sfile-pass-tip").html("\u9a8c\u8bc1\u7801\u9519\u8bef");return}s=o}_(r,i)&&Ajax.post("/authority/changePass",{old_pass:hex_md5(W(".oldPass").val()),new_pass:hex_md5(i.val()),captcha:s},function(n){var r=n.evalExp();if(!r.errno){yunpan.Msg.alert("\u5b89\u5168\u5bc6\u7801\u4fee\u6539\u6210\u529f\uff01",{type:"success"}),t.hide(),t.dispose(),t=null;return}W("#modiPassDia .sfile-pass-tip").html(r.errmsg).css("visibility","visible"),H();if(r.errno=="31306"){e.parentNode("div").show(),e.query(".refresh").on("click",H);return}})}},{text:"\u53d6\u6d88",handler:function(){t.hide(),t.dispose(),t=null}}]});t.show(),e=W("#modiPassDia .safe-code-info .verCode"),W("#modiPassDia .forgetPass").on("click",function(){t.hide(),t.dispose(),t=null,B()});var n=W("#modiPassDia .sfile-pass-tip"),r=W("#modiPassDia .sfile-pass"),i=W("#modiPassDia .sfile-repass");D(n,r,i)}catch(s){throw"FPassword: createModiPassDia:"+s.message}}function q(e){try{var t=yunpan.dialog.create({title:"360\u4e91\u76d8\u5b89\u5168\u5bc6\u7801\u8bbe\u7f6e",className:"panel-t1 y-pop",wrapId:"setPass",body:T,withClose:!0,buttons:[{text:"\u786e\u5b9a",type:"blue",withIcon:!1,handler:function(n){var s="";e&&e=="userInfo"?s="":yunpan.filelist.curFunc=="recycle"?s="rb_safe_key":s="safe_key",_(r,i)&&Ajax.post("/authority/setPass",{pass:hex_md5(i.val()),safe_key_type:s},function(e){var n=e.evalExp();n.errno?yunpan.Msg.alert(n.errmsg,{type:"error"}):s==""?top.location.href="/my/index/?p=profile":yunpan.filelist.curFunc=="recycle"?Ajax.post("/authority/lockRecycleBin",{},function(e){var t=e.evalExp();t.errno?yunpan.Msg.alert(t.errmsg,{type:"error"}):(W("#tbOpenPassword").hide(),W("#tbOpenPasswordDone").show(),yunpan.filelist.list())}):Ajax.post("/authority/openSafeBox",{},function(e){var t=e.evalExp();t.errno?yunpan.Msg.alert(t.errmsg,{type:"error"}):yunpan.filelist.list()}),t.hide(),t.dispose(),t=null})}},{text:"\u53d6\u6d88",handler:function(){t.hide(),t.dispose(),t=null}}]});t.show();var n=W("#setPass .sfile-pass-tip"),r=W("#setPass .sfile-pass"),i=W("#setPass .sfile-repass");D(n,r,i)}catch(s){throw"FPassword:createSetPassDia:"+s.message}}function U(e){var t=e.keyCode;t==13&&R()}function z(){W("#listHolder").html(N),n=W("#sfileCheckPassDia .verCode"),W("#sfileCheckPassDia .safepass").focus(),W("#sfileCheckPassDia .btn").on("click",R),W(document).un("keydown",Y),W("#sfileCheckPassDia .forgetPass").on("click",function(){B(),W(document).un("keydown",U)}),W(document).on("keydown",U)}function X(e,t){var n=t==undefined?"\u4e91\u76d8\u5b89\u5168\u5bc6\u7801\u8fd8\u672a\u8bbe\u7f6e\uff0c\u8bf7\u5148\u8bbe\u7f6e\u5b89\u5168\u5bc6\u7801\u624d\u80fd\u542f\u7528\u6587\u4ef6\u4fdd\u9669\u7bb1\uff0c\u662f\u5426\u7acb\u5373\u8bbe\u7f6e\uff1f":t,r=['<div class="safe-box set-code-ask">','<p class="tips">','<i class="icon icon-4"></i>','<span class="text">'+n+"</span>","</p>","</div>"].join("");try{var i=yunpan.dialog.create({title:"\u6587\u4ef6\u4fdd\u9669\u7bb1\u542f\u7528",wrapId:"openPass",className:"panel-t1 y-pop",body:r,withClose:!0,buttons:[{text:"\u7acb\u5373\u8bbe\u7f6e",type:"blue",withIcon:!1,handler:function(t){yunpan.authority.createSetPassDia(e),i.hide(),i.dispose(),i=null}},{text:"\u53d6\u6d88",handler:function(e){i.hide(),i.dispose(),i=null}}]});i.show()}catch(s){throw"FPassword:createOpenPassDia:"+s.message}}function V(){try{j=yunpan.dialog.create({title:"\u627e\u56de360\u4e91\u76d8\u5b89\u5168\u5bc6\u7801",className:"panel-t1 y-pop step1",wrapId:"resetPassDia",body:O,withClose:!0,buttons:[{text:"\u4e0a\u4e00\u6b65",withIcon:!1,id:"preStep",handler:function(e){F(0)}},{text:"\u4e0b\u4e00\u6b65",type:"blue",id:"nextStep",withIcon:!1,handler:function(e){w&&(w=!1,F(1))}}]}),r=W("#resetPassDia .resetPassType"),i=W("#resetPassDia .mobileTpl"),l=W("#resetPassDia .VeriCodeIpt"),s=W("#resetPassDia .phoneTpl"),W_chooseType=W("#resetPassDia .chooseType"),o=W("#preStep"),W_nextStepBtn=W("#nextStep"),f=W("#resetPassDia"),c=W("#resetPassDia .resPassTpl"),h=W("#resetPassDia .pass"),p=W("#resetPassDia .repass"),u=W("#resetPassDia .sendVerMess"),a=W("#resetPassDia .sendVerEmail"),d=W("#resetPassDia .flow-step"),W_resetOKTpl=W("#resetPassDia .resetOKTpl"),v=W("#resetPassDia .veriTime"),o.hide(),j.show(),u.on("click",function(e){if(b)return;Ajax.post("/authority/sendVeriToMobile",{},function(e){b=!0;var t=e.evalExp();u.hide(),t.errno==0?(y=t.data.interval,M()):(v.html(t.errmsg).show(),t.errno==31101?setTimeout(function(){y=120,M()},2e3):b=!1)})}),a.on("click",function(e){if(b)return;Ajax.post("/authority/sendVeriToMail",{},function(e){b=!0;var t=e.evalExp();a.hide(),t.errno==0?(y=t.data.interval,M()):(v.html(t.errmsg).show(),t.errno==31101?setTimeout(function(){y=120,M()},2e3):b=!1)})}),l.on("focus",function(){W("#resetPassDia .help-inline-erro").hide()})}catch(e){throw"FPassword:createResetPassDia:"+e.message}}function $(e){try{var t=yunpan.dialog.create({title:"360\u4e91\u76d8\u5b89\u5168\u5bc6\u7801",className:"panel-t1 y-pop",wrapId:"bindDia",body:x,withClose:!0,buttons:[{text:"\u524d\u5f80\u7ed1\u5b9a",type:"blue",withIcon:!1,handler:function(n){(!e||e!="userInfo")&&yunpan.envSwitch.showIfrPage("/user/info?from=set"),t.hide(),t.dispose(),t=null}}]});t.show()}catch(n){throw"FPassword:createBindDia:"+n.message}}function Y(e){var t=e.keyCode;t==13&&G(K,Q)}function Z(){W("#listHolder").html(C),Q=!1,n=W("#recycleCheckPassDia .verCode"),W("#recycleCheckPassDia .recyclesafepass").focus(),W("#recycleCheckPassDia .btn").on("click",function(){G(null,Q)}),W("#recycleCheckPassDia .forgetPass").on("click",function(){B(),W(document).un("keydown",Y)}),W(document).on("keydown",Y),W(document).un("keydown",U)}function et(e){K=e,Q=!0;try{J||(J=yunpan.dialog.create({title:"360\u4e91\u76d8\u5b89\u5168\u5bc6\u7801",className:"panel-t1 y-pop",body:L,withClose:!0,wrapId:"recycleCheckPassDia",aftershowcallback:function(){W("#recycleCheckPassDia .recyclesafepass").focus()},buttons:[{text:"\u786e\u5b9a",type:"blue",withIcon:!1,handler:function(e){G(K,Q)}}]})),J.show(),n=W("#recycleCheckPassDia .verCode"),W(document).un("keydown",U),W("#recycleCheckPassDia .forgetPass").on("click",function(){J.hide(),J.dispose(),J=null,B(),W("#tbClearall").addClass("y-btn-disable"),W(document).un("keydown",Y)}),W(document).on("keydown",Y)}catch(t){throw"FPassword:createRecycleCheckPassDia:"+t.message}}function nt(){try{tt||(tt=yunpan.dialog.create({title:"360\u4e91\u76d8\u5b89\u5168\u5bc6\u7801",className:"panel-t1 y-pop",wrapId:"recycleCloseDia",body:E,withClose:!0,buttons:[{text:"\u53d6\u6d88\u56de\u6536\u7ad9\u5b89\u5168\u5bc6\u7801",type:"blue",withIcon:!1,handler:function(e){tt.hide(),tt.dispose(),tt=null;var t=function(){Ajax.post("/authority/unlockRecycleBin",{},function(e){var t=e.evalExp();t.errno?yunpan.Msg.alert(t.errmsg,{type:"error"}):(W("#tbOpenPassword").show(),W("#tbOpenPasswordDone").hide(),yunpan.tips.show("\u5df2\u6210\u529f\u89e3\u9664\u5bf9\u56de\u6536\u7ad9\u7684\u5b89\u5168\u5bc6\u7801\u4fdd\u62a4"),yunpan.filelist.list())})};yunpan.authority.createRecycleCheckPassDia(t)}}]})),tt.show()}catch(e){throw"FPassword:createRecycleCloseDia:"+e.message}}function it(){try{rt||(rt=yunpan.dialog.create({title:"360\u4e91\u76d8\u5b89\u5168\u5bc6\u7801",className:"panel-t1 y-pop",wrapId:"recycleOpenPassDia",body:S,withClose:!0,buttons:[{text:"\u786e\u5b9a",type:"blue",withIcon:!1,handler:function(e){rt.hide(),rt.dispose(),rt=null}}]})),rt.show()}catch(e){throw"FPassword:createRecycleOpenPassDia:"+e.message}}var e=null,t=null,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m=/^\d{6}$/,g=/^\d{4}$/,y=10,b=!1,w=!0,E=['<div class="safe-box">','<p class="tips">','<i class="icon icon-5"></i>','<span class="text">\u56de\u6536\u7ad9\u4e91\u76d8\u5b89\u5168\u5bc6\u7801\u5df2\u542f\u7528\u4e2d...</span>',"</p>",'<p class="info">\u60a8\u662f\u5426\u8981\u5bf9\u56de\u6536\u7ad9\u53d6\u6d88\u4e91\u76d8\u5b89\u5168\u5bc6\u7801\uff1f\u53d6\u6d88\u540e\u8fdb\u5165\u56de\u6536\u7ad9\u5c06\u4e0d\u518d\u9700\u8981\u518d\u6b21\u9a8c\u8bc1</p>',"</div>"].join(""),S=['<div class="safe-box">','<p class="tips">','<i class="icon icon-3"></i>','<span class="text">\u56de\u6536\u7ad9\u542f\u7528\u4e91\u76d8\u5b89\u5168\u5bc6\u7801\u5df2\u6210\u529f\uff01</span>',"</p>",'<p class="info">\u540e\u7eed\u8fdb\u5165\u56de\u6536\u7ad9\u9700\u8981\u4e91\u76d8\u5b89\u5168\u5bc6\u7801\u9a8c\u8bc1</p>',"</div>"].join(""),x=['<div class="safe-box code-confirmation">','<p class="tips">','<i class="icon icon-2"></i>','<span class="text">\u4e91\u76d8\u5b89\u5168\u5bc6\u7801\u672a\u8bbe\u7f6e\uff0c\u60a8\u81f3\u5c11\u9700\u8981\u9a8c\u8bc1\u5bc6\u4fdd\u90ae\u7bb1\u6216\u7ed1\u5b9a\u624b\u673a\u53f7\u624d\u80fd\u7ee7\u7eed\u8bbe\u7f6e</span>',"</p>","</div>"].join(""),T=['<div class="safe-code-info set-code-pass">','<h3 class="sub-title">\u8bbe\u7f6e\u4e91\u76d8\u5b89\u5168\u5bc6\u7801</h3>','<p class="wrong-tip sfile-pass-tip" style="visibility:hidden">\u5f53\u524d\u5bc6\u7801\u8f93\u5165\u9519\u8bef</p>','<div class="form-horizontal">','<div class="control-group clearfix">','<label for="password" class="control-label">\u8f93\u5165\u5bc6\u7801\uff1a</label>','<div class="controls">','<input class="ipt-text sfile-pass" type="password" name="password" placeholder="\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801">',"</div>","</div>",'<div class="control-group clearfix">','<label for="repassword" class="control-label">\u786e\u8ba4\u5bc6\u7801\uff1a</label>','<div class="controls">','<input class="ipt-text sfile-repass" type="password" name="repassword" placeholder="\u518d\u6b21\u8f93\u5165\u5b89\u5168\u5bc6\u7801">',"</div>","</div>","</div>","</div>"].join(""),N=['<div id="sfileCheckPassDia" class="start-mod">','<div class="enter-icon"></div>','<div class="mod safe-box enter-safe-code enter-recycled-code">','<p class="tips">','<span class="text">\u6587\u4ef6\u4fdd\u9669\u7bb1\u5728\u5b89\u5168\u5bc6\u7801\u4fdd\u62a4\u4e0b\uff0c\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801</span>',"</p>",'<p class="wrong-tip sfile-pass-tip" style="visibility:hidden">\u5f53\u524d\u5bc6\u7801\u8f93\u5165\u9519\u8bef</p>','<input type="password" class="safepass ipt-text" placeholder="\u8f93\u5165\u5b89\u5168\u5bc6\u7801">','<span class="btn">\u8fdb\u5165\u4fdd\u9669\u7bb1</span>','<p class="enter-code verCode" style="display:none">','\u8f93\u5165\u9a8c\u8bc1\u7801\uff1a<input type="text" class="ipt-text"><img class="code-img refresh" src="/resource/img/blank.gif" alt="\u9a8c\u8bc1\u7801">',"</p>",'<p class="forget-password forgetPass">\u5fd8\u8bb0\u5b89\u5168\u5bc6\u7801\uff1f</p>',"</div>","</div>"].join(""),C=['<div id="recycleCheckPassDia" class="start-mod">','<div class="enter-icon"></div>','<div class="mod safe-box enter-recycled-code">','<p class="tips">','<span class="text">\u56de\u6536\u7ad9\u5728\u5b89\u5168\u5bc6\u7801\u7684\u4fdd\u62a4\u4e0b\uff0c\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801</span>',"</p>",'<p class="wrong-tip sfile-pass-tip" style="visibility:hidden">\u5f53\u524d\u5bc6\u7801\u8f93\u5165\u9519\u8bef</p>','<input type="password" class="recyclesafepass ipt-text" placeholder="\u8f93\u5165\u5b89\u5168\u5bc6\u7801">','<span class="btn">\u8fdb\u5165\u56de\u6536\u7ad9</span>','<p class="enter-code verCode" style="display:none">','\u8f93\u5165\u9a8c\u8bc1\u7801\uff1a<input type="text" class="ipt-text"><img class="code-img refresh" src="/resource/img/blank.gif" alt="\u9a8c\u8bc1\u7801">',"</p>",'<p class="forget-password-enter forgetPass">\u5fd8\u8bb0\u5b89\u5168\u5bc6\u7801\uff1f</p>',"</div>","</div>"].join(""),k=['<div id="sfile-openSfile" class="start-mod">','<div class="mod safe-box">','<a href="###" onclick="return false;" class="openPass btn">\u542f\u7528\u4fdd\u9669\u7bb1</a>','<a href="###" onclick="try{monitor.btnLog(\'locksfile\')}catch(e){};return false;" class="previewInitFile">\u7b80\u5355\u4e86\u89e3\u4e00\u4e0b</a>',"</div>","</div>"].join(""),L=['<div class="safe-box enter-recycled-code">','<p class="tips">','<i class="icon icon-6"></i>','<span class="text">\u56de\u6536\u7ad9\u5728\u5b89\u5168\u5bc6\u7801\u7684\u4fdd\u62a4\u4e0b\uff0c\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801</span>',"</p>",'<p class="wrong-tip sfile-pass-tip" style="visibility:hidden">\u5f53\u524d\u5bc6\u7801\u8f93\u5165\u9519\u8bef</p>','<input type="password" class="recyclesafepass ipt-text" placeholder="\u8f93\u5165\u5b89\u5168\u5bc6\u7801">','<a href="###" onclick="return false;" class="forget-password forgetPass">\u5fd8\u8bb0\u5b89\u5168\u5bc6\u7801\uff1f</a>','<p class="enter-code verCode" style="display:none">','\u8f93\u5165\u9a8c\u8bc1\u7801\uff1a<input type="text" class="ipt-text"><img class="code-img refresh" src="/resource/img/blank.gif" alt="\u9a8c\u8bc1\u7801">',"</p>","</div>"].join(""),A=['<div class="safe-code-info">','<h3 class="sub-title">\u4fee\u6539\u4e91\u76d8\u5b89\u5168\u5bc6\u7801</h3>','<div class="form-horizontal edit-code">','<div class="control-group clearfix">','<label for="" class="control-label">\u5f53\u524d\u5b89\u5168\u5bc6\u7801\uff1a</label>','<div class="controls">','<input class="ipt-text oldPass" type="password">','<span class="help-inline">','<a href="###" onclick="return false;" class="forget-password forgetPass">\u5fd8\u8bb0\u5b89\u5168\u5bc6\u7801\uff1f</a>',"</span>","</div>","</div>",'<div class="control-group clearfix">','<label for="password" class="control-label">\u65b0\u5b89\u5168\u5bc6\u7801\uff1a</label>','<div class="controls">','<input class="ipt-text sfile-pass" name="password" type="password"></div>',"</div>",'<div class="control-group clearfix">','<label for="repassword" class="control-label">\u786e\u8ba4\u65b0\u5b89\u5168\u5bc6\u7801\uff1a</label>','<div class="controls">','<input class="ipt-text sfile-repass" name="repassword" type="password"></div>',"</div>",'<div class="control-group clearfix" style="display:none">','<p class="enter-code verCode">','<label for="" class="control-label">\u8f93\u5165\u9a8c\u8bc1\u7801\uff1a</label>','<input type="text" class="ipt-text"><img class="code-img refresh" src="/resource/img/blank.gif" alt="\u9a8c\u8bc1\u7801">',"</p>","</div>",'<p class="help-block sfile-pass-tip" style="visibility:hidden">\u5f53\u524d\u5bc6\u7801\u8f93\u5165\u9519\u8bef</p>',"</div>"].join(""),O=W("#resetPassTpl").html(),M=function(){W(".veriTime").html("\u5df2\u53d1\u9001\uff0c<em>"+y+"</em>\u79d2\u540e\u53ef\u91cd\u53d1").show(),W(".sendTime").hide();var e=setTimeout(function(){y-=1,y>=0?M():(clearTimeout(e),W(".sendTime").show(),W(".veriTime").hide(),b=!1)},1e3)},j=null,R=function(){var e=W("#sfileCheckPassDia .safepass").val(),t="";if(e==""){W("#sfileCheckPassDia .sfile-pass-tip").html("\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801").css("visibility","visible");return}if(n.isVisible()){var r=n.query("input").val();if(r==""){W("#sfileCheckPassDia .sfile-pass-tip").html("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801").css("visibility","visible");return}if(!P(r)){W("#sfileCheckPassDia .sfile-pass-tip").html("\u9a8c\u8bc1\u7801\u9519\u8bef").css("visibility","visible");return}t=r}Ajax.post("/authority/checkPass",{pass:hex_md5(e),captcha:t,safe_key_type:"safe_key"},function(e){var t=e.evalExp();if(t.errno==0){W(document).un("keydown",U),W("#leftPanel .sFile").replaceClass("current","current-lock"),yunpan.filelist.sFileState=1,yunpan.filelist.list();return}W(".sfile-pass-tip").html(t.errmsg).css("visibility","visible"),H();if(t.errno=="31306"){n.show(),n.query(".refresh").on("click",H);return}})},J=null,K=null,Q=!1,G=function(e,t){try{var r=W("#recycleCheckPassDia .recyclesafepass").val(),i="";if(r==""){W("#recycleCheckPassDia .sfile-pass-tip").html("\u8bf7\u8f93\u5165\u5b89\u5168\u5bc6\u7801").css("visibility","visible");return}if(n.isVisible()){var s=n.query("input").val();if(s==""){W("#recycleCheckPassDia .sfile-pass-tip").html("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801").css("visibility","visible");return}if(!P(s)){W("#recycleCheckPassDia .sfile-pass-tip").html("\u9a8c\u8bc1\u7801\u9519\u8bef").css("visibility","visible");return}i=s}Ajax.post("/authority/checkPass",{pass:hex_md5(r),captcha:i,safe_key_type:"rb_safe_key"},function(r){var i=r.evalExp();if(i.errno==0){t&&(J.hide(),J.dispose(),J=null),W("#recycleCheckPassDia .recyclesafepass").blur(),W(document).un("keydown",Y),e?e():yunpan.filelist.list();return}W("#recycleCheckPassDia .sfile-pass-tip").html(i.errmsg).css("visibility","visible"),H();if(i.errno=="31306"){n.show(),n.query(".refresh").on("click",H);return}})}catch(o){throw"FPassword:_gointoRecyFunc"+o.message}},tt,rt=null;return{openSfile:function(e){W("#listHolder").html(k),W("#sfile-openSfile .openPass").on("click",function(){Ajax.post("/authority/isAuthentication",{},function(e){var t=e.evalExp();t.errno?yunpan.authority.createBindDia():Ajax.post("/authority/isSetPass",{},function(e){var t=e.evalExp();t.errno?yunpan.authority.createOpenPassDia():Ajax.post("/authority/openSafeBox",{},function(e){t.errno?yunpan.Msg.alert(t.errmsg,{type:"error"}):yunpan.filelist.list()})})})}),W("#sfile-openSfile .previewInitFile").on("click",function(e){e.preventDefault();var t=yunpan.docviewer.getUrl("sFile","default","doc","","");window.open(t)})},enterSfile:z,createSetPassDia:q,createResetPassDia:V,createBindDia:$,createOpenPassDia:X,createModiPassDia:I,enterRecycle:Z,createRecycleCheckPassDia:et,createRecycleCloseDia:nt,createRecycleOpenPassDia:it}}(),yunpan.cmdCenter=function(){function openDoc(){var e=getSelItems();if(!e)return;if(!isLogin())return!1;var t=e[0],n=t.attr("data-file-suffix"),r=t.attr("data-nid"),i=t.attr("data-scid"),s=t.attr("data-ori-size"),o=yunpan.docviewer.getUrl(yunpan.filelist.curFunc=="sFile"?"sFile":"file",r,n,null,{scid:i,size:s});o&&window.open(o)}function downloadItem(e){var t=Object.isString(e)&&e.length>0?yunpan.fo.getAllFile().filter(function(t){return t.attr("data-nid")==e}):getSelItems();if(!t)return;if(!isLogin())return!1;var n=t[0];if(yunpan.filelist.curFunc=="link"){yunpan.cmdCenter.viewLinkItem(n.attr("data-url"));return}var r=n.attr("data-path");W("#hidDLPath").val(r),W("#hidDLNid").val(n.attr("data-nid")),W("#frmDownload").attr("action",yunpan.config.url.f_down),W("#frmDownload").submit(),monitor.btnLog("Download"),monitor.tlog({qid:SYS_CONF.qid||"",m:"my",a:"20130108-my-dl",s:n.attr("data-file-suffix")})}function packDownloadItem(){var e=getSelItems();if(!e)return;if(!isLogin())return!1;var t="",n=[],r=[],i=0,s=yunpan.filelist.path;for(var o=0,u=e.length;o<u;o++){var a=e[o],f,l=e[o].attr("data-path").split("/");a.attr("data-type")=="folder"?f=l[l.length-2]+"/":f=l[l.length-1],r.push(a.attr("data-nid")),n.push(f)}for(var o=0;o<yunpan.filelist.nav.length;o++)if(yunpan.filelist.nav[o].path==s){i=yunpan.filelist.nav[o].nid;break}e.length==1&&e[0].attr("data-type")=="folder"?(l=e[0].attr("data-path").split("/"),t=l[l.length-2]+".zip"):t="360\u4e91\u76d8\u6253\u5305\u4e0b\u8f7d\u7684\u6587\u4ef6.zip";var c;yunpan.filelist.curFunc=="file"?c={fatherPath:s,"path[]":n}:c={pid:i,"nids[]":r};var h=new Ajax({url:yunpan.config.url.packDown,method:"post",data:c,async:!1,onsucceed:function(){var e=this.requester.responseText.evalExp();if(e.errno==0){var o=g("frmPackDownload");o.packKey.value=e.data.download_pack_key,o.packSign.value=e.data.download_pack_sign,o.fatherPath.value=s,o.fileNames.value=n.join("|"),o.nids.value=r.join("|"),o.pid.value=i,o.zipFileName.value=t,e.data.host&&W(o).attr("action","http://"+e.data.host+"/intf.php"),W(o).query(".method").attr("name","method"),yunpan.filelist.curFunc=="sFile"?W(o).query(".method").attr("value","SSync.downloadPack"):W(o).query(".method").attr("value","Sync.downloadPack"),o.submit()}else yunpan.Msg.alert(e.errmsg,{type:"error"})}});h.send(),monitor.btnLog("Download"),monitor.tlog({qid:SYS_CONF.qid||"",m:"my",a:"20130108-my-dl",s:"packdl"})}function delItem(){var items=getSelItems();if(!items)return;if(!isLogin())return!1;monitor.btnLog("Delete");var batchParamData,dataData,delTitle;yunpan.filelist.curFunc=="file"?delTitle="<p>\u786e\u5b9a\u8981\u5220\u9664\u8fd9<em>"+items.length+'</em>\u9879\uff1f<p><p class="info">\u5220\u9664\u540e\u53ef\u5728\u56de\u6536\u7ad9\u8fd8\u539f\u3002</p>':delTitle="<p>\u786e\u5b9a\u8981\u6c38\u4e45\u5220\u9664\u8fd9<em>"+items.length+'</em>\u9879\uff1f</p><p class="info info-warning">\u5220\u9664\u540e\uff0c\u4e0d\u8fdb\u56de\u6536\u7ad9\uff01</p>',yunpan.Msg.confirm(delTitle,{title:"\u786e\u8ba4\u5220\u9664",type:"warning",wrapId:"deleteDia",width:300,textwidth:161,fn:function(type){if(type!="yes")return;var paths=[],nids=[];items.forEach(function(e){var t=e.attr("data-path");paths.push(t),nids.push(e.attr("data-nid"))}),yunpan.filelist.curFunc=="file"?(batchParamData="path[]",dataData=paths):(batchParamData="nids[]",dataData=nids),yunpan.tips.show(),yunpan.BatchRequest.create({url:yunpan.config.url.delToRecyle,batchParam:batchParamData,data:dataData,batchSuccess:function(txt){var ret=eval("("+txt+")");ret
.errno!=0&&(yunpan.tips.hide(),yunpan.Msg.alert(ret.errmsg,{type:"error"}),yunpan.filelist.list(),yunpan.BatchRequest.terminate()),yunpan.ytree.isFolderChanged=!0,yunpan.ytreeSfile.isFolderChanged=!0,yunpan.ytreeSfileTofile.isFolderChanged=!0},success:function(){yunpan.tips.show("\u5220\u9664\u6210\u529f\uff01");try{items.forEach(function(e){e.removeNode()})}catch(e){}yunpan.fo.initFileIndex(),yunpan.userInfo.updateDiskInfo(),yunpan.fo.getFileNum()<1&&yunpan.filelist.page>0&&(yunpan.filelist.page=yunpan.filelist.page-1),yunpan.filelist.list(),yunpan.cmdCenter.updateStatus()}})}})}function refresh(){yunpan.filelist.list()}function renameItem(){function m(e){var t=W("textarea#rename-text");if(t.length<=0)return;var n=t.get("value"),r=W("body .folder-name-ruler"),i,s,o;r=r.length>0?r:W('<div class="folder-name-ruler"></div>').insertTo("beforeend",document.body),r.html(n.encode4Html().replace(/ /g,"&nbsp;")),i=r.getSize(),o=i.height,o=o>32?o+16:32,t.setStyle("height",o+"px")}function y(e){e.stopPropagation()}var e=getSelItems();if(!e||e.length>1)return;if(!isLogin())return!1;monitor.btnLog("Rename");var t=e[0],n=t.attr("data-path"),r=t.attr("data-nid"),i=t.attr("data-type"),s=t.attr("data-title"),o=yunpan.filelist.listtype,u;yunpan.fo.unSelectFile(t),yunpan.cmdCenter.updateStatus(),t.addClass("renaming").query(".text").hide(),o===1?t.query(".column-name").appendChild('<input id="rename-text" type="text" value="'+s+'" />'):t.query(".column-name").appendChild('<textarea id="rename-text">'+s+"</textarea>");var a=g("rename-text"),f=a.value,l=i!="folder"?f.lastIndexOf("."):f.length,c=0,h=l<0?f.length:l;if(a.setSelectionRange)a.focus(),a.setSelectionRange(c,h);else if(a.createTextRange){var p=a.createTextRange();p.collapse(!0),p.moveEnd("character",h),p.moveStart("character",c),p.select()}var d=W("#rename-text"),v=!1;d.on("blur",function(e){if(v)return;var o=W(this),u=o.attr("value"),a=null;if(u===s)return o.removeNode(),t.query(".text").show(),t.removeClass("renaming"),window.setTimeout(function(){yunpan.fo.selectFile(t),yunpan.cmdCenter.updateStatus()},10),!1;/[\\\/\:\*\?\"<>|]+/.test(u)?(a='\u4e0d\u80fd\u5305\u542b\\ / : * ? " < > |\u7b49\u5b57\u7b26\uff01',msgwith=224):/^\./.test(u)?(a="\u65b0\u540d\u79f0\u4e0d\u80fd\u4ee5.\u5f00\u5934",msgwith=128):/^\s*$/.test(u)?(a="\u65b0\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01",msgwith=128):yunpan.filelist.path==="/"&&"\u4e91\u540c\u6b65"===u&&(a='"\u4e91\u540c\u6b65"\u662f\u7cfb\u7edf\u76ee\u5f55\uff0c\u8bf7\u4f7f\u7528\u5176\u4ed6\u540d\u5b57\u521b\u5efa\u76ee\u5f55\uff01',msgwith=191);if(a)return v=!0,window.setTimeout(function(){yunpan.Msg.alert(a,{type:"error",textwidth:msgwith,fn:function(){v=!1;if(Browser.firefox)return;W("#rename-text").focus().select()}})},10),!1;yunpan.tips.show(),u=u.replace(/\r/g,"").replace(/\n/g,""),v=!0,Ajax.post(yunpan.config.url.rename,{path:n,nid:r,newpath:i==="folder"?u+"/":u},function(e){e=e.evalExp();if(e.errno)yunpan.tips.hide(),e.errno===3005&&(e.errmsg="\u5df2\u5b58\u5728\u76f8\u540c\u6587\u4ef6\u540d\uff01"),yunpan.Msg.alert(e.errmsg,{type:"error",fn:function(){if(Browser.firefox)return;W("#rename-text").focus().select(),v=!1}});else{yunpan.tips.show("\u91cd\u547d\u540d\u6210\u529f\uff01"),yunpan.fo.selectFile(t),yunpan.cmdCenter.updateStatus(),W("#rename-text").removeNode(),t.query(".text").html(u).show(),t.removeClass("renaming"),t.attr("data-title",u);var n=t.attr("data-path"),r=n.split("/");for(var i=r.length-1;i>=0;i-=1)r[i]===s&&(r[i]=u);n=r.join("/"),t.attr("data-path",n),yunpan.filelist.list(null,null,null,u),v=!1,yunpan.filelist.curFunc=="file"?(yunpan.ytreeSfileTofile.isFolderChanged=!0,yunpan.ytree.isFolderChanged=!0):yunpan.ytreeSfile.isFolderChanged=!0}})}).on("keydown",function(e){m(),e.keyCode===13&&(this.blur(),e.stopPropagation())}),d[0].oninput=m,d[0].onpropertychange=m,d.on("contextmenu",y).on("dblclick",y)}function moveItem(){monitor.btnLog("Move");if(!isLogin())return!1;var curFunc=yunpan.filelist.curFunc,okBtnFunc=function(){var newpath=yunpan.ytree.getFolder(),newNid=yunpan.ytree.getNid();if(!newpath)yunpan.Msg.alert("\u8bf7\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6\u5939\uff01",{type:"warning"});else{var paths=[],nids=[],items=getSelItems();if(!items)return diaMove.hide(),!1;if(newpath==yunpan.filelist.path)return diaMove.hide(),!1;items.forEach(function(e){var t=e.attr("data-path");paths.push(t);var n=e.attr("data-nid");nids.push(n)}),yunpan.tips.show(),yunpan.BatchRequest.create({url:"/file/move/",batchParam:"path[]",data:paths,params:{newpath:newpath},batchSuccess:function(txt){var ret=eval("("+txt+")");ret.errno!=0&&(yunpan.BatchRequest.terminate(),yunpan.tips.hide(),yunpan.Msg.alert(ret.errmsg,{type:"error"}),diaMove.hide())},success:function(){yunpan.tips.show("\u79fb\u52a8\u6210\u529f\uff01"),yunpan.ytree.isFolderChanged=!0;try{items.forEach(function(e){e.removeNode()})}catch(e){}yunpan.fo.initFileIndex(),yunpan.fo.getFileNum()<1&&yunpan.filelist.page>0&&(yunpan.filelist.page=yunpan.filelist.page-1),yunpan.filelist.list(),diaMove.hide()}})}};if(!diaMove){var moveTpl=['<div class="fileBox">','<h3 class="msg">\u9009\u62e9\u79fb\u52a8\u5230\u7684\u4f4d\u7f6e</h3>','<div class="fileBd">','<ul class="fileBdUl">','<li id="yunpanTree"></li>',"</ul>","</div>","</div>"].join("");diaMove=yunpan.dialog.create({body:moveTpl,title:"\u79fb\u52a8\u6587\u4ef6\uff08\u5939\uff09",withClose:!0,buttons:[{cls:"move",text:"\u786e\u5b9a\u79fb\u52a8",type:"blue",handler:function(){okBtnFunc()}},{text:"\u53d6\u6d88",handler:function(){diaMove.hide()}}]})}yunpan.ytree.show(),diaMove.show()}function moveOutSfile(){if(!isLogin())return!1;var e=function(){var e=yunpan.ytreeSfileTofile.getFolder(),t=yunpan.ytreeSfileTofile.getNid();if(!e)yunpan.Msg.alert("\u8bf7\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6\u5939\uff01",{type:"warning"});else{var n=[],r=[],i=getSelItems(),s=[],o=[],u=[];if(!i)return diaMove.hide(),!1;i.forEach(function(e){var t=e.attr("data-nid"),n=e.attr("data-type");n=="file"?r.push(t):s.push(t)}),r.length>0&&(s.push(r),o.push(n)),diaMoveOutSfile.hide(),yunpan.tip.QuickTip.init({container:W("#mainPanel"),cls:"batchRequestTip",close:!0,closeIcon:!0}),yunpan.tip.QuickTip.show('\u6b63\u5728\u8f6c\u51fa...<em class="batch-title">0%</em>',"loading",0);var a=W(".x-quicktip em.batch-title"),f=367,l=!0,c=0,h=s.length,p=null,d=0;for(var v=0;v<h;v++)v==0?u[v]=parseInt(f/h):v==h-1?u[v]=f:u[v]=u[v-1]+parseInt(f/h);var m=function(){l?(c+=Math.floor((u[d]-c)*.1),a.html(parseInt(c/f*100,10)+"%"),p=setTimeout(m,100)):(a.html(parseInt(u[d]/f*100,10)+"%"),clearTimeout(p))},g=function(){l=!0,m(u[d]),Ajax.post("/sFile/transportFromSafeBox/",{"nids[]":s[d],new_pid:t},function(e){var t=e.evalExp();if(t.errno==0){l=!1,m(u[d]),d+=1;if(d<h)g();else{setTimeout(function(){yunpan.tip.QuickTip.hide()},300),d=0,yunpan.ytree.isFolderChanged=!0,yunpan.ytreeSfile.isFolderChanged=!0,yunpan.ytreeSfileTofile.isFolderChanged=!0;try{i.forEach(function(e){e.removeNode()})}catch(n){}yunpan.fo.initFileIndex(),yunpan.fo.getFileNum()<1&&yunpan.filelist.page>0&&(yunpan.filelist.page=yunpan.filelist.page-1),yunpan.filelist.list()}}else setTimeout(function(){yunpan.tip.QuickTip.hide()},300),yunpan.Msg.alert(ret.errmsg,{type:"error"})})};g()}};if(!diaMoveOutSfile){var t="";t=['<div class="fileBox">','<h3 class="msg">\u9009\u62e9\u79fb\u52a8\u5230\u5168\u90e8\u6587\u4ef6\u7684\u4f4d\u7f6e</h3>','<div class="fileBd">','<ul class="fileBdUl">','<li id="yunpanTreeSfiletofile"></li>',"</ul>","</div>","</div>"].join(""),diaMoveOutSfile=yunpan.dialog.create({body:t,title:"\u79fb\u52a8\u6587\u4ef6\uff08\u5939\uff09",withClose:!0,buttons:[{cls:"move",text:"\u786e\u5b9a\u79fb\u52a8",type:"blue",handler:function(){e()}},{text:"\u53d6\u6d88",handler:function(){diaMoveOutSfile.hide()}}]})}yunpan.ytreeSfileTofile.show(),diaMoveOutSfile.show()}function moveSfileItem(){if(!isLogin())return!1;if(!disSfileMove){var moveSfileTpl=['<div class="fileBox">','<h3 class="msg">\u9009\u62e9\u79fb\u52a8\u5230\u7684\u4f4d\u7f6e</h3>','<div class="fileBd">','<ul class="fileBdUl">','<li id="yunpanTreeSfile"></li>',"</ul>","</div>","</div>"].join("");disSfileMove=yunpan.dialog.create({body:moveSfileTpl,title:"\u79fb\u52a8\u6587\u4ef6\uff08\u5939\uff09",withClose:!0,buttons:[{cls:"move",text:"\u786e\u5b9a\u79fb\u52a8",type:"blue",handler:function(){var newpath=yunpan.ytreeSfile.getFolder(),dst_nid=yunpan.ytreeSfile.getNid();if(!newpath)yunpan.Msg.alert("\u8bf7\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6\u5939\uff01",{type:"warning"});else{var paths=[],nids=[],items=getSelItems();if(!items)return disSfileMove.hide(),!1;if(newpath==yunpan.filelist.path)return disSfileMove.hide(),!1;items.forEach(function(e){var t=e.attr("data-path"),n=e.attr("data-nid");paths.push(t),nids.push(n)}),yunpan.tips.show(),yunpan.BatchRequest.create({url:"/sFile/move/",batchParam:"nids[]",data:nids,params:{dst_nid:dst_nid},batchSuccess:function(txt){var ret=eval("("+txt+")");ret.errno!=0&&(yunpan.BatchRequest.terminate(),yunpan.tips.hide(),yunpan.Msg.alert(ret.errmsg,{type:"error"}),disSfileMove.hide())},success:function(){yunpan.tips.show("\u79fb\u52a8\u6210\u529f\uff01"),yunpan.ytreeSfile.isFolderChanged=!0;try{items.forEach(function(e){e.removeNode()})}catch(e){}yunpan.fo.initFileIndex(),yunpan.fo.getFileNum()<1&&yunpan.filelist.page>0&&(yunpan.filelist.page=yunpan.filelist.page-1),yunpan.filelist.list(),disSfileMove.hide()}})}}},{text:"\u53d6\u6d88",handler:function(){disSfileMove.hide()}}]})}yunpan.ytreeSfile.show(),disSfileMove.show()}function moveInSfile(){var e=[],t=getSelItems(),n=[],r=[];if(!t)return!1;t.forEach(function(t){var r=t.attr("data-nid"),i=t.attr("data-type");i=="file"?e.push(r):n.push(r)}),e.length>0&&n.push(e),yunpan.tip.QuickTip.init({container:W("#mainPanel"),cls:"batchRequestTip",close:!0,closeIcon:!0}),yunpan.tip.QuickTip.show('\u6b63\u5728\u8f6c\u5165...<em class="batch-title">0%</em>',"loading",0);var i=W(".x-quicktip em.batch-title"),s=367,o=!0,u=0,a=n.length,f=null,l=0;for(var c=0;c<a;c++)c==0?r[c]=parseInt(s/a):c==a-1?r[c]=s:r[c]=r[c-1]+parseInt(s/a);var h=function(){o?(u+=Math.floor((r[l]-u)*.1),i.html(parseInt(u/s*100,10)+"%"),f=setTimeout(h,100)):(i.html(parseInt(r[l]/s*100,10)+"%"),clearTimeout(f))},p=function(){o=!0,h(r[l]),Ajax.post("/sFile/transportToSafeBox",{"nids[]":n[l]},function(e){var t=e.evalExp();if(t.errno==0)o=!1,h(r[l]),l+=1,l<a?p():(setTimeout(function(){yunpan.tip.QuickTip.hide()},300),yunpan.filelist.list(),yunpan.ytree.isFolderChanged=!0,yunpan.ytreeSfile.isFolderChanged=!0,yunpan.ytreeSfileTofile.isFolderChanged=!0,l=0);else{if(t.errno==31203){var n=yunpan.dialog.create({body:'<div class="msg-panel msg-warning"><div class="msg-text-box"><div class="msg-text msg-warning-tip">\u60a8\u8fd8\u6ca1\u6709\u5f00\u542f\u6587\u4ef6\u4fdd\u9669\u7bb1\uff0c\u8bf7\u79fb\u6b65\u5f00\u542f</div></div></div>',title:"\u64cd\u4f5c\u63d0\u793a",buttons:[{text:"\u786e\u5b9a",handler:function(){n.hide(),n.dispose(),n=null,yunpan.filelist.curFunc="sFile",yunpan.cmdCenter.updateNav(),yunpan.filelist.list()}}]});n.show()}else yunpan.Msg.alert(t.errmsg,{type:"error"});setTimeout(function(){yunpan.tip.QuickTip.hide()},300)}})};p()}function uploadItem(){monitor.btnLog("Upload");if(!isLogin())return!1;var e=yunpan.upload.detectCapability();if(!e.supportPlugin&&!e.supportAjax&&!e.supportFlash){yunpan.Msg.alert('\u60a8\u8fd8\u6ca1\u6709\u5b89\u88c5flash\u64ad\u653e\u5668\uff0c\u8bf7\u70b9\u51fb<a href="http://www.adobe.com/go/getflash" target="_blank">\u8fd9\u91cc</a>\u5b89\u88c5',{type:"warning"});return}yunpan.cmdCenter.showUpload()}function newItem(){if(!isLogin())return!1;try{monitor.btnLog("Newfolder"),yunpan.fo.createFolder()}catch(e){}}function openItem(e){var t;e?t=[e]:t=getSelItems();if(!t||t.length>1)return;if(!isLogin())return!1;var n=t[0],r=n.attr("data-type"),i=n.attr("data-title"),s=n.attr("data-nid"),o=n.attr("data-path");if(r=="folder")yunpan.filelist.nav.push({title:i,nid:s,path:o}),yunpan.cmdCenter.gotoPath(o,s,null,null,!0,yunpan.filelist.curFunc);else if(n.attr("data-preview")!=""&&yunpan.filelist.curFunc!="link"){var u={},a,f,l,c,h=yunpan.filelist.curFunc;h==="link"?(u.noDel=!0,u.pos="link"):(u.noDel=!1,u.pos="my"),a=W("#list .preview"),f=a.getAttrAll("data-fhash"),l=a.getAttrAll("data-scid"),c=a.getAttrAll("data-ori-size"),u.nid=a.getAttrAll("data-nid"),u.name=a.getAttrAll("data-title"),u.pic=a.getAttrAll("data-pic"),u.preview=a.getAttrAll("data-preview");var p=[],d;for(var v=0;v<c.length;v++)c[v]>=20971520&&p.push(v);d=p.length;var m=n.getAttr("data-nid");for(var g=0;g<a.length;g++){var y=a.item(g),b=y.getAttr("data-nid");if(b===m){u.index=g;break}}if(d>0)for(var v=0;v<d;v++)u.preview[p[v]]="/resource/img/gallary/gallary-20M.png",u.pic[p[v]]="/resource/img/gallary/gallary-20M.png";yunpan.gallary.show(u),monitor.clickLog("gallary\u6253\u5f00")}else{var w=n.attr("data-file-suffix"),E=yunpan.docviewer.checkPreview(w,n.attr("data-ori-size")),S=yunpan.video.isVideo(w),x=yunpan.video.isPlayBySe(w);if(yunpan.filelist.curFunc!="file"&&yunpan.filelist.curFunc!="sFile"||!E.isDoc)if(yunpan.filelist.curFunc!="file"&&yunpan.filelist.curFunc!="sFile"||!S)yunpan.cmdCenter.downloadItem();else{if(!/^win/i.test(Browser.platform)&&!yunpan.video.isPlayByFlash(w)){yunpan.cmdCenter.downloadItem();return}var r=1;yunpan.filelist.curFunc=="sFile"&&(r=2),x?yunpan.video.play({player:"se",nid:s,type:r}):yunpan.video.play({play:"none_se",nid:s,type:r})}else E.isOversize?(monitor.yplog(902,{qid:SYS_CONF.qid}),yunpan.Msg.alert("\u8fd9\u4e2a\u6587\u6863\u592a\u5927\uff0c\u6682\u4e0d\u652f\u6301\u9884\u89c8\uff01")):openDoc()}}function fileHistory(){var e=yunpan.fo.getSelectFile(),t=W(e[0]);yunpan.filehistory.fileHistoryList(t.attr("data-nid"))}function focusOnPreviousChild(e){if(e&&e.length>0){var t=yunpan.fo.getAllFile();for(var n=0,r=t.length;n<r;n++)if(t[n].attr("data-type")=="folder"){var i=t[n].attr("data-path").split("/");i=i[i.length-2];if(i==e){yunpan.fo.selectFile(t[n]),t[n][0].scrollIntoView(!1);break}}}}function gotoPath(e,t,n,r,i,s){if("recycle-bin"==e)this.gotoRecycleBin();else{s&&s!="sFile"&&(yunpan.filelist.curFunc="file");var o=yunpan.filelist.path;if(e&&(o=="recycle-bin"||o!=e)){yunpan.filelist.path=e;if(yunpan.filelist.curFunc=="sFile")var u="sFile"+e;else var u=e;HistoryManager.add(encodeURIComponent(u))}if(e&&yunpan.filelist.curFunc=="sFile"){var u="sFile"+e;HistoryManager.add(encodeURIComponent(u))}if(s=="file"){var u=e;HistoryManager.add(encodeURIComponent(u))}var a=null,f=null;if(n||r)f=0;n&&(a=function(){focusOnPreviousChild(n),yunpan.cmdCenter.updateStatus()}),yunpan.filelist.nid=t,yunpan.filelist.list(null,t,f,a)}}function addCopyEvent(){W("#list li.row").forEach(function(e){var t=W(e).query(".pwd-on .copy-box"),n=t.query(".copy-pwd"),r=W(e).query(".code").html(),i={box:t,btn:n,text:r,listeners:{aftercopy:function(e){e?yunpan.tips.show("\u8bbf\u95ee\u5bc6\u7801\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f"):yunpan.Msg.alert("\u62b1\u6b49\uff0c\u60a8\u4f7f\u7528\u7684\u6d4f\u89c8\u5668\u91cc\u4e0d\u80fd\u81ea\u52a8\u590d\u5236\u5230\u526a\u8d34\u677f\uff0c\u8bf7\u5148\u5b89\u88c5flash\u3002",{type:"warning"})}}};W(e).attr("data-extract-status")=="1"&&!n.hasClass("clip-on")&&(new yunpan.CopyClip(i),n.addClass("clip-on"))})}function changeListType(e){yunpan.fo.changeListType();var t=yunpan.filelist,n=e.hasClass("text")?1:2;n==2?monitor.btnLog("Iconview"):monitor.btnLog("Listview");var r=W("#list"),i=W("#fileListHead"),s=W("#fileListMain"),o=W("#listHolder"),u=r.query("li").length;u>0?u>300&&n==1?yunpan.filelist.list():n==1?(r.addClass("list-list"),r.removeClass("ico-list"),i.show(),yunpan.filelist.curFunc=="link"&&(r.query(".p-columnHit").show(),r.query(".p-columnCode").css("visibility","visible"),(Browser.ie==7||Browser.ie==6)&&addCopyEvent())):(r.addClass("ico-list"),r.removeClass("list-list"),i.hide(),yunpan.filelist.curFunc=="link"&&(r.query(".p-columnHit").hide(),r.query(".p-columnCode").css("visibility","hidden"))):i.hide(),yunpan.filelist.resizeHolder(),t.curFunc=="link"?t.shareListtype=n:(yunpan.Storage.set("YUNPAN_LISTTYPE",n),t.listtype=n),yunpan.cmdCenter.updateStatus(),yunpan.fo.setDisplayType(n)}function changeListSort(e,t){var n=yunpan.filelist,r=n.order_field,i=n.order,s="asc",o;n.curFunc=="recycle"&&(i=n.order_recycle,r=n.order_field_recycle),n.curFunc=="link"&&(i=n.order_link,r=n.order_field_link),n.specialFolder[n.path.toLowerCase()]&&(o=n.specialFolder[n.path.toLowerCase()],r=o.field,i=o.order||"desc"),t?s=t:r==e?s=i=="asc"?"desc":"asc":e=="mtime"&&(s="desc"),n.curFunc=="recycle"?(n.order_recycle=s,n.order_field_recycle=e,yunpan.Storage.set("ORDER_RECYCLE",s),yunpan.Storage.set("ORDER_FIELD_RECYCLE",e)):n.curFunc=="link"?(n.order_link=s,n.order_field_link=e,yunpan.Storage.set("ORDER_LINK",s),yunpan.Storage.set("ORDER_FIELD_LINK",e)):o?(o.field=e,o.order=s):(n.order=s,n.order_field=e,yunpan.Storage.set("ORDER_NORMAL",s),yunpan.Storage.set("ORDER_FIELD_NORMAL",e)),n.list()}function gotoRecycleBin(){yunpan.filelist.path="recycle-bin",yunpan.filelist.curFunc="recycle";var e=location.search.substr("1").queryUrl();e.his_nid?location.href="/my/index#recycleBin":HistoryManager.add("recycleBin"),yunpan.filelist.list()}function gotoLink(){yunpan.filelist.path="link",yunpan.filelist.curFunc="link";var e=location.search.substr("1").queryUrl();e.his_nid?location.href="/my/index#link":HistoryManager.add("link"),yunpan.filelist.list()}function gotosFile(){yunpan.filelist.path="/",yunpan.filelist.nid=0,yunpan.filelist.page=0,yunpan.filelist.curFunc="sFile";var e=location.search.substr("1").queryUrl();e.his_nid?location.href="/my/index#sFile":HistoryManager.add("sFile"),yunpan.filelist.list()}function gotoFile(){yunpan.filelist.path="/",yunpan.filelist.curFunc="file",yunpan.filelist.list()}function restoreItem(){if(yunpan.filelist.curFunc!="recycle")return;var items=getSelItems();if(!items)return;if(!isLogin())return!1;yunpan.Msg.confirm("\u786e\u5b9a\u8981\u8fd8\u539f\u8fd9<em>"+items.length+"</em>\u9879\uff08\u540c\u540d\u6587\u4ef6\u5c06\u81ea\u52a8\u91cd\u547d\u540d\uff09\uff1f",{title:"\u786e\u8ba4\u8fd8\u539f",type:"warning",width:300,textwidth:165,fn:function(type){if(type!="yes")return;var nids=[];items.forEach(function(e){nids.push(e.attr("data-nid"))}),yunpan.BatchRequest.create({url:"/file/recover",batchParam:"nid[]",data:nids,batchSuccess:function(txt){var ret=eval("("+txt+")");ret.errno!=0&&(yunpan.BatchRequest.terminate(),yunpan.tips.hide(),yunpan.Msg.alert(ret.errmsg,{type:"error"}),yunpan.userInfo.updateDiskInfo(),yunpan.filelist.list())},success:function(){yunpan.tips.show("\u8fd8\u539f\u6587\u4ef6\u6210\u529f\uff01");var e=yunpan.filelist.data_page;try{items.forEach(function(e){e.removeNode()})}catch(t){}yunpan.fo.initFileIndex(),yunpan.userInfo.updateDiskInfo();if(e){var n=parseInt(e[1],10);yunpan.fo.getFileNum()>0?yunpan.filelist.list():!isNaN(n)&&n>=0?yunpan.filelist.list():yunpan.filelist.list("recycleBin",0)}else yunpan.fo.getFileNum()<=0&&yunpan.filelist.list();yunpan.cmdCenter.updateStatus()}})}})}function diskdelItem(){if(yunpan.filelist.curFunc!="recycle")return;var items=getSelItems();if(!items)return;if(!isLogin())return!1;yunpan.Msg.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e9b\u6587\u4ef6\u5417\uff1f<br>\u5220\u9664\u4e86\u5c31\u518d\u4e5f\u627e\u4e0d\u56de\u6765\u4e86\u2026",{title:"\u786e\u8ba4\u6c38\u4e45\u5220\u9664",type:"warning",textwidth:171,fn:function(type){if(type!="yes")return;var nids=[];items.forEach(function(e){nids.push(e.attr("data-nid"))}),yunpan.BatchRequest.create({url:"/file/deletefilesinrecycle",batchParam:"nid[]",data:nids,batchSuccess:function(txt){var ret=eval("("+txt+")");ret.errno!=0&&(yunpan.tips.hide(),yunpan.Msg.alert(ret.errmsg,{type:"error"}))},success:function(){yunpan.tips.show("\u5220\u9664\u6210\u529f\uff01");var e=yunpan.filelist.data_page;yunpan.tips.show("\u5220\u9664\u6210\u529f\uff01");try{items.forEach(function(e){e.removeNode()})}catch(t){}yunpan.fo.initFileIndex(),yunpan.userInfo.updateDiskInfo();if(e){var n=parseInt(e[1],10);yunpan.fo.getFileNum()>0?yunpan.filelist.list():!isNaN(n)&&n>=0?yunpan.filelist.list():yunpan.filelist.list("recycleBin",0)}else yunpan.fo.getFileNum()<=0&&yunpan.filelist.list();yunpan.cmdCenter.updateStatus()}})}})}function clearall(){if(yunpan.filelist.curFunc!="recycle")return;var items=getAllItems();if(!items)return;if(!isLogin())return!1;yunpan.Msg.confirm("\u786e\u5b9a\u8981\u6e05\u7a7a\u56de\u6536\u7ad9\u5417\uff1f<br>\u6e05\u7a7a\u4e86\u5c31\u518d\u4e5f\u627e\u4e0d\u56de\u6765\u4e86\u2026",{title:"\u786e\u8ba4\u6e05\u7a7a",type:"warning",textwidth:171,fn:function(type){if(type!="yes")return;Ajax.post("/file/cleanrecycle",function(txt){var ret=eval("("+txt+")");ret.errno==0?(yunpan.tips.show("\u6e05\u7a7a\u56de\u6536\u7ad9\u6210\u529f\uff01"),yunpan.userInfo.updateDiskInfo(),yunpan.filelist.list()):(yunpan.tips.hide(),yunpan.Msg.alert(ret.errmsg,{type:"error"}))})}})}function linkItem(){var e=getSelItems();if(!e)return;if(!isLogin())return!1;monitor.btnLog("Share");var t=e.map(function(e){return e.attr("data-path")}),n=e.map(function(e){return parseInt(e.attr("f-index"))}),r=e[0],i=r.attr("data-type");Ajax.post("/share/create",{nid:r.attr("data-nid"),"name[]":t},function(t){var r=t.evalExp();if(r.errno==0){monitor.clickLog("\u5206\u4eab\u5f39\u5c42\u51fa\u73b0");var s={password:r.data.password||"",linkUrl:r.data.url,linkName:r.data.basename,msgLeft:r.smsshare.surplus_sms_share_count,msgTotal:r.smsshare.sms_qid_share_count,items:e,indexes:n,type:i};yunpan.cmdCenter.showLinkDia(s,r);var o=e.map(function(e){e.query(".link-logo").length<=0&&(W('<span class="link-logo"></span>').insertTo("beforeend",e.query(".ico")),e.attr("data-link","true"))})}else yunpan.tips.hide(),failure_dialog||(failure_dialog=yunpan.dialog.create(failure_dialog_conf)),W("#link-failure-dialog .response-msg").html(r.errmsg||"\u9650\u5236\u5206\u4eab"),failure_dialog.show()})}function init_share_href(e,t){var n="\u5206\u4eab",r="\u6211\u521a\u521a\u901a\u8fc7{$at}{$word}\u4e86 \u201c{$file}\u201d"+("file"==e?"":" \u6587\u4ef6\u5939")+" , \u63a8\u8350\u7ed9\u5927\u5bb6\u3002{$link}",i={kaixin:"http://www.jiathis.com/send/",douban:"http://shuo.douban.com/!service/share",renren:"http://www.connect.renren.com/sharer.do",qzone:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey",tencent:"http://v.t.qq.com/share/share.php",sina:"http://service.t.sina.com.cn/share/share.php"},s={kaixin:314,douban:312,renren:310,qzone:308,tencent:306,sina:304},o=t.basename.subByte("40","..."),u=t.url,a={kaixin:{webid:"kaixin001",url:encodeURIComponent(u+"?sid=314"),title:encodeURIComponent(r.tmpl({at:"360\u4e91\u76d8",word:n,file:o,link:"\n"+u}))},douban:{name:encodeURIComponent(r.tmpl({at:"360\u4e91\u76d8",word:n,file:o,link:""})),href:encodeURIComponent(u+"?sid=312")},renren:{url:encodeURIComponent(u+"?sid=310"),title:encodeURIComponent(r.tmpl({at:"360\u4e91\u76d8",word:n,file:o,link:"\n"+u+"?sid=310"}))},qzone:{url:encodeURIComponent(u+"?sid=308"),title:encodeURIComponent(r.tmpl({at:"360\u4e91\u76d8",word:n,file:o,link:"\n"+u+"?sid=308"}))},tencent:{title:encodeURIComponent(r.tmpl({at:"@i360yunpan ",word:n,file:o,link:"\n"})),url:u+"?sid=306"},sina:{title:encodeURIComponent(r.tmpl({at:"@360\u4e91\u76d8 ",word:n,file:o,link:"\n"+u+"?sid=304"})),appkey:"4060160539",content:"utf8"}};if(t.preview){var f=encodeURIComponent(t.preview);a.sina.pic=f,a.tencent.pic=f}W("#newLinkDia .share_to_sns a").forEach(function(e){var n=W(e),r=n.attr("className");if(!i[r])return;var o=i[r],u=a[r],f=[];for(var l in u)f.push(l+"="+u[l]);o+="?",o+=f.join("&"),n.attr("href",o),n.click(function(){monitor.yplog(s[r],{surl:t.shorturl})})})}function delLinkItem(){if(yunpan.filelist.curFunc=="recycle")return;var e=getSelItems();if(!e)return;if(!isLogin())return!1;var t=e.map(function(e){return parseInt(e.attr("f-index"))}),n=yunpan.filelist.curFunc,r,i,s=[];if(yunpan.filelist.curFunc=="link")s=e.map(function(e){return e.attr("data-shorturl")});else for(var o=0,u=e.length;o<u;o++)e[o].attr("data-link")=="true"&&s.push(e[o].attr("data-path"));if(s.length<=0)return;if(n==="file"){content='<strong style="font-size:16px;display:block;padding-bottom:10px;">'+(s.length==1&&e.length==1?"\u60a8\u5c06\u53d6\u6d88\u8be5\u6587\u4ef6\u7684\u6240\u6709\u5916\u94fe\u5206\u4eab":"\u60a8\u5c06\u53d6\u6d88\u6240\u9009\u6587\u4ef6\u7684\u6240\u6709\u5916\u94fe\u5206\u4eab")+'</strong><span style="color:#888;">\u82e5\u9700\u53d6\u6d88\u5355\u6b21\u5206\u4eab\uff0c\u8bf7\u5230<a href="###" onclick="return yunpan.cmdCenter.gotoLinkFromFile()">\u5206\u4eab\u7684\u6587\u4ef6</a>\u4e2d\u64cd\u4f5c</span>',i="/share/cancelLinkNode";var a=300}else{content=s.length>1?"\u786e\u5b9a\u8981\u53d6\u6d88\u8fd9\u4e9b\u5206\u4eab\u5417\uff1f":"\u786e\u5b9a\u8981\u53d6\u6d88\u6b64\u5206\u4eab\u5417\uff1f",i="/share/cancelLink";var a=165}yunpan.cmdCenter.msgInstance=yunpan.Msg.confirm(content,{title:"\u786e\u8ba4\u53d6\u6d88\u5206\u4eab",type:"warning",width:300,textwidth:a,fn:function(e){if(e!="yes")return;s.length===1?Ajax.post(i,{name:s[0],shorturl:s[0]},function(e){var r=e.evalExp();r.errno==0?yunpan.tips.show("\u53d6\u6d88\u5206\u4eab\u6210\u529f\uff01"):(yunpan.tips.hide(),yunpan.Msg.alert(r.errmsg,{type:"error"})),n=="file"?yunpan.filelist.list(null,null,null,t):yunpan.filelist.list()}):yunpan.BatchRequest.create({url:i,batchParam:yunpan.filelist.curFunc=="link"?"shorturl":"name",data:s,size:1,batchSuccess:function(e){var t=e.evalExp();t.errno&&(dumping_time=!1,yunpan.BatchRequest.terminate(),yunpan.Msg.alert(t.errmsg,{type:"warning"}))},success:function(){yunpan.tips.show("\u53d6\u6d88\u5206\u4eab\u6210\u529f\uff01"),n=="file"?yunpan.filelist.list(null,null,null,t):yunpan.filelist.list()}})}})}function gotoLinkFromFile(){return yunpan.cmdCenter.msgInstance&&(yunpan.cmdCenter.msgInstance.hide(),yunpan.cmdCenter.msgInstance=null),W("#leftPanel .folders li").removeClass("current"),yunpan.cmdCenter.gotoLink(),yunpan.cmdCenter.updateNav(),!1}function viewLinkItem(e){if(yunpan.filelist.curFunc==="file")return window.open("/my/index#link"),!0;if(!e||typeof e!="string"){var t=getSelItems();if(!t||t.length>1)return;var n=t[0],e=n.attr("data-url")}window.open(e),monitor.yplog(303)}function copyLinkUrl(e,t){return e==0?function(e){document.title=gTitle;var n=getSelItems();if(!n||n.length>1)return;var r=n[0],i=r.attr("data-url");e.setText(i),yunpan.tips.show("\u94fe\u63a5\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f"),t&&t.hide()}:e==1?function(){var e=getSelItems();if(!e)return;var n=e[0],r=n.attr("data-url"),i=window.clipboardData.setData("Text",r);i?yunpan.tips.show("\u94fe\u63a5\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f"):yunpan.Msg.alert("\u62b1\u6b49\uff0c\u60a8\u4f7f\u7528\u7684\u6d4f\u89c8\u5668\u91cc\u4e0d\u80fd\u81ea\u52a8\u590d\u5236\u5230\u526a\u8d34\u677f\uff0c\u8bf7\u5148\u5b89\u88c5flash\u3002",{type:"warning"}),t&&t.hide()}:function(){var e=getSelItems();if(!e)return;yunpan.Msg.alert("\u62b1\u6b49\uff0c\u60a8\u4f7f\u7528\u7684\u6d4f\u89c8\u5668\u91cc\u4e0d\u80fd\u81ea\u52a8\u590d\u5236\u5230\u526a\u8d34\u677f\uff0c\u8bf7\u5148\u5b89\u88c5flash\u3002",{type:"warning"}),t&&t.hide()}}function copyLinkInit(e,t,n,r){try{if(e=="menu"&&menuClip)return;if(e=="button"&&buttonClip)return;var i={},s=yunpan.util.getSwfVersion();if(s&&parseInt(s)>=10){var o="http://s5.qhimg.com/static/dd0f0a62aea2c1cb.swf";ZeroClipboard.setMoviePath(o),i=new ZeroClipboard.Client,i.glue(n[0],t[0]),i.setHandCursor(!0),i.addEventListener("onMouseUp",copyLinkUrl(0,r)),e=="button"&&(i.addEventListener("onMouseOver",function(){if(n.hasClass("link-copy-disable"))return;n.removeClass("link-copy-active"),n.addClass("link-copy-hover")}),i.addEventListener("onMouseDown",function(){if(n.hasClass("link-copy-disable"))return;n.removeClass("link-copy-hover"),n.addClass("link-copy-active")}),i.addEventListener("onMouseOut",function(){if(n.hasClass("link-copy-disable"))return;n.removeClass("link-copy-hover"),n.removeClass("link-copy-active")}))}else window.clipboardData?n.on("click",copyLinkUrl(1,r)):n.on("click",copyLinkUrl(2,r));e=="menu"&&(menuClip=i),e=="button"&&(buttonClip=i)}catch(u){throw new Error("YP:zerocopy, init zerocopy. "+u.message)}}function positionWithMouse(e,t,n){var r=Dom.getDocRect(),i=e.getRect(),s=i.width,o=i.height,u=t.getRect(),a,f;return n?(a=parseInt(n.left),f=parseInt(n.top),t.hasClass("row")?(a+s>r.width&&(a-=105),f+n.height+1>=r.height&&(f+=30)):(a=u.left-20,f=u.top,f+o>=r.height&&(f-=f+o-r.height))):(a=650,f=60),[a,f]}function enableExtractItem(e,t,n){if(yunpan.filelist.curFunc=="recycle")return;var r=getSelItems();if(!r)return;if(!isLogin())return!1;var i=r[0],s=i.attr("data-url");yunpan.cmdCenter.createPassword(1,s,function(e){i.attr("data-extract-status","1"),i.query(".pwd-off").addClass("pwd-on").removeClass("pwd-off"),i.query(".code").html(i.attr("data-password")),yunpan.filelist.list(null,null,null,[i.attr("f-index")],!0);if(e&&e.length){enablePwdDia||(enablePwdDia=yunpan.dialog.create({body:'<div class="msg-panel"><div class="msg-text-box" id="enablePwd"><div class="msg-text msg-warning-tip">\u5df2\u542f\u7528\u8bbf\u95ee\u5bc6\u7801\uff1a<span class="password"></span></div></div></div>',withClose:!0,className:"panel-t2",withMask:!1,buttons:[{type:"blue",text:"\u590d\u5236\u5bc6\u7801\u5e76\u5173\u95ed\u7a97\u53e3",id:"copyBtn"}]}),enablePwdDiaWrap=W("#enablePwd").parentNode(".panel"),enablePwdDia.on("beforehide",function(){pwdMask.hide()}),pwdMask||(pwdMask=W('<div class="transparent-mask"></div>').insertTo("afterbegin",document.body),pwdMask.on("click",function(){try{pwdMask.hide(),enablePwdDia.hide(),disablePwdDia.hide()}catch(e){}})),enablePwdDia.on("aftershow",function(){pwdMask.css("z-index",enablePwdDiaWrap.css("z-index")-1).show();var e=enablePwdDiaWrap.query("#copyBtn"),t=e.parentNode(".panel-content"),n=enablePwdDiaWrap.query(".password");if(!e.hasClass("clip-on")){var r={box:t,btn:e,text:n.html(),listeners:{aftercopy:function(e){doShare=!0,e?yunpan.tips.show("\u8bbf\u95ee\u5bc6\u7801\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f"):yunpan.tips.show("\u62b1\u6b49\uff0c\u60a8\u4f7f\u7528\u7684\u6d4f\u89c8\u5668\u91cc\u4e0d\u80fd\u81ea\u52a8\u590d\u5236\u5230\u526a\u8d34\u677f\u3002\u8bf7\u4f7f\u7528CTRL+C\u6216\u9f20\u6807\u53f3\u952e\u83dc\u5355\u590d\u5236\u5bc6\u7801"),enablePwdDiaWrap.css("left","-10000px"),pwdMask.hide()},beforecopy:function(e){e.setText(n)}}},i=new yunpan.CopyClip(r);e.addClass("clip-on")}})),enablePwdDiaWrap.query(".password").html(e);var t=positionWithMouse(enablePwdDiaWrap,i,n);enablePwdDia.show(t[0],t[1])}})}function disableExtractItem(e,t,n){if(yunpan.filelist.curFunc=="recycle")return;var r=getSelItems();if(!r)return;if(!isLogin())return!1;var i=r[0];disablePwdItem=i;var s=i.attr("data-url");disablePwdUrl=s,disablePwdDia||(disablePwdDia=yunpan.dialog.create({className:"panel-t2",body:'<div class="msg-panel"><div class="msg-text-box" id="disablePwd"><div class="msg-text msg-warning-tip">\u53d6\u6d88\u8be5\u6587\u4ef6\u8bbf\u95ee\u5bc6\u7801\uff1f</div></div></div>',withClose:!1,buttons:[{type:"blue",text:"\u53d6\u6d88\u5bc6\u7801",id:"disablePwdBtn"},{text:"\u6682\u4e0d\u53d6\u6d88",handler:function(){disablePwdDia.hide(),pwdMask.hide()}}],withMask:!1}),disablePwdDiaWrap=W("#disablePwd").parentNode(".panel"),disablePwdDiaWrap.query("#disablePwdBtn").on("click",function(){yunpan.cmdCenter.createPassword(0,disablePwdUrl,function(){disablePwdDia.hide(),pwdMask.hide(),disablePwdItem.attr("data-extract-status","0"),disablePwdItem.query(".pwd-on").addClass("pwd-off").removeClass("pwd-on"),disablePwdItem.query(".code").html("-"),yunpan.filelist.list(null,null,null,[disablePwdItem.attr("f-index")],!0),yunpan.tips.show("\u5df2\u53d6\u6d88\u8bbf\u95ee\u5bc6\u7801")})}),pwdMask||(pwdMask=W('<div class="transparent-mask"></div>').insertTo("afterbegin",document.body),pwdMask.on("click",function(){try{pwdMask.hide(),disablePwdDia.hide(),enablePwdDia.hide()}catch(e){}})),disablePwdDia.on("aftershow",function(){pwdMask.css("z-index",disablePwdDiaWrap.css("z-index")-1).show()}));var o=positionWithMouse(disablePwdDiaWrap,i,n);disablePwdDia.show(o[0],o[1])}function openpassInRecyclye(){Ajax.post("/authority/isSetPass",{},function(e){var t=e.evalExp();t.errno?Ajax.post("/authority/isAuthentication",{qid:SYS_CONF.qid},function(e){var t=e.evalExp();t.errno?yunpan.authority.createBindDia():yunpan.authority.createOpenPassDia(!0,"\u4e91\u76d8\u5b89\u5168\u5bc6\u7801\u8fd8\u672a\u8bbe\u7f6e\uff0c\u8bf7\u5148\u8bbe\u7f6e\u5b89\u5168\u5bc6\u7801\u624d\u80fd\u542f\u7528\u56de\u6536\u7ad9\u52a0\u5bc6\uff0c\u662f\u5426\u7acb\u5373\u8bbe\u7f6e\uff1f")}):Ajax.post("/authority/lockRecycleBin",{},function(e){var t=e.evalExp();t.errno?yunpan.Msg.alert(t.errmsg,{type:"error"}):(W("#tbOpenPassword").hide(),W("#tbOpenPasswordDone").show(),
yunpan.authority.createRecycleOpenPassDia(),yunpan.filelist.recycleState=1,yunpan.cmdCenter.updateNav())})})}function closepassInRecyle(){yunpan.authority.createRecycleCloseDia()}function locksfile(){Ajax.post("/authority/lockSafeBox",{},function(e){var t=e.evalExp();t.errno?yunpan.Msg.alert(t.errmsg,{type:"error"}):yunpan.filelist.list()})}function init(){yunpan.cmdCenter.initUpdate(),toolbar.delegate(".y-btn, .cmd, .y-btn-back","click",function(e){var t=W(this),n=t.attr("data-cn"),r=yunpan.cmdCenter;if(!n||t.hasClass("y-btn-disable")||t.hasClass("y-btn-back-disable"))return;switch(n){case"more":break;case"upload":r.uploadItem();break;case"new":r.newItem();break;case"dl":r.downloadItem();break;case"pack-dl":r.packDownloadItem();break;case"del":r.delItem();break;case"link":case"link-batch":r.linkItem();break;case"link-view":r.viewLinkItem();break;case"link-del":r.delLinkItem();break;case"text":case"pic":r.changeListType(t);break;case"back":yunpan.filelist.nav.pop(),r.gotoPath(t.attr("data-path"),t.attr("data-nid"),yunpan.filelist.path.replace(/(\/[^\/]+)*?\/([^\/]+)\/$/,"$2"),"back",yunpan.filelist.curFunc);break;case"re":yunpan.filelist.curFunc=="recycle"?r.gotoRecycleBin():r.gotoPath();break;case"restore":r.restoreItem();break;case"diskdel":r.diskdelItem();break;case"clearall":r.clearall();break;case"delfav":r.delFavItem();break;case"refresh":r.refresh();break;case"extract-on":r.enableExtractItem();break;case"extract-off":r.disableExtractItem();break;case"openpass":r.openpassInRecyclye();break;case"openpassdone":r.closepassInRecyle();break;case"moveoutsfile":r.moveOutSfile();break;case"locksfile":r.locksfile();break;case"offline":yunpan.offdl.showManageDia()}e.preventDefault()}),W("#crumb").delegate(".cmd","click",function(e){var t=W(this),n=t.attr("data-cn");if(!n||t.hasClass(n+"_disable"))return;yunpan.filelist.page=0;var r=t.attr("data-id"),i=yunpan.filelist.nav.length;if(r==-1)yunpan.filelist.nav=[];else for(var s=parseInt(r,10)+1;s<=i-1;s++)yunpan.filelist.nav.pop();yunpan.cmdCenter.updateStatus(),yunpan.cmdCenter.gotoPath(t.attr("data-path"),t.attr("data-nid"),t.attr("data-child"),yunpan.filelist.curFunc)}),toolbar.query(".sort h2").delegate("a","mouseenter",function(e){var t=W(this);t.parentNode(".sort").query("ul").show()}),toolbar.query(".sort ul").on("mouseleave",function(e){W(this).hide()}),toolbar.query(".sort ul a").on("click",function(e){e.preventDefault();var t=W(this).attr("data-field"),n;t==W("#toolbar .sort h2 a").attr("data-field")?W(this).hasClass("asc")?n="desc":n="asc":W(this).hasClass("asc")?n="asc":n="desc",yunpan.cmdCenter.changeListSort(W(this).attr("data-field"),n),W(this).parentNode("ul").hide()})}var toolbar=W("#toolbar"),container=W("#list"),oldCurFunc="",getSelItems=function(){var e=yunpan.fo.getSelectFile();return e.length?e:!1},getAllItems=function(){var e=yunpan.fo.getAllFile();return e.length?e:!1},isLogin=yunpan.isLogin,diaMove,disSfileMove,diaMoveOutSfile,failure_dialog_html='    <div id="link-failure-dialog" style="width:300px;height:88px;">        <div class="link-info"><p>\u6587\u4ef6\u5206\u4eab\u5931\u8d25\uff01</p></div>        <div class="link-name">            <p class="response-msg"></p>        </div>    </div>',failure_dialog_conf={title:"\u5206\u4eab\u6587\u4ef6",body:failure_dialog_html,buttons:[{text:"\u786e\u5b9a",handler:function(){failure_dialog.hide()}}]},failure_dialog,menuClip,buttonClip,extractWarningDia,extractUrl,extractType,extractItem,extractDiaBg,enablePwdDia,enablePwdDiaWrap,pwdMask,disablePwdDia,disablePwdDiaWrap,disablePwdItem,disablePwdUrl;return{init:init,openDoc:openDoc,getSelItems:getSelItems,getAllItems:getAllItems,downloadItem:downloadItem,packDownloadItem:packDownloadItem,delItem:delItem,renameItem:renameItem,moveItem:moveItem,moveSfileItem:moveSfileItem,uploadItem:uploadItem,newItem:newItem,openItem:openItem,gotoPath:gotoPath,changeListType:changeListType,changeListSort:changeListSort,gotoLink:gotoLink,gotosFile:gotosFile,gotoFile:gotoFile,gotoRecycleBin:gotoRecycleBin,restoreItem:restoreItem,diskdelItem:diskdelItem,clearall:clearall,linkItem:linkItem,delLinkItem:delLinkItem,viewLinkItem:viewLinkItem,copyLinkInit:copyLinkInit,refresh:refresh,gotoLinkFromFile:gotoLinkFromFile,disableExtractItem:disableExtractItem,enableExtractItem:enableExtractItem,init_share_href:init_share_href,moveInSfile:moveInSfile,moveOutSfile:moveOutSfile,fileHistory:fileHistory,openpassInRecyclye:openpassInRecyclye,closepassInRecyle:closepassInRecyle,locksfile:locksfile}}(),yunpan.cmdCenter=ObjectH.mix(yunpan.cmdCenter||{},function(){function x(){if(!t)return;var n=yunpan.filelist,r=e.query(".display-mode"),i=n.curFunc=="link"?n.shareListtype:n.listtype;r.query("a").removeClass("text-cur").removeClass("pic-cur"),i==1?r.query(".text").addClass("text-cur"):r.query(".pic").addClass("pic-cur");switch(n.curFunc){case"file":A();break;case"link":C();break;case"recycle":k();break;case"sFile":N();break;default:}}function T(e){var t="";yunpan.filelist.curFunc=="file"?t="\u5168\u90e8\u6587\u4ef6":t="\u6587\u4ef6\u4fdd\u9669\u7bb1";var n=' > "'+e+'"\u7684\u6587\u4ef6\u65f6\u5149\u673a<span>\uff08\u53ef\u6062\u590d90\u5929\u5185\u4efb\u610f\u5386\u53f2\u7248\u672c\uff09</span>';W("#crumb").html('<div class="his-crumb"><a title="'+t+'" href="#" onclick="return false;" class="cmd gopath gohome" data-path="/" data-nid="0" data-cn="gopath" data-id="-1">'+t+"</a>"+n+"</div>"),u.hide(),a.hide(),s.hide(),o.hide(),btnsHistoryFileGroup.show(),hisFilelist.show(),i.hide(),sortGroup.hide(),searchGroup.hide(),y(".his-restore"),y(".his-view"),y(".his-dl")}function N(){L(),r.removeClass("show"),l.removeClass("show"),i.show(),u.hide(),a.hide(),s.hide(),btnsHistoryFileGroup.hide(),o.show(),btnsUpLoad.replaceClass("icon-plugin-upload","icon-upload"),y(".refresh"),y(".back"),y(".new"),y(".upload"),y(".locksfile"),w(".upload"),w(".new");var e=p();if(e){if(e.length==1){y(".rename");var t=e[0],n=t.attr("data-type"),f=t.attr("data-path");n=="folder"?y(".pack-dl"):(y(".dl"),y(".filehistory"),S(t.attr("data-file-suffix"),t.attr("data-ori-size"))&&y(".opendoc"))}else e.length>1&&y(".pack-dl");y(".del"),y(".more"),y(".sfilemove"),y(".moveoutsfile")}else yunpan.menuManager.hideAll()}function C(){r.removeClass("show"),l.removeClass("show"),i.hide(),s.hide(),o.hide(),a.hide(),btnsHistoryFileGroup.hide(),u.show(),c.removeClass("show");var e=W("#crumb"),t=(e.attr("data-used")||"").toString(),n=(e.attr("data-remain")||"").toString(),h="";t&&n&&(h="<span>\uff082013\u5e748\u670814\u65e5\u8d77\u5206\u4eab\u6d41\u91cf\u4e0d\u9650\u91cf\uff09</span>"),W("#crumb").html('<div class="crumb-path"><a title="\u6211\u5206\u4eab\u7684\u6587\u4ef6" href="#" onclick="return false;" class="cmd gopath gohome">\u6211\u5206\u4eab\u7684\u6587\u4ef6</a>'+h+"</div>"),r.removeClass("show"),f.removeClass("show"),y(".refresh"),y(".link-view"),E(".link-view"),y(".link-del"),E(".link-del"),y(".link-copy"),E(".link-copy"),yunpan.cmdCenter.copyLinkInit("button",u,u.query(".link-copy"));var d=p();d&&(w(".link-del"),b(".link-view",g),b(".link-copy",g),d.length==1&&!d[0].hasClass("link-invalid")&&(w(".link-view"),w(".link-copy"),y(".link-view"),y(".link-copy"),S(d[0].attr("data-file-suffix"),d[0].attr("data-ori-size"))&&y(".opendoc"),d[0].attr("data-extract-status")=="0"?y(".extract-on"):y(".extract-off")))}function k(){i.show(),s.hide(),btnsHistoryFileGroup.hide(),o.hide(),u.hide(),a.show(),r.removeClass("show"),y(".refresh");if(yunpan.filelist.recyclePass)E(".clearall"),E(".diskdel"),E(".restore");else{var e=p();e?(y(".diskdel"),w(".diskdel"),y(".restore"),w(".restore")):(E(".diskdel"),E(".restore")),yunpan.fo.getFileNum()>0?(y(".clearall"),w(".clearall")):E(".clearall")}W("#crumb").html('<div class="crumb-path"><a title="\u56de\u6536\u7ad9" href="#" onclick="return false;" class="cmd gopath gohome">\u56de\u6536\u7ad9</a>            <span class="recycle-prompt">\uff08\u6e29\u99a8\u63d0\u793a\uff1a\u56de\u6536\u7ad9\u6587\u4ef6\u4e0d\u5360\u7528\u60a8\u4e91\u76d8\u7a7a\u95f4\uff0c\u4fdd\u755930\u5929\u540e\u5c06\u81ea\u52a8\u5220\u9664\u3002\uff09</span></div>')}function L(){var n=[],r=yunpan.filelist.nav,i=r.length,s="",o=function(e,t){for(var i=e;i<=t;i++)n.push([' &gt; <a data-id="',i,'" title="',r[i].title.encode4HtmlValue(),'"  href="###" onclick="return false;" data-cn="gopath" data-child="'+r[i+1].title.encode4Html()+'" data-nid="'+r[i].nid+'" class="cmd gopath" data-path="',r[i].path,'">',r[i].title.encode4Html().subByte(10,"..."),"</a>"].join(""))};i?(t.query(".back").removeClass("y-btn-back-disable").attr("title","\u8fd4\u56de\u4e0a\u7ea7\u76ee\u5f55"),i>=2?(e.query(".back").attr("data-path",r[i-2].path),e.query(".back").attr("data-nid",r[i-2].nid)):(e.query(".back").attr("data-path","/"),e.query(".back").attr("data-nid",0)),i<7?o(0,i-2):(o(0,2),n.push(' &gt; <a href="###" onclick="return false;">...</a>'),o(i-3,i-2)),n.push(' &gt; <span title="',r[i-1].title.encode4HtmlValue(),'">',r[i-1].title.encode4Html().subByte(10,"..."),"</span>"),s=r[0].title):t.query(".back").addClass("y-btn-back-disable").attr("title",""),W("#crumb").html('<div class="crumb-path"></div>'),yunpan.filelist.curFunc=="file"?W("#crumb .crumb-path").html('<a title="\u8fd4\u56de\u5168\u90e8\u6587\u4ef6"  href="###" onclick="return false;" data-nid="0" data-id="-1" data-cn="gopath"'+(s?' data-child="'+s.encode4Html()+'"':"")+' class="cmd gohome gopath" data-path="/">\u5168\u90e8\u6587\u4ef6</a>'+n.join("")):W("#crumb .crumb-path").html('<a title="\u8fd4\u56de\u6587\u4ef6\u4fdd\u9669\u7bb1"  href="###" onclick="return false;" data-nid="0" data-id="-1" data-cn="gopath" '+(s?' data-child="'+s.encode4Html()+'"':"")+'class="cmd gohome gopath" data-path="/">\u6587\u4ef6\u4fdd\u9669\u7bb1</a>'+n.join(""))}function A(){L(),r.removeClass("show"),f.removeClass("show"),i.show(),u.hide(),a.hide(),o.hide(),btnsHistoryFileGroup.hide(),s.show(),yunpan.upload.detectCapability().supportPlugin&&btnsUpLoad.replaceClass("icon-upload","icon-plugin-upload"),y(".refresh"),y(".back"),y(".new"),y(".upload"),y(".offline"),y(".new-offline-task"),y(".task-mng"),w(".upload"),w(".new");var e=p();if(e){if(e.length==1){y(".rename");var t=e[0],n=t.attr("data-type"),l=t.attr("data-path");n=="folder"?(y(".pack-dl"),t.attr("data-link")=="true"&&y(".link-del")):(y(".dl"),y(".filehistory"),t.attr("data-link")=="true"&&y(".link-del"),S(t.attr("data-file-suffix"),t.attr("data-ori-size"))&&y(".opendoc")),y(".link")}else if(e.length>1){y(".pack-dl"),y(".link-batch");for(var c=0,h=e.length;c<h;c++)if(e[c].attr("data-link")=="true"){y(".link-del");break}}y(".del"),y(".more"),y(".move"),y(".moveinsfile")}else yunpan.menuManager.hideAll()}function O(e){e=e||yunpan.filelist.curFunc,W("#leftPanel .menu-global li").removeClass("current"),W("#leftPanel .menu-global li.sFile").removeClass("lock").removeClass("current-lock"),yunpan.filelist.sFileState&&W("#leftPanel .menu-global li.sFile").addClass("lock"),["file","sFile","link","recycle"].indexOf(e)>=0&&(e=="sFile"?(W("#leftPanel .sFile").removeClass("lock"),yunpan.filelist.sFileState?W("#leftPanel .sFile").addClass("current-lock"):W("#leftPanel .sFile").addClass("current")):W("#leftPanel ."+e).addClass("current"))}function M(){var e=yunpan.filelist,t=yunpan.filelist.curFunc,n,r;W("#toolbar .sort li").hide();if(t=="file"||t=="sFile")W("#toolbar .sort .name").parentNode("li").show(),W("#toolbar .sort .fsize").parentNode("li").show(),W("#toolbar .sort .new-upload").parentNode("li").show(),W("#toolbar .sort .fmtime").parentNode("li").show();t=="link"&&(W("#toolbar .sort .name").parentNode("li").show(),W("#toolbar .sort .fsize").parentNode("li").show(),W("#toolbar .sort .share-date").parentNode("li").show()),t=="recycle"&&(W("#toolbar .sort .name").parentNode("li").show(),W("#toolbar .sort .fsize").parentNode("li").show(),W("#toolbar .sort .del-date").parentNode("li").show());var i="";if(t=="recycle")r=e.order_recycle,i=e.order_field_recycle,i=="mtime"&&(i="del-date");else if(e.specialFolder[e.path.toLowerCase()]){var s=e.specialFolder[e.path.toLowerCase()];i=s.field,r=s.order,i=="mtime"&&(i="new-upload")}else t=="link"?(i=e.order_field_link,r=e.order_link,i=="mtime"&&(i="share-date")):(i=e.order_field,r=e.order,i=="mtime"&&(i="new-upload"));var o=W("#toolbar .sort ul ."+i).parentNode("li");o.query("a").removeClass("asc").removeClass("desc").addClass(r),o.insertTo("afterbegin",W("#toolbar .sort ul")[0]),W("#toolbar .sort h2").html('<span class="text">\u6392\u5e8f\uff1a</span>'+o.html())}function _(){p=yunpan.cmdCenter.getSelItems,d=yunpan.cmdCenter.getAllItems,t=W("#crumb, #toolbar"),n=W(".menu-sys"),r=n.query(".item"),i=W("#toolbar .display-mode"),sortGroup=W("#toolbar .sort"),searchGroup=W("#search"),s=e.query(".btns-filelist"),o=e.query(".btns-sfilelist"),btnsHistoryFileGroup=e.query(".btns-hisfile"),u=e.query(".btns-link"),a=e.query(".btns-recycle"),btnsUpLoad=e.query(".upload .icon"),f=s.query(".y-btn, .y-btn-back"),l=o.query(".y-btn, .y-btn-back"),c=u.query(".y-btn"),h=a.query(".y-btn"),hisFilelist=W("#fileListHistory")}var e=W("#toolbar"),t,n,r,i,s,o,u,a,f,l,c,h,p,d,v=0,m=1,g=2,y=function(e,r){try{r!=g&&t.query(e).addClass("show"),r!=m&&n.query(e).addClass("show")}catch(i){throw new Error("YP:updateStatus, show. -"+e+"-"+i.message)}},b=function(e,r){try{r!=g&&t.query(e).removeClass("show"),r!=m&&n.query(e).removeClass("show")}catch(i){throw new Error("YP:updateStatus, hide. -"+e+"-"+i.message)}},w=function(e){try{t.query(e).removeClass("y-btn-disable")}catch(n){throw new Error("YP:updateStatus, enable. -"+e+"-"+n.message)}},E=function(e){try{t.query(e).addClass("y-btn-disable")}catch(n){throw new Error("YP:updateStatus, disable. -"+e+"-"+n.message)}},S=yunpan.docviewer.canPreview;return{initUpdate:_,updateSortStatus:M,updateStatus:x,updateRBStatus:k,updateNav:O,recycleState:0,updateStatusFromMenu:T}}()),Dom.ready(function(){var e=[{text:"\u91cd\u547d\u540d",cls:"rename",iconCls:"icon-rename",attrs:{"data-cn":"rename"},handler:yunpan.cmdCenter.renameItem},{text:"\u79fb\u52a8",cls:"move",iconCls:"icon-move",attrs:{"data-cn":"move"},handler:yunpan.cmdCenter.moveItem},{text:"\u8f6c\u5165\u6587\u4ef6\u4fdd\u9669\u7bb1",cls:"moveinsfile",iconCls:"icon-moveinsfile",attrs:{"data-cn":"moveinsfile"},handler:yunpan.cmdCenter.moveInSfile},{text:"\u6587\u4ef6\u65f6\u5149\u673a",cls:"filehistory",iconCls:"icon-filehistory",attrs:{"data-cn":"filehistory"},handler:yunpan.cmdCenter.fileHistory}],t=[{text:"\u91cd\u547d\u540d",cls:"rename",iconCls:"icon-rename",attrs:{"data-cn":"rename"},handler:yunpan.cmdCenter.renameItem},{text:"\u79fb\u52a8",cls:"sfilemove",iconCls:"icon-sfilemove",attrs:{"data-cn":"sfilemove"},handler:yunpan.cmdCenter.moveSfileItem},{text:"\u6587\u4ef6\u65f6\u5149\u673a",cls:"filehistory",iconCls:"icon-filehistory",attrs:{"data-cn":"filehistory"},handler:yunpan.cmdCenter.fileHistory}],n=new yunpan.Menu({cls:"cmd-panel",target:"#toolbar .btns-sfilelist .more",dock:"bottom",listeners:{aftershow:function(){W(this).hasClass("more-disable")&&n.hide()}},items:t}),r=new yunpan.Menu({cls:"cmd-panel",target:"#toolbar .btns-filelist .more",dock:"bottom",listeners:{aftershow:function(){W(this).hasClass("more-disable")&&r.hide()}},items:e}),i=[{text:"\u5728\u7ebf\u67e5\u770b",cls:"opendoc",iconCls:"icon-opendoc",attrs:{"data-cn":"opendoc"},handler:yunpan.cmdCenter.openDoc},{text:"\u4e0b\u8f7d",cls:"dl",iconCls:"icon-dl",attrs:{"data-cn":"dl"},handler:yunpan.cmdCenter.downloadItem},{text:"\u6253\u5305\u4e0b\u8f7d",cls:"pack-dl",iconCls:"icon-pack-dl",attrs:{"data-cn":"pack-dl"},handler:yunpan.cmdCenter.packDownloadItem},{text:"\u5220\u9664",cls:"del",iconCls:"icon-del",attrs:{"data-cn":"del"},handler:yunpan.cmdCenter.delItem},{text:"\u91cd\u547d\u540d",cls:"rename",iconCls:"icon-rename",attrs:{"data-cn":"rename"},handler:yunpan.cmdCenter.renameItem},{text:"\u79fb\u52a8",cls:"move",iconCls:"icon-move",attrs:{"data-cn":"move"},handler:yunpan.cmdCenter.moveItem},{text:"\u79fb\u52a8",cls:"sfilemove",iconCls:"icon-sfilemove",attrs:{"data-cn":"sfilemove"},handler:yunpan.cmdCenter.moveSfileItem},{text:"\u8fd8\u539f",cls:"restore",iconCls:"icon-restore",attrs:{"data-cn":"restore"},handler:yunpan.cmdCenter.restoreItem},{text:"\u5220\u9664",cls:"diskdel",iconCls:"icon-diskdel",attrs:{"data-cn":"diskdel"},handler:yunpan.cmdCenter.diskdelItem},{text:"\u8f6c\u5165\u6587\u4ef6\u4fdd\u9669\u7bb1",cls:"moveinsfile",iconCls:"icon-moveinsfile",attrs:{"data-cn":"moveinfile"},handler:yunpan.cmdCenter.moveInSfile},{text:"\u8f6c\u51fa\u6587\u4ef6\u4fdd\u9669\u7bb1",cls:"moveoutsfile",iconCls:"icon-moveoutsfile",attrs:{"data-cn":"moveoutsfile"},handler:yunpan.cmdCenter.moveOutSfile},{text:"\u6587\u4ef6\u65f6\u5149\u673a",cls:"filehistory",iconCls:"icon-filehistory",attrs:{"data-cn":"filehistory"},handler:yunpan.cmdCenter.fileHistory}];i=i.concat([{text:"\u5206\u4eab\u6587\u4ef6",cls:"link",iconCls:"icon-link",attrs:{"data-cn":"link"},handler:function(){yunpan.cmdCenter.linkItem()}},{text:"\u6279\u91cf\u5206\u4eab",cls:"link-batch",iconCls:"icon-link-batch",linkCls:"clearfix",attrs:{"data-cn":"link-batch"},handler:function(){yunpan.cmdCenter.linkItem()}},{text:"\u53d6\u6d88\u5206\u4eab",cls:"dellink",iconCls:"icon-dellink",attrs:{"data-cn":"link-del"},handler:yunpan.cmdCenter.delLinkItem},{text:"\u67e5\u770b\u5206\u4eab\u94fe\u63a5",cls:"link-view",iconCls:"icon-link-view",attrs:{"data-cn":"link-view"},handler:yunpan.cmdCenter.viewLinkItem},{text:"\u53d6\u6d88\u5206\u4eab",cls:"link-del",iconCls:"icon-link-del",attrs:{"data-cn":"link-del"},handler:yunpan.cmdCenter.delLinkItem},{text:"\u590d\u5236\u5206\u4eab\u94fe\u63a5",cls:"link-copy",iconCls:"icon-link-copy",attrs:{"data-cn":"link-copy"},handler:yunpan.cmdCenter.copyLinkItem},{text:"\u542f\u7528\u8bbf\u95ee\u5bc6\u7801",cls:"extract-on",iconCls:"icon-extract-on",attrs:{"data-cn":"extract-on"},handler:yunpan.cmdCenter.enableExtractItem},{text:"\u53d6\u6d88\u8bbf\u95ee\u5bc6\u7801",cls:"extract-off",iconCls:"icon-extract-off",attrs:{"data-cn":"extract-off"},handler:yunpan.cmdCenter.disableExtractItem}]);var s=new yunpan.Menu({cls:"cmd-panel",delegates:[{selector:"#listHolder",query:"li"}],listeners:{beforeshow:function(){var e=yunpan.fo.getSelectFile(),t=yunpan.fo.getSelArr(),n=W(this),r=parseInt(n.getAttr("f-index"),10);t[r]||(yunpan.fo.unSelectAllFile(),yunpan.fo.selectFile(n)),yunpan.cmdCenter.updateStatus()},aftershow:function(){try{var e=!0;s.copyLinkItem||(s.copyLinkItem=s.oWrap.query(".link-copy")),s.copyLinkItem.hasClass("show")?(yunpan.cmdCenter.copyLinkInit("menu",s.copyLinkItem,s.copyLinkItem.query("a"),s),e=!1):s.oWrap.query("li").forEach(function(t){t=W(t),t.hasClass("show")&&(e=!1)}),e&&s.hide()}catch(t){throw new Error("YP:menu, after show menu. "+t.message)}}},items:i}),o=[{text:"\u4e0a\u4f20\u6587\u4ef6",cls:"upload",iconCls:"icon-upload",attrs:{"data-cn":"upload"},handler:function(){monitor.clickLog("\u53f3\u952e\u4e0a\u4f20"),yunpan.cmdCenter.uploadItem()}},{text:"\u65b0\u5efa\u6587\u4ef6\u5939",cls:"new",iconCls:"icon-new",attrs:{"data-cn":"new"},handler:function(){monitor.clickLog("\u53f3\u952e\u65b0\u5efa\u6587\u4ef6\u5939"),yunpan.cmdCenter.newItem()}},{text:"\u5237\u65b0",cls:"refresh show",iconCls:"icon-refresh",attrs:{"data-cn":"refresh"},handler:function(){monitor.clickLog("\u53f3\u952e\u5237\u65b0"),yunpan.cmdCenter.refresh()}}],u=new yunpan.Menu({cls:"cmd-panel",delegates:[{selector:"#listHolder"},{selector:"#listHolder",query:"ul"}],conditionCheck:function(e){var t=e.target.id;return t!="list"&&t!="listHolder"?!1:!0},listeners:{beforeshow:function(){yunpan.fo.unSelectAllFile(),yunpan.cmdCenter.updateStatus()}},items:o});yunpan.cmdCenter.init()}),namespace("yunpan"),yunpan.offdl=yunpan.offlineDownload=function(){function o(){if(!n){n=yunpan.dialog.create({body:t,title:"\u65b0\u5efa\u79bb\u7ebf\u4e0b\u8f7d\u4efb\u52a1",withClose:!0});var e=W(n.oContent).query(".y-btn");e.item(0).click(function(){n.hide()}),e.item(1).click(function(){yunpan.offdl.createCheck()}),n.on("afterhide",function(){u(null,"hide"),W(n.oContent).query("input").val("")})}n.show(),setTimeout(function(){W("#offdlUrl").focus()},1)}function u(e,t){var n=W(".offdl-dia-create .offdl-tip");if(n.length>0){n.removeClass("offdl-error").removeClass("offdl-loading").html("");if(t=="hide")return;t=="error"?n.addClass("offdl-error"):t=="loading"&&n.addClass("offdl-loading"),n.html(e).show()}}function a(){var e=W("#offdlUrl").val().trim();if(e.length>2048){u("\u60a8\u8f93\u5165\u7684URL\u592a\u957f\uff01","error");return}var t=/^(http|https|ftp):\/\//i;if(!t.test(e)){u("\u60a8\u8f93\u5165\u7684URL\u683c\u5f0f\u4e0d\u5bf9\uff0c\u8bf7\u68c0\u67e5\uff01","error");return}u("\u6b63\u5728\u68c0\u6d4b\u6587\u4ef6\u94fe\u63a5\u5730\u5740...","loading"),Ajax.post("/offline/offlineDownload",{url:e},function(e){var t=JSON.parse(e);t.errno==0?(n.hide(),u(null,"hide"),b()):u(t.errmsg,"error")})}function f(){if(W(".offdl-dia-mng .offdl-file-holder li").length<=0)return;yunpan.Msg.confirm("\u786e\u8ba4\u8981\u6e05\u7a7a\u6240\u6709\u8bb0\u5f55\u5417\uff1f",{type:"warning",fn:function(e){if(e!="yes")return;Ajax.post("/offline/clean",function(e){var t=JSON.parse(e);t.errno!=0&&yunpan.Msg.alert(t.errmsg,{type:"error"}),p()})}})}function p(){if(l)return;h&&(clearTimeout(h),h=null),l=!0,Ajax.post("/offline/getOfflineTaskList",function(e){l=!1;var t=JSON.parse(e);W(".offdl-dia-mng .offdl-count").html(""),W(".offdl-dia-mng .offdl-file-holder").html("");if(t.errno!=0){yunpan.Msg.alert(t.errmsg,{type:"error"});return}var n=t.data.offline_task_list,r=[],i=yunpan.fileType.getType,o=yunpan.util.formatByte,u=!1;if(n.length>0){W(".offdl-dia-mng .offdl-count").html('<span class="offdl-count-num">'+n.length+"</span>\u6761");for(var a=0,f=n.length;a<f;a++){var d=n[a];d.fpath=d.fname.encode4Html();var v=d.fname.substring(d.fname.lastIndexOf("/")+1);d.fileType=i(v),d.name=v.encode4Html(),d.fsize<0?d.size="\u672a\u77e5":d.size=o(d.fsize,1);var m="",g="",y="";switch(d.status){case 1:g="offdl-status-dling",y="offdl-op-st-queue",m="\u6b63\u5728\u6392\u961f",u=!0;break;case 2:g="offdl-status-dling",y="offdl-op-st-dling",d.fsize<0?m="\u672a\u77e5":d.percent>=100?m="\u4fdd\u5b58\u4e2d...":m=d.percent+"%("+yunpan.util.formatByte(d.speed)+"/s)",u=!0;break;case 3:g="offdl-status-suc",y="offdl-op-st-suc",m="\u4e0b\u8f7d\u6210\u529f";break;case 4:g="offdl-status-fail",y="offdl-op-st-fail",m="\u4e0b\u8f7d\u5931\u8d25"}d.statuIconCls=g,d.opStatusCls=y,d.statusDesc=m,r.push(s(d))}W(".offdl-dia-mng .offdl-file-holder").html('<ul class="list-list file-list clearfix">'+r.join("")+"</ul>")}u?W(".offdl-dia-mng .offdl-title").addClass("offdl-downloading"):W(".offdl-dia-mng .offdl-title").removeClass("offdl-downloading"),c&&u&&(h=setTimeout(function(){p()},2e3))})}function d(e){Ajax.post("/offline/delete",{task_id:e},function(e){var t=JSON.parse(e);t.errno==0?p():yunpan.Msg.alert(t.errmsg,{type:"error"})})}function v(e){yunpan.Msg.confirm("\u60a8\u786e\u5b9a\u53d6\u6d88\u6b63\u5728\u4e0b\u8f7d\u4e2d\u7684\u4efb\u52a1\u5417\uff1f",{type:"warning",fn:function(t){if(t!="yes")return;Ajax.post("/offline/cancel",{task_id:e},function(e){var t=JSON.parse(e);t.errno==0?p():yunpan.Msg.alert(t.errmsg,{type:"error"})})}})}function g(e){if(m[e])return;m[e]=!0,Ajax.post("/offline/retry",{task_id:e},function(t){m[e]=!1;var n=JSON.parse(t);n.errno==0?p():yunpan.Msg.alert(n.errmsg,{type:"error"})})}function y(e){i.hide();var t=e.lastIndexOf("/");t==0?e="/":e=e.substring(0,t),yunpan.cmdCenter.gotoPath(e,null,null,null,null,"file"),yunpan.filelist.nav=[];if(e.length>1){var n=e.substring(1).split("/"),r="";if(n[0]!="")for(var s=0;s<n.length;s++)r+=n[s]+"/",yunpan.filelist.nav.push({title:n[s],nid:0,path:"/"+r})}yunpan.cmdCenter.updateStatus()}function b(){if(!i){i=yunpan.dialog.create({body:r,title:"\u4efb\u52a1\u7ba1\u7406",withClose:!0});var e=W(i.oContent).query(".offdl-btn-box").query(".y-btn");e.item(0).click(function(){i.hide()}),e.item(1).click(function(){f()}),i.on("afterhide",function(){c=!1}),W(i.oContent).query(".offdl-btn-create").on("click",function(){i.hide(),o()}),W(".offdl-dia-mng .offdl-file-holder").delegate(".offdl-op","click",function(){var e=W(this).parentNode("li").attr("data-taskid"),t=W(this).attr("data-op");switch(t){case"del":d(e);break;case"cancel":v(e);break;case"open":var n=W(this).parentNode("li").attr("data-path");y(n);break;case"retry":g(e)}})}c=!0,p(),i.show()}var e='<div class="offdl-dia-create clearfix"> <div class="offdl-title">\u8bf7\u8f93\u5165\u8981\u4e0b\u8f7d\u7684\u6587\u4ef6\u94fe\u63a5\u5730\u5740\uff1a</div> <div class="offdl-tip"></div> <div class="offdl-input-box"> <form action="#"onsubmit="yunpan.offdl.createCheck();return false"> <span class="offdl-placeholder">\u652f\u6301HTTP\u3001FTP\u94fe\u63a5\u4e0b\u8f7d</span> <input placeholder="\u652f\u6301HTTP\u3001FTP\u94fe\u63a5\u4e0b\u8f7d"type="text"name="offdlUrl"id="offdlUrl"> </form> </div> <div class="offdl-btn-box"> <span class="offdl-save-tip">\u79bb\u7ebf\u4e0b\u8f7d\u7684\u6587\u4ef6\u7edf\u4e00\u4fdd\u5b58\u5230\u3010\u6765\u81ea-\u79bb\u7ebf\u4e0b\u8f7d\u7684\u6587\u4ef6\u3011\u6587\u4ef6\u5939\u91cc</span> <span class="y-btn y-btn-gray">\u53d6\u6d88</span> <span class="y-btn y-btn-blue">\u5f00\u59cb\u4e0b\u8f7d</span> </div> </div> <split> <div class="offdl-dia-mng"> <div class="offdl-title">\u6700\u8fd1<span class="offdl-count"></span>\u79bb\u7ebf\u4e0b\u8f7d\u4efb\u52a1\u8bb0\u5f55</div> <div class="btn-group offdl-btn-group"> <span class="offdl-btn-create y-btn y-btn-gray show"> <i class="icon"></i> <span class="text">\u65b0\u5efa\u79bb\u7ebf\u4e0b\u8f7d\u4efb\u52a1</span> </span> </div> <div class="offdl-mng-list"class="file-list-box"> <div class="file-list-head clearfix"> <div class="column column-name">\u4efb\u52a1\u540d</div> <div class="column column-size">\u5927\u5c0f</div> <div class="column column-status">\u4e0b\u8f7d\u72b6\u6001</div> <div class="column column-op">\u64cd\u4f5c</div> </div> <div class="offdl-file-main"> <div class="offdl-file-holder clearfix"> </div> </div> </div> <div class="offdl-btn-box"> <span class="offdl-save-tip">\u79bb\u7ebf\u4e0b\u8f7d\u7684\u6587\u4ef6\u7edf\u4e00\u4fdd\u5b58\u5230\u3010\u6765\u81ea-\u79bb\u7ebf\u4e0b\u8f7d\u7684\u6587\u4ef6\u3011\u6587\u4ef6\u5939\u91cc</span> <span class="y-btn y-btn-gray">\u5173\u95ed</span> <span class="y-btn y-btn-gray">\u6e05\u7a7a\u5386\u53f2\u8bb0\u5f55</span> </div> </div> <split> <li class="row filelist-item"data-taskid="{$task_id}"data-path="{$fpath}"> <div class="column column-status-ico {$statuIconCls}"></div> <div class="column column-ico"> <span class="ico ico-{$fileType}"></span> </div> <div class="column column-name">{$name}</div> <div class="column column-size">{$size}</div> <div class="column column-status">{$statusDesc}</div> <div class="column column-op {$opStatusCls}"> <span title="\u5220\u9664\u4e0b\u8f7d\u8bb0\u5f55"class="offdl-op offdl-op-del"data-op="del"></span> <span title="\u53d6\u6d88\u4e0b\u8f7d"class="offdl-op offdl-op-cancel"data-op="cancel"></span> <span title="\u91cd\u8bd5\u4e0b\u8f7d"class="offdl-op offdl-op-retry"data-op="retry"></span> <span title="\u6253\u5f00\u6587\u4ef6\u6240\u5728\u6587\u4ef6\u5939"class="offdl-op offdl-op-open"data-op="open"></span> </div> '.split("<split>"),t=e[0],n,r=e[1],i,s=e[2].tmpl(),l=!1,c=!1,h,m={};return{showCreateDia:o,createCheck:a,showManageDia:b}}(),Dom.ready(function(){var e=String.queryUrl(location.href);e.init&&e.init=="offline"&&yunpan.offdl.showManageDia()}),yunpan.filehistory=function(){function f(){W("#fileListHistory").delegate("li.item","click",i).delegate("li.item","mouseenter",function(e){W(this).hasClass("active")||W(this).addClass("hover")}).delegate("li.item","mouseleave",function(e){W(this).removeClass("hover")}).delegate("li.eventItem","click",s),W("#tbHisView").on("click",u),W("#tbHisDl").on("click",a),W("#tbHisReFile").on("click",o),W(window).on("resize",yunpan.filehistory.resizeHolder)}function l(){W("#fileListHistory").undelegate("li.item","click",i).undelegate("li.eventItem","click",s),W("#tbHisView").un("click",u),W("#tbHisDl").un("click",a),W("#tbHisReFile").un("click",o),W(window).un("resize",yunpan.filehistory.resizeHolder)}function c(){var e=W("#fileListHistory"),t=W("#fileListHistory .main"),n=W("#fileListHistory .main .content"),r=Dom.getDocRect().height-t.getRect().top,i=W("#fileListHistory .main .content .list");t.css("height",r+"px");if(i.length>0){var s=i.getRect().height;r<s&&(r=s),n.css("height",r+"px")}var o=W("#fileListHistory .head"),u=o.getRect();if(u.width>0){var a=u.width+parseInt(o.css("margin-right"))-n.getRect().width;o.css("margin-right",a+"px")}if(QW.Browser.ie==6){var f=Dom.getDocRect().height-W("#fileListHistory .listholder").getRect().top;e.css("height",f+"px")}}function h(n,r){t&&t.cancel(),t=Ajax.post("/fHistory/getFileHistory/",n,function(t){var n=t.evalExp();if(!n.errno){var i=n.data;i.fhistory_list.length>=1&&(e.curNid=i.fhistory_list[0].nid),e.curNums+=i.retnum,r&&r(i)}else yunpan.Msg.alert(n.errmsg,{type:"error"})})}function p(){W("#listHolder").html(""),W("#fileList").hide(),n.html(""),e.curNums=0,e.nid=0,e.curNid=0,r=null,l()}function d(t){var n=t.current,r=yunpan.fileType.getSuffix(n.fname),i=yunpan.docviewer.checkPreview(r,n.fsize),s=n.fname;n.fname.length>=30&&(s=n.fname.subByte("30","...")),yunpan.cmdCenter.updateStatusFromMenu(s),n.pic&&n.pic!=""?(W("#tbHisViewPic").show().attr("href",n.pic),W("#tbHisView").hide()):i.isDoc?(W("#tbHisView").show(),W("#tbHisViewPic").hide()):(W("#tbHisView").hide(),W("#tbHisViewPic").hide()),e.suffix=r,e.path=n.fpath}function v(t){var i={};p(),e.nid=t,e.curNid=t,i.nid=e.nid,i.his_nid=e.curNid,i.start=0,i.num=e.Nums,i.source="",yunpan.filelist.curFunc=="sFile"&&(i.source="safebox");var s=function(e){d(e);var t=yunpan.filelist.curHisFileHtml(e);n.html(t.join("")),r=n.query("li")[0],W(r).addClass("active"),W(r).query(".column-radio span").addClass("selected"),W("#tbHisReFile").replaceClass("y-btn-blue","y-btn-disable");var i=yunpan.filelist.hisFileHtml(e);i.length>=1&&W(i.join("")).insertTo("beforeend",n[0]),yunpan.filehistory.resizeHolder(),f()};h(i,s)}function m(){var t={};t.nid=e.nid,t.his_nid=e.curNid,t.num=e.Nums,t.start=e.curNums,t.source="",yunpan.filelist.curFunc=="sFile"&&(t.source="safebox");var r=function(e){n.query(".eventItem").hide();var t=yunpan.filelist.hisFileHtml(e);t.length>=1&&W(t.join("")).insertTo("beforeend",n[0]).css("display","none").fadeIn()};h(t,r)}function g(e){var t="";e.init=="history"?(yunpan.filelist.curFunc="file",t="\u5168\u90e8\u6587\u4ef6"):(yunpan.filelist.curFunc="sFile",t="\u6587\u4ef6\u4fdd\u9669\u7bb1"),yunpan.cmdCenter.updateNav(),yunpan.config.init(yunpan.filelist.curFunc),yunpan.filehistory.fileHistoryList(e.his_nid),W("#fileListHistory").show()}var e={nid:0,curNid:0,curNums:0,Nums:300},t=null,n=W("#fileListHistory .content .list"),r=null,i=function(e){var t=r;if(W(t).attr("data-vid")==W(this).attr("data-vid"))return;W(this).hasClass("cur")?W("#tbHisReFile").replaceClass("y-btn-blue","y-btn-disable"):W("#tbHisReFile").replaceClass("y-btn-disable","y-btn-blue"),W(this).addClass("active"),W(this).query(".column-radio span").addClass("selected"),W("#tbHisViewPic").attr("href",W(this).attr("data-pic")),W(t).removeClass("active"),W(t).query(".column-radio span").removeClass("selected"),r=W(this)},s=function(t){W(this).addClass("loading"),W(this).query(".column-histitle span").html("\u6b63\u5728\u52aa\u529b\u52a0\u8f7d\u4e2d...");var n=W(this).attr("data-nid");n&&(e.curNid=n),W(this).attr("data-type")=="move"&&(e.curNums=0),m()},o=function(t){if(!r)return;if(W(this).hasClass("y-btn-disable"))return;yunpan.Msg.confirm("\u786e\u5b9a\u8981\u7a7f\u8d8a\u5230\u6b64\u65f6\u5149\u53f7\uff08\u8fd8\u539f\u5230\u9009\u4e2d\u7248\u672c\uff09",{type:"error",fn:function(t){if(t=="yes"){var i=W(r),s=i.attr("data-id"),o=e.nid;Ajax.post("/fHistory/restore",{id:s,nid:o,source:yunpan.filelist.curFunc=="file"?"":"safebox"},function(t){var r=t.evalExp();if(!r.errno){yunpan.tips.show("\u6210\u529f\u7a7f\u8d8a\u5230\u5386\u53f2\u7248\u672c!");var i={};i.nid=e.nid,i.his_nid=e.nid,i.num=1,i.start=0,i.source="",yunpan.filelist.curFunc=="sFile"&&(i.source="safebox");var s=function(e){var t=yunpan.filelist.curHisFileHtml(e),r=yunpan.filelist.hisFileHtml(e),i=r.join("")+t.join("");n.query("li.cur").removeNode(),W(i).insertTo("afterbegin",n).css("display","none").fadeIn(),W("li.cur").click()};h(i,s)}})}}})},u=function(t){if(!r)return;var n=W(r),i=e.suffix,s=e.nid,o=n.attr("data-id"),u=n.attr("data-ori-size"),a=0,f=yunpan.docviewer.checkPreview(e.suffix,n.attr("data-ori-size"));if(f.isDoc&&f.isOversize){yunpan.Msg.alert("\u8fd9\u4e2a\u6587\u6863\u592a\u5927\uff0c\u6682\u4e0d\u652f\u6301\u9884\u89c8\uff01");return}n.hasClass("cur")?a=0:a=1;var l=yunpan.docviewer.getUrl(yunpan.filelist.curFunc=="sFile"?"sFile"
:"file",s,i,null,{size:u},o,a);l&&window.open(l)},a=function(){if(!r)return;var t=W(r),n=t.attr("data-id"),i=e.nid;W(r).hasClass("cur")?(W("#hidDLPath").val(e.path),W("#hidDLNid").val(i),W("#frmDownload").attr("action",yunpan.config.url.f_down)):(W("#frmDownload").attr("action","/fHistory/downladHistory"),W("#hidDLPath").val(e.path),W("#hidDLId").val(n)),W("#frmDownload").submit()};return{fileHistoryList:v,resizeHolder:c,moreFileHistoryList:m,queryUrl:g}}(),yunpan.fo=ObjectH.mix(yunpan.fo||{},function(){function S(){var e=W("#toolbar .qrcode-content"),t=W("#toolbar .qrcode-content").css("height");e.slideUp(200,function(){e.setStyle({height:t,display:"none"})})}function x(e,t){var r=parseInt(e.getAttr("f-index"));if(n[r])return;e.addClass("active"),u=r,n[r]=!0,yunpan.filelist.curFunc=="file"&&U(),yunpan.filelist.curFunc=="share"&&S()}function T(e){if(e.length<=0)return;var t=parseInt(e.getAttr("f-index"));if(!n[t])return;n[t]=!1,e.removeClass("active"),yunpan.filelist.curFunc=="share"&&S()}function N(){for(var n=0;n<t;n++)x(e.item(n));yunpan.cmdCenter.updateStatus(),yunpan.filelist.curFunc=="share"&&S()}function C(){for(var n=0;n<t;n++)T(e.item(n));yunpan.cmdCenter.updateStatus(),yunpan.filelist.curFunc=="share"&&S()}function k(e,t){if(e.button==2)return;var n=this;if(yunpan.filelist.curFunc=="recycle")return;if(e&&e.target&&e.target.tagName.toLowerCase()=="label")return;e.target.tagName.toLowerCase()=="span"&&W(e.target).hasClass("text")?(C(),x(t),yunpan.cmdCenter.openItem(t)):yunpan.cmdCenter.openItem()}function F(){W("#list").delegate("li","click",L).delegate("li","mouseenter",function(e){W(this).addClass("hover")}).delegate("li","mouseleave",function(e){W(this).removeClass("hover")}).delegate("li","dblclick",j).delegate("li.row .column-checkbox","click",A).delegate("li span.text","click",B).delegate("li span.video-play-ico","click",H).delegate("li.active","mousedown",function(e){p.X=e.clientX-d.X,p.Y=e.clientY-d.Y}),W("#fileListHead").delegate(".file-sort","click",_).delegate(".column-checkbox","click",O)}function I(){W("#list").undelegate("li","click",L).undelegate("li","dblclick",k).undelegate("li span.text","click",B).undelegate("li span.video-play-ico","click",H).undelegate("li.row .column-checkbox","click",A),W("#fileListHead").undelegate(".file-sort","click",_).undelegate(".column-checkbox","click",O)}function q(){e=null,n=[],f=[],h=[],g=null,t=0,I(),yunpan.cmdCenter.updateStatus()}function R(){y&&(y.stop(),y=null),y=new yunpan.util.Lazyload({container:b,selector:"span.img img",type:"background-url",threshold:100}),y.start(),e=W("#list li"),t=e.length,n=null,n=new Array(t),e.forEach(function(e,t){e=W(e),e.setAttr("f-index",t)}),yunpan.cmdCenter.updateStatus()}function U(){try{if(yunpan.fo.getSelectFile().length>=1){var e=QW.NodeH.query(0,"#list li.active"),t=e;for(var n=0;n<e.length;n++){var r=W(e[n]).attr("f-index");if(!h[r]){h[r]=!0;var i=e[n],s=new QW.SimpleDrag({oDargTimeStart:500,oSrc:i,showProxy:!1,withProxy:!0,className:"proxy-dm",onbeforedragstart:function(e){return!!W("#list li.active").length&&W(e.target.oSrc).hasClass("active")&&!W(EventH.getTarget()).hasClass("text")}});s.on("dragstart",function(){try{var e=this,t=yunpan.fo.getSelectFile().length;d.X=parseInt(W(e.oProxy).css("left"),10),d.Y=parseInt(W(e.oProxy).css("top"),10),W(e.oProxy).html("<span>"+t+"</span><p></p>");if(!QW.Browser.ie6){var n=Date.now?function(){return Date.now()}:function(){return+(new Date)};E=n()}}catch(r){throw new Error("DragMove:dragstart."+r.message)}}),s.on("dragend",P),s.on("drag",D)}}}}catch(o){throw new Error("DragMove:initDrayLayout."+o.message)}}function z(e){e&&e.lazyLoaderCtn&&(b=e.lazyLoaderCtn),q(),o||(o=new QW.RectSelector({oHdl:W("#listHolder")[0],blackSelectors4Start:"a,input,textarea,object,embed",ignoreLeftButtonDrag:!0,onbeforedragstart:function(e){return!W(EventH.getTarget()).hasClass("text")}}),o.on("drag",M),o.on("dragstart",function(e){a=null;try{window.getSelection&&window.getSelection().removeAllRanges(),Browser.ie&&document.selection&&document.selection.empty()}catch(t){}W(EventH.getTarget()).parentNode(".filelist-item").length||C(),W("#list input[type=text], #list textarea").blur()}),o.on("dragend",function(){yunpan.cmdCenter.updateStatus(),m=yunpan.filelist.listtype,(yunpan.filelist.curFunc=="file"||yunpan.filelist.curFunc=="sFile")&&U()})),F(),R()}function X(e){r=e,y.loadImg()}function V(t){var r=[];for(var i=0,s=n.length;i<s;i++)if(n[i]){var o=e.item(i);(t||o.isVisible())&&r.push(o)}return r}function $(){var t=[];for(var r=0,i=n.length;r<i;r++){var s=e.item(r);t.push(s)}return t}var e,t=0,n=[],r,i=1,s=2,o=null,u=0,a,f=[],l=null,c=null,h=[],p={},d={},v=null,m,g,y,b="#fileListMain",w,E,L=function(r){r.stopPropagation();var i=this,s=n,o=W(i),a=r.target,f=parseInt(o.getAttr("f-index"));yunpan.menuManager.hideAll();if(!W(a).hasClass("column-checkbox")&&a.tagName!="LABEL"&&a.tagName!="INPUT"&&a.tagName!="TEXTAREA"){if(r.shiftKey){var l=f,c=Math.min(u,f),h=Math.max(u,f);for(var p=0;p<c;p++)T(e.item(p));for(var p=c;p<=h;p++)x(e.item(p));for(var p=h+1;p<t;p++)T(e.item(p))}else if(r.ctrlKey)n[f]?T(o):x(o);else{if(yunpan.filelist.listtype==1&&W(o).hasClass("active")){T(o),yunpan.cmdCenter.updateStatus(),x(o),W(o).removeClass("active");return}s.forEach(function(t,n){t&&T(e.item(n))}),x(o)}var d=W("#fileListHead");d.hasClass("active")&&d.removeClass("active"),yunpan.cmdCenter.updateStatus(),r.stopPropagation()}},A=function(e){var t=W(this).parentNode("li");W(t).hasClass("active")?(T(t),W("#fileListHead").removeClass("active")):x(t),yunpan.cmdCenter.updateStatus(),e.stopPropagation()},O=function(e){var t=W("#fileListHead");t.hasClass("active")?(C(),t.removeClass("active")):(N(),t.addClass("active")),e.stopPropagation()},M=function(n){if(!this.oProxy.offsetWidth)return;var r=QW.NodeH.getRect(this.oProxy);if(!a){a=[];for(var i=0;i<t;i++){var s=e[i];if(!s)continue;a[i]=QW.NodeH.getRect(s)}}for(var i=0;i<t;i++){var s=e.item(i),o=a[i];if(!s||!o)continue;QW.DomU.rectIntersect(o,r)?x(s):T(s)}},_=function(e){e.preventDefault(),yunpan.cmdCenter.changeListSort(W(this).attr("data-field"))},D=function(){try{if(!QW.Browser.ie6){var n=Date.now?function(){return Date.now()}:function(){return+(new Date)};w=n();if(w-E<100)return}}catch(r){throw new Error("DragMove: fDragMove time2 time1 "+r.message)}try{var i=this,s=W(i.oProxy).query("p");i.oProxy.style.display="block",s.hide();var o=QW.NodeH.getRect(i.oProxy);W(i.oProxy).css({left:o.left+p.X+5+"px",top:o.top+p.Y+10+"px",width:"64px",height:"64px"}),o.left=o.left+p.X,o.top=o.top+p.Y;var u=yunpan.filelist.listtype;if(!a||m!=u){m=u,a=[];for(var f=0;f<t;f++){var l=e[f];if(!l)continue;a[f]=QW.NodeH.getRect(l)}}for(var f=0;f<t;f++){var l=e.item(f),c=a[f],h=l.query("span.ico"),d=!l.hasClass("active")&&(h.hasClass("ico-folder")||h.hasClass("ico-picturefolder")||h.hasClass("ico-musicfolder")||h.hasClass("ico-documentfolder")||h.hasClass("ico-videofolder")||h.hasClass("ico-bookfolder")||h.hasClass("ico-fromchromefolder")||h.hasClass("ico-fromphonefolder"));if(!l||!c)continue;var v=yunpan.filelist.listtype=="2"?function(){c.left<=o.left&&c.top<=o.top&&o.left+32<=c.right&&o.top+32<=c.bottom?d&&(l.addClass("move"),s.html("\u79fb\u52a8\u5230\u201c"+l.attr("data-title").subByte("7","...")+"\u201d").show(),g=l):l.removeClass("move")}:function(){c.left<=o.left&&c.top+3<=o.top&&o.left<=c.right&&o.top+3<=c.bottom?d&&(l.addClass("move"),s.html("\u79fb\u52a8\u5230 \u201c"+l.attr("data-title").subByte("7","...")+"\u201d ").show(),g=l):l.removeClass("move")};v()}}catch(r){throw new Error("DragMove: fDragMove"+r.message)}},P=function(e){try{this.oProxy.style.display="none";if(!g)return;if(g.hasClass("active")||!g.hasClass("move"))return;var t=g.attr("data-path"),n=g.attr("data-nid"),r=[],i=[],s=yunpan.fo.getSelectFile();s.forEach(function(e){var t=e.attr("data-path");r.push(t),i.push(e.attr("data-nid"))});var o='"'+g.attr("data-title").subByte("20","...")+'"';yunpan.tips.show();var u,a;yunpan.filelist.curFunc=="file"?(u="path[]",a=r,paramsPost={newpath:t}):(u="nids[]",a=i,paramsPost={dst_nid:n}),yunpan.BatchRequest.create({url:yunpan.config.url.move,batchParam:u,data:a,params:paramsPost,batchSuccess:function(e){var t=e.evalExp();t.errno!=0?(yunpan.BatchRequest.terminate(),yunpan.tips.hide(),yunpan.Msg.alert(t.errmsg,{type:"error"}),g.removeClass("move")):(yunpan.tips.show("\u6210\u529f\u79fb\u52a8\u5230"+o,!1,!0),W("#topTips .close").on("click",function(){W("#topTips").fadeOut(300)}))},success:function(){yunpan.tips.show("\u6210\u529f\u79fb\u52a8\u5230"+o,!1,!0),W("#topTips .close").on("click",function(){W("#topTips").fadeOut(300)}),yunpan.filelist.curFunc=="file"?yunpan.ytree.isFolderChanged=!0:yunpan.ytreeSfile.isFolderChanged=!0;try{s.forEach(function(e){e.removeNode()})}catch(e){}yunpan.fo.initFileIndex(),yunpan.fo.getFileNum()<1&&yunpan.filelist.page>0&&(yunpan.filelist.page=yunpan.filelist.page-1),yunpan.filelist.list(),g=null}})}catch(e){throw new Error("DragMove: fDragEnd"+e.message)}},H=function(e){k(e,W(this).parentNode("li"))},B=function(e){k(e,W(this).parentNode("li"))},j=function(e){k(e,W(this))};return{init:z,setDisplayType:X,initFileIndex:R,getSelArr:function(){return n},getSelectFile:V,getAllFile:$,unSelectFile:T,selectAllFile:N,unSelectAllFile:C,selectFile:x,getFileNum:function(){return t}}}()),yunpan.fo=ObjectH.mix(yunpan.fo||{},function(){function o(e){var n=null;e=e.trim(),e==""?n="\u6587\u4ef6\u5939\u7684\u540d\u5b57\u4e0d\u80fd\u4e3a\u7a7a\uff01":/[\\\/\:\*\?\"<>|]+/.test(e)?n='\u4e0d\u80fd\u5305\u542b\\ / : * ? " < > |':/^\./.test(e)?n="\u4e0d\u80fd\u521b\u5efa.\u5f00\u5934\u7684\u6587\u4ef6\u5939":yunpan.filelist.path==="/"&&"\u4e91\u540c\u6b65"===e&&(n='"\u4e91\u540c\u6b65"\u662f\u7cfb\u7edf\u76ee\u5f55\uff0c\u8bf7\u4f7f\u7528\u5176\u4ed6\u540d\u5b57\u521b\u5efa\u76ee\u5f55\uff01');if(n){if(s)return;return window.setTimeout(function(){s=!0;var e=yunpan.Msg.alert(n,{type:"error",fn:function(){s=!1,yunpan.filelist.listtype==t?setTimeout(function(){W("#list .new-folder input").focus()[0].select()},100):setTimeout(function(){W("#list .new-folder textarea").focus()[0].select()},100)}});e.on("afterhide",function(){s=!1})},10),!0}var r=yunpan.filelist.path+e+"/";yunpan.tips.show(),Ajax.post(yunpan.config.url.mkdir,{path:r},function(e){e=e.evalExp(),e.errno?(yunpan.tips.hide(),e["errno"]==3005?e.errmsg="\u5df2\u5b58\u5728\u76f8\u540c\u6587\u4ef6\u540d\uff01":i=!1,yunpan.Msg.alert(e.errmsg,{type:"error"})):(W("#list .new-folder input,#list .new-folder textarea").un("blur",u).un("keydown",l),W("#list .new-folder").removeNode(),i=!1,yunpan.tips.show("\u6587\u4ef6\u5939\u521b\u5efa\u6210\u529f\uff01"),yunpan.filelist.lastdir=r,yunpan.filelist.list(),yunpan.ytree.isFolderChanged=!0,yunpan.ytreeSfile.isFolderChanged=!0,yunpan.ytreeSfileTofile.isFolderChanged=!0)})}function u(e){var e=this.value;o(e)}function a(){if(yunpan.filelist.isloading||i)return!1;yunpan.fo.unSelectAllFile(),i=!0,e=yunpan.filelist.listtype,W("#emptyTips").hide(),W("#list").removeClass("none-user-select");var n=yunpan.fo.getAllFile(),s=[],o=1,a="\u65b0\u5efa\u6587\u4ef6\u5939";n.forEach(function(e){s.push(e.attr("data-title"))});while(s.contains(a))a="\u65b0\u5efa\u6587\u4ef6\u5939("+o++ +")";var c,h;c=['<li data-type="folder" class="row filelist-item new-folder clearfix">','<div class="column column-checkbox">',"<label></label>","</div>",'<div class="column column-name">','<span class="ico ico-folder"></span>','<input maxlength="188" type="text" value="'+a+'" />',"<textarea>"+a+"</textarea>","</div>",'<div class="column column-size">&nbsp;</div>','<div class="column column-time">&nbsp;</div>',"</li>"].join(""),W("#list li").length<=0&&(W("#list")[0].innerHTML='<li style="display:none;">throw away my television!</li>',W("#list li").removeNode()),r=W(c).insertTo("afterbegin",W("#list")[0]),W("#list .new-folder input,#list .new-folder textarea").on("blur",u).on("keydown",l),setTimeout(function(){var n;e==t?n=W("#list .new-folder input"):n=W("#list .new-folder textarea"),n.focus()[0].select()},100);var p=W("#list textarea");p[0].oninput=f,p[0].onpropertychange=f,p.on("contextmenu",function(e){e.stopPropagation()})}function f(e){var t=W("#list textarea");if(t.length<=0)return;var n=t.get("value"),r=W("body .folder-name-ruler"),i,s,o;r=r.length>0?r:W('<div class="folder-name-ruler"></div>').insertTo("beforeend",document.body),r.html(n.encode4Html().replace(/ /g,"&nbsp;")),i=r.getSize(),o=i.height,o=o>32?o+16:32,t.setStyle("height",o+"px")}function l(e){var t=e.keyCode,n=e.shiftKey;f(),(t==191||t==220||n&&(t==56||t==59||t==188||t==190||t==222))&&e.preventDefault(),t==13&&(this.blur(),e.stopPropagation())}function c(){yunpan.filelist.listtype==t?(W("#list .new-folder textarea").val(W("#list .new-folder input").val()),setTimeout(function(){var e=W("#list .new-folder textarea");e.length>0&&e.focus()[0].select()},100)):(W("#list .new-folder input").val(W("#list .new-folder textarea").val()),setTimeout(function(){var e=W("#list .new-folder input");e.length>0&&e.focus()[0].select()},100))}var e,t=1,n=2,r,i=!1,s=!1;return{createFolder:a,changeListType:c}}()),namespace("yunpan.fileType"),yunpan.fileType=ObjectH.mix(yunpan.fileType,function(){function t(e){var t=e.lastIndexOf(".");if(t<0)return"file";var n=e.substr(t);return n.length<2?"file":(ext=n.substr(1).toLowerCase(),ext)}function n(n){var r=t(n);return e[r]?e[r]:"file"}function r(n){var r=t(n);return e[r]?e[r]:"file"}function i(e){var t="file",n=e.lastIndexOf(".");n<0&&(t="file");var r=e.substr(n);r.length<2&&(t="file"),t=r.substr(1).toLowerCase();switch(t){case"doc":case"docx":case"docm":case"dotx":case"dotm":case"dot":case"rtf":return"Word\u6587\u6863";case"xlsx":case"xls":case"csv":case"xlsm":case"xlsb":return"Excel\u8868\u683c";case"ppt":case"pptx":case"pptm":case"potx":case"pot":case"potm":return"PPT\u6f14\u793a\u7a3f";case"pdf":case"fdf":return"PDF\u6587\u4ef6";case"txt":return"\u6587\u672c\u6587\u4ef6";case"bmp":case"gif":case"jpg":case"jpeg":case"png":case"psd":case"cdr":case"ico":case"tif":case"tiff":case"tga":case"raw":return"\u56fe\u7247";case"mp3":case"wma":case"wav":case"aac":case"ape":case"mid":case"mod":case"cd":case"asf":case"arm":case"ram":case"m4a":case"ogg":case"aif":case"aifc":case"amr":return"\u97f3\u4e50";case"avi":case"rm":case"rmvb":case"wmv":case"mpg":case"mpeg":case"mkv":case"flv":case"dat":case"scm":case"mov":case"3g2":case"3gp":case"3gp2":case"3gpp":case"mp4":case"amv":case"csf":case"ivf":case"mts":case"swf":case"webm":return"\u89c6\u9891";case"exe":case"msi":case"bat":return"\u5e94\u7528\u7a0b\u5e8f";case"apk":case"ipa":return"\u624b\u673a\u5e94\u7528";case"rar":case"zip":case"jar":case"iso":case"cab":case"lha":case"bh":case"tar":case"lzh":case"7z":case"gz":case"gzip":case"bar":case"zipx":case"bz2":return"\u538b\u7f29\u6587\u4ef6";case"url":return"Internet \u5feb\u6377\u65b9\u5f0f";default:return"\u672a\u77e5\u6587\u4ef6"}}var e={bmp:"bmp",gif:"gif",jpg:"jpg",jpeg:"jpg",png:"png",psd:"psd",cdr:"cdr",ico:"ico",ai:"ai",txt:"txt",log:"log",pdf:"pdf",fdf:"pdf",mp3:"mp3",wma:"wma",wav:"wav",ape:"ape",mov:"mov",mp4:"mp4",rmvb:"rmvb",wmv:"wmv",rm:"rm",mpg:"mpg",avi:"avi",flv:"flv",mpeg:"mpeg",mkv:"mkv",webm:"webm",swf:"swf",fla:"swf",html:"html",htm:"htm",mht:"mht",xml:"xml",doc:"doc",docx:"doc",docm:"doc",dotx:"doc",dotm:"doc",dot:"doc",rtf:"doc",ppt:"ppt",pptx:"ppt",pptm:"ppt",potx:"ppt",pot:"ppt",potm:"ppt",xls:"xls",xlsx:"xls",csv:"xls",xlsm:"xls",xlsb:"xls",mdb:"access",rar:"rar",zip:"zip",iso:"iso",cab:"cab","7z":"7z",c:"c",cs:"cs",cpp:"cpp",java:"java",php:"php",url:"url",apk:"apk",torrent:"bt",ququ:"ququ"};return{getSuffix:t,getType:n,getTypeDesc:i,getTypeIcon:r}}()),window.yunpan.filelist=function(){var e=W("#listHolder"),t=null,n=null,r=300;return{specialFolder:{"/\u624b\u673a\u76f8\u518c/":{field:"mtime",order:"desc"},"/camera/":{field:"mtime",order:"desc"},"/100media/":{field:"mtime",order:"desc"},"/100andro/":{field:"mtime",order:"desc"},"/\u56fe\u7247/\u624b\u673a\u76f8\u518c/":{field:"mtime",order:"desc"},"/\u56fe\u7247/\u62cd\u7167\u76f8\u518c/":{field:"mtime",order:"desc"},"/\u56fe\u7247/camera/":{field:"mtime",order:"desc"},"/\u6765\u81ea-\u7f51\u9875\u5feb\u5b58/":{field:"mtime",order:"desc"}},listtype:yunpan.Storage.get("YUNPAN_LISTTYPE")=="1"?1:2,shareListtype:1,path:"",nid:0,page:0,nav:[],order:"asc",order_field:"name",isloading:!1,curFunc:"file",order_recycle:"desc",order_field_recycle:"mtime",order_link:"desc",order_field_link:"mtime",sFileState:0,recyclePass:!1,initLoadingMask:function(){var e=['<div id="loadingMask">',"<div></div>","<span>\u52a0\u8f7d\u6587\u4ef6\u5217\u8868\u4e2d...</span>","</div>"].join("");this.loadingMask=W(e).insertTo("beforeend",W("#mainPanel"))},resizeHolder:function(){var e=W("#fileListMain"),t=W("#listHolder"),n=W("#listHolder .page-nav"),r=Dom.getDocRect().height-e.getRect().top,i=W("#list");e.css("height",r+"px");if(i.length>0){var s=i.getRect().height;n.length>0&&r-n.getRect().height>s&&(r-=n.getRect().height),r<s&&(r=s),t.css("height",r+"px")}var o=W("#fileListHead"),u=o.getRect();if(u.width>0){var a=u.width+parseInt(o.css("margin-right"))-t.getRect().width;o.css("margin-right",a+"px")}},showLoadingMask:function(){setTimeout(function(){if(yunpan.filelist.isloading){yunpan.filelist.loadingMask||yunpan.filelist.initLoadingMask();var e=yunpan.filelist.loadingMask;if(e.css("display")!="none")return;e.setStyle({display:"block"});if(Browser.ie&&Browser.ie==6){var t=W("#mainPanel").getRect(),r=Dom.getDocRect(),i=r.width-t.left,s=r.height-t.top;e.setStyle({width:i+"px",height:s+"px"})}n=new ElAnim("loadingMask",{opacity:{to:1,from:0}},300,QW.Easing.easeBothStrong),n.play()}},500)},hideLoadingMask:function(){this.loadingMask||this.initLoadingMask(),n&&n.end(),n=new ElAnim("loadingMask",{opacity:{to:0,from:1}},300,QW.Easing.easeBothStrong),n.onend=function(){W("#loadingMask").setStyle("display","none"),n=null},n.play()},list:function(n,i,s,o,u,a,f){W("#listHolder").html(""),W("#fileListHistory").hide(),t&&t.cancel();if(SYS_CONF.token!=Cookie.get("token",""))return location.reload(),!1;n&&(this.path=n),i&&(this.nid=i),typeof s=="undefined"?s=this.page:s=parseInt(s||0);if(this.curFunc=="file"||this.curFunc=="sFile"||this.curFunc=="link")this.page=s;try{yunpan.envSwitch.show("filelist")}catch(l){}var c="",h={type:this.curFunc=="link"?this.shareListtype:this.listtype,t:Math.random()},p=this.order,d=this.order_field;if(this.specialFolder[this.path.toLowerCase()]){var v=this.specialFolder[this.path.toLowerCase()];d=v.field||"mtime",p=v.order||"desc"}var m={recycle:{name:"file_name",fsize:"file_size",mtime:"mtime"},file:{name:"file_name",fsize:"file_size",mtime:"server_time",fmtime:"fmtime"},link:{name:"name",fsize:"fsize",mtime:"mtime"},sFile:{name:"file_name",fsize:"file_size",mtime:"server_time",fmtime:"fmtime"}};this.curFunc=="link"?(h.skey=m.link[this.order_field_link],this.order_link=="desc"?h.isdesc="1":h.isdesc="0"):this.curFunc=="recycle"?(h.order=this.order_recycle,h.field=m.recycle[this.order_field_recycle]):(h.order=p,h.field=m[this.curFunc][d]),this.curFunc!="recycle"&&(this.order_recycle="desc",this.order_field_recycle="mtime");var g=f==undefined?!1:f;if(g&&this.curFunc=="file"){yunpan.filelist.nav=[];var y=this.path.substring(1,this.path.length-1).split("/"),b="";if(y[0]!="")for(var w=0;w<y.length;w++)b+=y[w]+"/",yunpan.filelist.nav.push({title:y[w],nid:0,path:"/"+b})}switch(this.curFunc){case"recycle":c="/file/getrecoverlist",h.start=typeof s!="number"?0:s;break;case"link":c="/share/listLink",h.page=this.page,h.page_size=r;break;case"sFile":c="/sFile/list",h.path=this.path,h.nid=this.nid,h.page=this.page,h.page_size=r,this.lastdir&&(h.lastdir=this.lastdir,this.lastdir=null);break;default:c="/file/list",h.path=this.path,h.page=this.page,h.page_size=r,this.lastdir&&(h.lastdir=this.lastdir,this.lastdir=null)}a||(document.getElementById("fileListMain").scrollTop=0),yunpan.cmdCenter.updateSortStatus(),this.isloading=!0,this.showLoadingMask();var E=new Date;yunpan.config.init(this.curFunc),t=Ajax.post(c,h,function(n){var r=new Date;yunpan.filelist.isloading=!1,yunpan.filelist.hideLoadingMask(),t=null;if(!n)return;if(n.indexOf("LOGIN_FLAG")>-1||yunpan.filelist.curFunc=="link"){var i=n.evalExp();if(i.errno=="3022"||i.errno=="3008"){yunpan.Msg.alert("\u6587\u4ef6\u5939\u8def\u5f84\u4e0d\u5b58\u5728\uff01");return}if(yunpan.filelist.curFunc=="sFile"){if(i.errno=="31203"){yunpan.filelist.sFileState=0,W("#leftPanel .sFile").addClass("current").removeClass("current-lock"),W("#toolbar").hide(),W("#crumb").hide(),W("#fileListHead").hide(),W("#fileListMain").css("height","auto"),W("#listHolder").css("height","auto"),W("#search").hide(),yunpan.authority.openSfile();return}if(i.errno=="1003"){yunpan.filelist.sFileState=0,W("#leftPanel .sFile").addClass("current").removeClass("current-lock"),W("#toolbar").hide(),W("#crumb").hide(),W("#fileListHead").hide(),W("#fileListMain").css("height","auto"),W("#listHolder").css("height","auto"),W("#search").hide(),yunpan.authority.enterSfile();return}yunpan.filelist.sFileState=1,W("#leftPanel .sFile").addClass("current-lock").removeClass("current")}if(yunpan.filelist.curFunc=="recycle"){if(i.errno=="1003"){yunpan.filelist.recyclePass=!0,yunpan.cmdCenter.updateRBStatus(),W("#toolbar").hide(),W("#crumb").hide(),W("#fileListHead").hide(),W("#fileListMain").css("height","auto"),W("#listHolder").css("height","auto"),W("#search").hide(),yunpan.authority.enterRecycle();return}yunpan.filelist.recyclePass=!1}var s,a;if(yunpan.filelist.curFunc=="link"){s=i.data.quotas.used.toString(),a=i.data.quotas.remain.toString();var f={};f.data=i.data.linklist,f.hasNextPage=i.data.pageinfo.has_next_page,f.page=i.data.pageinfo.page,i=f,i.data=i.data||[],i.data.push({})}var l=new Date;yunpan.filelist.html(i,e);var c=W("#list"),h=W("#fileListMain");W("#fileListHead").removeClass("active");var p=W("#fileList");p.hasClass(yunpan.filelist.curFunc+"-tab")||p.removeClass(p.attr("data-tab")).addClass(yunpan.filelist.curFunc+"-tab").attr("data-tab",yunpan.filelist.curFunc+"-tab");if(yunpan.filelist.curFunc=="link")var d=yunpan.filelist.shareListtype;else var d=yunpan.filelist.listtype;d===1?(c.addClass("list-list"),c.removeClass("ico-list"),i.data.length>=1?W("#fileListHead").show():W("#fileListHead").hide()):(c.addClass("ico-list"),c.removeClass("list-list"),i.data.length>=1?(W("#fileListHead").hide(),c.query(".p-columnCheck").hide(),c.query(".p-columnSize").hide(),c.query(".p-columnTime").hide(),yunpan.filelist.curFunc=="link"&&(c.query(".p-columnHit").hide(),c.query(".p-columnCode").css("visibility","hidden"))):W("#fileListHead").hide()),yunpan.filelist.resizeHolder();var v=new Date;try{monitor.tlog({m:"wpo",a:"20121224-fl-load",n:r-E}),monitor.tlog({m:"wpo",a:"20121224-fl-paint",n:v-l,n1:i.data.length})}catch(m){}yunpan.filelist.curFunc=="link"&&(W("#crumb").attr("data-used",s).attr("data-remain",a),W("#list li.row").forEach(function(e){var t=W(e).query(".pwd-on .copy-box"),n=t.query(".copy-pwd"),r=W(e).query(".code"),i={box:t,btn:n,text:r.html(),listeners:{aftercopy:function(e){monitor.clickLog("\u590d\u5236\u5206\u4eab\u5730\u5740"),e?yunpan.tips.show("\u8bbf\u95ee\u5bc6\u7801\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f"):yunpan.Msg.alert("\u62b1\u6b49\uff0c\u60a8\u4f7f\u7528\u7684\u6d4f\u89c8\u5668\u91cc\u4e0d\u80fd\u81ea\u52a8\u590d\u5236\u5230\u526a\u8d34\u677f\uff0c\u8bf7\u5148\u5b89\u88c5flash\u3002",{type:"warning"})},beforecopy:function(e){e.setText(r)}}};W(e).attr("data-extract-status")=="1"&&!n.hasClass("clip-on")&&(new yunpan.CopyClip(i),n.addClass("clip-on"))})),yunpan.fo.init(),i.data[0]&&i.data[0].lastdir&&(yunpan.fo.selectFile(W("#list >li:nth-of-type(1)")),yunpan.cmdCenter.updateStatus());try{yunpan.Search.research()}catch(m){}yunpan.filelist.pageNav(),o&&typeof o=="function"&&o(i),yunpan.filelist.findItemByIndexAndName(u)}else e.html(""),yunpan.Msg.alert("\u767b\u5f55\u5931\u6548\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\uff01",{type:"error",fn:function(){location.href="/"}})})},findItemByIndexAndName:function(e){if(e){if(typeof e=="string"){var t=yunpan.fo.getAllFile(),n=[];for(var r=0,i=t.length;r<i;r++)t[r].attr("data-title")==e&&n.push(parseInt(t[r].attr("f-index")));e=n}if(Object.isArray(e)){var s=W("#list .filelist-item");for(var r=0,i=e.length;r<i;r++){var o=s.item(e[r]);yunpan.fo.selectFile(o)}yunpan.cmdCenter.updateStatus()}}},pageNav:function(){var e=W("#fileList .page-nav"),t="disabled",n="normal";yunpan.filelist.data_page=null;if(!e.length)return;yunpan.filelist.data_page=e.attr("data-page").split(","),e.delegate("a","click",function(e){var n=W(this);if(n.hasClass(t))return;var r=parseInt(n.attr("data-start"),10),i="",s=0,o=yunpan.filelist.curFunc;if(o=="file"||o=="sFile")i=yunpan.filelist.path,s=yunpan.filelist.nid;o=="recycle"&&(i="recycleBin"),yunpan.filelist.list(i,s,isNaN(r)?0:r)})},showNotice:function(){return!0}}}();var pageFuncInited=!1;(function(){HistoryManager.init(function(e){e=e||"/";if(!pageFuncInited){pageFuncInited=!0;var t=String.queryUrl(location.href);t.func&&(e=t.func)}e=decodeURIComponent(e);if(e==yunpan.filelist.path&&yunpan.filelist.curFunc=="file")return!1;if(yunpan.filelist.curFunc=="recycle"&&e=="recycleBin")return!1;if(yunpan.filelist.curFunc=="link"&&e=="link")return!1;if(yunpan.filelist.curFunc=="sFile"&&(e=="sFile"+yunpan.filelist.path||e=="sFile"))return!1;/^sFile/.test(e)?(e=e.replace("sFile",""),yunpan.filelist.nid==0&&(e="/"),yunpan.filelist.curFunc="sFile"):e=="recycleBin"?yunpan.filelist.curFunc="recycle":e=="link"?yunpan.filelist.curFunc="link":e=="sFile"?yunpan.filelist.curFunc="sFile":(yunpan.filelist.curFunc="file",e.indexOf("%2F")!=0&&e.indexOf("/")!=0&&(e="/")),yunpan.filelist.path=e,W("#fileList").removeClass(W("#fileList").attr("data-tab")).addClass(yunpan.filelist.curFunc+"-tab").attr("data-tab",yunpan.filelist.curFunc+"-tab");var n=location.search.substr("1").queryUrl(),r={profile:"/user/info?from=my",task:"/task?from=my",invite:"/task/invitefriend?from=my",level:"/task/myLevel?from=my",notice:"/notice/index/?domain="+location.host,records:"/user/volrecords?type=all",sign:"/user/volrecords?type=sign",level3:"/user/volrecords?type=level3_activity",space:"http://yunpan.360.cn/pay/index/?domain="+location.host,pay:"http://yunpan.360.cn/card?domain="+location.host},i={sFile:"/my/index/#sFile",link:"/my#link",recycleBin:"/my#recycleBin"};if(n.p&&r[n.p])window._pluginTipHide=!0,Dom.ready(function(){yunpan.envSwitch.showIfrPage(r[n.p])});else if(n.p&&i[n.p])location.href=i[n.p];else{var s=yunpan.filelist;s.order_recycle=yunpan.Storage.get("ORDER_RECYCLE")||"desc",s.order_field_recycle=yunpan.Storage.get("ORDER_FIELD_RECYCLE")||"mtime",s.order_link=yunpan.Storage.get("ORDER_LINK")||"desc",s.order_field_link=yunpan.Storage.get("ORDER_FIELD_LINK")||"mtime",s.order=yunpan.Storage.get("ORDER_NORMAL")||"asc",s.order_field=yunpan.Storage.get("ORDER_FIELD_NORMAL")||"name",yunpan.filelist.curFunc=="recycle"?Ajax.post("/authority/isRecycleBinLocked",{qid:SYS_CONF.qid},function(e){var t=e.evalExp();t.errno!=0?(W("#tbOpenPassword").show(),W("#tbOpenPasswordDone").hide()):(W("#tbOpenPasswordDone").show(),W("#tbOpenPassword").hide()),yunpan.filelist.list(),yunpan.cmdCenter.updateNav()}):!n.his_nid||n.init!="history"&&n.init!="historysFile"?(yunpan.filelist.list(null,null,null,null,null,null,!0),yunpan.cmdCenter.updateNav()):yunpan.filehistory.queryUrl(n)}})})(),yunpan.filelist=ObjectH.mix(yunpan.filelist||{},function(){function m(e,t){var i=[],a,c,h,p=e.data,d=yunpan.filelist.curFunc,m=d=="link"?yunpan.filelist.shareListtype:yunpan.filelist.listtype,g,y=yunpan.fileType.getTypeDesc,b=yunpan.fileType.getType,w=yunpan.fileType.getSuffix,E=yunpan.util.formatByte;p.length=p.length-1,d=="file"||d=="link"||d=="sFile"?(a=(d=="file"||d=="sFile"?s:o).tmpl(),c=n.tmpl()):(a=u.tmpl(),c=r.tmpl()),d=="link"?h=f.tmpl():h=l.tmpl();for(var S=0,x=p.length;S<x;S++){g=p[S];if(g.name=="\u4e91\u540c\u6b65")continue;if(d=="file"||d=="sFile")g.path=g.path.encode4HtmlValue();d=="link"&&(g.date=g.create_time,g.oriName=g.name,g.oriSize=g.file_size,g.size=E(g.oriSize),g.path=g.fullpath,g.linkUrl=g.url,g.hasThumb=!!g.thumb,g.pwdCls=g.is_use_password?"pwd-on":"pwd-off",g.password1=g.is_use_password?g.password:"-",g.status!=0&&(g.itemCls="link-invalid")),g.name=g.oriName.encode4Html(),d=="link"&&g.status!=0?g.shortName='<span class="invalid-tag">\uff08\u5df2\u5931\u6548\uff09</span>'+g.oriName.subByte(40,"\u2026").encode4Html():g.shortName=g.oriName.subByte(50,"\u2026").encode4Html(),g.fileType=b(g.oriName),g.suffix=w(g.oriName),d==="link"&&!g.fhash&&(parseInt(g.node_count,10)>1?g.fileType="mix":g.fileType="folder"),g.title=g.name+"&#10",g.isLink&&(g.linkHtml='<span class="link-logo"></span>');var T=yunpan.video.isVideo(g.suffix);T&&(g.videoPlayHtml='<span class="video-play-ico"></span>'),d=="recycle"?g.time=g.mtime:g.time=g.date;if(g.isDir){g.title+="\u521b\u5efa\u65f6\u95f4: "+g.date;var N=/^\/\u6765\u81ea-(\u624b\u673a[^\/]*|iPhone|iPod)\/?$/;N.test(g.path)&&(g.foldertype="fromphone");switch(g.path){case"/\u89c6\u9891/":g.foldertype="video";break;case"/\u97f3\u4e50/":g.foldertype="music";break;case"/\u4e66\u7c4d/":g.foldertype="book";break;case"/\u56fe\u7247/":g.foldertype="picture";break;case"/\u6587\u6863/":g.foldertype="document";break;case"/\u6765\u81ea-\u7f51\u9875\u5feb\u5b58/":g.foldertype="fromchrome";break;default:}i.push(c(g))}else g.title+="\u7c7b\u578b: "+y(g.oriName)+"&#10"+"\u5927\u5c0f: "+g.size+"&#10"+(d=="link"?"\u4e0b\u8f7d\u6b21\u6570: "+g.total_hits+"\u6b21&#10":""),d=="link"?g.title+="\u521b\u5efa\u65f6\u95f4: "+g.date:d=="recycle"?g.title+="\u5220\u9664\u65f6\u95f4: "+g.mtime:g.title+="\u4fee\u6539\u65f6\u95f4: "+g.fmtime,d==="link"&&!g.fhash&&(g.title="\u521b\u5efa\u65f6\u95f4: "+g.date,g.total_hits="-",g.size="-"),g.thumbCls=g.fileType,g.thumb&&(g.imgHtml='<img src="/resource/img/blank.gif" data-imgurl="'+g.thumb+'" />',g.thumbCls="img"),g.mtime=g.mtime,g.preview&&(g.isPictures="preview"),i.push(a(g))}var C="",k="",L="",A="\u65e5\u671f",O="mtime",M=yunpan.filelist.order,_=yunpan.filelist.order_field;if(this.specialFolder[this.path.toLowerCase()]){var D=this.specialFolder[this.path.toLowerCase()];_=D.field||"mtime",M=D.order||"desc"}else this.curFunc=="recycle"?(M=this.order_recycle,_=this.order_field_recycle):this.curFunc=="link"&&(M=this.order_link,_=this.order_field_link);_=="name"&&(M=="asc"?C="arrow_u":C="arrow_d"),_=="fsize"&&(M=="asc"?k="arrow_u":k="arrow_d");if(d=="file"||d=="sFile")A="\u4fee\u6539\u65e5\u671f",O="fmtime",_=="fmtime"&&(M=="asc"?L="arrow_u":L="arrow_d");d=="recycle"&&(A="\u5220\u9664\u65e5\u671f"),(d=="recycle"||d=="link")&&_=="mtime"&&(M=="asc"?L="arrow_u":L="arrow_d");var P="file-sort";i='<ul id="list" class="file-list clearfix">'+i.join("")+"</ul>";var H;p.length<1&&(d=="recycle"?H="\u56de\u6536\u7ad9\u91cc\u6ca1\u6709\u8d44\u6599\uff0c\u5f88\u5e72\u51c0\u54e6~":d=="sFile"?H='<img src="/resource/img/my_empty_folder.gif" alt="empty folder" /><h1>\u6587\u4ef6\u4fdd\u9669\u7bb1\u6b64\u6587\u4ef6\u5939\u8fd8\u662f\u7a7a\u7684\u54e6~</h1>':d=="link"?H="\u60a8\u8fd8\u6ca1\u6709\u53d1\u5e03\u5206\u4eab\u6587\u4ef6\u54e6~ \u652f\u6301\u9f20\u6807\u53f3\u952e\u70b9\u51fb\u6587\u4ef6\u53d1\u5e03\u5206\u4eab\u3002":(H='                    <img src="/resource/img/my_empty_folder.gif" alt="empty folder" />                    <h1>\u60a8\u7684\u8fd9\u4e2a\u6587\u4ef6\u5939\u8fd8\u662f\u7a7a\u7684\u54e6~</h1>                    <p class="upload">\u7acb\u523b\u70b9\u51fb\u4e0a\u4f20\u6309\u94ae\u6216\u8005<a href="http://down.360safe.com/yunpan/360wangpan_setup.exe">\u4e0b\u8f7dPC\u5ba2\u6237\u7aef</a>\u6765\u6dfb\u52a0\u6587\u4ef6\u5427\uff01</p>',yunpan.upload.upload_type==="AJAX2"&&(H+='                <p class="prompt">\u63d0\u793a\uff1a\u60a8\u7684\u6d4f\u89c8\u5668\u652f\u6301\u6587\u4ef6\u62d6\u62fd\u4e0a\u4f20\u81f3\u4e91\u76d8\uff0c\u62d6\u8fdb\u6765\u8bd5\u8bd5</p>')),i='<ul id="list" class="clearfix"></ul><div id="emptyTips">'+H+"</div>");if(d=="file"||d=="sFile"||d=="link")e.hasNextPage?e.next=e.page+1:e.next=-1,e.previous=e.page-1,e.current=e.page;W("#fileList .page-nav").length&&W("#rtt").css("visibility","hidden");if(e.next>=0||e.previous>=0){var B="",j="";e.previous<0?B="disabled":B="normal",e.next<0?j="disabled":j="normal",i+=v.tmpl({data:e.data.length,current:e.current,previous:e.previous,next:e.next,prevCls:B,nextCls:j})}t.html(i);if(p.length>=1){var F=""+h({fileSort:P,timeField:O,nameCls:C,sizeCls:k,timeCls:L,dateName:A})+"";W("#fileListHead").html(F)}d=="link"&&yunpan.filelist.showNotice();if(!W(".returnToTop").length){var I={bottom:70,ch:W("#fileListMain").getRect().height,cw:W("#fileListMain").getRect().width,doc:document.getElementById("fileListMain"),dom:W("#fileListMain"),headH:1e3,left:!1,right:30,yId:"fileListMain"};yunpan.gotoTop.init(I)}}
function g(e){var t=[],n={},r={},i="",s=p.tmpl(),o=e.event,u=e.fhistory_list;for(var a=0,f=u.length;a<f;a++)n.size=yunpan.util.formatByte(u[a].fsize,2),n.oriSize=u[a].fsize,n.nid=u[a].nid,n.time=u[a].mtime,n.vid=u[a].version,n.id=u[a].id,n.pic=u[a].pic,n.item="item",t.push(s(n));return o?(r.nid=o.former,r.title="\u52a0\u8f7d\u79fb\u52a8\u524d\u7684\u6587\u4ef6\u65f6\u5149\u53f7",r.type="move",t.push(d.tmpl(r))):u.length>=300&&(r.title="\u52a0\u8f7d\u66f4\u591a",r.type="",t.push(d.tmpl(r))),t}function y(e){var t=[],n={},r=e.current;return n.nid=r.nid,n.size=yunpan.util.formatByte(r.fsize,2),n.oriSize=r.fsize,n.time=r.mtime,n.pic=r.pic,n.vid="\u5f53\u524d",n.item="",t.push(h.tmpl(n)),t}var e=['<li class="row filelist-item clearfix {$itemCls}"',' data-nid="{$nid}"',' data-type="folder"',' data-title="{$name}"',' data-link="{$isLink}"',' data-url="{$linkUrl}"',' data-shorturl="{$shorturl}"',' data-date="{$date}"',' data-password="{$password}"',' data-path="{$path}">','<div class="column column-checkbox">',"<label></label>","</div>",'<div class="column column-name" title="{$title}">',"{$inHtml}","</div>",'<div class="column column-size">&nbsp;</div>','<div class="column column-time">{$time}</div>',"</li>"].join(""),t='<span class="ico ico-{$foldertype}folder">{$linkHtml}</span><span class="text">{$shortName}</span>',n=e.replace(/\{\$inHtml\}/,""+t+""),r=e.replace(/\{\$inHtml\}/,t),i=['<li class="row filelist-item clearfix {$itemCls} {$isPictures}"',' data-nid="{$nid}"',' data-type="file"',' data-ori-size="{$oriSize}"',' data-size="{$size}"',' data-title="{$name}"',' data-date="{$date}"',' data-nid="{$nid}"',' data-fhash="{$fhash}"',' data-preview = "{$preview}"',' data-pic="{$pic}"',' data-link="{$isLink}"',' data-url="{$linkUrl}"',' data-shorturl="{$shorturl}"',' data-scid="{$scid}"',' data-mtime="{$mtime}"',' data-file-suffix="{$suffix}"',' data-extract-status="{$is_use_password}"',' data-password="{$password}"',' data-path="{$path}">','<div class="column column-checkbox">',"<label></label>","</div>",'<div class="column column-name" title="{$title}">',"{$inHtml}","</div>","{$extractCode}","{$hit}",'<div class="column column-size">{$size}</div>','<div class="column column-time">{$time}</div>',"</li>"].join(""),t=['<span class="ico {$thumbCls} ico-{$fileType}"',' data-imgurl="{$thumb}">',"{$imgHtml}","{$linkHtml}","{$videoPlayHtml}","</span>",'<span class="text">{$shortName}</span>'].join(""),s=i.replace(/\{\$inHtml\}/,""+t+""),o=s.replace(/\{\$hit\}/,'<div class="column column-hit">{$total_hits}</div>').replace(/\{\$extractCode\}/,'<div class="{$pwdCls} column column-code"><div class="code">{$password1}</div><span class="copy-box"><a class="copy-pwd" href="javascript:;">\u590d\u5236</a></span></div>');s=s.replace(/\{\$hit\}/,"").replace(/\{\$extractCode\}/,"");var u=i.replace(/\{\$inHtml\}/,t).replace(/\{\$hit\}/,"").replace(/\{\$extractCode\}/,""),a=['<div class="column column-checkbox">','<label class="chkall"></label>',"</div>",'<div class="column column-name">','<span class="{$fileSort}" data-field="name" >',"\u6587\u4ef6\u540d",'<span class="{$nameCls}"></span>',"</span>","</div>","{$extractCode}","{$hit}",'<div class="column column-size">','<span class="{$fileSort}" data-field="fsize" >',"\u5927\u5c0f",'<span class="{$sizeCls}"></span>',"</span>","</div>",'<div class="column column-time">','<span class="{$fileSort}" data-field="{$timeField}" >',"{$dateName}",'<span class="{$timeCls}"></span>',"</span>","</div>"].join(""),f=a.replace(/\{\$hit\}/,'<div class="column column-hit">\u4e0b\u8f7d\u6b21\u6570</div>').replace(/\{\$extractCode\}/,'<div class="column column-code">\u8bbf\u95ee\u5bc6\u7801</div>'),l=a.replace(/\{\$hit\}/,""),c=['<li class="row item {$cur} clearfix"',' data-nid="{$nid}"',' data-size="{$size}"',' data-ori-size="{$oriSize}"',' data-file-suffix="{$suffix}"',' data-scid="{$scid}"',' data-title="{$name}"',' data-vid="{$vid}"',' data-pic="{$pic}"',' data-id = "{$id}">','<div class="column column-radio"><span class="{$selected}"></span></div>','<div class="column column-hisversionid">{$vid}</div>','<div class="column column-hissize">{$size}</div>','<div class="column column-histime">{$time}</div>',"</li>"].join(""),h=c.replace(/\{\$cur\}/,"cur").replace(/\{\$operation\}/,'<span class=""></span><span title="\u67e5\u770b" class="view"></span><span title="\u4e0b\u8f7d" class="dl"></span>'),p=c.replace(/\{\$cur\}/,"").replace(/\{\$operation\}/,'<span class="restore" title="\u8fd8\u539f"></span><span title="\u67e5\u770b" class="view"></span><span title="\u4e0b\u8f7d" class="dl"></span>'),d=['<li class="row eventItem clearfix"',' data-nid="{$nid}"',' data-title="{$name}"',' data-type="{$type}"',' data-id = "{$id}">','<div class="column column-histitle"><span>{$title}</span></div>',"</li>"].join(""),v=['<div class="page-nav" data-page="{$current},{$next}">',"<p>\u5f53\u9875\u5df2\u52a0\u8f7d{$data}\u6761</p>","<div>",'<a href="###" onclick="monitor.clickLog(\'prev-page\');return false;" data-start="{$previous}" class="{$prevCls}">&lt;\u4e0a\u4e00\u9875</a>','<a href="###" onclick="monitor.clickLog(\'next-page\');return false;" data-start="{$next}" class="{$nextCls}">\u4e0b\u4e00\u9875&gt;</a>',"</div>","</div>"].join("");return{html:m,hisFileHtml:g,curHisFileHtml:y}}()),baseTree.prototype.tree_loading_handler=function(jsonTxt,that){that.icon.removeClass("folder-icon-loading");var jsonData=Object.isString(jsonTxt)?eval("("+jsonTxt+")"):jsonTxt,id=jsonData.id,data=jsonData.data,nodeData=[];if(jsonData.errno){jsonData["errno"]==3008?yunpan.Msg.alert("\u60a8\u9009\u62e9\u7684\u6587\u4ef6\u5939\u5df2\u4e0d\u5b58\u5728",{type:"warning",with_close:!1,fn:function(){location.reload()}}):yunpan.Msg.alert("\u60a8\u53ef\u80fd\u5df2\u5728\u5176\u5b83\u9875\u9762\u9000\u51fa\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55!",{type:"warning",with_close:!1,fn:function(){location.reload()}});return}for(var i=0,len=data.length;i<len;i++){var path=data[i].file_path,nid=data[i].nid,name=data[i].file_name.encode4Html(),selItems=yunpan.fo?yunpan.fo.getSelectFile():[],selPaths=[];if(path.toLowerCase()=="/.360syslib/")continue;selItems.forEach(function(e){e.attr("data-type")=="folder"&&selPaths.push(e.attr("data-path"))}),selPaths.indexOf(path)==-1&&(nodeData.push(["folder",id+"-"+i,name,path,nid]),that.fileList[id+"-"+i]={name:name,path:path,nid:nid})}that.me.setItemsData(id,nodeData,!0)},baseTree.prototype.tree_current_folder=function(e,t){this.folderNow=W(e);var n=this.folderPre?this.folderPre.getAttr("id")==this.folderNow.getAttr("id"):!1,r=this.folderNow.getAttr("id").split("_")[1],i=W(">div",this.folderNow);n||W(">div",this.folderPre).removeClass("over"),this.folderNow.hasClass("folder-closed")?(i.addClass("over"),W(">span:nth-of-type(1)",i).addClass("folder-icon-open"),t.openFolder(r)):n?(t.closeFolder(r),W(">span:nth-of-type(1)",i).removeClass("folder-icon-open")):i.addClass("over"),this.folderPre=this.folderNow},baseTree.prototype.init=function(e){var t=this;t.fileList={0:{name:"root",path:"/",nid:0}},t.tree=new Tree({treeCtn:QW.NodeH.g("yunpanTree"),rootItemData:["folderRoot","0",'<span class="folder-root">&nbsp;</span><strong>\u5168\u90e8\u6587\u4ef6</strong>'],getItemHtml:t.getItemHtml,treeId:"file",getNoDataHtml:function(e,t){return W("#treefile_"+e+" ul").addClass("no-data").setStyle({height:"0",overflow:"hidden"}),""},loadItemsData:function(n){t.me=this,t.icon=W("#tree_"+n+">div span:nth-of-type(1)"),W("#treefile_"+n+" ul").removeClass("no-data").setStyle({height:"auto"}),t.icon.addClass("folder-icon-loading");var r={path:t.fileList[n].path,id:n,nid:t.fileList[n].nid,t:+(new Date)};e?(r.token=SYS_CONF.token,r.ajax=1,loadJs(e+"/file/listAjax?"+Object.encodeURIJson(r)+"&cross_domain_callback=jsonpcallbackFunc")):Ajax.post("/file/listAjax",r,jsonpcallbackFunc)}}),W("#treefile_0").addClass("tree-root"),W("#treefile_0>div:nth-of-type(1)").addClass("root-node"),W("#treefile_0>div>span:nth-of-type(1)").addClass("folder-icon-root"),W("#yunpanTree").delegate("li>div","click",function(){t.tree_current_folder(this.parentNode,t.tree)})},baseTree.prototype.show=function(e,t){this.tree?this.isFolderChanged&&(this.folderNow&&this.folderNow[0].id!="treefile_0"&&(this.folderNow=null),this.tree.loadItemsData(0),this.isFolderChanged=!1):this.init(e);if(t!="link"&&this.folderPre){var n=yunpan.fo.getSelectFile(),r=W(n).attr("data-path")+"",i=this.folderPre[0].id.replace("treefile_","");tree_path=this.fileList[i].path+"";if(tree_path.indexOf(r)!==-1||r.indexOf(tree_path)!==-1)this.tree.loadItemsData(0),this.isFolderChanged=!0}},baseTree.prototype.getFolder=function(){var e="";if(this.folderNow){var t=this.folderNow.attr("id").split("_")[1];this.fileList[t]&&(e=this.fileList[t].path)}return e},baseTree.prototype.getNid=function(){var e="";if(this.folderNow){var t=this.folderNow.attr("id").split("_")[1];this.fileList[t]&&(e=this.fileList[t].nid)}return e},baseTree.prototype.setFolder=function(e){var t=e.attr("id").split("_")[1];path=this.fileList[t].path,this.tree_current_folder(e)},baseTree.prototype.getFolderID=function(){var e=null;return this.folderNow&&(e=this.folderNow.attr("id").split("_")[1]),e},fileTree.prototype=new baseTree,yunpan.ytree=new fileTree,sfileTofileTree.prototype=new baseTree,sfileTofileTree.prototype.init=function(e){var t=this,n=function(e){t.tree_loading_handler(e,t)};t.fileList={0:{name:"root",path:"/",nid:0}},t.tree=new Tree({treeCtn:QW.NodeH.g("yunpanTreeSfiletofile"),rootItemData:["folderRoot","0",'<span class="folder-root">&nbsp;</span><strong>\u5168\u90e8\u6587\u4ef6</strong>'],getItemHtml:t.getItemHtml,treeId:"sfiletofile",getNoDataHtml:function(e,t){return W("#treesfiletofile_"+e+" ul").addClass("no-data").setStyle({height:"0",overflow:"hidden"}),""},loadItemsData:function(e){t.me=this,t.icon=W("#treesfiletofile_"+e+">div span:nth-of-type(1)"),W("#treesfiletofile_"+e+" ul").removeClass("no-data").setStyle({height:"auto"}),t.icon.addClass("folder-icon-loading");var r={path:t.fileList[e].path,id:e,nid:t.fileList[e].nid,t:+(new Date)};Ajax.post("/file/listAjax",r,n)}}),W("#treesfiletofile_0").addClass("tree-root"),W("#treesfiletofile_0>div:nth-of-type(1)").addClass("root-node"),W("#treesfiletofile_0>div>span:nth-of-type(1)").addClass("folder-icon-root"),W("#yunpanTreeSfiletofile").delegate("li>div","click",function(){t.tree_current_folder(this.parentNode,t.tree)})},sfileTofileTree.prototype.show=function(e){this.tree?this.isFolderChanged&&(this.folderNow&&this.folderNow[0].id!="treesfiletofile_0"&&(this.folderNow=null),this.tree.loadItemsData(0),this.isFolderChanged=!1):this.init(e)},yunpan.ytreeSfileTofile=new sfileTofileTree,sfileTree.prototype=new baseTree,sfileTree.prototype.init=function(e){var t=this,n=function(e){t.tree_loading_handler(e,t)};t.fileList={0:{name:"root",path:"/",nid:0}},t.tree=new Tree({treeCtn:QW.NodeH.g("yunpanTreeSfile"),rootItemData:["folderRoot","0",'<span class="folder-root">&nbsp;</span><strong>\u6587\u4ef6\u4fdd\u9669\u7bb1</strong>'],getItemHtml:t.getItemHtml,treeId:"sfile",getNoDataHtml:function(e,t){return W("#treesfile_"+e+" ul").addClass("no-data").setStyle({height:"0",overflow:"hidden"}),""},loadItemsData:function(e){t.me=this,t.icon=W("#treesfile_"+e+">div span:nth-of-type(1)"),W("#treesfile_"+e+" ul").removeClass("no-data").setStyle({height:"auto"}),t.icon.addClass("folder-icon-loading");var r={path:t.fileList[e].path,id:e,nid:t.fileList[e].nid,t:+(new Date)};Ajax.post("/sFile/listAjax",r,n)}}),W("#treesfile_0").addClass("tree-root"),W("#treesfile_0>div:nth-of-type(1)").addClass("root-node"),W("#treesfile_0>div>span:nth-of-type(1)").addClass("folder-icon-root"),W("#yunpanTreeSfile").delegate("li>div","click",function(){t.tree_current_folder(this.parentNode,t.tree)})},sfileTree.prototype.show=function(e){this.tree?this.isFolderChanged&&(this.folderNow&&this.folderNow[0].id!="treesfile_0"&&(this.folderNow=null),this.tree.loadItemsData(0),this.isFolderChanged=!1):this.init(e);if(this.folderPre){var t=yunpan.fo.getSelectFile(),n=W(t).attr("data-path")+"",r=this.folderPre[0].id.replace("treesfile_","");tree_path=this.fileList[r].path+"";if(tree_path.indexOf(n)!==-1||n.indexOf(tree_path)!==-1)this.tree.loadItemsData(0),this.isFolderChanged=!0}},yunpan.ytreeSfile=new sfileTree;var SWFUpload;SWFUpload==undefined&&(SWFUpload=function(e){this.initSWFUpload(e)}),SWFUpload.prototype.initSWFUpload=function(e){try{this.customSettings={},this.settings=e,this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(),this.loadFlash(),this.displayDebugInfo()}catch(t){throw delete SWFUpload.instances[this.movieName],t}},SWFUpload.instances={},SWFUpload.movieCount=0,SWFUpload.version="2.2.0 2009-03-25",SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130},SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290},SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5},SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120},SWFUpload.CURSOR={ARROW:-1,HAND:-2},SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"},SWFUpload.completeURL=function(e){if(typeof e!="string"||e.match(/^https?:\/\//i)||e.match(/^\//))return e;var t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),n=window.location.pathname.lastIndexOf("/");return n<=0?path="/":path=window.location.pathname.substr(0,n)+"/",path+e},SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(e,t){this.settings[e]=this.settings[e]==undefined?t:this.settings[e]},this.ensureDefault("upload_url",""),this.ensureDefault("preserve_relative_urls",!1),this.ensureDefault("file_post_name","Filedata"),this.ensureDefault("post_params",{}),this.ensureDefault("use_query_string",!1),this.ensureDefault("requeue_on_error",!1),this.ensureDefault("http_success",[]),this.ensureDefault("assume_success_timeout",0),this.ensureDefault("file_types","*.*"),this.ensureDefault("file_types_description","All Files"),this.ensureDefault("file_size_limit",0),this.ensureDefault("file_upload_limit",0),this.ensureDefault("file_queue_limit",0),this.ensureDefault("flash_url","swfupload.swf"),this.ensureDefault("prevent_swf_caching",!0),this.ensureDefault("button_image_url",""),this.ensureDefault("button_width",1),this.ensureDefault("button_height",1),this.ensureDefault("button_text",""),this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;"),this.ensureDefault("button_text_top_padding",0),this.ensureDefault("button_text_left_padding",0),this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES),this.ensureDefault("button_disabled",!1),this.ensureDefault("button_placeholder_id",""),this.ensureDefault("button_placeholder",null),this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW),this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW),this.ensureDefault("debug",!1),this.settings.debug_enabled=this.settings.debug,this.settings.return_upload_start_handler=this.returnUploadStart,this.ensureDefault("swfupload_loaded_handler",null),this.ensureDefault("file_dialog_start_handler",null),this.ensureDefault("file_queued_handler",null),this.ensureDefault("file_queue_error_handler",null),this.ensureDefault("file_dialog_complete_handler",null),this.ensureDefault("upload_start_handler",null),this.ensureDefault("upload_progress_handler",null),this.ensureDefault("upload_error_handler",null),this.ensureDefault("upload_success_handler",null),this.ensureDefault("upload_complete_handler",null),this.ensureDefault("debug_handler",this.debugMessage),this.ensureDefault("custom_settings",{}),this.customSettings=this.settings.custom_settings,!this.settings.prevent_swf_caching||(this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime()),this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)),delete this.ensureDefault},SWFUpload.prototype.loadFlash=function(){var e,t;if(document.getElementById(this.movieName)!==null)throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";e=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(e==undefined)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;t=document.createElement("div"),t.innerHTML=this.getFlashHTML(),e.parentNode.replaceChild(t.firstChild,e),window[this.movieName]==undefined&&(window[this.movieName]=this.getMovieElement())},SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")},SWFUpload.prototype.getFlashVars=function(){var e=this.buildParamString(),t=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(t),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(e),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")},SWFUpload.prototype.getMovieElement=function(){this.movieElement==undefined&&(this.movieElement=document.getElementById(this.movieName));if(this.movieElement===null)throw"Could not find Flash element";return this.movieElement},SWFUpload.prototype.buildParamString=function(){var e=this.settings.post_params,t=[];if(typeof e=="object")for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n.toString())+"="+encodeURIComponent(e[n].toString()));return t.join("&amp;")},SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1);var e=null;e=this.getMovieElement();if(e&&typeof e.CallFunction=="unknown"){for(var t in e)try{typeof e[t]=="function"&&(e[t]=null)}catch(n){}try{e.parentNode.removeChild(e)}catch(r){}}return window[this.movieName]=null,SWFUpload.instances[this.movieName]=null,delete SWFUpload.instances[this.movieName],this.movieElement=null,this.settings=null,this.customSettings=null,this.eventQueue=null,this.movieName=null,!0}catch(i){return!1}},SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","	","upload_url:               ",this.settings.upload_url,"\n","	","flash_url:                ",this.settings.flash_url,"\n","	","use_query_string:         ",this.settings.use_query_string.toString(),"\n","	","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","	","http_success:             ",this.settings.http_success.join(", "),"\n","	","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","	","file_post_name:           ",this.settings.file_post_name,"\n","	","post_params:              ",this.settings.post_params.toString(),"\n","	","file_types:               ",this.settings.file_types,"\n","	","file_types_description:   ",this.settings.file_types_description,"\n","	","file_size_limit:          ",this.settings.file_size_limit,"\n","	","file_upload_limit:        ",this.settings.file_upload_limit,"\n","	","file_queue_limit:         ",this.settings.file_queue_limit,"\n","	","debug:                    ",this.settings.debug.toString(),"\n","	","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","	","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","	","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","	","button_image_url:         ",this.settings.button_image_url.toString(),"\n","	","button_width:             ",this.settings.button_width.toString(),"\n","	","button_height:            ",this.settings.button_height.toString(),"\n","	","button_text:              ",this.settings.button_text.toString(),"\n","	","button_text_style:        ",this.settings.button_text_style.toString(),"\n","	","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","	","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","	","button_action:            ",this.settings.button_action.toString(),"\n","	","button_disabled:          ",this.settings.button_disabled.toString(),"\n","	","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","	","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler=="function").toString(),"\n","	","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler=="function").toString(),"\n","	","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler=="function").toString(),"\n","	","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler=="function").toString(),"\n","	","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler=="function").toString(),"\n","	","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler=="function").toString(),"\n","	","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler=="function").toString(),"\n","	","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler=="function").toString(),"\n","	","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler=="function").toString(),"\n","	","debug_handler assigned:             ",(typeof this.settings.debug_handler=="function").toString(),"\n"].join(""))},SWFUpload.prototype.addSetting=function(e,t,n){return t==undefined?this.settings[e]=n:this.settings[e]=t},SWFUpload.prototype.getSetting=function(e){return this.settings[e]!=undefined?this.settings[e]:""},SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement(),returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>"),returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}return returnValue!=undefined&&typeof returnValue.post=="object"&&(returnValue=this.unescapeFilePostParams(returnValue)),returnValue},SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")},SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")},SWFUpload.prototype.startUpload=function(e){this.callFlash("StartUpload",[e])},SWFUpload.prototype.cancelUpload=function(e,t){t!==!1&&(t=!0),this.callFlash("CancelUpload",[e,t])},SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")},SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")},SWFUpload.prototype.setStats=function(e){this.callFlash("SetStats",[e])},SWFUpload.prototype.getFile=function(e){return typeof e=="number"?this.callFlash("GetFileByIndex",[e]):this.callFlash("GetFile",[e])},SWFUpload.prototype.addFileParam=function(e,t,n){return this.callFlash("AddFileParam",[e,t,n])},SWFUpload.prototype.removeFileParam=function(e,t){this.callFlash("RemoveFileParam",[e,t])},SWFUpload.prototype.setUploadURL=function(e){this.settings.upload_url=e.toString(),this.callFlash("SetUploadURL",[e])},SWFUpload.prototype.setPostParams=function(e){this.settings.post_params=e,this.callFlash("SetPostParams",[e])},SWFUpload.prototype.addPostParam=function(e,t){this.settings.post_params[e]=t,this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.removePostParam=function(e){delete this.settings.post_params[e],this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.setFileTypes=function(e,t){this.settings.file_types=e,this.settings.file_types_description=t,this.callFlash("SetFileTypes",[e,t])},SWFUpload.prototype.setFileSizeLimit=function(e){this.settings.file_size_limit=e,this.callFlash("SetFileSizeLimit",[e])},SWFUpload.prototype.setFileUploadLimit=function(e){this.settings.file_upload_limit=e,this.callFlash("SetFileUploadLimit",[e])},SWFUpload.prototype.setFileQueueLimit=function(e){this.settings.file_queue_limit=e,this.callFlash("SetFileQueueLimit",[e])},SWFUpload.prototype.setFilePostName=function(e){this.settings.file_post_name=e,this.callFlash("SetFilePostName",[e])},SWFUpload.prototype.setUseQueryString=function(e){this.settings.use_query_string=e,this.callFlash("SetUseQueryString",[e])},SWFUpload.prototype.setRequeueOnError=function(e){this.settings.requeue_on_error=e,this.callFlash("SetRequeueOnError",[e])},SWFUpload.prototype.setHTTPSuccess=function(e){typeof e=="string"&&(e=e.replace(" ","").split(",")),this.settings.http_success=e,this.callFlash("SetHTTPSuccess",[e])},SWFUpload.prototype.setAssumeSuccessTimeout=function(e){this.settings.assume_success_timeout=e,this.callFlash("SetAssumeSuccessTimeout",[e])},SWFUpload.prototype.setDebugEnabled=function(e){this.settings.debug_enabled=e,this.callFlash("SetDebugEnabled",[e])},SWFUpload.prototype.setButtonImageURL=function(e){e==undefined&&(e=""),this.settings.button_image_url=e,this.callFlash("SetButtonImageURL",[e])},SWFUpload.prototype.setButtonDimensions=function(e,t){this.settings.button_width=e,this.settings.button_height=t;var n=this.getMovieElement();n!=undefined&&(n.style.width=e+"px",n.style.height=t+"px"),this.callFlash("SetButtonDimensions",[e,t])},SWFUpload.prototype.setButtonText=function(e){this.settings.button_text=e,this.callFlash("SetButtonText",[e])},SWFUpload.prototype.setButtonTextPadding=function(e,t){this.settings.button_text_top_padding=t,this.settings.button_text_left_padding=e,this.callFlash("SetButtonTextPadding",[e,t])},SWFUpload.prototype.setButtonTextStyle=function(e){this.settings.button_text_style=e,this.callFlash("SetButtonTextStyle",[e])},SWFUpload.prototype.setButtonDisabled=function(e){this.settings.button_disabled=e,this.callFlash("SetButtonDisabled",[e])},SWFUpload.prototype.setButtonAction=function(e){this.settings.button_action=e,this.callFlash("SetButtonAction",[e])},SWFUpload.prototype.setButtonCursor=function(e){this.settings.button_cursor=e,this.callFlash("SetButtonCursor",[e])},SWFUpload.prototype.queueEvent=function(e,t){t==undefined?t=[]:t instanceof Array||(t=[t]);var n=this;if(typeof this.settings[e]=="function")this.eventQueue.push(function(){this.settings[e].apply(this,t)}),setTimeout(function(){n.executeNextEvent()},0);else if(this.settings[e]!==null)throw"Event handler "+e+" is unknown or is not a function"},SWFUpload.prototype.executeNextEvent=function(){var e=this.eventQueue?this.eventQueue.shift():null;typeof e=="function"&&e.apply(this)},SWFUpload.prototype.unescapeFilePostParams=function(e){var t=/[$]([0-9a-f]{4})/i,n={},r;if(e!=undefined){for(var i in e.post)if(e.post.hasOwnProperty(i)){r=i;var s;while((s=t.exec(r))!==null)r=r.replace(s[0],String.fromCharCode(parseInt("0x"+s[1],16)));n[r]=e.post[i]}e.post=n}return e},SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(e){return!1}},SWFUpload.prototype.flashReady=function(){var e=this.getMovieElement();if(!e){this.debug("Flash called back ready but the flash movie can't be found.");return}this.cleanUp(e),this.queueEvent("swfupload_loaded_handler")},SWFUpload.prototype.cleanUp=function(e){try{if(this.movieElement&&typeof e.CallFunction=="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var t in e)try{typeof e[t]=="function"&&(e[t]=null)}catch(n){}}}catch(r){}window.__flash__removeCallback=function(e,t){try{e&&(e[t]=null)}catch(n){}}},SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")},SWFUpload.prototype.fileQueued=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("file_queued_handler",e)},SWFUpload.prototype.fileQueueError=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("file_queue_error_handler",[e,t,n])},SWFUpload.prototype.fileDialogComplete=function(e,t,n){this.queueEvent("file_dialog_complete_handler",[e,t,n])},SWFUpload.prototype.uploadStart=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("return_upload_start_handler",e)},SWFUpload.prototype.returnUploadStart=function(e){var t;if(typeof this.settings.upload_start_handler=="function")e=this.unescapeFilePostParams(e),t=this.settings.upload_start_handler.call(this,e);else if(this.settings.upload_start_handler!=undefined)throw"upload_start_handler must be a function";t===undefined&&(t=!0),t=!!t,this.callFlash("ReturnUploadStart",[t])},SWFUpload.prototype.uploadProgress=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_progress_handler",[e,t,n])},SWFUpload.prototype.uploadError=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_error_handler",[e,t,n])},SWFUpload.prototype.uploadSuccess=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_success_handler",[e,t,n])},SWFUpload.prototype.uploadComplete=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("upload_complete_handler",e)},SWFUpload.prototype.debug=function(e){this.queueEvent("debug_handler",e)},SWFUpload.prototype.debugMessage=function(e){if(this.settings.debug){var t,n=[];if(typeof e=="object"&&typeof e.name=="string"&&typeof e.message=="string"){for(var r in e)e.hasOwnProperty(r)&&n.push(r+": "+e[r]);t=n.join("\n")||"",n=t.split("\n"),t="EXCEPTION: "+n.join("\nEXCEPTION: "),SWFUpload.Console.writeLine(t)}else SWFUpload.Console.writeLine(e)}},SWFUpload.Console={},SWFUpload.Console.writeLine=function(e){var t,n;try{t=document.getElementById("SWFUpload_Console"),t||(n=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(n),t=document.createElement("textarea"),t.id="SWFUpload_Console",t.style.fontFamily="monospace",t.setAttribute("wrap","off"),t.wrap="off",t.style.overflow="auto",t.style.width="700px",t.style.height="350px",t.style.margin="5px",n.appendChild(t)),t.value+=e+"\n",t.scrollTop=t.scrollHeight-t.clientHeight}catch(r){alert("Exception: "+r.name+" Message: "+r.message)}},namespace("yunpan.upload"),yunpan.upload.config={DIRECTORY_LAYER_NUMBER_LIMIT:10,FILE_QUEUE_LIMIT:3e3,MAX_FILE_SIZE:377487360,MIN_PLUGIN_VERSION:1003,LAST_PLUGIN_VERSION:1005,CLASSID_FOR_IE:"11E1EFE1-B856-53CD-BD1F-1E2F8424203B",PLUGIN_PREFIX:"YPPlugin-"},Object.mix(yunpan.upload,{UPLOAD_TYPE_FLASH:"up_type_flash",UPLOAD_TYPE_AJAX:"up_type_ajax",UPLOAD_TYPE_PLUGIN:"up_type_plugin",UPLOAD_TYPE_NONE:"up_type_none",STATUS_QUEUED:"file_status_queued",
STATUS_ERROR:"file_status_error",STATUS_CANCELLED:"file_status_cancelled",STATUS_COMPLETE:"file_status_complete",STATUS_PROGRESS:"file_status_progress",getFileName:function(e){e=e.replace(/\\/g,"/");var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},getRootName:function(e){var t=e.indexOf("/");return t<0?e:e.substring(0,t)},idGen:function(){var e=0;return function(){return"YPUpload-"+ ++e}}(),detectCapability:function(){var e;return function(){if(!e)try{e={supportPlugin:!1,supportPluginFolder:!1,supportAjax:!1,supportFlash:!1,supportDD:!1,supportAjaxFolder:!1};if(/^win/i.test(Browser.platform))try{var t,n,r=W('<div style="width:0;height:0;overflow:hidden;"></div>').insertTo("beforeend",document.body),i=yunpan.upload.idGen();Browser.ie&&Browser.ie>=6?t=W('<OBJECT ID="'+i+'" CLASSID="clsid:'+yunpan.upload.config.CLASSID_FOR_IE+'" HEIGHT="0" WIDTH="0"></OBJECT>'):(t=W("<object></object>"),t.attr({type:"application/x-uploadplugin",id:i})),t.insertTo("beforeend",r);var s=window[i];n=s.GetVersion().trim();var o=parseInt(n.substring(n.lastIndexOf(".")+1));o&&o>=yunpan.upload.config.MIN_PLUGIN_VERSION&&(e.supportPlugin=!0,o>=yunpan.upload.config.LAST_PLUGIN_VERSION&&(e.supportPluginFolder=!0)),r.removeNode()}catch(u){r.removeNode()}if(Browser.webkit&&parseFloat(Browser.webkit)>=534.13&&!/se 2.x metasr/i.test(navigator.userAgent)||Browser.firefox&&parseFloat(Browser.firefox)>=5)e.supportAjax=!0,e.supportDD=!0;W("<input webkitdirectory>").attr("webkitdirectory")&&(e.supportAjaxFolder=!0);var a=yunpan.util.getSwfVersion();a&&parseFloat(a)>=9&&(e.supportFlash=!0)}catch(u){throw new Error("YP:upload, detectCapability. "+u.message)}return e}}()}),yunpan.upload.File=function(e,t){this.id=e.id,this.name=e.name,typeof e.fid!="undefined"&&(this.fid=e.fid),this.status=e.status||yunpan.upload.STATUS_QUEUED,this.uploadType=e.uploadType,this.path=e.path||"",this.relativePath=e.relativePath||"",this.uploader=t,this.isFolder=e.isFolder||!1,e.file&&(this.file=e.file)},yunpan.upload.File.prototype={cancel:function(){try{var e=this.uploadType;e==yunpan.upload.UPLOAD_TYPE_PLUGIN?this.uploader.plugin.CancelUpload(this.fid):e==yunpan.upload.UPLOAD_TYPE_FLASH&&this.uploader.swf.cancelUpload(this.id),this.status=yunpan.upload.STATUS_CANCELLED}catch(t){throw new Error("YP:upload, file cancel. "+t.message)}}},yunpan.upload.Uploader=function(e){function t(){}var e=Object.mix({useDDUpload:!0,dropContainer:document.body,retryTime:60,limitSize:377487360,pluginLimitSize:0,suspendAfterSelect:!1},e,!0),n={},r=["afterinit","beforeselect","queuederror","afterselect","filequeue","folderqueue","progress","uploadsuccess","uploaderror","networkabnormal","hashprogress","dragstart","dragend","dragenter","dragover","drop","dragleave","ddmouseup"];for(var i=0,s=r.length;i<s;i++)n[r[i]]=t;this.listeners=Object.mix(n,e.listeners,!0),this.filesInWait=[],this.uploadType="",this.getConfig=function(t){return e[t]},this.plWaitList=[],this.plIsWaiting=!1;try{this.init()}catch(o){throw new Error("YP:upload, init the uploader. "+o.message)}},yunpan.upload.Uploader.prototype={reset:function(){this.info={totalNum:0,sucNum:0,failNum:0,queue:[],elapsedTime:0,folderMap:{},fileMap:{}}},resume:function(){try{this.isAddingFile=!1;if(!this.filesInWait)return;var e=this.filesInWait,t=e.list,n=yunpan.upload.STATUS_CANCELLED,r=yunpan.upload.STATUS_QUEUED;if(e.status&&e.status==yunpan.upload.STATUS_CANCELLED)for(var i=0,s=t.length;i<s;i++)t[i].cancel();else{if(!e.isFolder)for(var i=0,s=t.length;i<s;i++){var o=t[i];o.status==n&&o.cancel()}var u=this.info.totalNum,a=this.info.queue,f=this.info.fileMap;if(e.isFolder){var l={name:e.folderName,id:yunpan.upload.idGen(),totalNum:t.length,sucNum:0,failNum:0,startTime:0,saveTime:0,curFunc:e.curFunc,totalSize:e.totalSize,uploadedSize:0,path:e.path};u+=1;var c=this.info.folderMap;c[l.id]=l,this.listeners.folderqueue(l,e.queuedErrorList);for(var i=0,s=t.length;i<s;i++){var o=t[i];if(o.status!=r)continue;a.push(o),f[o.id]=o,c[o.id]=l,this.listeners.filequeue(!0,o)}l.totalNum<=0&&this.listeners.uploadsuccess(l)}else for(var i=0,s=t.length;i<s;i++){var o=t[i];o.status==r&&(a.push(o),f[o.id]=o,u++,this.listeners.filequeue(!1,o))}this.info.totalNum=u,e.uploadType==yunpan.upload.UPLOAD_TYPE_FLASH}}catch(h){throw new Error("YP:upload, upload resume. "+h.message)}this.filesInWait=null,this.startUpload()},startUpload:function(){try{if(this.info.queue.length<=0){this.uploadCompleteAll();return}if(this.isUploading)return;var e=this.info.queue[0];if(e.status==yunpan.upload.STATUS_CANCELLED){this.info.queue.shift(),this.startUpload();return}this.isUploading=!0,e.startTime=new Date,e.status=yunpan.upload.STATUS_PROGRESS;var t=this.info.folderMap[e.id];t&&!t.startTime&&(t.startTime=new Date),e.uploadType==yunpan.upload.UPLOAD_TYPE_PLUGIN?this.plDoUpload():e.uploadType==yunpan.upload.UPLOAD_TYPE_AJAX?this.jxStartUpload():e.uploadType==yunpan.upload.UPLOAD_TYPE_FLASH&&this.swf.startUpload(),this.listeners.startupload(e.id)}catch(n){throw new Error("YP:upload, upload start. "+n.message)}},cancel:function(e){try{var t=this,n=this.info.fileMap,r=this.info.queue[0],i=this.isUploading,s=yunpan.upload.UPLOAD_TYPE_AJAX;if(this.info.folderMap[e]){var o=this.info.folderMap,u=o[e];if(n[e]){var a=n[e];a.isRoot&&(e=u.id)}if(u.id==e){for(var f in n)o[f]&&o[f].id==e&&(n[f].cancel(),i&&r&&r.id==f&&(n[f].uploadType==s&&this.xhr.abort(),this.isUploading=!1));this.info.totalNum--}else n[e].cancel(),i&&r&&r.id==e&&(r.uploadType==s&&this.xhr.abort(),this.isUploading=!1)}else n[e].cancel(),i&&r&&r.id==e&&(n[e].uploadType==s&&this.xhr.abort(),this.isUploading=!1),this.info.totalNum--}catch(l){throw new Error("YP:upload, upload start. "+l.message)}},uploadProgress:function(e,t,n,r,i){try{if(this.info.totalNum<=this.info.sucNum+this.info.failNum)return;var s;if(this.info.folderMap[e]){var o=this.info.folderMap[e];if(o.totalSize<=0)return;var u=(t+o.uploadedSize)/o.totalSize;u>1&&(u=1),u=parseInt(u*100);var a=new Date-o.startTime;if(a<=0)return;var i=(t+o.uploadedSize)*1e3/a;if(i<=0)return;var s=(o.totalSize-t-o.uploadedSize)/i;s<0&&(s=1),s<1&&u<100&&(s=1),e=o.id,t=o.uploadedSize+t}else{var f=this.info.fileMap[e];if(r!=undefined)u=r;else{u=parseInt(t/n*100);if(n<1||t>=n)u=100}i!=undefined?(i*=1024,i==0&&(i=1)):i=t*1e3/(new Date-f.startTime);if(i<=0)return;s=(n-t)/i}this.listeners.progress(e,u,t,i,s,a)}catch(l){throw new Error("YP:upload, upload progress. "+l.message)}},uploadSuccess:function(e,t,n,r,i){try{this.isUploading=!1,this.info.fileMap[e]&&(this.info.fileMap[e].status=yunpan.upload.STATUS_COMPLETE);if(this.info.folderMap[e]){var s=this.info.folderMap[e];s.uploadedSize+=i,s.sucNum++,s.saveTime+=r,this.info.queue.shift(),this.uploadProgress(e,0),this.listeners.uploadsuccess(this.info.fileMap[e],!0),s.sucNum+s.failNum>=s.totalNum&&(this.info.sucNum++,this.listeners.uploadsuccess(s))}else{var o=this.info.queue.shift();this.info.sucNum++,this.listeners.uploadsuccess(o,!1)}}catch(u){throw new Error("YP:upload, upload success. "+u.message)}},uploadErrmsg:function(e){switch(e){case 2004:case 2006:msg="\u7528\u6237\u8ba4\u8bc1\u5931\u6548\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\uff01";break;case 2007:msg="\u60a8\u7684\u4e91\u76d8\u7a7a\u95f4\u4e0d\u8db3\uff0c\u4e0a\u4f20\u5931\u8d25\uff01";break;case 3009:case 3004:case 3011:msg="\u8fd9\u4e2a\u6587\u4ef6\u5939\u4e0d\u5b58\u5728\uff0c\u88ab\u5220\u4e86\uff1f";break;case 3021:msg="\u5bf9\u4e0d\u8d77\uff0c\u60a8\u7684\u6587\u4ef6\u5939\u8def\u5f84\u8fc7\u957f\uff01";break;case 3109:msg="\u4e0a\u4f20\u6587\u4ef6\u6570\u8d85\u8fc7\u6700\u5927\u9650\u5236!";break;default:msg="\u5bf9\u4e0d\u8d77\uff0c\u4e0a\u4f20\u5931\u8d25\uff01"}return msg},autoCommit:function(txt){try{var ret=txt.evalExp(),that=this,file=this.info.queue[0],errno=parseInt(ret.errno,10);if(errno===0)ret.data.autoCommit?that.uploadSuccess(file.id,file.name,!1,0,file.file.size):Ajax.post(file.curFunc=="file"?"/upload/addfile/":"/sUpload/addfile/",{tk:ret.data.tk},function(response){try{response=eval("("+response+")");var error_no=parseInt(response.errno,10);if(error_no===0)that.uploadSuccess(file.id,file.name,!1,0,file.file.size);else{var msg=that.uploadErrmsg(error_no);that.uploadError(file,msg)}}catch(e){throw new Error("YP:upload, autoCommit error 2. "+e.message)}});else{var msg=that.uploadErrmsg(errno);that.uploadError(file,msg)}}catch(e){throw that.uploadError(file,"\u5bf9\u4e0d\u8d77\uff0c\u4e0a\u4f20\u5931\u8d25\uff01"),new Error("YP:upload, autoCommit error 1. "+e.message)}},uploadError:function(e,t){try{this.isUploading=!1,e.status=yunpan.upload.STATUS_ERROR;if(this.info.folderMap[e.id]){var n=this.info.folderMap[e.id];if(e.uploadType==yunpan.upload.UPLOAD_TYPE_AJAX||e.uploadType==yunpan.upload.UPLOAD_TYPE_AJAX)n.uploadedSize+=e.file.size;n.failNum++,this.listeners.uploaderror(e,!0,t,n),n.sucNum+n.failNum>=n.totalNum?this.listeners.uploadsuccess(n):e.isRoot&&e.uploadType==yunpan.upload.UPLOAD_TYPE_PLUGIN&&this.listeners.uploadsuccess(n)}else this.listeners.uploaderror(e,!1,t);this.cancel(e.id)}catch(r){throw new Error("YP:upload, upload error ocur. "+r.message)}},uploadCompleteAll:function(){this.listeners.uploadall()},initEvent:function(){try{var e=yunpan.upload.detectCapability();e.supportPlugin&&this.initPlugin(),e.supportAjax&&this.initAjax(),e.supportFlash&&this.initFlash()}catch(t){throw new Error("YP:upload, upload initevent. "+t.message)}},init:function(){this.reset(),this.initEvent();var e=this;setTimeout(function(){e.listeners.afterinit&&e.listeners.afterinit()},1)}},Object.mix(yunpan.upload.Uploader.prototype,{swfDialogStart:function(){try{this.filesInWait={isFolder:!1,list:[],path:this.getConfig("getUploadPath")(),uploadType:yunpan.upload.UPLOAD_TYPE_FLASH},this.listeners.beforeselect()}catch(e){throw new Error("YP:upload, flash swfDialogStart. "+e.message)}},swfQueued:function(e){e=this.swf.getFile(e.id);try{this.filesInWait.list.push(new yunpan.upload.File({id:e.id,name:e.name,file:e,size:e.size,path:this.getConfig("getUploadPath")(),uploadType:yunpan.upload.UPLOAD_TYPE_FLASH},this))}catch(t){throw new Error("YP:upload, flash swfQueued. "+t.message)}},swfQueueError:function(e,t,n){try{var r="";switch(t){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:r="\u4e0a\u4f20\u6587\u4ef6\u6570\u91cf\u8d85\u8fc7\u603b\u9650\u5b9a\u4e2a\u6570\uff01\n"+(n===0?"":"\u8fd8\u53ef\u4ee5\u9009\u62e9 "+(n>1?n+" \u4e2a\u6587\u4ef6.":"1\u4e2a\u6587\u4ef6."));break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:monitor.yplog(901,{qid:SYS_CONF.qid}),r='\u4e0a\u4f20360MB\u4ee5\u4e0a\u6587\u4ef6\uff0c\u5efa\u8bae\u4f7f\u7528<a target="_blank" href="http://down.360safe.com/yunpan/360wangpan_setup.exe">\u5ba2\u6237\u7aef</a>\uff0c\u9ad8\u901f\u3001\u7a33\u5b9a\u3002';break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:r="\u4e0d\u652f\u6301\u4e0a\u4f20\u7a7a\u6587\u4ef6\uff01";break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:r="\u60a8\u9009\u62e9\u7684\u6587\u4ef6\u7c7b\u578b\u6709\u8bef\uff01";break;default:e!==null&&(r="\u53d1\u751f\u672a\u77e5\u9519\u8bef\uff01")}e&&r&&this.listeners.queuederror(r,e.name)}catch(i){throw new Error("YP:upload, flash swfQueueError. "+i.message)}},swfDialogComplete:function(){try{this.listeners.afterselect(!1)}catch(e){throw new Error("YP:upload, flash swfDialogComplete. "+e.message)}},swfUploadStart:function(e){try{var e=this.info.fileMap[e.id],t=this.getConfig("getPostParam")(e);t.path=t.path||e.path,this.swf.setPostParams(t),this.swf.setUploadURL(this.getConfig("getUploadUrl")(e))}catch(n){throw new Error("YP:upload, flash swfUploadStart. "+n.message)}},swfUploadError:function(e,t){try{var n;switch(t){case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:n="\u5df2\u53d6\u6d88\u6587\u4ef6\u4e0a\u4f20";return;case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:n="\u7f51\u7edc\u6709\u95ee\u9898\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u4e0a\u4f20";break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:n="\u6587\u4ef6\u8bfb\u53d6\u6709\u95ee\u9898";break;case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:n="\u6b64\u6587\u4ef6\u4e0d\u5728\u4e0a\u4f20\u961f\u5217\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:n="\u4e0a\u4f20\u4e2d\u6b62";break;default:n="\u5bf9\u4e0d\u8d77\uff0c\u4e0a\u4f20\u5931\u8d25\uff01"}this.uploadError(this.info.fileMap[e.id],n)}catch(r){throw new Error("YP:upload, flash swfUploadError. "+r.message)}},swfUploadSuccess:function(e,t){this.autoCommit(t)},swfUploadComplete:function(){},initFlash:function(){try{var e=this.getConfig("flSelectFileBtn");if(!e)return;e=W(e);if(e.length<=0)return;var t=this;this.swf=new SWFUpload({upload_url:this.getConfig("uploadUrl"),flash_url:this.getConfig("flashUrl"),assume_success_timeout:0,file_types:"*.*",file_types_description:"All Files(\u5355\u4e2a\u6587\u4ef6360M\u4ee5\u5185)",file_size_limit:this.getConfig("limitSize")+"B",file_upload_limit:0,file_queue_limit:0,file_post_name:"file",moving_average_history_size:40,debug:!1,prevent_swf_caching:!0,preserve_relative_urls:!1,button_placeholder:e[0],button_image_url:this.getConfig("swfBtnImgUrl"),button_width:this.getConfig("btnWidth"),button_height:this.getConfig("btnHeight"),button_text:"",button_action:SWFUpload.BUTTON_ACTION.SELECT_FILES,button_disabled:!1,button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.WINDOW,file_dialog_start_handler:function(){t.swfDialogStart()},file_queued_handler:function(e){t.swfQueued(e)},file_queue_error_handler:function(e,n,r){t.swfQueueError(e,n)},file_dialog_complete_handler:function(e,n){t.swfDialogComplete()},upload_start_handler:function(e){t.swfUploadStart(e)},upload_progress_handler:function(e,n,r){t.uploadProgress(e.id,n,r)},upload_error_handler:function(e,n){t.swfUploadError(e,n)},upload_success_handler:function(e,n){t.swfUploadSuccess(e,n)},upload_complete_handler:function(){}})}catch(n){throw new Error("YP:upload, flash initFlash. "+n.message)}}}),Object.mix(yunpan.upload.Uploader.prototype,{jxAddWaitFile:function(e,t,n){try{var r=0,i=e.length,s=yunpan.upload.UPLOAD_TYPE_AJAX,o=this,u=this.getConfig("limitSize");this.filesInWait={isFolder:!1,list:[],queuedErrorList:[],path:this.getConfig("getUploadPath")(),uploadType:s};function a(e){try{var t=new FileReader;t.onerror=function(t){o.jxQueueError("NOT_SUPPORT",e.name,!1),f()},t.onload=function(t){o.filesInWait.list.push(new yunpan.upload.File({id:yunpan.upload.idGen(),name:e.name,file:e,path:o.getConfig("getUploadPath")(),uploadType:yunpan.upload.UPLOAD_TYPE_AJAX},"ajax")),f()},t.readAsText(e)}catch(n){o.jxQueueError("NOT_SUPPORT",e.name,!1),f()}}function f(){if(r<i){var l=e[r];if(l.size<=0){r++,t&&l.type==""?o.jxQueueError("NOT_SUPPORT",l.name,!1):o.jxQueueError("ZERO_BYTE_FILE",l.name,!1),f();return}if(l.size>u){r++,o.jxQueueError("FILE_EXCEEDS_SIZE_LIMIT",l.name,!1),f();return}l.type==""&&l.size<=524288?(r++,a(l)):(r++,o.filesInWait.list.push(new yunpan.upload.File({id:yunpan.upload.idGen(),name:l.name,file:l,uploadType:s,relativePath:"",path:o.getConfig("getUploadPath")()},o)),f())}else r>=i?o.listeners.afterselect(!1):o.isAddingFile=!1,n&&W(n).val("")}f()}catch(l){throw new Error("YP:upload, ajax jxAddWaitFile. "+l.message)}},jxQueueError:function(e,t,n){try{var r="";switch(e){case"NOT_SUPPORT":r="\u4e0d\u652f\u6301\u4e0a\u4f20\u8be5\u6587\u4ef6\uff01";break;case"ZERO_BYTE_FILE":r="\u4e0d\u652f\u6301\u4e0a\u4f20\u7a7a\u6587\u4ef6\uff01";break;case"FILE_EXCEEDS_SIZE_LIMIT":r='\u4e0a\u4f20360MB\u4ee5\u4e0a\u6587\u4ef6\uff0c\u5efa\u8bae\u4f7f\u7528<a target="_blank" href="http://down.360safe.com/yunpan/360wangpan_setup.exe">\u5ba2\u6237\u7aef</a>\uff0c\u9ad8\u901f\u3001\u7a33\u5b9a\u3002';break;case"FILE_QUEUE_LIMIT":r="\u6587\u4ef6\u5939\u4e2d\u6587\u4ef6\u603b\u6570\u8d85\u8fc73000\u4e2a\u4e0a\u4f20\u9650\u5236\uff0c\u5efa\u8bae\u60a8\u5206\u6279\u4e0a\u4f20";break;case"DIRECTORY_LAYER_NUMBER_LIMIT":r="\u6587\u4ef6\u5939\u4e2d\u7684\u76ee\u5f55\u5c42\u6570\u8d85\u8fc710\u5c42\uff0c\u5efa\u8bae\u60a8\u6574\u7406\u540e\u4e0a\u4f20";break;default:r="\u53d1\u751f\u672a\u77e5\u9519\u8bef\uff01"}r&&t&&(this.listeners.queuederror(r,t,n),this.filesInWait.queuedErrorList.push({name:t,msg:r}))}catch(i){throw new Error("YP:upload, ajax jxQueueError. "+i.message)}},jxFileSelected:function(e,t){try{if(this.isAddingFile)return;this.isAddingFile=!0,this.jxAddWaitFile(t.files,!1,t)}catch(e){throw new Error("YP:upload, ajax jxFileSelected. "+e.message)}},jxFolderSelected:function(e,t){try{if(this.isAddingFile)return;if(t.files.length<=0){this.isAddingFile=!1,W(t).val("");return}var n=t.files,r=yunpan.upload.getRootName(n[0].webkitRelativePath),i=this.getConfig("getUploadPath")(),s=yunpan.upload.UPLOAD_TYPE_AJAX;if(n.length>yunpan.upload.config.FILE_QUEUE_LIMIT){this.isAddingFile=!1,W(t).val(""),this.jxQueueError("FILE_QUEUE_LIMIT",r,!1);return}this.isAddingFile=!0,this.filesInWait={isFolder:!0,folderName:r,list:[],queuedErrorList:[],path:i,uploadType:s};var o=0,u=yunpan.upload.config.DIRECTORY_LAYER_NUMBER_LIMIT;for(var a=0,f=n.length;a<f;a++){var l=n[a],c=l.name,h=!1,p=this.getConfig("limitSize"),d=l.webkitRelativePath.split("/").length;if(d>u){this.isAddingFile=!1,this.jxQueueError("DIRECTORY_LAYER_NUMBER_LIMIT",r,!1),W(t).val("");return}if(c==".")h=!0,c=l.webkitRelativePath.replace(/(^|.*?\/)([^\/]+)\/\.$/,"$2");else{if(l.size<=0){this.jxQueueError("ZERO_BYTE_FILE",l.name,!0);continue}if(l.size>p){monitor.yplog(901,{qid:SYS_CONF.qid}),this.jxQueueError("FILE_EXCEEDS_SIZE_LIMIT",l.name,!0);continue}}o+=l.size;var v=l.webkitRelativePath.substring(0,l.webkitRelativePath.lastIndexOf("/")+1);this.filesInWait.list.push(new yunpan.upload.File({id:yunpan.upload.idGen(),name:c,isFolder:h,file:l,path:i,relativePath:v,uploadType:s},this))}this.filesInWait.totalSize=o,W(t).val(""),this.listeners.afterselect(!0)}catch(e){throw new Error("YP:upload, ajax jxFolderSelected. "+e.message)}},jxStartUpload:function(){try{var e=this,t=this.info.queue[0],n=this.getConfig("getPostParam")(t),r=new FormData;n.Filename=n.Filename||t.name,n.path=n.path||t.path+t.relativePath,n.file=n.file||t.file;for(var i in n)r.append(i,n[i]);var s=new XMLHttpRequest;s.upload.addEventListener("progress",function(t){if(t.lengthComputable){var n=e.info.queue[0],r=t.loaded;r>n.file.size&&(r=n.file.size),e.uploadProgress(n.id,r,t.total)}},!1),s.addEventListener("load",function(t,n){if(!n){var r=t.target.responseText;e.autoCommit(r)}else e.uploadError(e.info.queue[0],"\u5bf9\u4e0d\u8d77\uff0c\u4e0a\u4f20\u5931\u8d25\uff01");s=null},!1),s.addEventListener("error",function(t){e.uploadError(e.info.queue[0],"\u5bf9\u4e0d\u8d77\uff0c\u4e0a\u4f20\u5931\u8d25\uff01"),s=null},!1);var o=this.getConfig("getUploadUrl")(t);s.open("POST",o),s.send(r),this.xhr=s}catch(u){throw new Error("YP:upload, ajax jxStartUpload. "+u.message)}},initDD:function(){var e=this.getConfig("dropZone"),t=this;W(e).on("dragstart",function(e){t.listeners.dragstart(e)}).on("dragend",function(e){t.listeners.dragend(e)}).on("dragenter",function(e){t.listeners.dragenter(e)}).on("dragover",function(e){e.preventDefault(),t.listeners.dragover(e)}).on("drop",function(e){try{if(t.isAddingFile)return;var n=t.listeners.drop(e);if(!n)return;t.listeners.beforeselect(!1,yunpan.upload.UPLOAD_TYPE_AJAX);if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0){e.preventDefault();var r=e.dataTransfer.files;t.isAddingFile=!0,t.jxAddWaitFile(r,!0)}}catch(e){throw new Error("YP:upload, ajax dd drop. "+e.message)}}).on("dragleave",function(e){t.listeners.dragleave(e)}).on("mouseup",function(e){t.listeners.ddmouseup(e)})},initAjax:function(){try{var e=this.getConfig("jxSelectFileHolder"),t=this;if(e){var e=W(e);for(var n=0,r=e.length;n<r;n++){var i=W('<input title="\u8bf7\u9009\u62e9\u8981\u4e0a\u4f20\u7684\u6587\u4ef6" id="'+yunpan.upload.idGen()+'" class="file-select-proxy" type="file" multiple/>').insertTo("beforeend",e[n]);i.on("change",function(e){t.listeners.beforeselect(!1,yunpan.upload.UPLOAD_TYPE_AJAX),t.jxFileSelected(e,W(this)[0])})}}var s=yunpan.upload.detectCapability();if(s.supportAjaxFolder&&this.getConfig("jxSelectFolderHolder")){var o=W(this.getConfig("jxSelectFolderHolder"));for(var n=0,r=o.length;n<r;n++){var i=W('<input title="\u8bf7\u9009\u62e9\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\u5939" id="'+yunpan.upload.idGen()+'" class="folder-select-proxy" type="file" webkitdirectory multiple/>').insertTo("beforeend",o[n]);i.on("change",function(e){t.listeners.beforeselect(!0,yunpan.upload.UPLOAD_TYPE_AJAX),t.jxFolderSelected(e,W(this)[0])})}}this.getConfig("dropZone")&&this.initDD()}catch(u){throw new Error("YP:upload, ajax initAjax. "+u.message)}}}),Object.mix(yunpan.upload.Uploader.prototype,{plNetworkAbnormal:function(e){this.listeners.networkabnormal()},plHashProgress:function(e,t){this.listeners.hashprogress(yunpan.upload.config.PLUGIN_PREFIX+e,t)},plDoUpload:function(){try{if(this.plWaitList.length>0){var e=this.plWaitList.shift(),t=yunpan.upload.config.PLUGIN_PREFIX+e;this.info.fileMap[t]?this.info.fileMap[t].status==yunpan.upload.STATUS_COMPLETE?this.plDoUpload():this.plUploadStart(e):this.plDoUpload()}else this.plIsWaiting=!0,this.plugin.DoUpload()}catch(n){throw new Error("YP:upload, plugin plDoUpload. "+n.message)}},plUploadStart:function(e){try{var t=yunpan.upload.config.PLUGIN_PREFIX+e,n;if(this.info.folderMap[t])n=this.info.folderMap[t],t=n.id;else{if(!this.info.fileMap[t]){this.plugin.CancelUpload(e),this.startUpload();return}n=this.info.fileMap[t]}this.listeners.startupload(t),n.startTime||(n.startTime=new Date),this.plugin.StartUpload(e)}catch(r){throw new Error("YP:upload, plugin plUploadStart. "+r.message)}},plFileQueuedError:function(e,t,n,r){try{var i="";switch(n){case 1002:i="\u6587\u4ef6\u5939\u4e2d\u6587\u4ef6\u603b\u6570\u8d85\u8fc73000\u4e2a\u4e0a\u4f20\u9650\u5236\uff0c\u5efa\u8bae\u60a8\u5206\u6279\u4e0a\u4f20";break;case 1006:i="\u6587\u4ef6\u5939\u4e2d\u7684\u76ee\u5f55\u5c42\u6570\u8d85\u8fc710\u5c42\uff0c\u5efa\u8bae\u60a8\u6574\u7406\u540e\u4e0a\u4f20";break;case 1001:i="\u4e0a\u4f20\u6587\u4ef6\u8d85\u8fc7\u9650\u5236\u5927\u5c0f"+yunpan.util.formatByte(this.getConfig("pluginUploadLimit"));break;case 1003:i="\u6587\u4ef6\u88ab\u5360\u7528\uff0c\u65e0\u6cd5\u8bfb\u53d6";break;case 1007:i="\u4e0d\u80fd\u4e0a\u4f20\u6839\u76ee\u5f55\uff01";break;default:file!==null&&(i="\u53d1\u751f\u672a\u77e5\u9519\u8bef\uff01")}if(i){var s={name:t,msg:i,errno:n,size:r,type:yunpan.upload.UPLOAD_TYPE_PLUGIN};this.listeners.queuederror(i,t,!!this.filesInWait.folderName),this.filesInWait.folderName?this.filesInWait.queuedErrorList.push(s):this.isAddingFile=!1}}catch(o){throw new Error("YP:upload, plugin plFileQueuedError. "+o.message)}},plBindEvent:function(){var e=function(e,t,n){e.attachEvent?e["on"+t]=n:e.addEventListener?e.addEventListener(t,n,!1):e["on"+t]=n},t=this,n=this.plugin,r=yunpan.upload.UPLOAD_TYPE_PLUGIN,i=yunpan.upload.config.PLUGIN_PREFIX;e(n,"FileQueued",function(e,n){try{t.filesInWait.list.push(new yunpan.upload.File({id:i+e,fid:e,name:n,uploadType:r,path:t.getConfig("getUploadPath")()},t))}catch(s){throw new Error("YP:upload, plugin addHandler, FileQueued. "+s.message)}}),e(n,"DirFileQueued",function(e,n){try{var s=n.substring(0,n.length-1);if(n.indexOf("/")==n.length-1){var o=new yunpan.upload.File({isRoot:!0,id:i+e,fid:e,name:s,uploadType:r,path:t.getConfig("getUploadPath")()},t);t.filesInWait.list.push(o),t.filesInWait.folderName=s}else t.filesInWait.list.push(new yunpan.upload.File({id:i+e,fid:e,name:n,uploadType:r,path:t.getConfig("getUploadPath")()},t))}catch(u){throw new Error("YP:upload, plugin addHandler, DirFileQueued. "+u.message)}}),e(n,"FileQueuedError",function(e,n,r,i){try{t.plFileQueuedError(e,n,r,i)}catch(s){throw new Error("YP:upload, plugin addHandler, FileQueuedError. "+s.message)}}),e(n,"FileDialogComplete",function(e){try{t.listeners.afterselect(!1)}catch(n){throw new Error("YP:upload, plugin addHandler, FileDialogComplete. "+n.message)}}),e(n,"DirDialogComplete",function(e,n,r,i){try{if(!e){t.isAddingFile=!1;return}t.filesInWait.totalSize=r,t.listeners.afterselect(!0)}catch(s){throw new Error("YP:upload, plugin addHandler, DirDialogComplete. "+s.message)}}),e(n,"UploadStart",function(e){try{t.plIsWaiting?(t.plIsWaiting=!1,t.plUploadStart(e)):t.plWaitList.push(e)}catch(n){throw new Error("YP:upload, plugin addHandler, UploadStart. "+n.message)}}),e(n,"UploadComplete",function(e){}),e(n,"HashProgress",function(e,n){try{t.plHashProgress(e,n)}catch(r){throw new Error("YP:upload, plugin addHandler, HashProgress. "+r.message)}}),e(n,"UploadProgress",function(e,n,r,s,o){try{t.uploadProgress(i+e,r,s,n,o)}catch(u){throw new Error("YP:upload, plugin addHandler, uploadProgress. "+u.message)}}),e(n,"UploadSuccess",function(e,n,r,s,o){try{t.uploadSuccess(i+e,n,r,s,o)}catch(u){throw new Error("YP:upload, plugin addHandler, uploadSuccess. "+u.message)}}),e(n,"UploadError",function(e,n,r){try{t.uploadError(t.info.fileMap[yunpan.upload.config.PLUGIN_PREFIX+e],r)}catch(i){throw new Error("YP:upload, plugin addHandler, uploadError. "+i.message)}}),e(n,"NetworkAbnormal",function(e){try{t.plNetworkAbnormal(e)}catch(n){throw new Error("YP:upload, plugin addHandler, networkabnormal. "+n.message)}})},plOpenFileDia:function(e){try{if(this.isAddingFile)return;this.isAddingFile=!0;var t=this.getConfig("getUploadPath")();e?(this.filesInWait={isFolder:!0,uploadType:yunpan.upload.UPLOAD_TYPE_PLUGIN,path:t,list:[],queuedErrorList:[]},this.listeners.beforeselect(!1,yunpan.upload.UPLOAD_TYPE_PLUGIN),this.plugin.DirDialogStart(t)):(this.filesInWait={isFolder:!1,uploadType:yunpan.upload.UPLOAD_TYPE_PLUGIN,list:[],queuedErrorList:[]},this.listeners.beforeselect(!0,yunpan.upload.UPLOAD_TYPE_PLUGIN),this.plugin.FileDialogStart(t))}catch(n){throw new Error("YP:upload, plugin plOpenFileDia. "+n.message)}},initPlugin:function(){try{var e=this.getConfig("plSelectFileBtn"),t=this.getConfig("plSelectFolderBtn"),n=yunpan.upload.detectCapability(),r=this;if(!e&&(!n.supportPluginFolder||!t))return;try{var i,s,o=W('<div style="width:0;height:0;overflow:hidden;"></div>').insertTo("beforeend",document.body),u=yunpan.upload.idGen();Browser.ie&&Browser.ie>=6?i=W('<OBJECT ID="'+u+'" CLASSID="clsid:'+yunpan.upload.config.CLASSID_FOR_IE+'" HEIGHT="0" WIDTH="0"></OBJECT>'):(i=W("<object></object>"),i.attr({type:"application/x-uploadplugin",id:u})),i.insertTo("beforeend",o);var a=window[u];s=a.GetVersion().trim(),this.pluginVersion=parseInt(s.substring(s.lastIndexOf(".")+1))}catch(f){i.removeNode(),o.removeNode()}this.pluginVersion&&this.pluginVersion>=yunpan.upload.config.MIN_PLUGIN_VERSION&&(this.uploadType=yunpan.upload.UPLOAD_TYPE_PLUGIN,this.plugin=a),e&&W(e).on("click",function(){r.plOpenFileDia()}),n.supportPluginFolder&&t&&W(t).on("click",function(){r.plOpenFileDia(!0)}),this.plBindEvent()}catch(f){throw new Error("YP:upload, plugin initPlugin. "+f.message)}}}),yunpan.cmdCenter.showUpload=function(){function y(){try{var e=(yunpan.filelist.curFunc=="file"?"\u5168\u90e8\u6587\u4ef6":"\u6587\u4ef6\u4fdd\u9669\u7bb1")+yunpan.filelist.path;e=e.substr(0,e.length-1),W("#curUploadPath").attr("title",e.encode4Html()),e.byteLen()>50&&(W("#curUploadPath").attr("title",e),e=e.split("").reverse().join(""),e=e.subByte(50,"\u2026"),e=e.split("").reverse().join("")),W("#curUploadPath").html(e.encode4Html())}catch(t){throw new Error("YP:upload, app-upload setCurPath. "+t.message)}}function b(){try{yunpan.filelist.curFunc=="file"||yunpan.filelist.curFunc=="sFile"?(W("#uploadItemList").query("li").length<=0&&a.supportAjax&&W(".drag-tip").show(),T(),W(".uploadPath").show(),W(".uploadDeny").hide()):(W(".drag-tip").hide(),T(),W(".uploadDeny").show(),W(".uploadPath").hide());var e=new ElAnim("miniProxy",{opacity:{from:0,to:.2},top:{from:u.top,to:o.top},left:{from:u.left,to:o.left},width:{from:u.width,to:o.width},height:{from:u.height,to:o.height}},300,QW.Easing.easeBothStrong);e.on("beforeplay",function(){i.css("display","block")}),e.onend=function(){y(),t.withMask=!0,t.show(o.left,o.top),i.css("display","none")},s.setStyle("visibility","hidden"),e.play(),r=!1}catch(n){throw new Error("YP:upload, app-upload maximize. "+n.message)}}function w(n){try{e.info.totalNum<1&&s.query(".per").html("\u9009\u62e9\u8981\u4e0a\u4f20\u7684\u6587\u4ef6"),o=W(t.oWrap).getRect(),u=s.getRect(),i.setStyle({display:"block"});var a=new ElAnim("miniProxy",{opacity:{to:0,from:.2},top:{from:o.top,to:u.top},left:{from:o.left,to:u.left},width:{from:o.width,to:u.width},height:{from:o.height,to:u.height}},300,QW.Easing.easeBothStrong);s.setStyle("visibility","visible"),a.on("end",function(){i.css("display","none")}),a.play(),W(t.oWrap).setStyle("left","-10000px"),W(".mask").setStyle("display","none"),t.withMask=!1,r=!0}catch(n){throw new Error("YP:upload, app-upload minimize. "+n.message)}}function E(t,n,r){try{var i=n.hasClass("normal"),s=!1;if(i){r||(s=confirm("\u60a8\u786e\u5b9a\u8981\u505c\u6b62\u5f53\u524d\u7684\u4e0a\u4f20\u4efb\u52a1\uff1f"));if(r||s)e.cancel(t),n.removeNode()}else n.removeNode()}catch(o){throw new Error("YP:upload, app-upload cancelUpload. "+o.message)}}function S(){try{var n=W("#uploadItemList").query("li.normal");if(n.length){if(!confirm("\u786e\u5b9a\u8981\u505c\u6b62\u6240\u6709\u672a\u5b8c\u6210\u7684\u4efb\u52a1\u4e48\uff1f"))return;n.forEach(function(e){E(e.id,W(e),!0)}),window.onbeforeunload=null}e.reset(),t.hide(),W("#uploadItemList").html(""),document.title=yunpan.title}catch(r){throw new Error("YP:upload, app-upload cancel. "+r.message)}}function x(){var r='<div id="uploadPanel"> <div class="plugin-tip"style="display:none">\u5f53\u524d\u6d4f\u89c8\u5668\u53ef\u5347\u7ea7\u4e3a\u201c\u4e91\u52a0\u901f\u4e0a\u4f20\u201d\uff0c\u652f\u6301\u6587\u4ef6\u79d2\u4f20\u3001\u65ad\u70b9\u7eed\u4f20\u3001\u5927\u6587\u4ef6\u4e0a\u4f20 <a href="http://down.360safe.com/yunpan/360yunpanupload_setup.exe"target="_blank">\u5b89\u88c5\u5347\u7ea7\u63a7\u4ef6</a></div> <div class="upload-toolbar clearfix"> <div class="upload-btns"> <div class="pl-select-file"> <span class="pl-select-file-btn"></span> </div> <div class="pl-select-menu select-menu"> <a class="file-select"href="###"onclick="return false">\u6dfb\u52a0\u6587\u4ef6</a> <a class="folder-select"href="###"onclick="return false">\u6dfb\u52a0\u6587\u4ef6\u5939</a> </div> <div class="jx-select-file"> <span class="jx-select-file-btn"></span> </div> <div class="jx-select-menu select-menu"> <a class="file-select"href="javascript:;">\u6dfb\u52a0\u6587\u4ef6</a> <a class="folder-select"href="javascript:;">\u6dfb\u52a0\u6587\u4ef6\u5939</a> </div> <div class="fl-select-file-box"> <button class="fl-select-file"></button> </div> </div> <div class="uploadDeny"style="display:none">\u4e0d\u53ef\u4e0a\u4f20\u81f3\u5f53\u524d\u76ee\u5f55\uff0c\u53ef\u4e0a\u4f20\u81f3\u201c<span>\u5168\u90e8\u6587\u4ef6</span>\u201d\u4e2d\u53ca\u5176\u5b50\u6587\u4ef6</div> <div class="uploadPath">\u5230\uff1a<span id="curUploadPath"></span></div> </div> <div class="network-abnormal-tip"style="display:none">\u7f51\u7edc\u5f02\u5e38\uff0c\u4e0a\u4f20\u6682\u505c\u3002\u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u7edc</div> <div class="upload-list-box"> <div class="drag-tip"style="display:none"><h1>\u8bd5\u8bd5\u5c06\u7535\u8111\u91cc\u7684\u6587\u4ef6\u62d6\u62fd\u5230\u6b64\u4e0a\u4f20</h1><p>\uff08\u60a8\u7684\u6d4f\u89c8\u5668\u652f\u6301\u6b64\u62d6\u62fd\u529f\u80fd\uff09</p></div> <ul id="uploadItemList"class="upload-list"> </ul> </div> </div> <split> <li class="{$status} {$sfile}"id="{$id}"data-name="{$fname}"> <div class="title"> <span class="name">{$fname}</span> <em title="\u53d6\u6d88"data-id="{$id}">\u53d6\u6d88</em> </div> <div class="progress"> <span class="progress-box"> <span class="progress-bar"></span> </span> <span class="progress-value"></span> </div> <div class="uploadPathLi"style="display:none">\u5df2\u4e0a\u4f20\u5230\uff1a<span class="fileUploadPath"></span></div> <div class="info">\u7b49\u5f85\u4e0a\u4f20\u4e2d...</div> <split> <li class="folder {$status} {$sfile}"id="{$id}"data-name="{$fname}"> <div class="title clearfix"> <span class="folder-pic"></span> <span class="name">{$fname}</span> <em title="\u53d6\u6d88">\u53d6\u6d88</em> </div> <div class="progress"> <span class="progress-box"> <span class="progress-bar"></span> </span> <span class="progress-value"></span> </div> <div class="uploadPathLi"style="display:none">\u5df2\u4e0a\u4f20\u5230\uff1a<span class="fileUploadPath"></span></div> <div class="info"> <span class="fail-loaded"style="display:none">\u5931\u8d25\uff1a<span class="fail-num">0</span><span class="arrow"></span></span> <span class="status">\u7b49\u5f85\u4e0a\u4f20\u4e2d...</span> <span class="err-msg">{$errMsg}</span> </div> <div class="file-box"style="display:none"></div> <split> <div class="err-file"> <span class="name">{$name}</span> <span class="err-msg">{$errmsg}</span> </div>'.split("<split>"),o=r[0]
.trim();l=r[1].trim().tmpl(),c=r[2].trim().tmpl(),h=r[3].trim().tmpl(),t=new yunpan.dialog.create({body:o,title:"\u4e0a\u4f20\u6587\u4ef6\u5230360\u4e91\u76d8",withClose:!1,buttons:[{text:"\u5b8c\u6210",id:"uploadStatusBtn",handler:S}]}),t.on("aftershow",function(){t.bindMinimize||(W(".mask").on("click",function(){t.isVisible&&t.withMask&&w()}),t.bindMinimize=!0)}),a=yunpan.upload.detectCapability(),!a.supportPlugin&&/^win/i.test(Browser.platform)&&(W("#uploadPanel .plugin-tip").show(),W('<div class="upload-tips"><p>\u7f51\u9875\u7248\u5355\u6587\u4ef6\u6700\u5927\u652f\u6301360M</p><p><a target="_blank" href="http://down.360safe.com/yunpan/360wangpan_setup.exe">\u5b89\u88c5PC\u5ba2\u6237\u7aef\uff0c\u4e0a\u4f205G\u8d85\u5927\u6587\u4ef6</a></p></div>').insertTo("afterbegin",t.oFooter)),n=W("#uploadPanel .upload-btns"),i||(W("#uploadItemList").delegate(".title em","click",function(){var t=W(this).parentNode("li");t.hasClass("normal")?E(t[0].id,t,!1):t.removeNode(),e.startUpload()}),W('<span class="minimize"><a href="#" onclick="return false;" class="minimize-link"><span>\u5173\u95ed</span></a></span>').insertTo("beforeend",t.oWrap).on("click",w),W('<span class="close"><a href="#" onclick="return false;" class="close-link"><span>\u5173\u95ed</span></a></span>').insertTo("beforeend",t.oWrap).on("click",S),i=W('<div id="miniProxy" class="miniProxy"></div>').insertTo("beforeend",document.body),s=W("#toolbar .mini-upload").on("click",function(e){b(),e.preventDefault()}),W("#uploadPanel").delegate(".fail-loaded","click",function(){try{var e=W(this),t=e.parentNode("li");if(e.hasClass("unfolded"))t.query(".file-box").hide(),t.css("height","83px"),e.removeClass("unfolded");else{var n=t.query(".file-box").show().getRect();t.css("height",83+n.height+"px"),e.addClass("unfolded")}}catch(r){throw new Error("YP:upload, app-upload fail-loaded. "+r.message)}}));var u={dropZone:document.body,limitSize:377487360,pluginUploadLimit:SYS_CONF.uploadLimit,getUploadPath:function(){return yunpan.filelist.path},getPostParam:function(e){if(e.uploadType==yunpan.upload.UPLOAD_TYPE_AJAX)return{qid:SYS_CONF.qid,ofmt:"json",method:"Upload.web",token:Cookie.get("token",""),v:"1.0.1",tk:ypDomain.tk,Upload:"Submit Query",devtype:"web",pid:"ajax"};if(e.uploadType==yunpan.upload.UPLOAD_TYPE_FLASH)return{v:"1.0.1",qid:SYS_CONF.qid,ofmt:"json",method:"Upload.web",token:Cookie.get("token",""),tk:ypDomain.tk,devtype:"web",pid:"flash"}},getUploadUrl:function(){return"http://"+ypDomain.up+"/webupload?devtype=web"}};a.supportAjax?(u.jxSelectFileHolder="#uploadPanel .jx-select-file-btn",f.file="act-ajax",f.sFile="act-ajax",W("#uploadPanel .drag-tip").show(),a.supportAjaxFolder&&(u.jxSelectFileHolder+=",#uploadPanel .jx-select-menu .file-select",u.jxSelectFolderHolder="#uploadPanel .jx-select-menu .folder-select",f.file="act-ajax-folder",f.sFile="act-ajax-folder",W("#uploadPanel .upload-btns").hover(function(){W(this).hasClass("act-ajax-folder")&&(W("#uploadPanel .jx-select-menu").show(),W(this).addClass("act-ajax-folder-hover"))},function(){W(this).hasClass("act-ajax-folder")&&(W("#uploadPanel .jx-select-menu").hide(),W(this).removeClass("act-ajax-folder-hover"))}))):a.supportFlash&&(f.file="act-flash",f.sFile="act-flash",u.flSelectFileBtn="#uploadPanel .fl-select-file",u.flashUrl="http://s5.qhimg.com/static/45b2bbe371e98f62.swf",u.btnWidth=103,u.btnHeight=30,u.swfBtnImgUrl="/resource/img/dialog/dialog-flash-upload.png"),a.supportPlugin&&(u.plSelectFileBtn="#uploadPanel .pl-select-file-btn",f.file="act-plugin",a.supportPluginFolder&&(u.plSelectFileBtn+=", #uploadPanel .pl-select-menu .file-select",u.plSelectFolderBtn="#uploadPanel .pl-select-menu .folder-select",f.file="act-plugin-folder",W("#uploadPanel .upload-btns").hover(function(){W(this).hasClass("act-plugin-folder")&&W("#uploadPanel .pl-select-menu").show()},function(){W(this).hasClass("act-plugin-folder")&&W("#uploadPanel .pl-select-menu").hide()}))),u.listeners={afterinit:function(){if(yunpan.upload.detectCapability().supportPlugin){var t=e.plugin;t.SetParam("fileSizeLimit",SYS_CONF.uploadLimit+""),t.SetParam("timeout",60),t.SetParam("devtype","web_upload")}},beforeselect:function(t,n){W("#uploadPanel .drag-tip").css("display","none");if(n==yunpan.upload.UPLOAD_TYPE_PLUGIN){W("#uploadPanel .pl-select-menu").hide();var r=e.plugin,i=ypDomain.api;i=i.substring(i.indexOf("a"),i.length),r.SetPostParam("qid",SYS_CONF.qid),r.SetPostParam("token",Cookie.get("token","")),r.SetPostParam("host",i)}},afterselect:function(t){try{var n=e.filesInWait,r=n.list,i=yunpan.filelist.curFunc;if(r.length<=0){e.resume();return}if(n.uploadType==yunpan.upload.UPLOAD_TYPE_AJAX){var s=W("#uploadPanel .upload-btns");s.hasClass("act-ajax-folder")&&(W("#uploadPanel .jx-select-menu").hide(),s.removeClass("act-ajax-folder-hover"))}else n.uploadType==yunpan.upload.UPLOAD_TYPE_FLASH&&(document.title=yunpan.title);n.curFunc=i;var o=yunpan.filelist.path;n.path=o;for(var u=0,a=r.length;u<a;u++)r[u].curFunc=i,r[u].path=o;yunpan.cmdCenter.checkFile(t,e)}catch(f){throw new Error("YP:upload, app-upload afterselect. "+f.message)}},filequeue:function(e,t){e||(W(l({id:t.id,fname:t.name.encode4Html(),status:"normal",sfile:t.curFunc=="sFile"?"sfile":""})).insertTo("beforeend",g("uploadItemList")),W("#uploadStatusBtn").addClass("cancel").html("\u53d6\u6d88"))},folderqueue:function(e,t){try{W(c({id:e.id,fname:e.name.encode4Html(),status:"normal",sfile:e.curFunc=="sFile"?"sfile":""})).insertTo("beforeend",g("uploadItemList"));if(t&&t.length){for(var n=0,r=t.length;n<r;n++){var i=t[n];W(h({name:i.name,errmsg:i.msg})).insertTo("beforeend",W("#"+e.id+" .file-box")),W("#"+e.id+" .fail-num").html(parseInt(W("#"+e.id+" .fail-num").html())+1)}W("#"+e.id+" .fail-loaded").show()}}catch(s){throw new Error("YP:upload, app-upload folderqueue. "+s.message)}},queuederror:function(e,t,n){n||W(l({fname:yunpan.upload.getFileName(t),status:"err"})).insertTo("beforeend",g("uploadItemList")).query(".info").html(e)},startupload:function(e){var t=W("#"+e);t.length>0&&t[0].scrollIntoView()},progress:function(t,n,r,i,o){try{W("#uploadPanel .network-abnormal-tip").hide();var u=W("#"+t);u.query(".progress-bar").css("width",n+"%"),u.query(".progress-value").html(n+"%");var a=p({upload:d(r,2),speed:d(i,2)+"/\u79d2",remain:o?v(o):"00:00:00"});u.hasClass("folder")?u.query(".info .status").html(a):(u.query(".info").html(a),n>=99&&(a="\u6587\u4ef6\u5b58\u50a8\u4e2d\u2026",u.query(".info").html(a))),s.query(".per").html("\u4e0a\u4f20\u8fdb\u5ea6\uff1a"+(e.info.sucNum+e.info.failNum+1)+"/"+e.info.totalNum),s.query(".mini-bg").css("width",n+"%")}catch(f){throw new Error("YP:upload, app-upload progress. "+f.message)}},uploadsuccess:function(t,n,r){try{W("#uploadPanel .network-abnormal-tip").hide();var i=W("#"+t.id);if(!n&&i.length>0){m(i,"\u606d\u559c\u60a8\uff0c\u4e0a\u4f20\u6210\u529f\uff01","pass",t);var s=i.query(".uploadPathLi"),o=(t.curFunc=="file"?"\u5168\u90e8\u6587\u4ef6":"\u6587\u4ef6\u4fdd\u9669\u7bb1")+t.path;o=o.substr(0,o.length-1),(o=="\u5168\u90e8\u6587\u4ef6"||o=="\u6587\u4ef6\u4fdd\u9669\u7bb1")&&s.html(s.html().replace("\u5df2\u4e0a\u4f20\u5230","\u5df2\u4e0a\u4f20\u5230\u6839\u76ee\u5f55"));var u=i.query(".fileUploadPath");o.byteLen()>50&&(u.attr("title",o),o=o.split("").reverse().join(""),o=o.subByte(50,"\u2026"),o=o.split("").reverse().join("")),u.setAttr("data-path",t.path.encode4Html()),u.html(o),t.curFunc=="file"&&(u.addClass("open"),u.on("click",function(e){w(),yunpan.filelist.curFunc="file",yunpan.cmdCenter.updateNav();var t=W(this).attr("data-path");yunpan.cmdCenter.gotoPath(n),yunpan.filelist.nav=[];var n=t.substring(1,t.length-1).split("/"),r="";if(n[0]!="")for(var i=0;i<n.length;i++)r+=n[i]+"/",yunpan.filelist.nav.push({title:n[i],nid:0,path:"/"+r});yunpan.cmdCenter.updateStatus()})),s.show()}e.startUpload()}catch(a){throw new Error("YP:upload, app-upload uploadsuccess. "+a.message)}},uploaderror:function(t,n,r,i){try{var s=W("#"+t.id);if(n){W(h({name:t.name,errmsg:r})).insertTo("beforeend",W("#"+i.id+" .file-box")),W("#"+i.id+" .fail-loaded").show();var o=W("#"+i.id+" .fail-num"),u=parseInt(o.html())+1;W("#"+i.id+" .fail-num").html(u);var a=W("#"+i.id+" .fail-loaded"),f=a.parentNode("li");if(a.hasClass("unfolded")){var l=f.query(".file-box").show().getRect();f.css("height",83+l.height+"px")}}else s.length>0&&s.removeClass("normal").addClass("err").query(".info").html(r);e.startUpload()}catch(c){throw new Error("YP:upload, app-upload uploaderror. "+c.message)}},uploadall:function(){s.query(".per").html("\u5df2\u4e0a\u4f20"+e.info.totalNum+"\u4e2a\uff0c\u7ee7\u7eed\u6dfb\u52a0"),s.query(".mini-bg").css("width","100%"),W("#uploadStatusBtn").removeClass("cancel").html("\u5b8c\u6210"),yunpan.filelist.list()},networkabnormal:function(){W("#uploadPanel .network-abnormal-tip").show()},hashprogress:function(e,t){var n=W("#"+e);n.length>0&&n.query(".info").html("\u4e91\u52a0\u901f\u51c6\u5907\u4e2d:"+t+"%")}};var x=['<div id="dropOverlay">',"<h1>","\u5c06\u6587\u4ef6\u62d6\u653e\u81f3\u6b64\u53ef\u4ee5\u4e0a\u4f20","</h1>","</div>"].join(""),N=W(x).insertTo("beforeend",document.body),C;Object.mix(u.listeners,{dragstart:function(e){N.css("width","0")},dragenter:function(e){if(yunpan.filelist.curFunc!="file"&&yunpan.filelist.curFunc!="sFile")return;N.css("display","block")},dragover:function(e){if(yunpan.filelist.curFunc!="file"&&yunpan.filelist.curFunc!="sFile")return;N.css("opacity","0.8")},dragend:function(e){setTimeout(function(){N.css("width","100%")},600)},dragleave:function(e){N.css("opacity","0")},drop:function(e){try{if(yunpan.filelist.curFunc!="file"&&yunpan.filelist.curFunc!="sFile")return;return N.css("opacity","0"),C&&(clearTimeout(C),C=null),C=setTimeout(function(){N.css("display","none")},500),T(),y(),e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0&&t.show(),!0}catch(e){throw new Error("YP:upload, app-upload dd drop. "+e.message)}},ddmouseup:function(e){if(yunpan.filelist.curFunc!="file"&&yunpan.filelist.curFunc!="sFile")return;N.css("opacity","0"),N.css("display","none")}}),e=new yunpan.upload.Uploader(u)}function T(){var e=yunpan.filelist.curFunc;n.attr("data-act-btn")!=f[e]&&(n.replaceClass(n.attr("data-act-btn"),f[e]),n.attr("data-act-btn",f[e]))}var e,t,n,r=!1,i,s,o,u,a,f={},l,c,h,p=['\u5df2\u4e0a\u4f20\uff1a<span class="upload-upload">{$upload}</span>','\u901f\u5ea6\uff1a<span class="upload-speed">{$speed}</span>','\u5269\u4f59\u65f6\u95f4\uff1a<span class="upload-remain">{$remain}</span>'].join("").tmpl(),d=yunpan.util.formatByte,v=function(e){var t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60);return t<10&&(t="0"+t),n<10&&(n="0"+n),r<10&&(r="0"+r),t+":"+n+":"+r},m=function(e,t,n,r){try{e.replaceClass("normal",n),e.hasClass("folder")?e.query(".info .status").html(t):e.query(".info").html(t),e.query("em").set("title","").replaceClass("prohibit",n),e.query(".progress").hide(),e.query(".title em").hide()}catch(i){throw new Error("YP:upload, app-upload setItemStatus. "+i.message)}};return Dom.ready(function(){setTimeout(function(){t||x()},2e3)}),function(){t||x(),T(),y(),r?b():t.show()}}(),Dom.ready(function(){var uploadCap=yunpan.upload.detectCapability();uploadCap.supportPlugin&&yunpan.filelist.curFunc=="file"&&W("#toolbar .upload .icon").replaceClass("icon-upload","icon-plugin-upload"),Ajax.post("/upload/getuploadaddress/",function(response){response=eval("("+response+")"),ypDomain.up=response.data.up,ypDomain.tk=response.data.tk})}),yunpan.cmdCenter.checkFile=function(){function u(){for(var t=0,n=e.filesInWait,r=n.length;t<r;t++)n[t].status=i}function a(){var t=e.filesInWait.list;for(var n=r.length-1;n>=0;n--){var s=r[n];for(var o=0,u=t.length;o<u;o++)if(s==t[o].name){t[o].status=i;break}}}function f(){if(n.query("input")[0].checked)a(),h();else{var t=r.shift().toLowerCase();for(var s=0,o=e.filesInWait.list,u=o.length;s<u;s++)if(t==o[s].name.toLowerCase()){o[s].status=i;break}r.length==0?h():c()}}function l(){n.query("input")[0].checked?(r=[],h()):(r.shift(),r.length==0?h():c())}function c(){if(r.length>0){t||(t=yunpan.dialog.create({body:'<div id="duplicate"></div>',title:"\u4e91\u76d8\u5df2\u5305\u542b\u540c\u540d\u6587\u4ef6",withClose:!0,buttons:[{text:"\u786e\u5b9a",handler:l},{text:"\u53d6\u6d88",handler:f}]}),t.on("afterhide",function(){return}),n=W("#duplicate"));var e={name:r[0].subByte(30,"\u2026").split("").join("<wbr />"),defaultNum:r.length-1};n.html(o.tmpl(e)),r.length<=1?(n.css("height","100px"),n.query(".default-all").css("display","none")):(n.css("height","120px"),n.query(".default-all").css("display","block")),t.show()}}function h(){t.hide(),e.resume()}function d(){if(p.length>0){var t=e.filesInWait.path+p.shift();Ajax.post(e.filesInWait.curFunc=="file"?"/file/mkdir/":"/sFile/mkdir/",{path:t},function(t){t=t.evalExp();if(t.errno==0||t.errno==3005){d();return}if(t.errno){e.filesInWait.status=i,e.resume(),yunpan.Msg.alert("\u521b\u5efa\u76ee\u5f55\u5931\u8d25");return}})}else{var n=e.filesInWait.list;for(var r=n.length-1;r>=0;r--)n[r].isFolder&&n.splice(r,1);e.resume()}}function v(){var t=e.filesInWait.list;p=[];var n=[];for(var r=0,s=t.length;r<s;r++){var o=t[r],u=o.relativePath;u=u.substring(0,u.lastIndexOf("/")),n.indexOf(u)<0&&n.push(u),o.isFolder&&(o.status=i)}for(var r=0,s=n.length;r<s;r++){var a=n[r].split("/"),f=a[0]+"/";p.indexOf(f)<0&&p.push(f);for(var l=1,c=a.length;l<c;l++)f+=a[l]+"/",p.indexOf(f)<0&&p.push(f)}p.length<0?(e.filesInWait.status=i,e.resume()):d()}function m(e,t,n,r){var n=n.toLowerCase();for(var i=0,s=e.length;i<s;i++)if(t==r&&e[i].toLowerCase()==n)return i;return-1}var e,t,n,r,i=yunpan.upload.STATUS_CANCELLED,s=yunpan.upload.UPLOAD_TYPE_PLUGIN,o=['<div class="msg-panel msg-warning-tip" style="width:210px">','<div class="msg-text-box">','<div class="msg-text" style="width:210px;">\u60a8\u4e0a\u4f20\u7684\u201c{$name}\u201d\u5df2\u5b58\u5728\uff0c\u662f\u5426\u786e\u8ba4\u8986\u76d6\uff1f</div>','<div class="default-all"><input id="defaultAll" type="checkbox"/><label for="defaultAll">\u540e\u7eed{$defaultNum}\u9879\u540c\u6837\u5904\u7406</label></div>',"</div>","</div>"].join(""),p;return function(t,n){e=n;var i=e.filesInWait;if(t){var s={},o=i.curFunc;o=="sFile"?s.nid=yunpan.filelist.nid:s.dir=yunpan.filelist.path,s["fname[]"]=i.folderName,Ajax.post(i.curFunc=="file"?"/file/detectFileExists":"/sFile/detectFileExists",s,function(t){var n=t.evalExp();if(n.errno!=0){n.errno===3007?yunpan.Msg.alert("\u8981\u4e0a\u4f20\u5230\u7684\u76ee\u5f55\u4e0d\u5b58\u5728!"):yunpan.Msg.alert("\u6587\u4ef6\u540c\u540d\u68c0\u67e5\u5931\u8d25\uff01"),i.status=yunpan.upload.STATUS_CANCELLED,e.resume();return}if(n.data.exists.length>0){yunpan.Msg.alert("\u4e0a\u4f20\u7684\u6587\u4ef6\u5939\u4e0e\u5df2\u5b58\u5728\u7684\u6587\u4ef6(\u5939)\u91cd\u540d\uff0c\u8bf7\u4fee\u6539\u6587\u4ef6\u5939\u540d\u79f0\u540e\u518d\u4e0a\u4f20"),i.status=yunpan.upload.STATUS_CANCELLED,e.resume();return}i.uploadType==yunpan.upload.UPLOAD_TYPE_PLUGIN?e.resume():v()})}else{i.list.length<=0&&e.resume();var u=i.list,a=e.info.fileMap,f=u[0].path,l=[],o=i.curFunc;for(var h=0,p=u.length;h<p;h++)l.push(u[h].name);var s={};o=="sFile"?s.nid=yunpan.filelist.nid:s.dir=yunpan.filelist.path,s["fname[]"]=l,Ajax.post(i.curFunc=="file"?"/file/detectFileExists":"/sFile/detectFileExists",s,function(t){var n=t.evalExp();if(n.errno!=0){n.errno===3007?yunpan.Msg.alert("\u6587\u4ef6\u6216\u76ee\u5f55\u4e0d\u5b58\u5728!"):yunpan.Msg.alert("\u6587\u4ef6\u540c\u540d\u68c0\u67e5\u5931\u8d25\uff01"),e.resume();return}var i=n.data.exists;W("#uploadItemList").query("li.normal, li.pass").forEach(function(e){var t=W(e),n=t.attr("data-name");if(!t.attr("id")||!a[t.attr("id")])return;var r=a[t.attr("id")].path||"";(t.hasClass("sfile")&&o=="sFile"||!t.hasClass("sfile")&&o!="sFile")&&m(l,f,n,r)>=0&&m(i,f,n,r)<0&&i.push(n)}),i.length>0?(r=i,c()):e.resume()})}}}(),yunpan.menuManager=function(){function n(){e.forEach(function(e){e.hide()})}function r(t){e.push(t)}function i(t){var n=Object.isString(t)?t:t.config.id;for(var r=0,i=e.length;r<i;r++){if(e[r].config.id==n){e.remove(e[r]);break}continue}}function s(t){var n=Object.isString(t)?t:t.config.id;for(var r=0,i=e.length;r<i;r++){if(e[r].config.id==n){e[r].hide();break}continue}}function o(){var e=Dom.getDocRect();t.css({width:e.width-1+"px",height:e.height-1+"px"}),t.css("display","block")}function u(){t&&t.css&&t.css("display","none")}var e=[],t;return Dom.ready(function(){t=W('<div style="z-index:99;position:absolute;left:0;top:0;background-color:#fff;opacity:0;filter:alpha(opacity=0);display: none;"></div>').insertTo("beforeend",document.body),t.on("mousedown",n)}),{add:r,remove:i,hide:s,hideAll:n,showBg:o,hideBg:u}}(),yunpan.Menu=function(e){this.config=ObjectH.mix({id:yunpan.id(),listeners:{},dock:"bottom",marginLeft:0,marginTop:0},e,!0),this.oWrap=null,this.oTarget=null,this.currentTarget=null,this.init(),yunpan.menuManager.add(this)},yunpan.Menu.prototype={init:function(){var e=this.config,t=this;html=[],itemTpl='<li {$_attrs} class="item {$cls}"><a class="{$linkCls}" href="#" onclick="return false;"><i class="icon {$iconCls}"></i><span class="text {$textCls}">{$text}</span></a></li>'.tmpl();if(e.items){html.push('<div id="'+e.id+'" style="'+(e.width?"width:"+e.width+"px":"")+'" class="menu menu-sys'+(e.cls?" "+e.cls:"")+'">'),html.push("<ul>"),e.items.forEach(function(e){var t="";if(e.attrs)for(var n in e.attrs)t+=n+'="'+e.attrs[n]+'" ';e._attrs=t,e.iconCls||(e.cls=(e.cls||"")+" icon-none"),html.push(itemTpl(e))}),html.push("</ul>"),html.push("</div>"),this.oWrap=W(html.join("")).insertTo("beforeend",document.body),this.oWrap.on("contextmenu",function(e){e.preventDefault()}),e.delegates?e.delegates.forEach(function(n){n.query?W(n.selector).delegate(n.query,"contextmenu",function(n){if(e.conditionCheck&&!e.conditionCheck(n))return;t.show(n,this),n.stopPropagation()}).on("contextmenu",function(e){e.preventDefault()}):W(n.selector).on("contextmenu",function(n){if(e.conditionCheck&&!e.conditionCheck(n))return;n.target==this&&(t.show(n,this),n.preventDefault())})}):e.target&&(this.oTarget=W(e.target),this.oTarget.on("contextmenu",function(e){e.stopPropagation(),e.preventDefault(),t.show(e,this)}).on("click",function(e){e.stopPropagation(),e.preventDefault(),t.show(e,this)}));var n=this;this.oWrap.query("li").forEach(function(t,r){if(e.items[r].handler){var i=this;W(t).on("click",function(t){var s=e.items[r].handler.bind(i),o=n.oWrap.getRect();s(n.currentTarget,t,o),n.hide()}).on("mousedown",function(e){e.stopPropagation()})}})}},show:function(e,t){this.currentTarget=t;if(ObjectH.isFunction(this.config.listeners.beforeshow)){var n=this.config.listeners.beforeshow.bind(t);n()}var r=0,i=0,s=Dom.getDocRect(),o=this.config.marginLeft,u=this.config.marginTop;if(this.oTarget){var a=this.oTarget.getRect(),f=this.oWrap.getRect();switch(this.config.dock){case"top":r=a.left+o,i=a.top-f.height+u;break;case"right":r=a.left+a.width+o,i=a.top+u;break;case"left":r=a.left-f.width+o,i=a.top+u;break;default:r=a.left+o,i=a.top+a.height+u}r-=s.scrollX,i-=s.scrollY}else{r=e.clientX+o,i=e.clientY+u;var a=this.oWrap.getRect(),s=Dom.getDocRect();a.height+i>s.height&&(i=s.height-a.height),a.width+r>s.width&&(r=s.width-a.width),i<0&&(i=0),r<0&&(r=0)}this.oWrap.css({left:r+"px",top:i+"px"}),yunpan.menuManager.showBg();if(ObjectH.isFunction(this.config.listeners.aftershow)){var n=this.config.listeners.aftershow.bind(t);n()}},hide:function(){this.oWrap.css({left:"-10000px",top:"-10000px"}),yunpan.menuManager.hideBg()}},yunpan.Search=function(){function m(){if(v!=d)return;g(),setTimeout(m,n)}function g(n){if(!s){var r=e.val().toLowerCase();if(r==o&&!n)return;s=!0,r?(o=r,t.forEach(function(e,t){var n=e.oriName.indexOf(o);e.node.query(".text").html(e.name);if(n<0)e.node.hide();else{var r=e.name,i="";if(e.sName.indexOf(o)>=0)i=r.substring(0,n)+'<span class="hl">'+r.substr(n,o.length)+"</span>"+r.substr(n+o.length);else{var s=r.lastIndexOf("..."),u=r.substring(0,s);i=r.substring(0,n)+'<span class="hl">'+u.substr(n)+"</span>"+"..."}e.node.query(".text").html(i),e.node.show()}})):(o="",E()),yunpan.filelist.resizeHolder(),s=!1}}function y(){v==h&&b(),f=yunpan.filelist.path,u.show(),a.hide(),setTimeout(m,n),v=d,monitor.clickLog("\u641c\u7d22")}function b(){r=yunpan.filelist.listtype==2,i=yunpan.filelist.curFunc=="recycle",t.length=0;var e;e=W("#list li"),e.forEach(function(e){e=W(e);var n=e.query(".text").html();t.push({name:n,sName:n.toLowerCase(),oriName:e.attr("data-title").toLowerCase(),node:e})})}function w(){v=p}function E(){t.forEach(function(e,t){e.node.query(".text").html(e.name),e.node.show()})}function S(){try{E()}catch(e){}W("#listHolder .page-nav").show(),v=h,o="",t.length=0,yunpan.filelist.resizeHolder(),u.hide(),a.show()}function x(){f==yunpan.filelist.path?v==p&&(b(),g(!0)):v!=h&&(e.val(""),W("#searchInput").blur(),S())}function T(){e=W("#search .search-text"),a=W("#search .ss-search"),u=W("#search .ss-close"),sPlaceholder=W("#searchPlaceholder"),u.on("click",function(){e.val(""),S()}),l="placeholder"in document.createElement("input"),c=l?"":e.attr("data-placeholder"),e.on("focus",function(){l||sPlaceholder.hide(),y(),W("#listHolder .page-nav").hide()}).on("blur",function(){l||this.value==""&&sPlaceholder.show(),this.value?w():S()}),l?sPlaceholder.hide():(sPlaceholder.show(),sPlaceholder.on("mousedown",function(){sPlaceholder.hide(),setTimeout(function(){e.focus()},10)}))}var e,t=[],n=100,r=!0,i,s=!1,o="",u,a,f="",l,c,h=0,p=1,d=2,v=h;return{init:T,research:x}}(),Dom.ready(function(){yunpan.Search.init()}),function(){function n(t,n,r){e(this,r),e(this,{animFun:t,dur:n,per:0,_status:0}),CustEvent.createEvents(this)}var e=ObjectH.mix,t=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame;e(n.prototype,{isPlaying:function(){return this._status==1},end:function(){this.animFun(1),clearInterval(this.timerId),this.timerId=null,this._status=2,this.fire("end")},step:function(){var e=this,t=(new Date-e._startDate)/e.dur;this.per=Math.min(t,1),this.animFun(this.per);if(this.per==1){this.end();return}},play:function(){var e=this;this._startDate=new Date,this.step();if(t){this.timerId=1;var n=function(){e.timerId&&(t(n),e.step())};t(n)}else this.timerId=setInterval(function(){e.step()},13);this._status=1,this.fire("play")}}),window.Anim=n}(),yunpan.gallary=function(){function Q(){var e=r("div",{className:"imagePreviewmask",tabIndex:-1,unselectable:"on"});return t&&(e.innerHTML='<div unselectable="on"></div><iframe src="'+l+'"></iframe>'),document.body.insertBefore(e,document.body.firstChild),e}function G(){var e=p.offsetParent,t=document.documentElement,n=p.style;if(parseInt(n.top,10)!=e.scrollTop||parseInt(n.left,10)!=e.scrollLeft)n.top=e.scrollTop,n.left=e.scrollLeft;t.clientHeight!=p.offsetHeight&&(n.height=t.clientHeight),t.clientWidth!=p.offsetWidth&&(n.width=t.clientWidth)}function Y(e){var s="my";switch(e){case"link":s="imgList-link";break;case"my":s="imgList-my";break;case"group":s="imgList-group";break;default:}var o=r("div",{id:"imageScreen"}),u=['<div class="hd">','<div class="imgInfo">','<span class="info"></span>','<span class="num">(<span class="currentNum"></span>/<span class="totalNums"></span>)</span>',"</div>",'<div class="toolbar"></div>',"</div>"].join(""),a=['<div class="bd">','<div id="imgList" class="'+s+'"></div>','<div class="preBtnContainer"><a class="preBtn" title="\u4e0a\u4e00\u5f20" href="###" onclick="return false;"></a></div>','<div class="nextBtnContainer"><a class="nextBtn" title="\u4e0b\u4e00\u5f20" href="###" onclick="return false;"></a></div>',"</div>",'<div class="viewMask" style="display:none"></div>','<div class="viewToolbarBack"><div class="viemask"></div>','<div class="viewToolbar"><p class="viewBack">\u5173\u95ed\u539f\u56fe</p></div></div>','<div class="view"><img src="/resource/img/blank.gif" /></div>'].join("");o.innerHTML=u+a,document.body.insertBefore(o,document.body.firstChild),p=p||Q(),i(p,{zIndex:1e4,display:"block"}),t&&(o.style.height=n.getDocRect().height+"px",G(p),clearInterval(d),d=setInterval(G,1e3))}function Z(e){var t=parseInt(e,10);U.setHtml(t+1),z.setHtml(_[t]),P.attr("href",D[t])}function et(e){if(H==1){I.hide(),q.hide(),V.css("cursor","default"),X.css("cursor","default");return}e==0||e==H-1?e==0?(I.hide(),q.show(),V.css("cursor","default"),X.css("cursor","pointer")):(q.hide(),I.show(),V.css("cursor","pointer"),X.css("cursor","default")):(I.show(),q.show(),V.css("cursor","pointer"),X.css("cursor","pointer"))}function tt(){var e=n.getDocRect(),t=e.width,r=e.height;k.W=y*t,k.H=b*(r-120),k.L=(1-y)*t/2,k.T=w*(r-120)+57,k.lW=k.rW=E*t,k.lH=k.rH=S*(r-120),k.lL=k.rR=x*t,k.lT=k.rT=(k.H-k.lH)/2+57,k.rL=(1-x)*t-k.lW,k.llW=k.rrW=T*t,k.llH=k.rrH=N*(r-120),k.llL=k.rrR=C*t,k.llT=k.rrT=(k.H-k.llH)/2+57,k.rrL=(1-C)*t-k.llW,L[4]={w:k.llW,h:k.llH,l:k.llL,t:k.llT},L[3]={w:k.lW,h:k.lH,l:k.lL,t:k.lT},L[2]={w:k.W,h:k.H,l:k.L,t:k.T},L[1]={w:k.rW,h:k.rH,l:k.rL,t:k.rT},L[0]={w:k.rrW,h:k.rrH,l:k.rrL,t:k.rrT}}function nt(e,t){var n=W(e).query("img"),r=n.attr("data-width")|0,i=n.attr("data-height")|0,s=t.w,o=t.h,u=0,a=0,f=i/r;if(s<10||o<10)u=10,a=10;else{var l=r/s,c=i/o;l>1||c>1?l<c?(a=o,u=a/f):(u=s,a=f*u):(u=r,a=i)}var h={width:u,height:a,left:(t.w-u)/2+t.l,top:(t.h-a)/2+t.t};return h}function rt(e){var t=W(e).query("img");t.attr("data-width")|0?it(e):yunpan.util.imgSize(t.attr("data-url"),function(){t.attr({"data-width":this.width,"data-height":this.height,src:t.attr("data-url")}),it(e)})}function it(e){if(!e&&K&&K.isPlaying())return!1;L.length||tt();var t=[];if(e)t.push(e);else for(var n=Math.max(0,F-2);n<=F+2&&n<j.length;n++)j.item(n).attr("data-width")|0&&t.push(B[n]);for(var n=0;n<t.length;n++){var r=t[n],i=!1;for(var s=Math.max(0,F-2);s<=F+2&&n<B.length;s++)if(r===B[s]){var o=nt(r,L[F-s+2]);for(var u in o)o[u]=(o[u]|0)+"px";W(r).css(o).css("zIndex",3-Math.abs(F-s)),s==F&&W(r).addClass("cur"),i=!0;break}W(r).css("display",i?"block":"none")}var a=(L[1].h-43)/2,f=[I,q];for(var n=0;n<2;n++)f[n].css({top:L[1].t-56+a+"px"});et(F)}function st(e,t){var n=[];fromRects=[],toRects=[];for(var r=0;r<e.length;r++){var i=e[r];i&&(n.push(i),fromRects.push({width:parseInt(i.style.width),height:parseInt(i.style.height),left:parseInt(i.style.left),top:parseInt(i.style.top)}),toRects.push(nt(i,L[r])))}K=new Anim(function(e){var t=QW.Easing.easeBothStrong(e);for(var r=0;r<n.length;r++)n[r].style.cssText=["z-index:"+n[r].style.zIndex,"width:"+Math.round(fromRects[r].width+(toRects[r].width-fromRects[r].width)*t)+"px","height:"+Math.round(fromRects[r].height+(toRects[r].height-fromRects[r].height)*t)+"px","left:"+Math.round(fromRects[r].left+(toRects[r].left-fromRects[r].left)*t)+"px","top:"+Math.round(fromRects[r].top+(toRects[r].top-fromRects[r].top)*t)+"px"].join(";")},500,{frameTime:16,onend:t}),K.play()}function ot(e){M.splice(e,1),_.splice(e,1);for(var e=F;e<H;e++){var t=parseInt(W(j[e]).attr("data-index"),10);W(j[e]).attr("data-index",t-1)}if(H==1){lt();return}B.item(F).removeNode(),F==H-1&&F--,B=W("#imgList .bimg"),j=W("#imgList img"),F+2<B.length&&rt(B[F+2]),F-2>0&&rt(B[F-2]),it(),H--,W("#imageScreen .totalNums").setHtml(H),Z(F),et(F)}function ut(){var e=[],t=[],n=W("#imgList"),r=W("#thumList");for(var i=0;i<O.length;i++)e.push('<div class="bimg" style="display:none"><img data-index='+(i+1)+' data-url="'+O[i]+'" data-width="0" data-height="0" src="/resource/img/blank.gif"/></div>');e.push('<div id="imgMask"></div>'),n.html(e.join("")),B=n.query(".bimg"),j=n.query("img");var s=[F,F-1,F+1,F-2,F+2];for(var i=0;i<5;i++)s[i]>=0&&s[i]<B.length&&rt(B[s[i]])}function at(e){if(K&&K.isPlaying())return;W("#delete-confirm").hide();if(e==0){if(F==0||(j.item(F-1).attr("data-width")|0)==0)return;F--}else{if(F==j.length-1||(j.item(F+1).attr("data-width")|0)==0)return;F++}var t=new Array(5);for(var n=Math.max(0,F-3);n<j.length&&n<=F+3;n++){var r=Math.abs(n-F),i=B.item(n),s=j.item(n);i.css({display:r>2||!(s.attr("data-width")|0)?"none":"block",zIndex:3-r}),r==2?rt(B[n]):r<2&&(s.attr("data-width")|0?t[F-n+2]=B[n]:rt(B[n]),r==1&&i.removeClass("cur"),r==0&&i.addClass("cur"))}st(t,function(){monitor.clickLog("gallary\u7ffb\u9875"),Ct&&setTimeout(function(){at(e)},10)}),Z(F),et(F)}function kt(){W("#imageScreen .close").on("click",lt),W("#imageScreen .dow").on("click",ct),W("#imageScreen .sharedow").on("click",ht),W("#imageScreen .del").on("click",mt),W("#delete-confirm .yes").on("click",gt),W("#delete-confirm .no").on("click",yt),W("#imageScreen .nextBtnContainer,#imageScreen .preBtnContainer").on("mouseenter",xt),W("#imageScreen .nextBtnContainer,#imageScreen .preBtnContainer").on("mouseleave",Tt),W("#imageScreen .nextBtnContainer,#imageScreen .preBtnContainer").on("mousedown",bt),W(document).on("keydown",Et),W(document).on("mousewheel",St),W(window).on("resize,scroll",Nt),$.on("dblclick",vt),W("#imageScreen .viewMask").on("dblclick",vt),W("#imageScreen .viewBack").on("click",vt)}function Lt(){W("#imageScreen .close").un("click",lt),W("#imageScreen .dow").un("click",ct),W("#imageScreen .sharedow").un("click",ht),W("#imageScreen .del").un("click",mt),W("#delete-confirm .yes").un("click",gt),W("#delete-confirm .no").un("click",yt),W("#imageScreen .nextBtnContainer,#imageScreen .preBtnContainer").un("mouseenter",xt),W("#imageScreen .nextBtnContainer,#imageScreen .preBtnContainer").un("mouseleave",Tt),W("#imageScreen .nextBtnContainer,#imageScreen .preBtnContainer").un("mousedown",bt),$.un("dblclick",vt),W("#imageScreen .viewMask").un("dblclick",vt),W("#imageScreen .viewBack").un("click",vt),W(document).un("keydown",Et),W(document).un("mousewheel",St),W(window).un("resize,scroll",Nt)}function At(e){var t;e?t=['<p class="close"></p><ul><li class="sharevie"><a href="###" target="_blank">\u67e5\u770b\u539f\u56fe</a>','<div id="delete-confirm" class="delete-confirm" style="display:none;">',"<p>\u786e\u5b9a\u5220\u9664\u6b64\u56fe\u7247\uff1f</p>",'<a class="yes" href="javascript:void(0)">\u786e\u5b9a</a>','<a class="no" href="javascript:void(0)">\u53d6\u6d88</a>',"</div></li>",'<li class="sharedow"><a href="###" onclick="return false;">\u4e0b\u8f7d\u539f\u56fe</a></li>',"</ul>"].join(""):t=['<p class="close"></p><ul>','<li class="vie"><a href="###" target="_blank">\u67e5\u770b\u539f\u56fe</a></li>','<li class="dow"><a href="###" onclick="return false;">\u4e0b\u8f7d\u539f\u56fe</a></li>','<li class="del"><a href="###" onclick="return false;">\u5220\u9664</a>','<div id="delete-confirm" class="delete-confirm" style="display:none;">',"<p>\u786e\u5b9a\u5220\u9664\u6b64\u56fe\u7247\uff1f</p>",'<a class="yes" href="javascript:void(0)">\u786e\u5b9a</a>','<a class="no" href="javascript:void(0)">\u53d6\u6d88</a>',"</div></li>","</ul>"].join(""),W("#imageScreen .toolbar").html(t)}function Ot(e){v||(v=!0,Y(e.pos),I=W("#imageScreen a.preBtn"),q=W("#imageScreen a.nextBtn"),U=W("#imageScreen .currentNum"),z=W("#imageScreen .info"),V=W("#imageScreen .preBtnContainer"),X=W("#imageScreen .nextBtnContainer"),$=W("#imageScreen .view"),J=new QW.SimpleDrag({oSrc:$[0]})),At(e.noDel),M=e.nid,_=e.name,O=e.preview,D=e.pic,H=O.length,F=e.index,W("#imageScreen .totalNums").setHtml(H),e.noDel?P=W("#imageScreen .sharevie a"):P=W("#imageScreen .vie a"),Z(F),ut(),kt(),t?(W("#imageScreen").css("display","block"),W(".imagePreviewmask").css("display","block")):(W("#imageScreen").fadeIn(),W(".imagePreviewmask").fadeIn())}function Mt(e){if(m)return;m=!0,Ot(e)}var e=QW.ObjectH.mix,t=QW.Browser.ie6,n=QW.DomU,r=n.createElement,i=NodeH.setStyle,s=QW.EventTargetH.addEventListener,o=QW.EventTargetH.removeEventListener,u=EventH.getTarget,a=n.getDocRect(),f=EventH.preventDefault,l="about:blank",c=QW.ElAnim,h="",p=0,d=0,v=!1,m=!1,g=null,y=1100/1440,b=560/590,w=30/590,E=250/1440,S=130/590,x=RRStep=55/1440,T=208/1440,N=94/590,C=RRRStep=40/1440,k={},L=[],A={ESC:27,RIGHT:39,LEFT:37,UP:38,DOWN:40,FULL:70},O=[],M,_,D,P,H,B,j,F,I,q,R=a.width,U,z,X,V,$,J=null,K=null,ft,lt=function(){m=!1,t?(W("#imageScreen").css("display","none"),W(".imagePreviewmask").css("display","none")):(W("#imageScreen").fadeOut(),W(".imagePreviewmask").fadeOut()),W("#imgList").html(""),W("#imageScreen .delete-confirm").hide(),W("#thumList").html(""),W("#thumList").css("left","0"),I.hide(),q.hide(),Lt(),J=null,$.css("display","none"),W("#imageScreen .viewMask").css("display","none"),W("#imageScreen .view img").attr("src","/resource/img/blank.gif")},ct=function(){monitor.clickLog("gallary\u4e0b\u8f7d"),W("#imageScreen .delete-confirm").hide();var e=M[F];yunpan.cmdCenter.downloadItem(e)},ht=function(){monitor.clickLog("gallary\u5206\u4eab\u4e0b\u8f7d");var e=M[F];yunpan.cmdCenter.downloadByNid(e)},pt=function(){monitor.clickLog("gallary\u67e5\u770b\u539f\u56fe"),W(document).un("keydown",Et),W(document).un("mousewheel",St)},dt=function(){monitor.clickLog("gallary\u5206\u4eab\u67e5\u770b\u539f\u56fe"
),W(document).un("keydown",Et),W(document).un("mousewheel",St);var e=M[F];yunpan.cmdCenter.viewByNid(e)},vt=function(){$.css("display","none"),W("#imageScreen .viewMask").css("display","none"),W("#imageScreen .view img").css("display","none"),W("#imageScreen .viewToolbarBack").hide(),W(document).on("keydown",Et),W(document).on("mousewheel",St)},mt=function(){var e=W("#imageScreen .delete-confirm");e.removeClass("view-tip"),e.show()},gt=function(e){monitor.clickLog("gallary\u5220\u9664"),e.stopPropagation();var t=M[F],n=W("#imageScreen .delete-confirm"),r=yunpan.fo.getAllFile().filter(function(e){return e.attr("data-nid")==t})[0],i=[r.attr("data-path")],s=r.attr("data-nid");Ajax.post(yunpan.config.url.delToRecyle,{"path[]":i,"nids[]":s},function(e){e=e.evalExp();if(e.errno)n.hide(),yunpan.filelist.list();else{n.hide();try{r.removeNode()}catch(t){}yunpan.fo.initFileIndex(),yunpan.userInfo.updateDiskInfo(),yunpan.fo.getFileNum()<1&&yunpan.filelist.page>0&&(yunpan.filelist.page=yunpan.filelist.page-1),yunpan.filelist.list(),yunpan.cmdCenter.updateStatus()}}),ot(F)},yt=function(e){e.stopPropagation(),W("#imageScreen .delete-confirm").hide()},bt=function(e){W(this).hasClass("preBtnContainer")?at(0):at(1)},wt=function(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()},Et=function(e){switch(e.keyCode){case A.ESC:lt();break;case A.LEFT:case A.UP:e.preventDefault(),at(0);break;case A.RIGHT:case A.DOWN:e.preventDefault(),at(1);break;case A.FULL:wt();break;default:}},St=function(e){e.preventDefault();var t=e.wheelDelta?e.wheelDelta/120:-e.detail/3;t>0?at(0):at(1)},xt=function(e){e.preventDefault(),W(this).hasClass("preBtnContainer")?I.addClass("preBtnHover"):q.addClass("nextBtnHover")},Tt=function(e){e.preventDefault(),W(this).hasClass("preBtnContainer")?I.removeClass("preBtnHover"):q.removeClass("nextBtnHover")},Nt=function(){clearTimeout(ft),ft=setTimeout(function(){tt(),it(),R=n.getDocRect().width,windowHeight=n.getDocRect().height,W("#imageScreen").css("height",windowHeight+"px")},10)},Ct=!1;return{show:Mt}}(),yunpan.cmdCenter=ObjectH.mix(yunpan.cmdCenter||{},function(){function u(r,u){e=r,t=u,n=W("#newLinkDia"),i=n.query(".msg-left"),s=n.query(".msg-left-tip"),o=W("#mailList"),n.query(".msg-total").html(t),i.html(e),e==0?i.addClass("zero-left"):i.removeClass("zero-left"),e<=5?s.show():s.hide()}function a(e){var t=/^\w[_\.\w-]{0,31}@(\w[\w-]{0,30}\w\.){1,4}[a-z]{2,4}$/,n=/^1[358]\d{9}$/;return t.test(e)?1:n.test(e)?2:0}function f(e){var t=/[\,\uff0c\uff0c\uff0c\uff1b\uff1b\uff1b\;\s\u3000\u3000\u3000]/g;return t.exec(e)?!0:!1}function l(e){var t=/[\,\uff0c\uff0c\uff0c\uff1b\uff1b\uff1b\;\s\u3000\u3000\u3000]/g,n=e.replace(t,"");return n}function c(e,t,n){var r=t.getRect(),i=n.getRect();r.top-i.top<30?(e.removeClass("up"),e.addClass("down"),e.css("top",r.top-i.top+11+"px")):(e.removeClass("down"),e.addClass("up"),e.css("top",r.top-i.top+r.height+56+"px")),r.left-i.left>200?(e.removeClass("mid"),e.css("left","200px"),e.query(".tip-arrow").css("left",r.left-i.left-150+"px")):(e.hasClass("mid")||e.addClass("mid"),e.css("left",r.left-i.left+30+"px"),e.query(".tip-arrow").css("left","9px"))}function h(){var e=W(".mail-input input"),t=o.lastChild();if(t&&t.length){var n=t.getRect(),r=W(".mail-input").getRect(),i=n.width+n.left,s=r.left+r.width-i-35;s<e.getValue().byteLen()*8?e.css("width","338px"):e.css("width",s+"px"),r=W(".mail-input").getRect();var u=r.height-46;W("#newLinkDia .ac_wrap").css("top",94+u+"px"),W("#newLinkDia .mail-content").css("top",103+u+"px")}}function p(t,r,o){var u=n.query(".msg-limit-tip"),a=n.query(".send-btn");r.hasClass("phone")&&(e++,i.html(e),e<0&&i.html(0),e>0&&(i.removeClass("zero-left"),i.html(e)),e<=5?s.show():s.hide(),!r.hasClass("exceed")&&W("#mailList .exceed").length&&W("#mailList .exceed").item(0).removeClass("exceed"),u.hide()),r.removeNode(),W("#mailList li").length||yunpan.cmdCenter.resetInput(o),W("#mailList li.correct").length-W("#mailList li.exceed").length<=0&&!a.hasClass("disabled")&&a.addClass("disabled"),h(),o.show()}function d(t){var u=W("#mailList"),f=n.query(".mail-input"),d=n.query(".send_share"),v=n.query(".msg-limit-tip"),m=n.query(".mail-tip");r=n.query(".send-btn");var g=t.getValue();g=l(g),t.val("");if(g&&g.length){var y;if(a(g)==1){y="correct mail";if(g.length>40){var b="..."+g.substring(g.indexOf("@")-2,g.length),w=40-b.length,E=g.substring(0,w);g=E+b}}else a(g)==2?y="correct phone":(y="error",g.byteLen()>45&&(g=g.subByte(43,"...")));t.hide();var S=W('<li class="'+y+'"><span class="msg-limit"></span><span class="mail-str">'+g+'</span><span class="cancel"></span></li>').insertTo("beforeend",u);o.show(),S.query(".cancel").on("click",function(){p(u,S,t)}),S.on("mouseenter",function(){S.addClass("hover")}).on("mouseleave",function(){S.removeClass("hover")}),S.hasClass("phone")&&(e--,i.html(e),e<0&&(S.addClass("exceed"),setTimeout(function(){c(v,S,f),Browser.ie==6?(v.show(),setTimeout(function(){v.hide()},3e3)):v.fadeIn(1,function(){setTimeout(function(){v.fadeOut(500)},3e3)})},50),S.on("mouseenter",function(e){W(e.target).hasClass("exceed")&&setTimeout(function(){c(v,S,f),Browser.ie==6?v.show():v.fadeIn(1)},50)}).on("mouseleave",function(e){W(e.target).hasClass("exceed")&&v.hide()})),e<=0&&(i.addClass("zero-left"),i.html(0)),e<=5?s.show():s.hide()),o.query("li")&&o.query("li").length>=20&&(W(".mail-input input").hide(),W("#newLinkDia .ac_wrap").hide(),W("#newLinkDia .ctrl-count-tip").show(),setTimeout(function(){W("#newLinkDia .ctrl-count-tip").fadeOut(500)},3e3)),t.setValue(""),f[0].scrollTop=1e4,o.query("li.correct").length-o.query("li.exceed").length>0&&r.hasClass("disabled")&&r.removeClass("disabled");var x=o.lastChild();x&&x.length&&setTimeout(function(){S.hasClass("error")&&(c(m,S,f),Browser.ie==6?(m.show(),setTimeout(function(){m.hide()},3e3)):m.fadeIn(1,function(){setTimeout(function(){m.fadeOut(500)},3e3)})),o.query("li")&&o.query("li").length<20&&(h(),t.show(),window._shareFocusIpt!="vc"&&t.focus())},100)}else o.query("li").length||yunpan.cmdCenter.resetInput(t)}function v(e){var t=new ComboBox({oText:e[0],refreshData:function(){var e=this.oText.value.split("@")[0],t=(this.oText.value.split("@")[1]||"").toLowerCase(),n=["","@sina.com","@163.com","@qq.com","@126.com","@vip.sina.com","@sina.cn","@hotmail.com","@gmail.com","@sohu.com","@yahoo.com","@139.com","@wo.com.cn","@189.cn"],r=[];for(var i=0;i<n.length;i++)n[i].indexOf(t)>-1&&r.push(e+n[i]);this.itemsData=r},onselectitem:function(){var t=this;d(e)},onenter:function(){d(e)}})}function g(e,t,r){if(!m){var i=['<div id="sendLinkMask">','<div class="ok"><div class="okbg">\u5df2\u6210\u529f\u53d1\u9001','<span class="mail_msg"></span>','</div> <p class="other_msg"></p><p>\u60a8\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u5206\u4eab\u3002</p>',"</div>",'<div class="bg"></div>','<div class="error"><p class="errorbg">\u7f51\u7edc\u6545\u969c\uff0c\u672a\u53d1\u9001\u6210\u529f\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002</p><div class="ok-btn">\u786e\u5b9a</div></div>',"</div>"].join("");m=W(i).insertTo("beforeend",n.parentNode(".panel")),W("#sendLinkMask .ok-btn").on("click",function(){W("#sendLinkMask").hide()})}W("#sendLinkMask .mail").html(t),W("#sendLinkMask .msg").html(r);var s=W("#sendLinkMask .only-mail"),o=W("#sendLinkMask .mail_msg"),u=W("#sendLinkMask .other_msg");olMsg=W("#sendLinkMask .only-msg"),both=W("#sendLinkMask .both"),warning=W("#sendLinkMask .error");switch(e){case 0:W("#sendLinkMask .ok").show(),o.html(' <span class="mail">'+t+"</span> \u5c01\u90ae\u4ef6\u3002").show(),r==-2?u.html("\u77ed\u4fe1\u56e0\u540c\u4e00IP\u6bcf\u65e5\u53d1\u9001\u9650\u5236\uff0c\u53d1\u9001\u5931\u8d25").show():u.hide(),warning.hide();break;case 1:W("#sendLinkMask .ok").show(),o.html(' <span class="msg">'+r+"</span> \u6761\u77ed\u4fe1\u3002").show(),u.hide(),warning.hide();break;case 2:W("#sendLinkMask .ok").show(),o.html(' <span class="mail">'+t+'</span> \u5c01\u90ae\u4ef6\uff0c <span class="msg">'+r+"</span> \u6761\u77ed\u4fe1\u3002").show(),u.hide(),warning.hide();break;case 3:r==-2?warning.query(".errorbg").html("\u77ed\u4fe1\u56e0\u540c\u4e00IP\u6bcf\u65e5\u53d1\u9001\u9650\u5236\uff0c\u53d1\u9001\u5931\u8d25"):warning.query(".errorbg").html("\u7f51\u7edc\u6545\u969c\uff0c\u672a\u53d1\u9001\u6210\u529f\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002"),W("#sendLinkMask .ok").hide(),warning.show()}var a=W("#newLinkDia").parentNode(".panel"),f=a.getRect();W("#sendLinkMask").css("width",f.width-2+"px"),W("#sendLinkMask").css("height",f.height-2+"px").show(),W("#sendLinkMask .bg").css("width",f.width-2+"px"),W("#sendLinkMask .bg").css("height",f.height-2+"px").show(),e!=3&&setTimeout(function(){W("#sendLinkMask").fadeOut(500),yunpan.cmdCenter.resetInput(n.query(".mail-input input"))},3e3)}function y(t,u){var a=W("#mailList li"),f="";for(var l=0,c=a.length;l<c;l++)if(W(a[l]).hasClass("correct")){var h=W(a[l]).query(".mail-str").html();f+=h+";"}var p=n.query(".add_input_box"),d=n.query(".add_content_finish");try{p.query("input").blur()}catch(v){}var m=d.query("span").attr("data-text"),y=u.substring(u.lastIndexOf("/")+1,u.length),b=1;if(f.length&&b){b=0;var w=new Ajax({url:"/share/sendSmsOremail/",method:"post",data:{sendlist:f,shorturl:y,captcha:t,notes:m},onsucceed:function(){var t=this.requester.responseText.evalExp(),u=parseInt(t.errno,10);b=1;if(u===0){var a=t.data.msgprompt.retstatus,f=t.data.msgprompt.retmsg;if(f.length)if(a===-1)yunpan.Msg.alert(f,{type:"error"});else{o.html(""),yunpan.cmdCenter.resetAddStatus("a"),yunpan.cmdCenter.resetTextarea(n.query(".add_input_box textarea")),W("#newLinkDia .link-oper .tip").hide(),r.addClass("disabled");var l=t.data.msgprompt.sucess_mail_count,c=t.data.msgprompt.sucess_sms_count,h=0;e=t.data.surplus_sms_share_count,c==-1&&(e=0),baseLeft=e,e<=5?s.show():s.hide(),i.html(e),e==0?i.addClass("zero-left"):i.removeClass("zero-left"),l>0&&c<=0?h=0:l<=0&&c>0?h=1:l>0&&c>0?h=2:l<=0&&c<=0&&(h=3),g(h,l,c),monitor.tlog({m:"share",a:"20130106-send",n:l<=0?0:l,n1:c<=0?0:c})}}else if(u===26020)W("#newLinkDia .verify_code .vc-tip").html("\u9a8c\u8bc1\u7801\u8f93\u5165\u9519\u8bef");else if(u==26039){var p=W("#newLinkDia .add_err_tip");p.query("span").html("\u53d1\u9001\u5931\u8d25\uff0c\u9644\u8a00\u4e2d\u5305\u542b\u4e0d\u5b9c\u4f20\u64ad\u7684\u5185\u5bb9"),Browser.ie==6?(p.show(),setTimeout(function(){p.hide()},5e3)):p.fadeIn(1,function(){setTimeout(function(){p.fadeOut(500)},5e3)})}else if(u==26038){var p=W("#newLinkDia .add_err_tip");p.query("span").html("\u53d1\u9001\u5931\u8d25\uff0c\u9644\u8a00\u8fc7\u957f\uff0c\u8bf7\u4fee\u6539"),Browser.ie==6?(p.show(),setTimeout(function(){p.hide()},5e3)):p.fadeIn(1,function(){setTimeout(function(){p.fadeOut(500)},5e3)})}else if(u==26042){var p=W("#newLinkDia .add_err_tip");p.query("span").html(t.errmsg),Browser.ie==6?(p.show(),setTimeout(function(){p.hide()},5e3)):p.fadeIn(1,function(){setTimeout(function(){p.fadeOut(500)},5e3)})}else g(3,0,0);yunpan.cmdCenter.refreshVerifyCode()},onerror:function(){b=1,g(3,0,0)}});w.send()}}var e,t,n,r,i,s,o,m;return{initMsgNum:u,initSuggest:v,isFinish:f,resizeInput:h,sendLinkUrl:y,completeInput:d,removeLiNode:p}}()),yunpan.cmdCenter=ObjectH.mix(yunpan.cmdCenter||{},function(){function createLinkDia(e){var t="\u5206\u4eab\uff1a"+e.subByte("30","\u2026");linkDia=yunpan.dialog.create({title:t,wrapId:"shareLinkDia",body:linkDiaHtml}),linkDiaWrap=W("#newLinkDia"),linkDia.on("aftershow",function(){var e=linkDiaWrap.query(".copy_link_box"),t=e.query(".copy_link"),n=linkDiaWrap.query(".link_url input"),r=linkDiaWrap.query(".cp-link-tip");if(!t.hasClass("clip-on")){var i={box:e,btn:t,text:n.val(),listeners:{aftercopy:function(e){doShare=!0,monitor.clickLog("\u590d\u5236\u5206\u4eab\u5730\u5740"),e?(r.query(".cp-result").html("\u590d\u5236\u6210\u529f"),r.replaceClass("copy-failure","copy-success"),r.show(),Browser.ie==6?setTimeout(function(){r.hide()},1e3):setTimeout(function(){r.fadeOut(500)},1e3)):(r.query(".cp-result").html('\u62b1\u6b49\uff0c\u60a8\u4f7f\u7528\u7684\u6d4f\u89c8\u5668\u91cc\u4e0d\u80fd\u81ea\u52a8\u590d\u5236\u5230\u526a\u8d34\u677f\u3002\u8bf7\u4f7f\u7528CTRL+C\u6216\u9f20\u6807\u53f3\u952e\u83dc\u5355\u590d\u5236\u94fe\u63a5<span class="cancel"></span>'),r.replaceClass("copy-success","copy-failure"),r.show(),r.query(".cancel").on("click",function(){r.hide()})),monitor.yplog(301,{url:i.text||""})},beforecopy:function(e){e.setText(n)}}};new yunpan.CopyClip(i),t.addClass("clip-on")}}),linkDiaWrap.query(".share_to_sns a").on("click",function(){doShare=!0}),bindTabClickEvent(),bindLinkBtns(),bindMailInputEvent(),bindPwdClickEvent(),bindPlaceholderClick(),bindTextPlaceholderClick(),bindVerifyCodeEvent(),bindCancelShare(),bindOKBtn(),bindAddBtn(),bindAddInput(),bindAddModify(),adjustAddInput()}function showLinkDia(e,t){conf=e,result=t,linkDia||createLinkDia(conf.linkName),linkDiaWrap.query(".tab_trigger_li").removeClass("active_tab"),linkDiaWrap.query(".tab_content_li").removeClass("show_tab"),linkDiaWrap.query(".link_url_trigger").addClass("active_tab"),linkDiaWrap.query(".link_url").addClass("show_tab"),linkDiaWrap.query(".tab_arrow").set("className","tab_arrow tab1"),linkDia.show(),initLinkDia(conf),monitor.yplog(302,{url:result.data.url})}function initLinkDia(e){var t=linkDiaWrap.query(".mail-input input");resetInput(t),resetAddStatus("a"),initLinkBtnTips(),initLinkUrl(e.linkUrl,e.password),initPassword(e.password),initTitle(e.linkName),initAddContent(),yunpan.cmdCenter.initMsgNum(e.msgLeft,e.msgTotal),yunpan.cmdCenter.init_share_href(e.type,result.data),refreshVerifyCode();try{hideDia(cancelShareDia,cancelShareBg)}catch(n){}linkDiaWrap.query(".add_input_box textarea").val(""),t.on("focus",function(){window._shareFocusIpt="mail"}),linkDiaWrap.query(".vc_content input").on("focus",function(){window._shareFocusIpt="vc"})}function initLinkBtnTips(){linkDiaWrap.query(".send-btn").addClass("disabled"),yunpan.tips.hide(),linkDiaWrap.query(".tip").hide(),linkDiaWrap.query(".msg-limit-tip").hide(),linkDiaWrap.query(".verify_code .vc-tip").html("")}function initPassword(e){e&&e.length?(linkDiaWrap.query(".head").addClass("psw_on"),linkDiaWrap.query(".psw_switch").attr("data-psw","on").html("\u53d6\u6d88\u8bbf\u95ee\u5bc6\u7801"),linkDiaWrap.query(".code").html(e),setLinkDiaPwd(1,e)):(linkDiaWrap.query(".head").removeClass("psw_on"),linkDiaWrap.query(".psw_switch").attr("data-psw","off").html("\u7ed9\u5206\u4eab\u52a0\u5bc6\u7801"),linkDiaWrap.query(".password").hide(),linkDiaWrap.query(".mail-content .ispassword").hide())}function initLinkUrl(e,t){t&&t.length?(linkDiaWrap.query(".link_url input").val(e+" \uff08\u8bbf\u95ee\u5bc6\u7801\uff1a"+t+"\uff09"),linkDiaWrap.query(".copy_link").html("\u590d\u5236\u94fe\u63a5\u548c\u5bc6\u7801")):(linkDiaWrap.query(".link_url input").val(e),linkDiaWrap.query(".copy_link").html("\u590d\u5236\u94fe\u63a5")),linkDiaWrap.query(".mail-content .linkurl").html(e),linkDiaWrap.query(".others .goto_link").set("href",e).click(function(){monitor.clickLog("\u67e5\u770b\u5206\u4eab\u5730\u5740")})}function initTitle(e){var t=e.subByte("30","\u2026");linkDiaWrap.parentNode(".panel-content").query(".hd h3").html("\u5206\u4eab\uff1a"+t),t=t.split("").join("<wbr>"),linkDiaWrap.query(".fix_content .file_name").html("\u201c"+t+"\u201d")}function initAddContent(){linkDiaWrap.query(".add_btn").show(),linkDiaWrap.query(".add_input_box").hide(),linkDiaWrap.query(".add_content_finish").hide()}function resetInput(e){W("#mailList").html("").hide();var t=linkDiaWrap.query(".placeholder"),n=e.getRect(),r=linkDiaWrap.query(".mail-input").getRect(),i=n.left-r.left+1,s=n.top-r.top;linkDiaWrap.query(".placeholder").setStyle({left:i+"px",top:s+"px"}),e.attr("data-name","false"),e.css("width","338px"),t.show(),e.show(),t.html("\u8bf7\u8f93\u5165\u90ae\u7bb1\u6216\u624b\u673a\u53f7\uff0c\u7528\u9017\u53f7\u3001\u5206\u53f7\u6216\u7a7a\u683c\u5206\u9694");try{e.focus()}catch(o){}Browser.ie==6?(linkDiaWrap.query(".ac_wrap").css("top","123px"),linkDiaWrap.query(".mail-content").css("top","132px")):(linkDiaWrap.query(".ac_wrap").css("top","94px"),linkDiaWrap.query(".mail-content").css("top","103px"))}function resetTextarea(e){var t="\u8bf7\u8f93\u5165\u9644\u8a00\uff0864\u4e2a\u5b57\u4ee5\u5185\uff09",n=linkDiaWrap.query(".add_input_box label");n.show(),e.val(""),e.attr("data-name","false"),adjustAddInput()}function showDia(e){var t=e.dia,n=e.bg;if(!t){t=W(dialogStruct),t.insertTo("beforeend",e.targetBox);var r=linkDiaWrap.parentNode(".panel-content").getRect(),i=r.width,s=r.height;n=W('<div id="'+e.id+'Bg" style="z-index:5;position:absolute;left:0;top:0;bottom:0;right:0;width:'+i+"px;height:"+s+'px;background-color:#fff;opacity:0;filter:alpha(opacity=0);display: none;"></div>').insertTo("afterend",t),n.on("mousedown",function(){hideDia(t,n)}),t.query(".ok").on("click",function(r){r.preventDefault();var i=e.okFunc;i&&typeof i=="function"&&i(),hideDia(t,n)}),t.query(".no").on("click",function(r){r.preventDefault();var i=e.noFunc;i&&typeof i=="function"&&i(),hideDia(t,n)})}var o=e.addElement||"";return t.query(".add_element").html(o),t.set("className",e.cls),t.attr("id",e.id),t.query(".text").html(e.text),t.query(".ok").html(e.okText),t.query(".no").html(e.noText),t.css("left",diaPosition.dia),n.css("left",diaPosition.bg),t.show(),n.show(),{dia:t,bg:n}}function hideDia(e,t){t.css("left","-10000px"),e.css("left","-10000px")}function showCancelShareDia(e){var t=showDia(e);cancelShareDia=t.dia,cancelShareBg=t.bg}function cancelLink(e){if(!yunpan.isLogin())return!1;var t="/share/cancelLink",n=conf.linkUrl,r=n.substring(n.lastIndexOf("/")+1,n.length);Ajax.post(t,{name:r,shorturl:r},function(e){var t=e.evalExp();t.errno==0?yunpan.tips.show("\u53d6\u6d88\u5206\u4eab\u6210\u529f\uff01"):(yunpan.tips.hide(),yunpan.Msg.alert(t.errmsg,{type:"error"})),yunpan.filelist.list(null,null,null,conf.indexes)})}function bindCancelShare(){var e=linkDiaWrap.query(".cancel_share");e.on("click",function(e){e.preventDefault(),monitor.clickLog("cancel_share_btn in linkDia"),confOfCancelDia={dia:cancelShareDia,bg:cancelShareBg,id:"cancelShareDia",cls:"normal_dia bottom cancel_dia cancelShareDia_bottom",text:"\u53d6\u6d88\u6b64\u6b21\u5206\u4eab\uff1f",okText:"\u53d6\u6d88\u5206\u4eab",noText:"\u6682\u4e0d\u53d6\u6d88",okFunc:function(){monitor.clickLog("cancel_confirm_btn in cancelDia"),cancelLink(conf.items),linkDia.hide()},targetBox:linkDiaWrap.parentNode(".panel")},showCancelShareDia(confOfCancelDia)})}function bindPlaceholderClick(){var e=linkDiaWrap.query(".placeholder");e.on("click",function(){linkDiaWrap.query(".mail-input input").focus()})}function bindTextPlaceholderClick(){var e=linkDiaWrap.query(".add_input_box label");e.on("click",function(){linkDiaWrap.query(".add_input_box textarea").focus()}).on("mousedown",function(){clickBtns=!0,setTimeout(function(){blurTextarea||(clickBtns=!1)},200)})}function bindLinkBtns(){linkDiaWrap.query(".manage_share").on("click",function(){linkDia.hide(),yunpan.cmdCenter.gotoLink(),yunpan.cmdCenter.updateNav(),monitor.clickLog("\u7ba1\u7406\u6211\u7684\u5206\u4eab")}),linkDiaWrap.query(".link_url input").on("mouseover",function(){W(this).select()});var e=linkDiaWrap.query(".verify_code .vc-tip"),t=linkDiaWrap.query(".verify_code input");linkDiaWrap.query(".send-btn").on("click",function(){W(this).hasClass("disabled")||(t.val().length?isLegalVerifyCode(t.val())?setTimeout(function(){yunpan.cmdCenter.sendLinkUrl(t.val(),conf.linkUrl)},200):e.html("\u9a8c\u8bc1\u7801\u8f93\u5165\u9519\u8bef"):e.html("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"))}),linkDiaWrap.query(".verify_code .refresh").on("click",refreshVerifyCode),W("body").delegate("#newLinkDia .add_err_tip .close_btn","click",function(e){e.preventDefault(),W(this).parentNode(".add_err_tip").hide()})}function bindMailInputEvent(){var e=linkDiaWrap.query(".mail-input input"),t=linkDiaWrap.query(".placeholder"),n=[108,13,188,32,186];yunpan.cmdCenter.initSuggest(e),e.on("keydown",function(n){var r=W("#mailList li");e.attr("data-name")==="false"&&n.keyCode!=8&&n.keyCode!=13&&(t.hide(),e.attr("data-name","true")),r.length>=20&&e.hide(),n.keyCode===8&&!r.length&&e.val().length==1&&resetInput(e),n.keyCode===8&&r.length&&(e.val().length||yunpan.cmdCenter.removeLiNode(r,r.item(r.length-1),e))}).on("keyup",function(t){var r=W("#mailList li");r.length<20?linkDiaWrap.query(".ac_wrap .selected").length||n.indexOf(t.keyCode)>=0&&(t.keyCode===32?yunpan.cmdCenter.isFinish(W(this).getValue())&&yunpan.cmdCenter.completeInput(e):yunpan.cmdCenter.completeInput(e)):e.hide(),yunpan.cmdCenter.resizeInput()}).on("blur",function(){var t=W("#mailList li");t.length<20&&setTimeout(function(){e.attr("data-name")!="false"&&yunpan.cmdCenter.completeInput(e)},16)})}function bindPwdClickEvent(){var e=linkDiaWrap.query(".psw_switch");e.on("click",function(){var t;e.attr("data-psw")=="off"?(t=1,monitor.clickLog("\u52fe\u9009\u8bbf\u95ee\u5bc6\u7801")):(t=0,monitor.clickLog("\u53d6\u6d88\u52fe\u9009\u8bbf\u95ee\u5bc6\u7801")),createPassword(t,conf.linkUrl)}),linkDiaWrap.query(".password label").on("mouseenter",function(){e[0].checked==0&&linkDiaWrap.query(".pwd-tip").show()}).on("mouseout",function(){linkDiaWrap.query(".pwd-tip").hide()})}function bindTabClickEvent(){function r(e){var t=linkDiaWrap.query(".tab_content_li[data-tabid='"+e+"']");return t}var e=linkDiaWrap.query(".tab_trigger_li"),t=e.query("a"),n=linkDiaWrap.query(".tab_content_li");t.forEach(function(t){W(t).on("click",function(){var i=W(t).parentNode("li");if(!i.hasClass("active_tab")){e.removeClass("active_tab"),i.addClass("active_tab"),n.removeClass("show_tab");var s=W(this).attr("data-tabid");targetContentTab=r(s).addClass("show_tab"),s=s.replace("#",""),linkDiaWrap.query(".tab_arrow").set("className","tab_arrow "+s),targetContentTab.hasClass("send_share")&&(targetContentTab.query(".mail-input input").focus(),W("#mailList li").length||resetInput(targetContentTab.query(".mail-input input")))}})})}function bindVerifyCodeEvent(){var e=linkDiaWrap.query(".verify_code input");e.on("blur",function(){if(!linkDiaWrap.query(".send-btn").hasClass("disabled")){var t=linkDiaWrap.query(".verify_code .vc-tip");e.val().length?isLegalVerifyCode(e.val())?t.html(""):t.html("\u9a8c\u8bc1\u7801\u8f93\u5165\u9519\u8bef"):t.html("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801")}}).on("keydown",function(){})}function bindOKBtn(){linkDiaWrap.query(".others .ok_btn").on("click",function(){linkDia.hide()})}function bindAddBtn(){var e=linkDiaWrap.query(".add_btn"),t=linkDiaWrap.query(".add_input_box"),n=linkDiaWrap.query(".add_content_finish");e.on("click",function(n){n.preventDefault();if(e.parentNode(".add_btn_box").css("display")=="none")return;resetTextarea(t.query("textarea")),resetAddStatus("b"),setTimeout(function(){t.query("textarea").focus(),t.query("textarea")[0].onblur=bindAddInputBlur},100)})}function bindAddInput(){var e=linkDiaWrap.query(".add_btn"),t=linkDiaWrap.query(".add_input_box"),n=linkDiaWrap.query(".add_content_finish"),r=t.query("label"),i=t.query("textarea");i.on("keydown",function(e){i.attr("data-name")==="false"&&e.keyCode!=8&&e.keyCode!=13&&(r.hide(),i.attr("data-name","true"))}).on("keyup",function(e){(e.keyCode==8||e.keyCode==46)&&!i.val().length&&resetTextarea(i)}),i[0].oninput=function(){restrictMaxLength(i,64)},i[0].onpropertychange=function(){restrictMaxLength(i,64)}}function restrictMaxLength(e,t){var n=e.val();n.length>64&&e.val(n.substring(0,64))}function adjustAddInput(){function o(e){var n=t.val();n.length>64&&t.val(n.substring(0,64)),Browser.ie||(t[0].style.height=0);var r=t[0].scrollHeight;Browser.firefox||(r-=6),r<i&&(r=i),r>s?(r=s,t[0].style.overflowY="scroll"):t[0].style.overflowY="hidden",t[0].style.height=r+"px"}var e=linkDiaWrap.query(".add_input_box"),t=e.query("textarea"),n=1,r=3,i=n*18,s=r*18;t[0].style.height=i+"px",t.on("keyup",o),t.on("keydown",o),t.on("mouseup",o)}function bindAddInputBlur(){blurTextarea=!0,setTimeout(function(){blurTextarea=!1;var e=linkDiaWrap.query(".add_btn"),t=linkDiaWrap.query(".add_input_box"),n=linkDiaWrap.query(".add_content_finish");if(!t.isVisible())return;if(clickBtns){clickBtns=!1;return}var r=t.query("textarea").val();r=r.replace(/(^\s*)|(\s*$)/g,"");if(!r.length)resetAddStatus("a");else{var i=r;r=r.split("").join("<wbr>"),n.query("span").attr("data-text",i).html("\u9644\u8a00\uff1a "+r+' <a class="modify_btn" href="###">[\u4fee\u6539]</a>'),resetAddStatus("c")}t.query("textarea").onblur=null},100)}function bindAddModify(){var e=linkDiaWrap.query(".add_input_box"),t=linkDiaWrap.query(".add_content_finish");W("body").delegate(".modify_btn","click",function(n){var r=t.query("span").attr("data-text");n.preventDefault(),e.query("textarea").val(r);if(t.css("display")=="none")return;resetAddStatus("b"),setTimeout(function(){e.query("textarea").focus(),e.query("textarea")[0].onblur=bindAddInputBlur},100)})}function resetAddStatus(e){var t=linkDiaWrap.query(".add_btn"),n=linkDiaWrap.query(".add_input_box"),r=linkDiaWrap.query(".add_content_finish");e=="a"?(t.parentNode(".add_btn_box").show(),n.hide(),n.query(".textarea").val(""),r.hide(),r.query("span").attr("data-text","").html("")):e=="b"?(t.parentNode(".add_btn_box").hide(),n.show(),r.hide(),r.query("span").attr("data-text","").html("")):(t.parentNode(".add_btn_box").hide(),n.hide(),n.query(".textarea").val(""),r.show())}function isLegalVerifyCode(e){var t=/^\d{4}$/;if(t.test(e))return!0}function refreshVerifyCode(){var e="http://captcha.360.cn/image.php?app=ypshare&t=",t=(new Date).getTime(),n=e+t;linkDiaWrap.query(".verify_code img").attr("src",n),linkDiaWrap.query(".verify_code input").val("")}function setLinkDiaPwd(e,t,n){e?yunpan.filelist.curFunc=="file"?(linkDiaWrap.query(".head").addClass("psw_on"),linkDiaWrap.query(".psw_switch").attr("data-psw","on").html("\u53d6\u6d88\u5206\u4eab\u5bc6\u7801"),linkDiaWrap.query(".password .code").html(t),linkDiaWrap.query(".password").show(),linkDiaWrap.query(".link_url input").val(conf.linkUrl+" \uff08\u8bbf\u95ee\u5bc6\u7801\uff1a"+t+"\uff09"),linkDiaWrap.query(".copy_link").html("\u590d\u5236\u94fe\u63a5\u548c\u5bc6\u7801"),linkDiaWrap.query(".mail-content .ispassword span").html(t),linkDiaWrap.query(".mail-content .ispassword").show()):yunpan.filelist.curFunc=="link"&&n&&typeof n=="function"&&n(t):yunpan.filelist.curFunc=="file"?(linkDiaWrap.query(".head").removeClass("psw_on"),linkDiaWrap.query(".psw_switch").attr("data-psw","off").html("\u7ed9\u5206\u4eab\u52a0\u5bc6\u7801"),linkDiaWrap.query(".password").hide(),linkDiaWrap.query(".link_url input").val(conf.linkUrl),linkDiaWrap.query(".copy_link").html("\u590d\u5236\u94fe\u63a5"),linkDiaWrap.query(".mail-content .ispassword").hide()):yunpan.filelist.curFunc=="link"&&n&&typeof n=="function"&&n()}function createPassword(issetpassword,longurl,callback){var shorturl=longurl.substring(longurl.lastIndexOf("/")+1,longurl.length),url="/share/setLinkPassword/",params={shorturl:shorturl,issetpassword:issetpassword};Ajax.post(url,params,function(response){response=eval("("+response+")");var error_no=parseInt(response.errno,10);if(error_no===0){var password="";response.data&&(password=response.data.linkpassword),password&&password.length&&issetpassword?setLinkDiaPwd(issetpassword,password,callback):issetpassword||setLinkDiaPwd(issetpassword,password,callback)}})}var password,linkDiaWrap,linkDia,linkUrl,result,conf,diaRect,cancelShareDia,cancelShareBg,confOfCancelDia,linkDiaHtml='<div id="newLinkDia"> <div class="head"> <span class="title_suc psw_off">\u5df2\u6210\u529f\u521b\u5efa\u5206\u4eab\u94fe\u63a5</span> <span class="password">\uff08\u8bbf\u95ee\u5bc6\u7801\uff1a <span class="code"></span>\uff09 </span> <a href="###"onclick="return false"class="psw_switch"data-psw="off">\u7ed9\u5206\u4eab\u52a0\u5bc6\u7801</a> </div> <div class="tab_wrap"> <ul class="tab_trigger_ul"> <li class="tab_trigger_li active_tab link_url_trigger"><a href="#"data-tabid="#tab1"onclick="return false"hidefocus="true">\u53d1\u9001\u5206\u4eab\u94fe\u63a5</a> <li class="tab_trigger_li"><a href="#"data-tabid="#tab2"onclick="return false"hidefocus="true">\u5206\u4eab\u5230\u5fae\u535a\u3001\u793e\u533a</a> <li class="tab_trigger_li send_mail_trigger"><a href="#"data-tabid="#tab3"onclick="return false"hidefocus="true">\u53d1\u9001\u5230\u90ae\u7bb1\u3001\u624b\u673a</a> </ul> <span class="tab_arrow"></span> <ul class="tab_content_ul"> <li class="tab_content_li show_tab link_url"data-tabid="#tab1"> <p class="tips_of_content">\u6210\u529f\u751f\u6210\u5206\u4eab\u94fe\u63a5\uff0c\u590d\u5236\u4ee5\u4e0b\u94fe\u63a5\u53d1\u7ed9QQ\u3001\u98de\u4fe1\u597d\u53cb\u5427\uff01</p> <input type="text"value=""readonly> <div class="btns"> <div class="copy_link_box"><a href="###"class="copy_link"hidefocus="true"onclick="return false">\u590d\u5236\u94fe\u63a5</a></div> </div> <div class="tip down cp-link-tip"><div class="tip-arrow"></div><p class="cp-result"></p></div> <li class="tab_content_li share_to_sns"data-tabid="#tab2"> <p class="tips_of_content">\u5c06\u5df2\u751f\u6210\u7684\u5206\u4eab\u94fe\u63a5\u4e00\u952e\u53d1\u9001\u5230\uff1a</p> <div class="weibo-share btns clearfix"> <a target="_blank"href="###"hidefocus="true"class="sina">\u65b0\u6d6a\u5fae\u535a</a> <a target="_blank"href="###"hidefocus="true"class="tencent">\u817e\u8baf\u5fae\u535a</a> </div> <div class="other-share"> <span>\u5176\u5b83\uff1a</span> <a target="_blank"href="###"hidefocus="true"class="kaixin">\u5206\u4eab</a> <a target="_blank"href="###"hidefocus="true"class="douban">\u5206\u4eab</a> <a target="_blank"href="###"hidefocus="true"class="renren">\u5206\u4eab</a> <a target="_blank"href="###"hidefocus="true"class="qzone">\u5206\u4eab</a> </div> <li class="tab_content_li send_share"data-tabid="#tab3"> <p class="tips_of_content">\u5c06\u5df2\u751f\u6210\u7684\u5206\u4eab\u94fe\u63a5<strong>\u514d\u8d39</strong>\u53d1\u9001\u5230\uff1a</p> <div class="ctrl-count-tip tip"style="display:none">\u4e00\u6b21\u6700\u591a\u8f93\u516520\u9879\uff0c\u5206\u6210\u4e24\u6279\u5206\u4eab\u5427:)</div> <div class="mail-tip tip down"style="display:none"><div class="tip-arrow"></div>\u65e0\u6cd5\u8bc6\u522b\u8be5\u8d26\u53f7,\u5206\u4eab\u65e0\u6cd5\u53d1\u9001\u5230\u8be5\u5730\u5740</div> <div class="msg-limit-tip tip down"style="display:none"><div class="tip-arrow"></div>\u4eca\u65e5\u7d2f\u8ba1\u77ed\u4fe1\u5df2\u8fbe\u4e0a\u9650\uff08<span class="msg-total"></span>\u6761\uff09\uff0c\u5c06\u65e0\u6cd5\u53d1\u9001</div> <div class="mail-input"> <ul id="mailList"style="display:none"></ul> <input data-name="false"> <label class="placeholder">\u8bf7\u8f93\u5165\u90ae\u7bb1\u6216\u624b\u673a\u53f7\uff0c\u7528\u9017\u53f7\u3001\u5206\u53f7\u6216\u7a7a\u683c\u5206\u9694</label> </div> <div class="mail-content"> <div class="frame-arrow"></div> <p class="fix_content"> <span class="first-words">\u53d1\u9001\u5185\u5bb9\uff1a</span>\u6211\u901a\u8fc7360\u4e91\u76d8\u7ed9\u4f60\u5206\u4eab\u4e86<span class="file_name"></span>\uff0c\u67e5\u770b\u94fe\u63a5 <span class="linkurl"></span> <span class="ispassword"style="display:none">&nbsp;&nbsp;\u5bc6\u7801\uff1a<span></span></span> </p> <div class="add_content"> <div class="add_btn_box"><a class="add_btn"href="###">\u6dfb\u52a0\u9644\u8a00</a> \uff0864\u4e2a\u5b57\u4ee5\u5185\uff09</div> <div class="add_input_box clearfix"><label>\u8bf7\u8f93\u5165\u9644\u8a00\uff0864\u4e2a\u5b57\u4ee5\u5185\uff09</label><textarea></textarea><a class="ok_btn"href="###"onclick="return false"></a></div> <div class="add_content_finish"><span></span></div> </div> </div> <p class="msg-left-tip"style="display:none">\u6bcf\u65e5\u53ef\u53d1\u9001<span class="msg-total"></span>\u6761\u514d\u8d39\u77ed\u4fe1\uff0c\u8fd8\u5269<span class="msg-left"></span>\u6761</p> <div class="verify_code"><p class="vc-tip">hhh</p><div class="vc_content"><span>\u9a8c\u8bc1\u7801\uff1a</span><input type="text"><img src="/resource/img/blank.gif"><a class="refresh"href="###"onclick="return false">\u6362\u4e00\u4e2a</a></div></div> <a class="send-btn"href="###"hidefocus="true"onclick="return false">\u53d1\u9001</a> <div class="tip down add_err_tip"style="display:none"><div class="tip-arrow"></div><span>\u53d1\u9001\u5931\u8d25\uff0c\u9644\u8a00\u4e2d\u5305\u542b\u4e0d\u5b9c\u4f20\u64ad\u7684\u5185\u5bb9</span><a class="close_btn"href="###"></a></div> </ul> </div> <div class="others clearfix"> <div class="tip down pwd-tip"style="display:none"><div class="tip-arrow"></div><p>\u6587\u4ef6\u5f53\u524d\u53ef\u76f4\u63a5\u8bbf\u95ee\uff0c<br>\u52fe\u9009\u53ef\u542f\u7528\u6587\u4ef6\u8bbf\u95ee\u5bc6\u7801</p></div> <div class="tip down metion-tip"style="display:none"><div class="tip-arrow"></div><p>\u8bb0\u5f97\u628a\u8bbf\u95ee\u5bc6\u7801\u544a\u8bc9\u76f8\u5173\u597d\u53cb\u54e6</p></div> <div class="tip down cancel-pwd-tip"style="display:none"><div class="tip-arrow"></div><p>\u5df2\u53d6\u6d88\u8bbf\u95ee\u5bc6\u7801</p></div> <div class="tip down cp_pwd_tip"><div class="tip-arrow"></div><p class="cp-result"></p></div> <div class="btns"> <a href="###"class="goto_link"hidefocus="true"target="_blank">\u67e5\u770b\u5206\u4eab\u9875\u9762</a> <a href="###"class="cancel_share"hidefocus="true">\u53d6\u6d88\u5206\u4eab</a> <a href="###"class="ok_btn"onclick="return false"hidefocus="true">\u5173\u95ed</a> </div> </div> </div>'
,dialogStruct=["<div>",'<div class="content">','<p class="text"></p>','<div class="btns clearfix">','<a class="ok" href="###" onclick="return false;"></a>','<a class="no" href="###" onclick="return false;"></a>',"</div>",'<div class="add_element"></div>',"</div>",'<div class="bg"></div>','<span class="arrow"></span>',"</div>"].join(""),diaPosition={bg:"0",dia:"0"},clickBtns=!1,blurTextarea=!1;return{showLinkDia:showLinkDia,resetInput:resetInput,resetTextarea:resetTextarea,refreshVerifyCode:refreshVerifyCode,createPassword:createPassword,resetAddStatus:resetAddStatus}}()),yunpan.soGuide=function(){function u(){p(),W("body").undelegate("#imageScreen .close","click",u)}function a(){Ajax.post("/task/reward/",{task_id:612},function(){})}function f(e){for(var t=0,n=e.length;t<n;t++)e.item(t).attr("data-path")==i.path&&yunpan.fo.selectFile(e.item(t))}function l(){W("#fileList li").length?(f(W("#fileList li")),yunpan.cmdCenter.openItem()):setTimeout(l,100)}function c(){if(!t){var n=i.thumb;e=W('<div id="guideMask" tabindex="-1" unselectable="on"></div>'),t=W('<div id="guideClickTip"><div></div></div>'),r=W('<div id="guideThumbPic"><span class="ico img img-preview"><img src="/resource/img/blank.gif"/></span><span class="text"></span></div>'),r.query("img").css("background-image","url("+n+")");var s=i.fname.subByte(50,"\u2026").encode4Html();r.query(".text").html(s),r.query("img").on("dblclick",function(){t.hide(),r.hide(),e.hide(),clearInterval(o),l(),W("body").delegate("#imageScreen .close","click",u),monitor.clickLog("20130427-guidePreview")}),r.query(".text").on("click",function(){t.hide(),r.hide(),e.hide(),clearInterval(o),l(),W("body").delegate("#imageScreen .close","click",u),monitor.clickLog("20130427-guidePreview")}),e.appendTo(W("body")),r.appendTo(W("body")),t.appendTo(W("body"))}setTimeout(function(){var n=166,i=206,s=122,u=145;W(".pluginTip_non_first").length&&W(".pluginTip_non_first").isVisible()&&(n=190);if(W("#fileList li").length){var a=W("#fileList li").item(0).getRect();n=a.top,i=a.left,s=a.width,u=a.height}r.css({top:n+"px",left:i+"px"}),t.css({top:n+75+"px",left:i+101+"px"}),r.show(),t.show(),e.show(),QW.Browser.ie6&&(h(e),clearInterval(o),o=setInterval(h,1e3))},1e3)}function h(){var t=e[0].offsetParent,n=document.documentElement,r=e[0].style;if(parseInt(r.top)!=t.scrollTop||parseInt(r.left)!=t.scrollLeft)r.top=t.scrollTop,r.left=t.scrollLeft;n.clientHeight!=e[0].offsetHeight&&(r.height=n.clientHeight),n.clientWidth!=e[0].offsetWidth&&(r.width=n.clientWidth)}function p(){n||(n=W('<div id="guideQucDlTip"><div></div><a href="###" onclick="return false;" class="close"></a><a class="qucdl-btn" href="http://down.360safe.com/yunpan/360yunpan_web.exe" target="_self">\u7acb\u5373\u5b89\u88c5</a></div>'),s=W('<div id="guideQucDlBtn"><a title="\u684c\u9762\u5feb\u6377\u65b9\u5f0f\u4e0b\u8f7d" href="http://down.360safe.com/yunpan/360yunpan_web.exe" target="_self"></a></div>'),n.appendTo(W("body")),s.appendTo(W("body")),n.query(".close").on("click",function(){n.hide(),s.hide(),e.hide(),clearInterval(o)}),n.query(".qucdl-btn").on("click",function(){n.hide(),s.hide(),e.hide(),clearInterval(o),monitor.clickLog("20130427-\u684c\u9762\u5feb\u6377\u65b9\u5f0f")}),s.query("a").on("click",function(){n.hide(),s.hide(),e.hide(),clearInterval(o),monitor.clickLog("20130427-\u684c\u9762\u5feb\u6377\u65b9\u5f0f")}));var t=W("#leftPanel .quc-desktop").getRect(),r=t.top,i=t.left,u=t.width,a=t.height;n.css({bottom:Dom.getDocRect().height-r-20+"px",left:i+u+30+"px"}),s.css({bottom:Dom.getDocRect().height-r-a-5+"px",left:i-26+"px"}),n.show(),s.show(),e.show(),QW.Browser.ie6&&(h(e),clearInterval(o),o=setInterval(h,1e3))}var e,t,n,r,i,s,o=0;Dom.ready(function(){i=SYS_CONF.firstImageFile,i.path&&location.href.queryUrl("from")=="soimage"&&(yunpan.upload.noPluginTip.flag=!0,W("#pluginTip").hide(),yunpan.filelist.listtype==1&&(yunpan.fo.init(),yunpan.cmdCenter.changeListType(W("#toolbar .pic"))),yunpan.freshGuide=!0,c()),setTimeout(function(){var e=document.referrer,t=new RegExp(/image.so.com/);if(t.test(e)){var n="false",r=new RegExp(/from=soimage/);r.test(location.search)&&(n="true"),monitor.tlog({qid:SYS_CONF.qid,m:"soSaveImage",a:"20130427-fromSoImageUser",s:n})}},3e3)})}(),namespace("yunpan.group"),yunpan.group=Object.mix(yunpan.group||{},function(){function t(){e&&(clearTimeout(e),e=null);var t=W("#groupMore");t.show();var n=W("#group .more").getRect(),r=W("#groupMore").getRect(),i=Dom.getDocRect(),s=0;n.top+r.height<i.height?s=n.top:s=i.height-r.height,W("#groupMore").css("top",s+"px"),W("#group .more").addClass("hover")}function n(){W("#groupMore").hide(),W("#group .more").removeClass("hover")}function r(){e&&clearTimeout(e),e=setTimeout(n,100)}function i(e){var t="";return t=e>99?"99+":e.toString(),t}function o(e){if(!window.groupInfoList)return;if(groupInfoList.length<=0&&!isQualified)return;var t=W("#group .group-title").getRect().bottom,n=W("#leftPanel .clients-download").getRect().top,r=Math.floor((n-t)/35),o=groupInfoList.length,u="",a=0;if(r>0){r-=3;if(r>0){var f=0,l=!1;o<=r?f=o:(f=r-1,l=!0);for(var c=0;c<f;c++){var h=groupInfoList[c],p="",d="",v=window.update_file_num[h.gid]||0;if(v>0){var m=i(v);p="<span class='update_file_num'>"+m+"</span>",d=" has-update",a++}u+='<li class="group-item'+d+'" data-gid="'+h.gid+'"><a href="'+h.url+'"><span class="group-name">'+h.name.encode4Html()+"</span>"+p+"</a></li>"}var g="",y=0,b="",w="";for(var c=f;c<o;c++){var h=groupInfoList[c],p="",d="",v=window.update_file_num[h.gid]||0;if(v>0){var m=i(v);p="<span class='update_file_num'>"+m+"</span>",d=" has-update",a++}y+=parseInt(v),g+='<li class="group-item'+d+'" data-gid="'+h.gid+'"><a href="'+h.url+'"><span class="group-name">'+h.name.encode4Html()+"</span>"+p+"</a></li>"}if(y>0){var m=i(y);b="<span class='update_file_num'>"+m+"</span>",w=" has-update"}l&&(u+='<li class="more group-item'+w+'"><a href="###" onclick="return false;"><span class="group-name"></span>'+b+"</a></li>"),W("#groupMore ul").html(g),s||(monitor.tlog({qid:SYS_CONF.qid,m:"showGroupList",a:"20130725-\u7fa4\u6d88\u606f\u51fa\u73b0\u4e2a\u6570",n:a}),s=!0)}}o>0&&(u+='<span class="line"></span><li class="hot-title-box"><a class="hot-title" href="'+window.hotGroupUrl+'">\u70ed\u95e8\u5171\u4eab\u7fa4</a></li>'),u+='<li class="create-find">',window.isQualified?window.isCanCreate?u+='<a class="create" onclick="return false;" href="#">\u521b\u5efa</a>':u+='<a class="create-invalid" title="\u60a8\u5df2\u521b\u5efa\u4e00\u4e2a\u7fa4\uff0c\u8fbe\u5efa\u7fa4\u4e0a\u9650" onclick="return false;" href="#">\u521b\u5efa</a>':u+='<a class="create-get" href="http://qun.yunpan.360.cn/activity/">\u83b7\u5efa\u7fa4\u8d44\u683c</a>',u+='&nbsp;|&nbsp;<a class="find" onclick="return false;" href="#">\u67e5\u627e</a></li>',W("#group ul").html(u),e&&typeof e=="function"&&e()}function u(e){if(e.errno==0){window.groupInfoList=e.data.group_list,window.groupListUrl=e.data.group_list_url,window.isCanCreate=e.data.is_can_create_group,window.isQualified=e.data.is_qualified,window.hotGroupUrl=e.data.hot_groups_url;if(!window.isQualified&&window.groupInfoList&&window.groupInfoList.length<=0){f(!1);return}W("#group .group-title").attr("href",e.data.group_list_url);var t=W("#leftPanel .menu-global").getRect();W("#group").css({top:t.height+5+"px",display:"block"}),o(yunpan.group.getUpdateNum),f(!0)}}function a(){W("#group").delegate(".more","mouseenter",t).delegate(".more","mouseleave",r).delegate(".create","click",function(){location.href=window.groupListUrl+"/?op=create"}).delegate(".find","click",function(){location.href=window.groupListUrl+"/?op=find"}),W("#groupMore").on("mouseenter",t).on("mouseleave",r),loadJs(ypDomain.qun+"/group/grouplist?cross_domain_callback=yunpan.group.showList")}function f(e){var t="http://qun.yunpan.360.cn/statistics/index?qid="+SYS_CONF.qid+"&sid="+(e?"is_group_user":"not_group_user")+"&_t="+Math.random(),n=new Image;n.src=t}window.update_file_num={};var e,s=!1;return{initGroup:a,relayout:o,showList:u}}()),yunpan.group=Object.mix(yunpan.group,function(){function n(){e={},t=[];var n=W("#leftPanel .group-item"),r=W("#groupMore .group-item");for(var i=0,s=n.length;i<s;i++){var o=n.item(i),u=o.attr("data-gid");if(o.hasClass("more"))continue;e[u]=o}for(var i=0,s=r.length;i<s;i++){var o=r.item(i),u=o.attr("data-gid");t.push(o),e[u]=o}}function r(e){var t="";return t=e>99?"99+":e.toString(),t}function i(i){n();if(!i||!i.data)return;var s=i.data.update_file_num_list||[];if(s.length){for(var o=0,u=s.length;o<u;o++){var a=s[o].gid,f=s[o].update_file_num,l=e[a],c="",h="";window.update_file_num[a]=f;if(!l||!l.length)continue;if(f>0)l.attr("data-num",f),c=f>99?"99+":f.toString(),h="<span class='update_file_num'>"+c+"</span>",l.query(".update_file_num").length?l.query(".update_file_num").html(c):(l.addClass("has-update"),W(h).appendTo(l.query("a")));else try{l.attr("data-num",0),l.removeClass("has-update"),l.query(".update_file_num").removeNode()}catch(p){}}var d=0;for(var o=0,u=t.length;o<u;o++){var l=t[o];d+=parseInt(l.attr("data-num"))}var v=W("#group .more");if(!v.length)return;if(d>0){v.attr("data-num",d);var c=r(d),h="<span class='update_file_num'>"+c+"</span>";v.query(".update_file_num").length?v.query(".update_file_num").html(c):(v.addClass("has-update"),W(h).appendTo(v.query("a")))}else try{v.attr("data-num",0),v.removeClass("has-update"),v.query(".update_file_num").removeNode()}catch(p){}}}function s(){if(!window.update_num_switch)return;loadJs(ypDomain.qun+"/file/getFileUpdateCount?cross_domain_callback=yunpan.group.updateNum"),setTimeout(s,6e5)}window.update_num_switch=!0;var e={},t=[];return{getUpdateNum:s,updateNum:i}}()),namespace("yunpan.video"),yunpan.video.config={CLASSID_PLUGIN:"F3D0D36F-23F8-4682-A195-74C92B03D4AF",VIDEO_FAKEURL:"http://yunpan.360.cn/videoplayer",PLUGIN_TYPE:{mov:1,mp4:1,rmvb:1,wmv:1,rm:1,mpg:1,avi:1,flv:1,mpeg:1,mkv:1,webm:1,"3gp":1,"3g2":1,"3gp2":1,"3gpp":1},SE_TYPE:{rmvb:1,rm:1,flv:1,f4v:1,mkv:1,mp4:1,mov:1,m4v:1,"3gp":1,avi:1},FLASH_TYPE:{mp4:1,flv:1,f4v:1},VIDEO_TYPE:["mov","mp4","rmvb","wmv","rm","mpg","avi","flv","mpeg","mkv","webm","f4v","3gp","3g2","3gp2","3gpp"],PLAY_URL:"/videoPlayer/index"},Object.mix(yunpan.video,{idGen:function(){var e=0;return function(){return"YPVideo_"+ ++e}}(),detectQvodHttp:function(){if(/^win/i.test(Browser.platform))try{external.AppCmd(external.GetSID(window),"ExtVideoAssis","CanOpenVideoPage","","",function(e){e&&(window.vCanPlayQvodHttp=!0)})}catch(e){}},detectFlash:function(){var e=yunpan.util.getSwfVersion();if(e&&parseFloat(e)>=9)return!0},detectPlugin:function(){if(/^win/i.test(Browser.platform))try{var e,t,n=W('<div style="width:0;height:0;overflow:hidden;"></div>').insertTo("beforeend",document.body),r="Qvod";Browser.ie&&Browser.ie>=6?e=W('<OBJECT ID="'+r+'" CLASSID="clsid:'+yunpan.video.config.CLASSID_PLUGIN+'" HEIGHT="0" WIDTH="0"></OBJECT>'):(e=W("<object></object>"),e.attr({type:"application/qvod-plugin",id:r})),e.insertTo("beforeend",n);var i=window[r];t=i.Version;if(parseFloat(t)>=4.2)return n.removeNode(),!0;n.removeNode()}catch(s){n.removeNode()}},isVideo:function(e){if(yunpan.filelist&&yunpan.filelist.curFunc&&yunpan.filelist.curFunc=="recycle")return!1;if(/^win/i.test(Browser.platform)){if(yunpan.video.config.VIDEO_TYPE.indexOf(e)>=0)return!0}else if(yunpan.video.config.FLASH_TYPE[e])return!0},isPlayBySe:function(e){return!1},isPlayByFlash:function(e){var t=yunpan.video.detectFlash();if(t&&yunpan.video.config.FLASH_TYPE[e]>=0)return!0},isPlayByQvod:function(e){if(/^win/i.test(Browser.platform)){var t=yunpan.video.detectPlugin();if(t&&yunpan.video.config.PLUGIN_TYPE[e]>=0)return!0}},play:function(e){new yunpan.video.Player(e)}}),yunpan.video.Player=function(e){this.player=e.player,this.nid=e.nid,this.domain=e.domain?"http://"+e.domain:"",this.play(e)},yunpan.video.Player.prototype={play:function(e){if(this.player=="se")this.initSe(e);else{var t=this.domain+yunpan.video.config.PLAY_URL+"?nid="+encodeURIComponent(this.nid)+"&type="+e.type;e.shorturl&&(t+="&shorturl="+e.shorturl),window.open(t)}}},Dom.ready(function(){yunpan.video.detectQvodHttp()}),Object.mix(yunpan.video.Player.prototype,{getUrl:function(e){var t=this;Ajax.post("/videoPlayer/ajaxGetVideoUrl",{nid:e.nid,type:e.type},function(e){try{e=e.evalExp(),e.errno||t.sePlayVideo(e.data)}catch(n){throw new Error("YP:se getUrl, '/videoPlayer/ajaxGetVideoUrl' "+n.message)}})},initSe:function(e){try{if(!window.vCanPlayQvodHttp){var t=this;external.AppCmd(external.GetSID(window),"ExtVideoAssis","CanPlayQvodHttp","","",function(n){window.vCanPlayQvodHttp=!0,t.getUrl(e)})}else this.getUrl(e)}catch(n){}},sePlayVideo:function(e){if(window.vCanPlayQvodHttp){var t="gqv="+encodeURIComponent(e.video_url)+"&qvt="+encodeURIComponent(e.file_name)+"&fakeurl="+encodeURIComponent("http://yunpan.360.cn/videoPlayer")+"&ref=yunpan.360.cn";external.AppCmd(external.GetSID(window),"ExtVideoAssis","OpenVideoPage",t,"",function(e){})}}});var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-37860337-1"]),_gaq.push(["_setDomainName","360.cn"]),_gaq.push(["_setAllowLinker",!0]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();